{"mappings":"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","sources":["src/js/mavo-uncompressed.js"],"sourcesContent":["!function(){\"use strict\";function t(e,n,i){return n=void 0===n?1:n,i=i||n+1,i-n<=1?function(){if(arguments.length<=n||\"string\"===r.type(arguments[n]))return e.apply(this,arguments);var t,i=arguments[n];for(var o in i){var s=Array.prototype.slice.call(arguments);s.splice(n,1,o,i[o]),t=e.apply(this,s)}return t}:t(t(e,n+1,i),n,i-1)}function e(t,r,i){var o=n(i);if(\"string\"===o){var s=Object.getOwnPropertyDescriptor(r,i);!s||s.writable&&s.configurable&&s.enumerable&&!s.get&&!s.set?t[i]=r[i]:(delete t[i],Object.defineProperty(t,i,s))}else if(\"array\"===o)i.forEach(function(n){n in r&&e(t,r,n)});else for(var a in r)i&&(\"regexp\"===o&&!i.test(a)||\"function\"===o&&!i.call(r,a))||e(t,r,a);return t}function n(t){if(null===t)return\"null\";if(void 0===t)return\"undefined\";var e=(Object.prototype.toString.call(t).match(/^\\[object\\s+(.*?)\\]$/)[1]||\"\").toLowerCase();return\"number\"==e&&isNaN(t)?\"nan\":e}var r=self.Bliss=e(function(t,e){return 2==arguments.length&&!e||!t?null:\"string\"===r.type(t)?(e||document).querySelector(t):t||null},self.Bliss);e(r,{extend:e,overload:t,type:n,property:r.property||\"_\",listeners:self.WeakMap?new WeakMap:new Map,original:{addEventListener:(self.EventTarget||Node).prototype.addEventListener,removeEventListener:(self.EventTarget||Node).prototype.removeEventListener},sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:2!=arguments.length||e?Array.prototype.slice.call(\"string\"==typeof t?(e||document).querySelectorAll(t):t||[]):[]},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]},create:function(t,e){return t instanceof Node?r.set(t,e):(1===arguments.length&&(\"string\"===r.type(t)?e={}:(e=t,t=e.tag,e=r.extend({},e,function(t){return\"tag\"!==t}))),r.set(document.createElement(t||\"div\"),e))},each:function(t,e,n){n=n||{};for(var r in t)n[r]=e.call(t,r,t[r]);return n},ready:function(t,e,n){if(\"function\"!=typeof t||e||(e=t,t=void 0),t=t||document,e&&(\"loading\"!==t.readyState?e():r.once(t,\"DOMContentLoaded\",function(){e()})),!n)return new Promise(function(e){r.ready(t,e,!0)})},Class:function(t){var e,n=[\"constructor\",\"extends\",\"abstract\",\"static\"].concat(Object.keys(r.classProps)),i=t.hasOwnProperty(\"constructor\")?t.constructor:r.noop;2==arguments.length?(e=arguments[0],t=arguments[1]):(e=function(){if(this.constructor.__abstract&&this.constructor===e)throw new Error(\"Abstract classes cannot be directly instantiated.\");e[\"super\"]&&e[\"super\"].apply(this,arguments),i.apply(this,arguments)},e[\"super\"]=t[\"extends\"]||null,e.prototype=r.extend(Object.create(e[\"super\"]?e[\"super\"].prototype:Object),{constructor:e}),e.prototype[\"super\"]=e[\"super\"]?e[\"super\"].prototype:null,e.__abstract=!!t[\"abstract\"]);var o=function(t){return this.hasOwnProperty(t)&&n.indexOf(t)===-1};if(t[\"static\"]){r.extend(e,t[\"static\"],o);for(var s in r.classProps)s in t[\"static\"]&&r.classProps[s](e,t[\"static\"][s])}r.extend(e.prototype,t,o);for(var s in r.classProps)s in t&&r.classProps[s](e.prototype,t[s]);return e},classProps:{lazy:t(function(t,e,n){return Object.defineProperty(t,e,{get:function(){var t=n.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},set:function(t){Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,n){return\"function\"===r.type(n)&&(n={set:n}),Object.defineProperty(t,e,{get:function(){var t=this[\"_\"+e],r=n.get&&n.get.call(this,t);return void 0!==r?r:t},set:function(t){var r=this[\"_\"+e],i=n.set&&n.set.call(this,t,r);this[\"_\"+e]=void 0!==i?i:t},configurable:n.configurable,enumerable:n.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length&&arguments[0],n=document.createElement(\"script\");return e?Promise.resolve():new Promise(function(e,i){r.set(n,{async:!0,onload:function(){e(n),n.parentNode&&n.parentNode.removeChild(n)},onerror:function(){i(n)},src:t,inside:document.head})})},load:function o(t,e){e=e?new URL(e,location.href):location.href,t=new URL(t,e);var n=o.loading=o.loading||{};return n[t+\"\"]?n[t+\"\"]:/\\.css$/.test(t.pathname)?n[t+\"\"]=new Promise(function(e,n){var i=r.create(\"link\",{href:t,rel:\"stylesheet\",inside:document.head,onload:function(){e(i)},onerror:function(){n(i)}})}):n[t+\"\"]=r.include(t)},fetch:function(t,n){if(!t)throw new TypeError(\"URL parameter is mandatory and cannot be \"+t);var i=e({url:new URL(t,location),data:\"\",method:\"GET\",headers:{},xhr:new XMLHttpRequest},n);i.method=i.method.toUpperCase(),r.hooks.run(\"fetch-args\",i),\"GET\"===i.method&&i.data&&(i.url.search+=i.data),document.body.setAttribute(\"data-loading\",i.url),i.xhr.open(i.method,i.url.href,i.async!==!1,i.user,i.password);for(var o in n)if(\"upload\"===o)i.xhr.upload&&\"object\"==typeof n[o]&&r.extend(i.xhr.upload,n[o]);else if(o in i.xhr)try{i.xhr[o]=n[o]}catch(s){self.console&&console.error(s)}var a=Object.keys(i.headers).map(function(t){return t.toLowerCase()});\"GET\"!==i.method&&a.indexOf(\"content-type\")===-1&&i.xhr.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");for(var c in i.headers)void 0!==i.headers[c]&&i.xhr.setRequestHeader(c,i.headers[c]);var u=new Promise(function(t,e){i.xhr.onload=function(){document.body.removeAttribute(\"data-loading\"),0===i.xhr.status||i.xhr.status>=200&&i.xhr.status<300||304===i.xhr.status?t(i.xhr):e(r.extend(Error(i.xhr.statusText),{xhr:i.xhr,get status(){return this.xhr.status}}))},i.xhr.onerror=function(){document.body.removeAttribute(\"data-loading\"),e(r.extend(Error(\"Network Error\"),{xhr:i.xhr}))},i.xhr.ontimeout=function(){document.body.removeAttribute(\"data-loading\"),e(r.extend(Error(\"Network Timeout\"),{xhr:i.xhr}))},i.xhr.send(\"GET\"===i.method?null:i.data)});return u.xhr=i.xhr,u},value:function(t){var e=\"string\"!=typeof t;return r.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),r.Hooks=new r.Class({add:function(t,e,n){if(\"string\"==typeof arguments[0])(Array.isArray(t)?t:[t]).forEach(function(t){this[t]=this[t]||[],e&&this[t][n?\"unshift\":\"push\"](e)},this);else for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1])},run:function(t,e){this[t]=this[t]||[],this[t].forEach(function(t){t.call(e&&e.context?e.context:e,e)})}}),r.hooks=new r.Hooks;r.property;r.Element=function(t){this.subject=t,this.data={},this.bliss={}},r.Element.prototype={set:t(function(t,e){t in r.setProps?r.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return new Promise(function(n,i){if(\"transition\"in this.style&&0!==e){var o=r.extend({},this.style,/^transition(Duration|Property)$/);r.style(this,{transitionDuration:(e||400)+\"ms\",transitionProperty:Object.keys(t).join(\", \")}),r.once(this,\"transitionend\",function(){clearTimeout(s),r.style(this,o),n(this)});var s=setTimeout(n,e+50,this);r.style(this,t)}else r.style(this,t),n(this)}.bind(this))},fire:function(t,e){var n=document.createEvent(\"HTMLEvents\");return n.initEvent(t,!0,!0),this.dispatchEvent(r.extend(n,e))},bind:t(function(t,e){if(arguments.length>1&&(\"function\"===r.type(e)||e.handleEvent)){var n=e;e=\"object\"===r.type(arguments[2])?arguments[2]:{capture:!!arguments[2]},e.callback=n}var i=r.listeners.get(this)||{};t.trim().split(/\\s+/).forEach(function(t){if(t.indexOf(\".\")>-1){t=t.split(\".\");var n=t[1];t=t[0]}i[t]=i[t]||[],0===i[t].filter(function(t){return t.callback===e.callback&&t.capture==e.capture}).length&&i[t].push(r.extend({className:n},e)),r.original.addEventListener.call(this,t,e.callback,e)},this),r.listeners.set(this,i)},0),unbind:t(function(t,e){if(e&&(\"function\"===r.type(e)||e.handleEvent)){var n=e;e=arguments[2]}\"boolean\"==r.type(e)&&(e={capture:e}),e=e||{},e.callback=e.callback||n;var i=r.listeners.get(this);(t||\"\").trim().split(/\\s+/).forEach(function(t){if(t.indexOf(\".\")>-1){t=t.split(\".\");var n=t[1];t=t[0]}if(i){for(var o in i)if(!t||o===t)for(var s,a=0;s=i[o][a];a++)n&&n!==s.className||e.callback&&e.callback!==s.callback||!!e.capture!=!!s.capture&&(t||e.callback||void 0!==e.capture)||(i[o].splice(a,1),r.original.removeEventListener.call(this,o,s.callback,s.capture),a--)}else if(t&&e.callback)return r.original.removeEventListener.call(this,t,e.callback,e.capture)},this)},0),when:function(t,e){var n=this;return new Promise(function(r){n.addEventListener(t,function i(n){e&&!e.call(this,n)||(this.removeEventListener(t,i),r(n))})})},toggleAttribute:function(t,e,n){arguments.length<3&&(n=null!==e),n?this.setAttribute(t,e):this.removeAttribute(t)}},r.setProps={style:function(t){for(var e in t)e in this.style?this.style[e]=t[e]:this.style.setProperty(e,t[e])},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){r.extend(this,t)},events:function(t){if(1!=arguments.length||!t||!t.addEventListener)return r.bind.apply(this,[this].concat(r.$(arguments)));var e=this;if(r.listeners){var n=r.listeners.get(t);for(var i in n)n[i].forEach(function(t){r.bind(e,i,t.callback,t.capture)})}for(var o in t)0===o.indexOf(\"on\")&&(this[o]=t[o])},once:t(function(t,e){var n=this,i=function(){return r.unbind(n,t,i),e.apply(n,arguments)};r.bind(this,t,i,{once:!0})},0),delegate:t(function(t,e,n){r.bind(this,t,function(t){t.target.closest(e)&&n.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=r.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+\"\"):\"object\"===e&&(t=r.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t&&t.appendChild(this)},before:function(t){t&&t.parentNode.insertBefore(this,t)},after:function(t){t&&t.parentNode.insertBefore(this,t.nextSibling)},start:function(t){t&&t.insertBefore(this,t.firstChild)},around:function(t){t&&t.parentNode&&r.before(this,t),this.appendChild(t)}},r.Array=function(t){this.subject=t},r.Array.prototype={all:function(t){var e=r.$(arguments).slice(1);return this[t].apply(this,e)}},r.add=t(function(t,e,n,i){n=r.extend({$:!0,element:!0,array:!0},n),\"function\"==r.type(e)&&(!n.element||t in r.Element.prototype&&i||(r.Element.prototype[t]=function(){return this.subject&&r.defined(e.apply(this.subject,arguments),this.subject)}),!n.array||t in r.Array.prototype&&i||(r.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(n){return n&&r.defined(e.apply(n,t),n)})}),n.$&&(r.sources[t]=r[t]=e,(n.array||n.element)&&(r[t]=function(){var e=[].slice.apply(arguments),i=e.shift(),o=n.array&&Array.isArray(i)?\"Array\":\"Element\";return r[o].prototype[t].apply({subject:i},e)})))},0),r.add(r.Array.prototype,{element:!1}),r.add(r.Element.prototype),r.add(r.setProps),r.add(r.classProps,{element:!1,array:!1});var i=document.createElement(\"_\");r.add(r.extend({},HTMLElement.prototype,function(t){return\"function\"===r.type(i[t])}),null,!0)}();\n/* jsep v0.3.4 (http://jsep.from.so/) */\n!function(e){\"use strict\";var C=\"Compound\",U=\"MemberExpression\",w=\"Literal\",k=function(e,r){var t=new Error(e+\" at character \"+r);throw t.index=r,t.description=e,t},O={\"-\":!0,\"!\":!0,\"~\":!0,\"+\":!0},S={\"||\":1,\"&&\":2,\"|\":3,\"^\":4,\"&\":5,\"==\":6,\"!=\":6,\"===\":6,\"!==\":6,\"<\":7,\">\":7,\"<=\":7,\">=\":7,\"<<\":8,\">>\":8,\">>>\":8,\"+\":9,\"-\":9,\"*\":10,\"/\":10,\"%\":10},r=function(e){var r,t=0;for(var n in e)(r=n.length)>t&&e.hasOwnProperty(n)&&(t=r);return t},j=r(O),A=r(S),P={true:!0,false:!1,null:null},L=function(e){return S[e]||0},B=function(e,r,t){return{type:\"||\"===e||\"&&\"===e?\"LogicalExpression\":\"BinaryExpression\",operator:e,left:r,right:t}},M=function(e){return 48<=e&&e<=57},q=function(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||128<=e&&!S[String.fromCharCode(e)]},J=function(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||128<=e&&!S[String.fromCharCode(e)]},t=function(n){for(var e,r,p=0,t=n.charAt,o=n.charCodeAt,i=function(e){return t.call(n,e)},u=function(e){return o.call(n,e)},s=n.length,f=function(){for(var e=u(p);32===e||9===e||10===e||13===e;)e=u(++p)},c=function(){var e,r,t=a();return f(),63!==u(p)?t:(p++,(e=c())||k(\"Expected expression\",p),f(),58===u(p)?(p++,(r=c())||k(\"Expected expression\",p),{type:\"ConditionalExpression\",test:t,consequent:e,alternate:r}):void k(\"Expected :\",p))},l=function(){f();for(var e=n.substr(p,A),r=e.length;0<r;){if(S.hasOwnProperty(e)&&(!q(u(p))||p+e.length<n.length&&!J(u(p+e.length))))return p+=r,e;e=e.substr(0,--r)}return!1},a=function(){var e,r,t,n,o,i,a,u,s;if(i=h(),!(r=l()))return i;for(o={value:r,prec:L(r)},(a=h())||k(\"Expected expression after \"+r,p),n=[i,o,a];(r=l())&&0!==(t=L(r));){for(o={value:r,prec:t},s=r;2<n.length&&t<=n[n.length-2].prec;)a=n.pop(),r=n.pop().value,i=n.pop(),e=B(r,i,a),n.push(e);(e=h())||k(\"Expected expression after \"+s,p),n.push(o,e)}for(e=n[u=n.length-1];1<u;)e=B(n[u-1].value,n[u-2],e),u-=2;return e},h=function(){var e,r,t;if(f(),e=u(p),M(e)||46===e)return d();if(39===e||34===e)return v();if(91===e)return b();for(t=(r=n.substr(p,j)).length;0<t;){if(O.hasOwnProperty(r)&&(!q(u(p))||p+r.length<n.length&&!J(u(p+r.length))))return p+=t,{type:\"UnaryExpression\",operator:r,argument:h(),prefix:!0};r=r.substr(0,--t)}return!(!q(e)&&40!==e)&&g()},d=function(){for(var e,r,t=\"\";M(u(p));)t+=i(p++);if(46===u(p))for(t+=i(p++);M(u(p));)t+=i(p++);if(\"e\"===(e=i(p))||\"E\"===e){for(t+=i(p++),\"+\"!==(e=i(p))&&\"-\"!==e||(t+=i(p++));M(u(p));)t+=i(p++);M(u(p-1))||k(\"Expected exponent (\"+t+i(p)+\")\",p)}return r=u(p),q(r)?k(\"Variable names cannot start with a number (\"+t+i(p)+\")\",p):46===r&&k(\"Unexpected period\",p),{type:w,value:parseFloat(t),raw:t}},v=function(){for(var e,r=\"\",t=i(p++),n=!1;p<s;){if((e=i(p++))===t){n=!0;break}if(\"\\\\\"===e)switch(e=i(p++)){case\"n\":r+=\"\\n\";break;case\"r\":r+=\"\\r\";break;case\"t\":r+=\"\\t\";break;case\"b\":r+=\"\\b\";break;case\"f\":r+=\"\\f\";break;case\"v\":r+=\"\\v\";break;default:r+=e}else r+=e}return n||k('Unclosed quote after \"'+r+'\"',p),{type:w,value:r,raw:t+r+t}},x=function(){var e,r=u(p),t=p;for(q(r)?p++:k(\"Unexpected \"+i(p),p);p<s&&(r=u(p),J(r));)p++;return e=n.slice(t,p),P.hasOwnProperty(e)?{type:w,value:P[e],raw:e}:\"this\"===e?{type:\"ThisExpression\"}:{type:\"Identifier\",name:e}},y=function(e){for(var r,t,n=[],o=!1,i=0;p<s;){if(f(),(r=u(p))===e){o=!0,p++,41===e&&i&&i>=n.length&&k(\"Unexpected token \"+String.fromCharCode(e),p);break}if(44===r){if(p++,++i!==n.length)if(41===e)k(\"Unexpected token ,\",p);else if(93===e)for(var a=n.length;a<i;a++)n.push(null)}else(t=c())&&t.type!==C||k(\"Expected comma\",p),n.push(t)}return o||k(\"Expected \"+String.fromCharCode(e),p),n},g=function(){var e,r;for(r=40===(e=u(p))?m():x(),f(),e=u(p);46===e||91===e||40===e;)p++,46===e?(f(),r={type:U,computed:!1,object:r,property:x()}):91===e?(r={type:U,computed:!0,object:r,property:c()},f(),93!==(e=u(p))&&k(\"Unclosed [\",p),p++):40===e&&(r={type:\"CallExpression\",arguments:y(41),callee:r}),f(),e=u(p);return r},m=function(){p++;var e=c();if(f(),41===u(p))return p++,e;k(\"Unclosed (\",p)},b=function(){return p++,{type:\"ArrayExpression\",elements:y(93)}},E=[];p<s;)59===(e=u(p))||44===e?p++:(r=c())?E.push(r):p<s&&k('Unexpected \"'+i(p)+'\"',p);return 1===E.length?E[0]:{type:C,body:E}};if(t.version=\"0.3.4\",t.toString=function(){return\"JavaScript Expression Parser (JSEP) v\"+t.version},t.addUnaryOp=function(e){return j=Math.max(e.length,j),O[e]=!0,this},t.addBinaryOp=function(e,r){return A=Math.max(e.length,A),S[e]=r,this},t.addLiteral=function(e,r){return P[e]=r,this},t.removeUnaryOp=function(e){return delete O[e],e.length===j&&(j=r(O)),this},t.removeAllUnaryOps=function(){return O={},j=0,this},t.removeBinaryOp=function(e){return delete S[e],e.length===A&&(A=r(S)),this},t.removeAllBinaryOps=function(){return S={},A=0,this},t.removeLiteral=function(e){return delete P[e],this},t.removeAllLiterals=function(){return P={},this},\"undefined\"==typeof exports){var n=e.jsep;(e.jsep=t).noConflict=function(){return e.jsep===t&&(e.jsep=n),t}}else\"undefined\"!=typeof module&&module.exports?exports=module.exports=t:exports.parse=t}(this);\n//# sourceMappingURL=jsep.min.js.map\n!function(){if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)){var p=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type=\"'+\"text number url email tel\".split(\" \").join('\"], input[type=\"')+'\"]',filter:\"*\"},script:document.currentScript||t(\"script\").pop(),resize:function(e){if(p.resizes(e)){var t,i=getComputedStyle(e),n=0;!e.value&&e.placeholder&&(t=!0,e.value=e.placeholder);var o=e.nodeName.toLowerCase();if(\"textarea\"==o)e.style.height=\"0\",\"border-box\"==i.boxSizing?n=e.offsetHeight:\"content-box\"==i.boxSizing&&(n=-e.clientHeight+parseFloat(i.minHeight)),e.style.height=e.scrollHeight+n+\"px\";else if(\"input\"==o)if(e.style.width=\"1000px\",e.offsetWidth){e.style.width=\"0\",\n\"border-box\"==i.boxSizing?n=e.offsetWidth:\"padding-box\"==i.boxSizing?n=e.clientWidth:\"content-box\"==i.boxSizing&&(n=parseFloat(i.minWidth));var r=Math.max(n,e.scrollWidth-e.clientWidth);e.style.width=r+\"px\";for(var l=0;l<10&&(e.scrollLeft=1e10,0!=e.scrollLeft);l++)r+=e.scrollLeft,e.style.width=r+\"px\"}else e.style.width=e.value.length+1+\"ch\";else if(\"select\"==o){var s,c=0<e.selectedIndex?e.selectedIndex:0,a=document.createElement(\"_\");for(var d in a.textContent=e.options[c].textContent,e.parentNode.insertBefore(a,e.nextSibling),i){var h=i[d];/^(width|webkitLogicalWidth|length)$/.test(d)||\"string\"!=typeof h||(a.style[d]=h,/appearance$/i.test(d)&&(s=d))}a.style.width=\"\",0<a.offsetWidth&&(e.style.width=a.offsetWidth+\"px\",i[s]&&\"none\"===i[s]||(e.style.width=\"calc(\"+e.style.width+\" + 2em)\")),a.parentNode.removeChild(a),a=null}t&&(e.value=\"\")}},resizeAll:function(e){t(e||p.selectors.base).forEach(function(e){p.resize(e)})},active:!0,resizes:function(e){\nreturn e&&e.parentNode&&e.matches&&e.matches(p.selectors.base)&&e.matches(p.selectors.filter)},init:function(){p.selectors.filter=p.script.getAttribute(\"data-filter\")||(t(\"[data-stretchy-filter]\").pop()||document.body).getAttribute(\"data-stretchy-filter\")||p.selectors.filter,p.resizeAll(),self.MutationObserver&&!p.observer&&(p.observer=new MutationObserver(function(e){p.active&&e.forEach(function(e){\"childList\"==e.type&&p.resizeAll(e.addedNodes)})}),p.observer.observe(document.documentElement,{childList:!0,subtree:!0}))},$$:t};\"loading\"!==document.readyState?requestAnimationFrame(p.init):document.addEventListener(\"DOMContentLoaded\",p.init),window.addEventListener(\"load\",function(){p.resizeAll()});var e=function(e){p.active&&p.resize(e.target)};document.documentElement.addEventListener(\"input\",e),document.documentElement.addEventListener(\"change\",e)}function t(e,t){return e instanceof Node||e instanceof Window?[e]:[].slice.call(\"string\"==typeof e?(t||document).querySelectorAll(e):e||[])\n}}();\n//# sourceMappingURL=stretchy.min.js.map\n\n/**\n * Mavo: Create web applications by writing HTML and CSS!\n * @author Lea Verou and contributors\n * @version v0.2.4\n */\n\n Stretchy.selectors.filter = \".mv-editor:not([property]), .mv-autosize\";\n\n(async function ($, $$) {\n\n// Define $ and $$ if they are not already defined\n// Primarily for backwards compat since we used to use Bliss Full.\nself.$ = self.$ || $;\nself.$$ = self.$$ || $$;\n\nvar _ = self.Mavo = $.Class({\n\tconstructor: function (element) {\n\t\tthis.treeBuilt = Mavo.promise();\n\t\tthis.dataLoaded = Mavo.promise();\n\t\tthis.deleted = [];\n\n\t\tthis.element = element;\n\n\t\tthis.inProgress = false;\n\n\t\t// Index among other mavos in the page, 1 is first\n\t\tthis.index = Object.keys(_.all).length + 1;\n\t\tObject.defineProperty(_.all, this.index - 1, {value: this, configurable: true});\n\n\t\t// Assign a unique (for the page) id to this mavo instance\n\t\tthis.id = Mavo.getAttribute(this.element, \"mv-app\", \"id\") || `mavo${this.index}`;\n\n\t\tif (this.id in _.all) {\n\t\t\t// Duplicate app name\n\t\t\tfor (var i=2; this.id + i in _.all; i++) {}\n\t\t\tthis.id = this.id + i;\n\t\t}\n\n\t\t_.all[this.id] = this;\n\t\tthis.element.setAttribute(\"mv-app\", this.id);\n\n\t\tthis.observe({attribute: \"lang\", deep: false}, () => {\n\t\t\tvar lang = Mavo.getClosestAttribute(this.element, \"lang\") || Mavo.locale;\n\t\t\tthis.locale = Mavo.Locale.get(lang);\n\t\t})();\n\n\t\t// Should we start in edit mode?\n\t\tthis.autoEdit = this.element.classList.contains(\"mv-autoedit\");\n\n\t\t// Should we save automatically?\n\t\tthis.autoSave = this.element.hasAttribute(\"mv-autosave\");\n\t\tthis.autoSaveDelay = (this.element.getAttribute(\"mv-autosave\") || 0) * 1000;\n\n\t\tMavo.setAttributeShy(this.element, \"typeof\", \"\");\n\n\t\tMavo.hooks.run(\"init-start\", this);\n\n\t\t// ----- Heuristic for groups ------\n\n\t\t// First, add property attributes to mv-multiple elements without one\n\t\t$$(_.selectors.multiple, this.element).forEach(element => {\n\t\t\t_.setAttributeShy(element, \"property\", \"\");\n\t\t});\n\n\t\t// Now, turn properties that contain other properties into groups\n\t\t$$(_.selectors.primitive, this.element).forEach(element => {\n\t\t\tif ($(_.selectors.property, element)) { // contains other properties\n\t\t\t\tvar config = Mavo.Primitive.getConfig(element);\n\n\t\t\t\tif (!config.attribute && !config.hasChildren || Mavo.is(\"multiple\", element)) {\n\t\t\t\t\tMavo.setAttributeShy(element, \"typeof\", \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.expressions = new Mavo.Expressions(this);\n\n\t\t_.observers = _.observers || new Mavo.Observers();\n\t\t_.observers.observer.observe(this.element, {\n\t\t\t// Observe everything\n\t\t\tcharacterData: true,\n\t\t\tchildList: true,\n\t\t\tsubtree: true,\n\t\t\tattributes: true\n\t\t});\n\n\t\t// Build mavo objects\n\t\tMavo.hooks.run(\"init-tree-before\", this);\n\n\t\tthis.root = new Mavo.Group(this.element, this);\n\t\tthis.treeBuilt.resolve();\n\n\t\tMavo.hooks.run(\"init-tree-after\", this);\n\n\t\tthis.permissions = new Mavo.Permissions();\n\n\t\tvar backendTypes = [\"source\", \"storage\", \"init\", \"uploads\"]; // order is significant!\n\n\t\t// Figure out backends for storage, data reads, and initialization respectively\n\t\tbackendTypes.forEach(role => this.updateBackend(role));\n\n\t\tthis.observe({deep: false, attribute: true}, ({attribute}) => {\n\t\t\tif (attribute.indexOf(\"mv-\") === 0) {\n\t\t\t\t// We want to observe changes both in a backend (the mv-role attribute)\n\t\t\t\t// and its metadata (provided via the mv-role-* family of attributes)\n\t\t\t\tlet role = attribute?.replace(/^mv-/, \"\")?.split(\"-\")?.[0];\n\n\t\t\t\tif (backendTypes.includes(role)) {\n\t\t\t\t\tthis.updateBackend(role);\n\n\t\t\t\t\t// Do we need to re-load data?\n\t\t\t\t\tif (role === \"source\" || (!this.source && (role === \"storage\" || role === \"init\" && !this.root.data))) {\n\t\t\t\t\t\tthis.load();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t});\n\n\t\tthis.permissions.can(\"login\", () => {\n\t\t\t// We also support a URL param to trigger login, in case the user doesn't want visible login UI\n\t\t\tlet loginUrlParam;\n\t\t\tif (Mavo.Functions.url(\"login\") !== null && this.index === 1) {\n\t\t\t\tloginUrlParam = \"login\";\n\t\t\t}\n\t\t\telse if (Mavo.Functions.url(this.id + \"-login\") !== null) {\n\t\t\t\tloginUrlParam = this.id + \"-login\";\n\t\t\t}\n\n\t\t\tif (loginUrlParam !== undefined) {\n\t\t\t\t// Remove param from url\n\t\t\t\tconst currentURL = new URL(location.href);\n\t\t\t\tcurrentURL.searchParams.delete(loginUrlParam);\n\t\t\t\thistory.replaceState(null, \"\", currentURL);\n\t\t\t\tthis.primaryBackend.login();\n\t\t\t}\n\t\t});\n\n\t\t// Update login status\n\t\t$.bind(this.element, \"mv-login.mavo\", evt => {\n\t\t\tif (evt.backend == (this.source || this.storage)) {\n\t\t\t\t// If last time we rendered we got nothing, maybe now we'll have better luck?\n\t\t\t\tif (!this.root.data && !this.unsavedChanges) {\n\t\t\t\t\tthis.load();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.bar = new Mavo.UI.Bar(this);\n\n\t\t// Is there any control that requires an edit button?\n\t\tthis.needsEdit = this.calculateNeedsEdit();\n\n\t\tthis.setUnsavedChanges(false);\n\n\t\tthis.permissions.onchange(({action, value}) => {\n\t\t\tvar permissions = this.element.getAttribute(\"mv-permissions\") || \"\";\n\t\t\tpermissions = permissions.trim().split(/\\s+/).filter(a => a != action);\n\n\t\t\tif (value) {\n\t\t\t\tpermissions.push(action);\n\t\t\t}\n\n\t\t\tthis.element.setAttribute(\"mv-permissions\", permissions.join(\" \"));\n\t\t});\n\n\t\tthis.permissions.can([\"edit\", \"add\", \"delete\"], () => {\n\t\t\tif (this.autoEdit) {\n\t\t\t\tthis.edit();\n\t\t\t}\n\t\t});\n\n\t\t// Observe entire tree for mv-mode changes\n\t\tthis.observe({attribute: \"mv-mode\"}, ({element}) => {\n\t\t\tif (!this.permissions.edit && !this.permissions.add && !this.permissions.delete) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet nodes = _.Node.children(element);\n\n\t\t\tnodeloop: for (let i=0; i<nodes.length; i++) {\n\t\t\t\tlet node = nodes[i];\n\t\t\t\tlet previousMode = node.mode, mode;\n\n\t\t\t\tif (node.element == element) {\n\t\t\t\t\t// If attribute set directly on a Mavo node, then it forces it into that mode\n\t\t\t\t\t// otherwise, descendant nodes still inherit, unless they are also mode-restricted\n\t\t\t\t\tmode = node.element.getAttribute(\"mv-mode\");\n\t\t\t\t\tnode.modes = mode;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Inherited\n\t\t\t\t\tif (node.modes) {\n\t\t\t\t\t\t// Mode-restricted, we cannot change to the other mode\n\t\t\t\t\t\tcontinue nodeloop;\n\t\t\t\t\t}\n\n\t\t\t\t\tmode = _.getStyle(node.element.parentNode, \"--mv-mode\");\n\t\t\t\t}\n\n\t\t\t\tnode.mode = mode;\n\n\t\t\t\tif (previousMode != node.mode) {\n\t\t\t\t\tnode[node.mode == \"edit\"? \"edit\" : \"done\"]();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\n\t\tif (this.storage || this.source) {\n\t\t\t// Fetch existing data\n\t\t\tthis.permissions.can(\"read\", () => this.load());\n\t\t}\n\t\telse {\n\t\t\t// No storage or source\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tthis.dataLoaded.resolve();\n\t\t\t\tthis.expressions.update();\n\t\t\t\t$.fire(this.element, \"mv-load\");\n\t\t\t});\n\t\t}\n\n\t\t// Dynamic ids\n\t\t$.bind(this.element, \"mv-load.mavo\", evt => {\n\t\t\tif (location.hash) {\n\t\t\t\tvar callback = () => {\n\t\t\t\t\tvar target = document.getElementById(location.hash.slice(1));\n\n\t\t\t\t\tif (target || !location.hash) {\n\t\t\t\t\t\tif (this.element.contains(target)) {\n\t\t\t\t\t\t\trequestAnimationFrame(() => { // Give the browser a chance to render\n\t\t\t\t\t\t\t\tMavo.scrollIntoViewIfNeeded(target);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn target;\n\t\t\t\t};\n\n\t\t\t\tif (!callback()) {\n\t\t\t\t\t// No target, perhaps not yet?\n\t\t\t\t\tthis.observe({attribute: \"id\", once: true}, callback);\n\t\t\t\t\t// FIXME if expressions take multiple cycles to resolve, this will not scroll to the proper id\n\t\t\t\t\t// FIXME also, if the user has started interacting with the document, we shouldn't scroll\n\t\t\t\t}\n\t\t\t}\n\n\t\t\trequestAnimationFrame(() => Stretchy.resizeAll());\n\t\t});\n\n\n\t\tif (this.autoSave) {\n\t\t\tthis.dataLoaded.then(evt => {\n\t\t\t\tvar debouncedSave = _.debounce(() => {\n\t\t\t\t\tthis.save();\n\t\t\t\t}, this.autoSaveDelay);\n\n\t\t\t\tvar callback = evt => {\n\t\t\t\t\tif (evt.node.saved && this.autoSave) {\n\t\t\t\t\t\tdebouncedSave();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tthis.permissions.can(\"save\", () => {\n\t\t\t\t\t\t$.bind(this.element, \"mv-change.mavo:autosave\", callback);\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\t$.unbind(this.element, \"mv-change.mavo:autosave\", callback);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t// Keyboard navigation\n\t\tthis.element.addEventListener(\"keydown\", evt => {\n\t\t\tvar element = evt.target;\n\n\t\t\t// Ctrl + S or Cmd + S to save\n\t\t\tif (this.permissions.save && evt.key == \"S\" && evt[_.superKey] && !evt.altKey) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t\telse if (evt.key === \"ArrowUp\" || evt.key === \"ArrowDown\") {\n\t\t\t\tif (element.matches(\"textarea, input[type=range], input[type=number]\")) {\n\t\t\t\t\t// Up/down arrow keys are meaningful here\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (element.matches(\".mv-editor\")) {\n\t\t\t\t\tvar editor = true;\n\t\t\t\t\telement = element.parentNode;\n\t\t\t\t}\n\n\t\t\t\tvar node = Mavo.Node.get(element);\n\n\t\t\t\tif (node?.closestCollection) {\n\t\t\t\t\tvar nextNode = node.getCousin(evt.key === \"ArrowUp\"? -1 : 1, {wrap: true});\n\n\t\t\t\t\tif (nextNode) {\n\t\t\t\t\t\tif (editor && nextNode.editing) {\n\t\t\t\t\t\t\tnextNode.edit();\n\t\t\t\t\t\t\tnextNode.editor.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tnextNode.element.focus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t$.bind(this.element, \"click submit\", _.Actions.listener);\n\n\t\tMavo.hooks.run(\"init-end\", this);\n\t},\n\n\tget editing() {\n\t\treturn this.root.editing;\n\t},\n\n\tobserve (o = {}, callback) {\n\t\tlet options = Object.assign({element: this.element}, o);\n\t\treturn _.observers?.observe(options, callback);\n\t},\n\n\tunobserve (o, callback) {\n\t\tlet options = Object.assign({element: this.element}, o);\n\t\treturn _.observers?.observe(options, callback);\n\t},\n\n\tgetData: function(o) {\n\t\tlet env = {context: this, options: o};\n\t\tenv.data = this.root.getData(o);\n\t\t_.hooks.run(\"getdata-end\", env);\n\t\treturn env.data;\n\t},\n\n\ttoJSON: function() {\n\t\treturn _.toJSON(this.getData());\n\t},\n\n\tmessage: function(message, options = {}) {\n\t\treturn new _.UI.Message(this, message, options);\n\t},\n\n\terror: function(message, ...log) {\n\t\tthis.message(message, {\n\t\t\ttype: \"error\",\n\t\t\tdismiss: [\"button\", \"timeout\"]\n\t\t});\n\n\t\t// Log more info for programmers\n\t\tif (log.length > 0) {\n\t\t\tconsole.log(`%c${this.id}: ${message}`, \"color: red; font-weight: bold\", ...log);\n\t\t}\n\t},\n\n\trender: function(data) {\n\t\tvar env = {context: this, data};\n\t\t_.hooks.run(\"render-start\", env);\n\n\t\tif (env.data) {\n\t\t\tthis.root.render(env.data);\n\t\t}\n\n\t\tthis.unsavedChanges = false;\n\n\t\t_.hooks.run(\"render-end\", env);\n\t},\n\n\tedit: function() {\n\t\tthis.root.edit();\n\n\t\t// Highlight collection item when item controls are hovered\n\t\t$.bind(this.element, \"mouseenter.mavo:edit mouseleave.mavo:edit\", evt => {\n\t\t\tif (evt.target.matches(_.selectors.multiple)) {\n\t\t\t\tevt.target.classList.remove(\"mv-has-hovered-item\");\n\n\t\t\t\tvar parent = evt.target.parentNode.closest(_.selectors.multiple);\n\n\t\t\t\tif (parent) {\n\t\t\t\t\tparent.classList.toggle(\"mv-has-hovered-item\", evt.type == \"mouseenter\");\n\t\t\t\t}\n\t\t\t}\n\t\t}, true);\n\n\t\tthis.setUnsavedChanges();\n\t},\n\n\t// Conclude editing\n\tdone: function() {\n\t\tthis.root.done();\n\t\t$.unbind(this.element, \".mavo:edit\");\n\t\tthis.unsavedChanges = false;\n\t},\n\n\t/**\n\t * Set this mavo instances unsavedChanges flag.\n\t * @param {Boolean} [value]\n\t *        If true, just sets the flag to true, no traversal.\n\t *        If false, sets the flag of the Mavo instance and every tree node to false\n\t *        If not provided, traverses the tree and recalculates the flag value.\n\t */\n\tsetUnsavedChanges: function(value) {\n\t\tvar unsavedChanges = !!value;\n\n\t\tif (!value) {\n\t\t\tthis.walk(obj => {\n\t\t\t\tif (obj.unsavedChanges) {\n\t\t\t\t\tunsavedChanges = true;\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tobj.unsavedChanges = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.unsavedChanges = unsavedChanges;\n\t},\n\n\t/**\n\t * Update the backend for a given role\n\t * @return {Boolean} true if a change occurred, false otherwise\n\t */\n\tupdateBackend (role) {\n\t\tlet existing = this[role], backend, changed;\n\t\tconst attribute = \"mv-\" + role;\n\n\t\tif (this.index == 1) {\n\t\t\t// This app is the first one in the page, so we can override its backend\n\t\t\t// via URL params such as ?storage=...\n\t\t\tbackend = _.Functions.url(role);\n\t\t}\n\n\t\tif (!backend) {\n\t\t\tbackend =  _.Functions.url(`${this.id}-${role}`) || this.element.getAttribute(attribute) || null;\n\t\t}\n\n\t\tif (backend) {\n\t\t\tbackend = backend.trim();\n\n\t\t\tif (backend == \"none\") {\n\t\t\t\tbackend = null;\n\t\t\t}\n\t\t}\n\n\t\tif (backend) {\n\t\t\t// Do we have any other attributes?\n\t\t\tlet prefix = attribute + \"-\";\n\t\t\tlet roleAttributes = Mavo.getAttributes(this.element, RegExp(\"^\" + prefix));\n\t\t\tlet options = Object.fromEntries(roleAttributes.map(n => [n.replace(prefix, \"\"), this.element.getAttribute(n)]));\n\n\t\t\tif (!existing?.equals?.(backend)) {\n\t\t\t\t// We have a string, convert to a backend object if different than existing\n\t\t\t\tthis[role] = backend = _.Backend.create(backend, {\n\t\t\t\t\tformat: this.element.getAttribute(\"mv-format\"), // can be overwritten by options below\n\t\t\t\t\t...options,\n\t\t\t\t\tmavo: this\n\t\t\t\t}, existing);\n\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// We had a backend and now we will un-have it\n\t\t\tthis[role] = null;\n\t\t}\n\n\t\tchanged = changed || (backend? !backend.equals(existing) : Boolean(existing));\n\n\t\tif (changed) {\n\t\t\t// A change occured\n\t\t\tif (!this.storage && !this.source && this.init) {\n\t\t\t\t// If init is present with no storage and no source, init is equivalent to source\n\t\t\t\tthis.source = this.init;\n\t\t\t\tthis.init = null;\n\t\t\t}\n\n\t\t\tvar permissions = this.storage? this.storage.permissions : new Mavo.Permissions({edit: true, save: false});\n\t\t\tpermissions.parent = this.source?.permissions;\n\t\t\tthis.permissions.parent = permissions;\n\n\t\t\tthis.primaryBackend = this.storage || this.source;\n\t\t}\n\n\t\treturn changed;\n\t},\n\n\t/**\n\t * load - Fetch data from source and render it.\n\t *\n\t * @return {Promise}  A promise that resolves when the data is loaded.\n\t */\n\tasync load () {\n\t\tvar backend = this.source || this.storage;\n\n\t\tif (!backend) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.inProgress = \"Loading\";\n\n\t\tawait backend.ready;\n\n\t\tlet data = await backend.load()\n\t\t.catch(err => {\n\t\t\t// Try again with init\n\t\t\tif (this.init && this.init != backend) {\n\t\t\t\tbackend = this.init;\n\t\t\t\treturn this.init.ready.then(() => this.init.load());\n\t\t\t}\n\n\t\t\t// No init, propagate error\n\t\t\treturn Promise.reject(err);\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err) {\n\t\t\t\tvar xhr = err instanceof XMLHttpRequest? err : err.xhr;\n\n\t\t\t\tif (xhr?.status == 404) {\n\t\t\t\t\tthis.render(null);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar message = this._(\"problem-loading\");\n\n\t\t\t\t\tif (xhr) {\n\t\t\t\t\t\tmessage += xhr.status? this._(\"http-error\", err) : \": \" + this._(\"cant-connect\");\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.error(message, err);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t});\n\n\t\tthis.render(data);\n\n\t\tthis.inProgress = false;\n\n\t\tawait Mavo.defer();\n\n\t\tthis.dataLoaded.resolve();\n\t\t$.fire(this.element, \"mv-load\");\n\t},\n\n\tasync store () {\n\t\tif (!this.storage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.inProgress = \"Saving\";\n\n\t\tlet saved;\n\n\t\ttry {\n\t\t\tsaved = await this.storage.store(this.getData());\n\t\t}\n\t\tcatch (err) {\n\t\t\tif (err) {\n\t\t\t\tvar message = this._(\"problem-saving\");\n\n\t\t\t\tif (err instanceof XMLHttpRequest) {\n\t\t\t\t\tmessage += \": \" + (err.status? this._(\"http-error\", err) : this._(\"cant-connect\"));\n\t\t\t\t}\n\n\t\t\t\tthis.error(message, err);\n\t\t\t}\n\n\t\t\tsaved = null;\n\t\t}\n\n\t\tthis.inProgress = false;\n\t\treturn saved;\n\t},\n\n\tupload: function(file, path = \"images/\" + file.name) {\n\t\tif (!this.uploadBackend) {\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\tthis.inProgress = this._(\"uploading\");\n\n\t\treturn this.uploadBackend.upload(file, path)\n\t\t\t.then(url => {\n\t\t\t\tthis.inProgress = false;\n\t\t\t\treturn url;\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tthis.error(this._(\"error-uploading\"), err);\n\t\t\t\tthis.inProgress = false;\n\t\t\t\treturn null;\n\t\t\t});\n\t},\n\n\tasync save () {\n\t\t_.hooks.run(\"save-start\", this);\n\t\tlet saved = await this.store();\n\n\t\tif (saved) {\n\t\t\t$.fire(this.element, \"mv-save\", saved);\n\n\t\t\tthis.lastSaved = Date.now();\n\t\t\tthis.root.save();\n\t\t\tthis.unsavedChanges = false;\n\t\t}\n\t},\n\n\twalk: function() {\n\t\treturn this.root.walk(...arguments);\n\t},\n\n\tcalculateNeedsEdit: function() {\n\t\tvar needsEdit = false;\n\n\t\tthis.walk((obj, path) => {\n\t\t\tif (needsEdit) {\n\t\t\t\t// If already true, no need to descend further\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// True if both modes are allowed and node is not group\n\t\t\tneedsEdit = !obj.modes && !(obj instanceof Mavo.Group);\n\n\t\t\treturn !obj.modes;\n\t\t}, undefined, {descentReturn: true});\n\n\t\treturn needsEdit;\n\t},\n\n\tchanged: function(change) {\n\t\tif (!this.root) {\n\t\t\t// No tree yet\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.expressions.active) {\n\t\t\tthis.expressions.updateThrottled(change);\n\t\t}\n\t},\n\n\tsetDeleted: function(...nodes) {\n\t\t// Clear previous deleted item(s)\n\t\tthis.deleted.forEach(node => node.destroy());\n\t\tthis.deleted.length = [];\n\n\t\tthis.deletionNotice?.close();\n\n\t\tif (!nodes.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deleted.push(...nodes);\n\n\t\tif (nodes.length == 1) {\n\t\t\tvar phrase = nodes[0].name;\n\t\t}\n\t\telse { // Multiple items deleted, possibly from multiple collections\n\t\t\tvar counts = {}, ret = [];\n\n\t\t\tnodes.forEach(n => {\n\t\t\t\tcounts[n.name] = (counts[n.name] || 0) + 1;\n\t\t\t});\n\n\t\t\tfor (var name in counts) {\n\t\t\t\tret.push(this._(\"n-items\", {name, n: counts[name]}));\n\t\t\t}\n\n\t\t\tvar phrase = ret.join(\", \");\n\t\t}\n\n\t\tvar notice = this.deletionNotice = this.message(\n\t\t\t[\n\t\t\t\tthis._(\"item-deleted\", {name: phrase}),\n\t\t\t\t{\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttype: \"button\",\n\t\t\t\t\ttextContent: this._(\"undo\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: evt => {\n\t\t\t\t\t\t\tthis.undoDelete();\n\t\t\t\t\t\t\tthis.deletionNotice.close(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t], {\n\t\t\t\tclasses: \"mv-deleted\",\n\t\t\t\tdismiss: {\n\t\t\t\t\tbutton: true,\n\t\t\t\t\ttimeout: 20000\n\t\t\t\t}\n\t\t\t});\n\n\t\tnotice.closed.then(undone => {\n\t\t\tif (!undone && this.deleted.length) {\n\t\t\t\t// Gone forever now\n\t\t\t\tthis.deleted.forEach(node => node.destroy());\n\t\t\t\tthis.deleted.length = 0;\n\t\t\t}\n\n\t\t\tif (this.deletionNotice == notice) {\n\t\t\t\tthis.deletionNotice = null;\n\t\t\t}\n\t\t});\n\t},\n\n\tundoDelete: function() {\n\t\tthis.deleted.forEach(node => node.collection.add(node, node.index));\n\t\tthis.deleted.length = 0;\n\t},\n\n\t// A lot of this is inspired by @hopeful2's work in https://github.com/mavoweb/mavo/pull/430\n\tdestroy () {\n\t\tMavo.hooks.run(\"mavo-destroy-start\", this);\n\n\t\tif (this.editing) {\n\t\t\tthis.done();\n\t\t}\n\n\t\t// first remove observers.\n\t\tthis.observer.destroy();\n\n\t\tthis.bar?.destroy();\n\n\t\t// .index starts from 1, .all starts from 0\n\t\t// ISSUE Should we just delete this and rearrange the other indices?\n\t\tMavo.all[this.id] = Mavo.all[this.index - 1] = null;\n\n\t\tthis.root.destroy();\n\n\t\tMavo.hooks.run(\"mavo-destroy-end\", this);\n\t},\n\n\tlive: {\n\t\tinProgress: function(value) {\n\t\t\t$.toggleAttribute(this.element, \"mv-progress\", value, value);\n\t\t\t$.toggleAttribute(this.element, \"aria-busy\", !!value, !!value);\n\t\t\tthis.element.style.setProperty(\"--mv-progress-text\", value? `\"${this._(value)}\"` : \"\");\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tthis.element.classList.toggle(\"mv-unsaved-changes\", value);\n\t\t},\n\n\t\tneedsEdit: function(value) {\n\t\t\tif (this.bar) {\n\t\t\t\tthis.bar.toggle(\"edit\", value && this.permissions.edit);\n\t\t\t}\n\t\t},\n\n\t\tstorage: function(value) {\n\t\t\tif (value !== this._storage && !value) {\n\t\t\t\tvar permissions = new Mavo.Permissions({edit: true, save: false});\n\t\t\t\tpermissions.parent = this.permissions.parent;\n\t\t\t\tthis.permissions.parent = permissions;\n\t\t\t}\n\t\t},\n\n\t\tprimaryBackend: function(value) {\n\t\t\tvalue = value || null;\n\n\t\t\tif (value != this._primaryBackend) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t},\n\n\t\tuploadBackend: {\n\t\t\tget: function () {\n\t\t\t\tconst backend = this.uploads;\n\n\t\t\t\tif (backend?.upload) {\n\t\t\t\t\t// We need to authenticate a user if we haven't done that earlier\n\t\t\t\t\tif (backend.permissions.login) {\n\t\t\t\t\t\tbackend.login();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.uploads;\n\t\t\t\t}\n\n\t\t\t\tif (this.storage?.upload) {\n\t\t\t\t\t// Prioritize storage\n\t\t\t\t\treturn this.storage;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tversion: \"v0.2.4\",\n\n\t\tall: {},\n\n\t\tget: function(id) {\n\t\t\tif (id instanceof Element) {\n\t\t\t\t// Get by element\n\t\t\t\tfor (var name in _.all) {\n\t\t\t\t\tif (_.all[name].element == id) {\n\t\t\t\t\t\treturn _.all[name];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar name = typeof id === \"number\"? Object.keys(_.all)[id] : id;\n\n\t\t\treturn _.all[name] || null;\n\t\t},\n\n\t\tsuperKey: navigator.platform.indexOf(\"Mac\") === 0? \"metaKey\" : \"ctrlKey\",\n\t\tbase: location.protocol == \"about:\"? (document.currentScript? document.currentScript.src : \"http://mavo.io\") : location,\n\t\tdependencies: [\n\t\t\t// Plugins.load() must be run after DOM load to pick up all mv-plugins attributes\n\t\t\t$.ready().then(() => _.Plugins.load()),\n\t\t],\n\n\t\t// Only naive tests here (no false positives, but false negatives are ok).\n\t\t// polyfill.io will do more proper checking\n\t\tpolyfillsNeeded: {\n\t\t\t\"blissfuljs\": Array.from && document.documentElement.closest && self.URL && \"searchParams\" in URL.prototype,\n\t\t\t\"Intl.~locale.en\": self.Intl,\n\t\t\t\"IntersectionObserver\": self.IntersectionObserver,\n\t\t\t\"Symbol\": self.Symbol,\n\t\t\t\"Element.prototype.remove\": Element.prototype.remove,\n\t\t\t\"Element.prototype.before\": Element.prototype.before,\n\t\t\t\"Element.prototype.after\": Element.prototype.after,\n\t\t\t\"Element.prototype.prepend\": Element.prototype.prepend,\n\t\t\t\"Array.prototype.flat\": Array.prototype.flat,\n\t\t\t\"Array.prototype.flatMap\": Array.prototype.flatMap,\n\t\t},\n\t\tpolyfills: [],\n\n\t\tinit: function(container = document) {\n\t\t\tvar mavos = Array.isArray(arguments[0])? arguments[0] : $$(_.selectors.init, container);\n\n\t\t\tvar ret = mavos.filter(element => !_.get(element)) // not already inited\n\t\t\t\t.map(element => new _(element));\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tobserve (options, callback) {\n\t\t\t_.observers = _.observers || new Mavo.Observers();\n\t\t\treturn _.observers.observe(options, callback);\n\t\t},\n\n\t\tunobserve (options, callback) {\n\t\t\t_.observers.unobserve(options, callback);\n\t\t},\n\n\t\twarn: function warn(message, o = {}) {\n\t\t\twarn.history = warn.history || new Set();\n\n\t\t\tif (!_.warn.history.has(message)) {\n\t\t\t\tconsole.warn(message);\n\t\t\t}\n\n\t\t\tif (o.once !== false) {\n\t\t\t\twarn.history.add(message);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Similar to Promise.all() but can handle post-hoc additions\n\t\t * and does not reject if one promise rejects.\n\t\t */\n\t\tthenAll: function(iterable) {\n\t\t\t// Turn rejected promises into resolved ones\n\t\t\t$$(iterable).forEach(promise => {\n\t\t\t\tif ($.type(promise) == \"promise\") {\n\t\t\t\t\tpromise = promise.catch(err => err);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn Promise.all(iterable).then(resolved => {\n\t\t\t\tif (iterable.length != resolved.length) {\n\t\t\t\t\t// The list of promises or values changed. Return a new Promise.\n\t\t\t\t\t// The original promise won't resolve until the new one does.\n\t\t\t\t\treturn _.thenAll(iterable);\n\t\t\t\t}\n\n\t\t\t\t// The list of promises or values stayed the same.\n\t\t\t\t// Return results immediately.\n\t\t\t\treturn resolved;\n\t\t\t});\n\t\t},\n\n\t\tpromise: function(constructor) {\n\t\t\tvar res, rej;\n\n\t\t\tvar promise = new Promise((resolve, reject) => {\n\t\t\t\tif (typeof constructor === \"function\") {\n\t\t\t\t\tconstructor(resolve, reject);\n\t\t\t\t}\n\t\t\t\telse if (constructor instanceof Promise) {\n\t\t\t\t\tconstructor.then(resolve);\n\t\t\t\t\tconstructor.catch(reject);\n\t\t\t\t}\n\n\t\t\t\tres = resolve;\n\t\t\t\trej = reject;\n\t\t\t});\n\n\t\t\tpromise.resolve = a => {\n\t\t\t\tres(a);\n\t\t\t\treturn promise;\n\t\t\t};\n\n\t\t\tpromise.reject = a => {\n\t\t\t\trej(a);\n\t\t\t\treturn promise;\n\t\t\t};\n\n\t\t\treturn promise;\n\t\t},\n\n\t\tdefer: delay => new Promise(resolve => delay === undefined? requestAnimationFrame(resolve) : setTimeout(resolve, delay)),\n\n\t\tUI: {},\n\n\t\thooks: new $.Hooks(),\n\n\t\t// Will be filled with a union of all properties across all Mavos\n\t\tproperties: new Set(),\n\n\t\tattributes: [\n\t\t\t\"mv-app\", \"mv-storage\", \"mv-source\", \"mv-init\", \"mv-path\", \"mv-multiple-path\", \"mv-format\",\n\t\t\t\"mv-attribute\", \"mv-default\", \"mv-mode\", \"mv-edit\", \"mv-editor\", \"mv-permisssions\",\n\t\t\t\"mv-rel\", \"mv-value\"\n\t\t],\n\n\t\tlazy: {\n\t\t\tlocale: () => document.documentElement.lang || \"en-GB\"\n\t\t}\n\t}\n});\n\n// Define symbols\n// These are lazy to give the Symbol polyfill a chance to load if needed\n[\"toNode\", \"isProxy\", \"route\", \"parent\", \"property\", \"mavo\", \"groupedBy\", \"as\"].forEach(symbol => {\n\t$.lazy(_, symbol, () => Symbol(symbol));\n});\n\nObject.defineProperty(_.all, \"length\", {\n\tget: function() {\n\t\treturn Object.keys(this).length;\n\t}\n});\n\n{\n\nlet s = _.selectors = {\n\tinit: \"[mv-app], [data-mv-app]\",\n\tproperty: \"[property]\",\n\tspecificProperty: name => `[property=${name}]`,\n\tgroup: \"[typeof], [mv-group]\",\n\tprimitive: \"[property]:not([typeof]):not([mv-group])\",\n\tchildGroup: \"[typeof][property], [mv-group][property]\",\n\tmultiple: \"[mv-multiple]\",\n\tformControl: \"input, select, option, textarea\",\n\ttextInput: [\"text\", \"email\", \"url\", \"tel\", \"search\", \"number\"].map(t => `input[type=${t}]`).join(\", \") + \", input:not([type]), textarea\",\n\tui: \".mv-ui\",\n\tcontainer: {\n\t\t// \"li\": \"ul, ol\",\n\t\t\"tr\": \"table\",\n\t\t\"option\": \"select\",\n\t\t// \"dt\": \"dl\",\n\t\t// \"dd\": \"dl\"\n\t}\n};\n\n$.extend(_.selectors, {\n\titem: s.multiple + \", \" + s.group,\n\toutput: s.specificProperty(\"output\") + \", .mv-output\"\n});\n\n}\n\n$.each(_.polyfillsNeeded, (id, supported) => {\n\tif (!supported) {\n\t\t_.polyfills.push(id);\n\t}\n});\n\n_.ready = _.thenAll(_.dependencies);\n_.inited = _.promise();\n\n// Init mavo. Async to give other scripts a chance to modify stuff.\nawait _.defer();\n\nif (_.polyfills.length > 0) {\n\tvar polyfillURL = \"https://cdn.polyfill.io/v2/polyfill.min.js?unknown=polyfill&features=\" + _.polyfills.map(a => a + \"|gated\").join(\",\");\n\t_.dependencies.push($.include(polyfillURL));\n}\n\nawait $.ready();\n\n// Convert any data-mv-* attributes to mv-*\nMavo.attributeStartsWith(\"data-mv-\").forEach(attribute => {\n\tlet element = attribute.ownerElement;\n\tlet name = attribute.name.replace(\"data-\", \"\");\n\tMavo.setAttributeShy(element, name, attribute.value);\n});\n\n$$(_.selectors.init).forEach(function(elem) {\n\t// Skip if an instance has been created, for example by another script.\n\tif (!_.get(elem)) {\n\t\telem.setAttribute(\"mv-progress\", \"Loading\");\n\t}\n});\n\nawait _.ready;\n\n_.init();\n_.inited.resolve();\n\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\nvar _ = $.extend(Mavo, {\n\t/**\n\t * Load a file, only once\n\t */\n\tload: (url, base = document.currentScript?.src ?? location) => {\n\t\treturn $.load(url, base);\n\t},\n\n\treadFile: (file, format = \"DataURL\") => {\n\t\tvar reader = new FileReader();\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\treader.onload = f => resolve(reader.result);\n\t\t\treader.onerror = reader.onabort = reject;\n\t\t\treader[\"readAs\" + format](file);\n\t\t});\n\t},\n\n\ttoJSON: data => {\n\t\tif (data === null) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (typeof data === \"string\") {\n\t\t\t// Do not stringify twice!\n\t\t\treturn data;\n\t\t}\n\n\t\ttry {\n\t\t\treturn JSON.stringify(data, null, \"\\t\");\n\t\t}\n\t\tcatch (e) {\n\t\t\treturn e;\n\t\t}\n\t},\n\n\t/**\n\t * toJSON without cycles\n\t */\n\tsafeToJSON: function(o) {\n\t\tvar cache = new WeakSet();\n\n\t\treturn JSON.stringify(o, (key, value) => {\n\t\t\tif (typeof value === \"object\" && value !== null) {\n\t\t\t\t// No circular reference found\n\n\t\t\t\tif (cache.has(value)) {\n\t\t\t\t\treturn; // Circular reference found!\n\t\t\t\t}\n\n\t\t\t\tcache.add(value);\n\t\t\t}\n\n\t\t\treturn value;\n\t\t});\n\t},\n\n\t// Detect if this is a plain object, not an instance of some other class\n\tisPlainObject: o => {\n\t\tif ($.type(o) !== \"object\") {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar proto = Object.getPrototypeOf(o);\n\t\treturn proto.constructor?.name === \"Object\";\n\t},\n\n\t// Specifiy a primitive fallback for an object\n\tprimitivify: (object, primitive) => {\n\t\tif (object) {\n\t\t\tif (primitive && typeof primitive === \"object\") {\n\t\t\t\t// Primitive is objectified, must copy its metadata to avoid losing it\n\t\t\t\tObject.assign(object, primitive);\n\t\t\t\tprimitive = Mavo.value(primitive);\n\t\t\t}\n\n\t\t\tobject.valueOf = object.toJSON = object[Symbol.toPrimitive] = () => primitive;\n\t\t}\n\n\t\treturn object;\n\t},\n\n\tobjectify: (value, properties) => {\n\t\tvar primitive = Mavo.value(value);\n\n\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\tif (value === null) {\n\t\t\t\tvalue = {\n\t\t\t\t\t[Symbol.toStringTag]: \"Null\",\n\t\t\t\t\ttoJSON: () => null\n\t\t\t\t};\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar constructor = value.constructor;\n\t\t\t\tvalue = new constructor(primitive);\n\t\t\t\tvalue[Symbol.toStringTag] = constructor.name;\n\t\t\t}\n\n\t\t\t_.primitivify(value, primitive);\n\t\t}\n\n\t\treturn $.extend(value, properties);\n\t},\n\n\tvalue: value => value?.valueOf? value.valueOf() : value,\n\n\t/**\n\t * Array & set utlities\n\t */\n\n\t// If the passed value is not an array, convert to an array\n\ttoArray: arr => {\n\t\treturn arr === undefined? [] : Array.isArray(arr)? arr : [arr];\n\t},\n\n\t// Delete an element from an array\n\t// @param all {Boolean} Delete more than one?\n\tdelete: (arr, element, all) => {\n\t\tdo {\n\t\t\tvar index = arr && arr.indexOf(element);\n\n\t\t\tif (index > -1) {\n\t\t\t\tarr.splice(index, 1);\n\t\t\t}\n\t\t} while (index > -1 && all);\n\t},\n\n\t// Push an item to an array iff it's not already in there\n\tpushUnique: (arr, item) => {\n\t\tif (arr.indexOf(item) === -1) {\n\t\t\tarr.push(item);\n\t\t}\n\t},\n\n\t// Adds items from set2 into set1, turns set1 into a set if it's not\n\tunion: (set1, set2) => {\n\t\tif (set1 instanceof Set && set2) {\n\t\t\tset2.forEach(x => set1.add(x));\n\t\t\treturn set1;\n\t\t}\n\n\t\treturn new Set([...(set1 || []), ...(set2 || [])]);\n\t},\n\n\t// Filter an array in place\n\t// TODO add index to callback\n\tfilter: (arr, callback) => {\n\t\tfor (var i=0; i<arr.length; i++) {\n\t\t\tif (!callback(arr[i])) {\n\t\t\t\tarr.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * DOM element utilities\n\t */\n\n\tis: function(thing, ...elements) {\n\t\tfor (let i=0, element; i < elements.length; i++) {\n\t\t\tif (elements?.[i]?.matches?.(_.selectors[thing])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t * Get the current value of a CSS property on an element\n\t */\n\tgetStyle: (element, property) => {\n\t\tif (element) {\n\t\t\tvar value = getComputedStyle(element).getPropertyValue(property);\n\n\t\t\treturn value?.trim();\n\t\t}\n\t},\n\t/**\n\t * Get/set data on an element\n\t */\n\tdata: function(element, name, value) {\n\t\tif (!element) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar data = _.elementData.get(element) || {}, ret;\n\n\t\tif (arguments.length == 2) {\n\t\t\tret = data[name];\n\t\t}\n\t\telse if (value === undefined) {\n\t\t\tdelete data[name];\n\t\t}\n\t\telse {\n\t\t\tret = data[name] = value;\n\t\t}\n\n\t\t_.elementData.set(element, data);\n\t\treturn ret;\n\t},\n\n\telementData: new WeakMap(),\n\n\t/**\n\t * Get node from path or get path of a node to an ancestor\n\t * For maximum robustness, all but the last path segment refer to elements only.\n\t * The last part of the path is a decimal: the integer part of the decimal is element index,\n\t * the decimal part is node index *after* that element and starts from 1.\n\t * If the node has no previous element sibling, the integer part of the index will be -1.\n\t */\n\telementPath: function (ancestor, element) {\n\t\tif (Array.isArray(element)) {\n\t\t\t// Get element by path\n\t\t\tvar path = element;\n\n\t\t\tvar ret = path.reduce((acc, cur) => {\n\t\t\t\treturn acc.children[cur >> 0] || acc;\n\t\t\t}, ancestor);\n\n\t\t\tvar last = path[path.length - 1];\n\n\t\t\tif (last != (last >> 0)) {\n\t\t\t\t// We are returning a non-element node\n\t\t\t\tvar offset = +(last + \"\").split(\".\")[1];\n\n\t\t\t\tif (last >> 0 < 0) {\n\t\t\t\t\tret = ret.firstChild;\n\t\t\t\t\toffset--;\n\t\t\t\t}\n\n\t\t\t\tfor (var i=0; i<offset; i++) {\n\t\t\t\t\tret = ret.nextSibling;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t\telse {\n\t\t\t// Get path\n\t\t\tvar path = [];\n\n\t\t\tfor (var parent = element; parent && parent != ancestor; parent = parent.parentNode) {\n\t\t\t\tvar index = 0;\n\t\t\t\tvar countNonElementSiblings = parent === element && element.nodeType !== 1;\n\t\t\t\tvar offset = countNonElementSiblings? 1 : 0;\n\t\t\t\tvar sibling = parent;\n\n\t\t\t\twhile (sibling = sibling[`previous${countNonElementSiblings? \"\" : \"Element\"}Sibling`]) {\n\t\t\t\t\tif (countNonElementSiblings) {\n\t\t\t\t\t\toffset++;\n\n\t\t\t\t\t\tif (sibling.nodeType == 1) {\n\t\t\t\t\t\t\tcountNonElementSiblings = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tindex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (offset > 0) {\n\t\t\t\t\tindex = index - 1 + \".\" + offset;\n\t\t\t\t}\n\n\t\t\t\tpath.unshift(index);\n\t\t\t}\n\n\t\t\treturn parent? path : null;\n\t\t}\n\t},\n\n\t/**\n\t * Revocably add/remove elements from the DOM\n\t */\n\trevocably: {\n\t\tadd: function(element, insert) {\n\t\t\tvar comment = _.revocably.isRemoved(element);\n\n\t\t\tif (comment?.parentNode) {\n\t\t\t\tcomment.parentNode.replaceChild(element, comment);\n\t\t\t}\n\t\t\telse if (element && insert && !element.parentNode) {\n\t\t\t\t// Has not been revocably removed because it has never even been added\n\t\t\t\tif (typeof insert === \"function\") {\n\t\t\t\t\tinsert(element);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tinsert.appendChild(element);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn comment;\n\t\t},\n\n\t\tremove: function(element, commentText) {\n\t\t\tif (!element) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar comment = _.data(element, \"commentstub\");\n\n\t\t\tif (!comment) {\n\t\t\t\tcommentText = commentText || element.id || element.className || element.nodeName;\n\t\t\t\tcomment = _.data(element, \"commentstub\", document.createComment(commentText));\n\t\t\t}\n\n\t\t\tif (element.parentNode) {\n\t\t\t\t// In DOM, remove\n\t\t\t\telement.parentNode.replaceChild(comment, element);\n\t\t\t}\n\n\t\t\treturn comment;\n\t\t},\n\n\t\tisRemoved: function(element) {\n\t\t\tif (!element || element.parentNode) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar comment = _.data(element, \"commentstub\");\n\n\t\t\tif (comment?.parentNode) {\n\t\t\t\treturn comment;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\tsetAttribute: function(element, attribute, value) {\n\t\t\tvar previousValue = _.data(element, \"attribute-\" + attribute);\n\n\t\t\tif (previousValue === undefined) {\n\t\t\t\t// Only set this when there's no old value stored, otherwise\n\t\t\t\t// if called multiple times, it could result in losing the original value\n\t\t\t\t_.data(element, \"attribute-\" + attribute, element.getAttribute(attribute));\n\t\t\t}\n\n\t\t\telement.setAttribute(attribute, value);\n\t\t},\n\n\t\trestoreAttribute: function(element, attribute) {\n\t\t\tvar previousValue = _.data(element, \"attribute-\" + attribute);\n\n\t\t\tif (previousValue !== undefined) {\n\t\t\t\t$.toggleAttribute(element, attribute, previousValue);\n\t\t\t\t_.data(element, \"attribute-\" + attribute, undefined);\n\t\t\t}\n\t\t}\n\t},\n\n\tinView: {\n\t\tis: element => {\n\t\t\tvar r = element.getBoundingClientRect();\n\n\t\t\treturn (0 <= r.bottom && r.bottom <= innerHeight || 0 <= r.top && r.top <= innerHeight) // vertical\n\t\t\t       && (0 <= r.right && r.right <= innerWidth || 0 <= r.left && r.left <= innerWidth); // horizontal\n\t\t},\n\n\t\twhen: (element, rootMargin = `${innerHeight / 2}px ${innerWidth/2}px`) => {\n\t\t\tvar observer = _.inView.observer = _.inView.observer || new IntersectionObserver(function(entries, observer) {\n\t\t\t\tentries.forEach(entry => {\n\t\t\t\t\tif (entry.intersectionRatio > 0) {\n\t\t\t\t\t\tobserver.unobserve(entry.target);\n\t\t\t\t\t\t$.fire(entry.target, \"mv-inview\", {entry});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, {rootMargin});\n\n\t\t\treturn new Promise(resolve => {\n\t\t\t\tif (_.is(element)) {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\n\t\t\t\tobserver.observe(element);\n\n\t\t\t\tvar callback = evt => {\n\t\t\t\t\telement.removeEventListener(\"mv-inview\", callback);\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\n\t\t\t\telement.addEventListener(\"mv-inview\", callback);\n\t\t\t});\n\t\t}\n\t},\n\n\tscrollIntoViewIfNeeded: element => {\n\t\tif (element && !Mavo.inView.is(element)) {\n\t\t\telement.scrollIntoView({behavior: \"smooth\"});\n\t\t}\n\t},\n\n\t/**\n\t * Set attribute only if it doesnt exist\n\t */\n\tsetAttributeShy: function(element, attribute, value) {\n\t\tif (!element.hasAttribute(attribute)) {\n\t\t\telement.setAttribute(attribute, value);\n\t\t}\n\t},\n\n\t/**\n\t * Get the value of an attribute, with fallback attributes in priority order.\n\t */\n\tgetAttribute: function(element, ...attributes) {\n\t\tfor (let i=0, attribute; attribute = attributes[i]; i++) {\n\t\t\tlet value = element.getAttribute(attribute);\n\n\t\t\tif (value) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\tgetClosestAttribute: function(element, attribute) {\n\t\treturn element.closest(`[${attribute}]`)?.getAttribute(attribute) ?? null;\n\t},\n\n\t/**\n\t * Get the element identified by the URL hash\n\t */\n\tgetTarget: function() {\n\t\tvar id = location.hash.substr(1);\n\t\treturn document.getElementById(id);\n\t},\n\n\tXPath: function(query, context = document) {\n\t\tvar doc = context.ownerDocument || context;\n\t\tvar ret = [], node;\n\n\t\tif (doc.evaluate) {\n\t\t\tvar result = doc.evaluate(query, context, null, XPathResult.ANY_TYPE, null);\n\n\t\t\twhile (node = result.iterateNext()) {\n\t\t\t\tret.push(node);\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\t// Returns attribute nodes that start with `str` on or inside `context`\n\t// Use getAttributes() instead if you are only looking at the element itself and not its subtree\n\t// Use attr.ownerElement to get element\n\tattributeStartsWith: function(str, context = document.documentElement) {\n\t\treturn _.XPath(`.//@*[starts-with(name(), \"${str}\")]`, context);\n\t},\n\n\t// Returns attribute names that match a regex\n\tgetAttributes: function(element, regex) {\n\t\treturn element.getAttributeNames().filter(name => regex.test(name));\n\t},\n\n\t/**\n\t * Object utilities\n\t */\n\n\t/**\n\t * Check if property exists in object. Like the in operator but more robust and does not throw.\n\t * Why not just in? E.g. \"foo\".length is 3 but \"length\" in \"foo\" throws\n\t */\n\tin: function(property, obj) {\n\t\tif (obj) {\n\t\t\treturn (typeof obj === \"object\" && property in obj) || obj[property] !== undefined;\n\t\t}\n\t},\n\n\t/**\n\t * Get real property name from case insensitive property\n\t */\n\tgetCanonicalProperty: function(obj, property) {\n\t\tif (obj && (property || property === 0)) {\n\t\t\t// Property in object?\n\t\t\tif (_.in(property, obj)) {\n\t\t\t\treturn property;\n\t\t\t}\n\n\t\t\tif (property.toLowerCase) {\n\t\t\t\t// Lowercase property in object?\n\t\t\t\tvar propertyL = property.toLowerCase();\n\n\t\t\t\tif (_.in(propertyL, obj)) {\n\t\t\t\t\treturn propertyL;\n\t\t\t\t}\n\n\t\t\t\t// Any case property in object?\n\t\t\t\tvar properties = Object.keys(obj);\n\t\t\t\tvar i = properties.map(p => p.toLowerCase()).indexOf(propertyL);\n\n\t\t\t\tif (i > -1) {\n\t\t\t\t\treturn properties[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tsubset: function(obj, path, value) {\n\t\tif (arguments.length == 3) {\n\t\t\t// Put\n\t\t\tif (path.length) {\n\t\t\t\tvar last = path[path.length - 1];\n\t\t\t\tvar parent = $.value(obj, ...path.slice(0, -1));\n\n\t\t\t\tif (Array.isArray(parent) && Array.isArray(value)) {\n\t\t\t\t\t// Merge arrays instead of adding array inside array\n\t\t\t\t\tparent.splice(last, 1, ...value);\n\t\t\t\t}\n\t\t\t\telse if (parent) {\n\t\t\t\t\tparent[path[path.length - 1]] = value;\n\t\t\t\t}\n\n\t\t\t\treturn obj;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\t\telse if (typeof obj == \"object\" && path?.length) { // Get\n\t\t\treturn path.reduce((obj, property, i) => {\n\t\t\t\tvar meta = {};\n\t\t\t\tvar ret = Mavo.Functions.get(obj, property, meta);\n\n\t\t\t\t// We don't yet support multiple properties at the same level\n\t\t\t\t// i.e. the path can't be for the 2nd and 3rd item\n\t\t\t\tpath[i] = Array.isArray(meta.property)? meta.property[0] : meta.property;\n\n\t\t\t\tif (ret === undefined && meta.query) {\n\t\t\t\t\t// Not found, return dummy if query\n\t\t\t\t\tret = {[meta.query.property]: meta.query.value};\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t}, obj);\n\t\t}\n\t\telse {\n\t\t\treturn obj;\n\t\t}\n\t},\n\n\tclone: function(o) {\n\t\tif (!o || typeof o !== \"object\") {\n\t\t\treturn o;\n\t\t}\n\n\t\treturn JSON.parse(_.safeToJSON(o));\n\t},\n\n\t// Will not work for symbols\n\tshallowClone: function(o) {\n\t\tif (!o || typeof o !== \"object\") {\n\t\t\treturn o;\n\t\t}\n\n\t\tif (Array.isArray(o)) {\n\t\t\treturn [...o];\n\t\t}\n\n\t\treturn $.extend({}, o);\n\t},\n\n\t// Credit: https://remysharp.com/2010/07/21/throttling-function-calls\n\tdebounce: function (fn, delay) {\n\t\tif (!delay) {\n\t\t\t// No throttling\n\t\t\treturn fn;\n\t\t}\n\n\t\tvar timer = null, code;\n\n\t\treturn function () {\n\t\t\tvar context = this, args = arguments;\n\n\t\t\tcode = function () {\n\t\t\t\tfn.apply(context, args);\n\t\t\t\tremoveEventListener(\"beforeunload\", code);\n\t\t\t};\n\n\t\t\tclearTimeout(timer);\n\t\t\ttimer = setTimeout(code, delay);\n\t\t\taddEventListener(\"beforeunload\", code);\n\t\t};\n\t},\n\n\tescapeRegExp: s => s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\"),\n\n\tobserveResize: function(element, callbackOrObserver) {\n\t\tif (!self.ResizeObserver) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar previousRect = null;\n\t\tvar ro = callbackOrObserver instanceof ResizeObserver? callbackOrObserver : new ResizeObserver(entries => {\n\t\t\tvar contentRect = entries[entries.length - 1].contentRect;\n\n\t\t\tif (previousRect\n\t\t\t\t&& previousRect.width == contentRect.width\n\t\t\t\t&& previousRect.height == contentRect.height) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcallbackOrObserver(entries);\n\n\t\t\tpreviousRect = contentRect;\n\t\t});\n\n\t\tro.observe(element);\n\n\t\treturn ro;\n\t},\n\n\tObserver: class Observer {\n\t\tconstructor (element, attribute, callback, o = {}) {\n\t\t\tif (callback instanceof MutationObserver) {\n\t\t\t\tthis.observer = callback;\n\t\t\t}\n\n\t\t\tthis.observer = this.observer || new MutationObserver(callback);\n\t\t\tthis.callback = callback;\n\t\t\tthis.update(element, attribute, o);\n\n\t\t\tthis.run();\n\t\t}\n\n\t\tupdate (element, attribute, options) {\n\t\t\tthis.element = element;\n\t\t\tthis.attribute = attribute;\n\t\t\tthis.options = $.extend({}, options);\n\n\t\t\t// We use the user-provided options object verbatim if it exists and\n\t\t\t// is valid, i.e. has at least one of the required properties\n\t\t\tif (options === undefined || !options.attributes && !options.childList && !options.characterData) {\n\t\t\t\tif (this.attribute) {\n\t\t\t\t\tObject.assign(this.options, {\n\t\t\t\t\t\tattributes: true,\n\t\t\t\t\t\tattributeFilter: this.attribute == \"all\"? undefined : Mavo.toArray(this.attribute),\n\t\t\t\t\t\tattributeOldValue: !!options.oldValue\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (!this.attribute || this.attribute == \"all\") {\n\t\t\t\t\tObject.assign(this.options, {\n\t\t\t\t\t\tcharacterData: true,\n\t\t\t\t\t\tchildList: true,\n\t\t\t\t\t\tsubtree: true,\n\t\t\t\t\t\tcharacterDataOldValue: !!options.oldValue\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.observer?.running) {\n\t\t\t\tthis.stop();\n\t\t\t\tthis.run();\n\t\t\t}\n\t\t}\n\n\t\tflush () {\n\t\t\tlet records = this.observer?.takeRecords();\n\n\t\t\tif (records) {\n\t\t\t\tthis.callback(records);\n\t\t\t}\n\t\t}\n\n\t\tstop () {\n\t\t\tthis.observer?.disconnect();\n\t\t\tthis.running = false;\n\t\t\treturn this;\n\t\t}\n\n\t\trun () {\n\t\t\tif (this.observer) {\n\t\t\t\tthis.observer.observe(this.element, this.options);\n\t\t\t\tthis.running = true;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Like stop(), but saves running state and then resumes it\n\t\t */\n\t\tpause () {\n\t\t\tthis.runOnResume = this.running;\n\t\t\tthis.stop();\n\t\t}\n\n\t\t/**\n\t\t * Like run(), but runs only if observer was running before pause().\n\t\t */\n\t\tresume () {\n\t\t\tif (this.runOnResume !== false) {\n\t\t\t\tthis.run();\n\t\t\t}\n\n\t\t\tdelete this.runOnResume;\n\t\t}\n\n\t\tdestroy () {\n\t\t\tthis.stop();\n\t\t\tthis.observer = this.element = null;\n\t\t}\n\t},\n\n\t/**\n\t * Run & Return a function\n\t */\n\trr: function(f) {\n\t\tf();\n\t\treturn f;\n\t},\n\n\t// Get out of bounds array index to wrap around\n\twrap: (index, length) => index < 0? length - 1 : index >= length? 0 : index,\n\n\t/**\n\t * Parses a simple CSS-like text format for declaring key-value options:\n\t * Pairs are comma or semicolon-separated, key and value are colon separated.\n\t * Escapes are supported, via backslash. Useful for attributes.\n\t */\n\toptions: str => {\n\t\tvar ret = {};\n\n\t\tstr.trim().match(/(?:\\\\[,;]|[^,;])+/g)?.forEach(option => {\n\t\t\tif (option) {\n\t\t\t\toption = option.trim().replace(/\\\\([,;])/g, \"$1\");\n\t\t\t\tvar pair = option.match(/^\\s*((?:\\\\:|[^:])+?)\\s*:\\s*(.+)$/);\n\n\t\t\t\tif (pair) {\n\t\t\t\t\tret[pair[1].replace(/\\\\:/g, \":\")] = pair[2];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// If no value, it's boolean\n\t\t\t\t\tret[option] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn ret;\n\t},\n\n\t/**\n\t * Map that can hold multiple values per key\n\t */\n\tBucketMap: class BucketMap {\n\t\tconstructor({arrays = false} = {}) {\n\t\t\tthis.map = new Map();\n\t\t\tthis[Symbol.iterator] = this.map[Symbol.iterator];\n\t\t\tthis.arrays = arrays;\n\t\t}\n\n\t\tset(key, value) {\n\t\t\tif (this.arrays) {\n\t\t\t\tvar values = this.map.get(key) || [];\n\t\t\t\tvalues.push(value);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar values = this.map.get(key) || new Set();\n\t\t\t\tvalues.add(value);\n\t\t\t}\n\n\t\t\tthis.map.set(key, values);\n\t\t}\n\n\t\tdelete(key, value) {\n\t\t\tif (arguments.length == 2) {\n\t\t\t\tvar values = this.map.get(key);\n\n\t\t\t\tif (values) {\n\t\t\t\t\tif (this.arrays) {\n\t\t\t\t\t\t_.delete(values, value);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvalues.delete(value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.map.delete(key);\n\t\t\t}\n\t\t}\n\n\t\tforEach(...args) {\n\t\t\treturn this.map.forEach(...args);\n\t\t}\n\t}\n});\n\n/**\n * Collection of fake \"observers\" implemented over one large MutationObserver\n */\n_.Observers = class Observers extends Map {\n\tconstructor({observer, callback} = {}) {\n\t\tsuper();\n\n\t\tlet self = _.Observers;\n\t\tthis.callback = callback || self.callback;\n\t\tthis.observer = observer || (self.observer = self.observer || new MutationObserver(this.callback));\n\t}\n\n\tapplyRecord (r) {\n\t\tfor (let [o, callback] of this.entries()) {\n\t\t\tif (_.Observers.matchesRecord(o, r)) {\n\t\t\t\t// If we are here, the observer matches\n\t\t\t\tcallback.call(this, {\n\t\t\t\t\tnode: Mavo.Node.get(r.target, true),\n\t\t\t\t\telement: r.target,\n\t\t\t\t\ttype: r.type,\n\t\t\t\t\tattribute: r.attributeName,\n\t\t\t\t\trecord: r\n\t\t\t\t});\n\n\t\t\t\tif (o.once) {\n\t\t\t\t\tthis.unobserve(o, callback);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic matchesRecord (o, r) {\n\t\tif (o.active === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet element = r.target;\n\n\t\tif (o.selector && !element.matches?.(o.selector)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (o.attribute) {\n\t\t\t// We are monitoring attribute changes only\n\t\t\tif (r.type !== \"attributes\") {\n\t\t\t\t// Not an attribute change\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (o.attribute !== true && o.attribute !== r.attributeName && !o.attribute.includes?.(r.attributeName)) {\n\t\t\t\t// We are monitoring specific attribute(s), and a different one changed\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\telse if (r.type === \"attributes\" && o.attribute === false) {\n\t\t\t// We explicitly opted out monitoring attributes, and an attribute has changed\n\t\t\treturn false;\n\t\t}\n\n\t\tif (o.element) {\n\t\t\tif (o.deep === false) {\n\t\t\t\treturn element === o.element;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn o.element.contains(element);\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tflush () {\n\t\tlet records = this.observer.takeRecords();\n\n\t\tif (records) {\n\t\t\tthis.callback(records);\n\t\t}\n\t}\n\n\tobserve (o = {}, callback) {\n\t\tthis.set(o, callback);\n\t\treturn callback;\n\t}\n\n\tunobserve (options, callback) {\n\t\tlet matches = this.find(options, callback);\n\n\t\tfor (let [o, c] of matches.entries()) {\n\t\t\tthis.delete(o);\n\t\t}\n\t}\n\n\tpause (options) {\n\t\tlet matches = this.find(options);\n\n\t\tfor (let [o, c] of matches.entries()) {\n\t\t\t// Decativate and store active state\n\t\t\to._active = o.active !== false && o._active !== false;\n\t\t\to.active = false;\n\t\t}\n\n\t\tthis.flush();\n\n\t\treturn matches;\n\t}\n\n\tresume (matches) {\n\t\tif (!(matches instanceof _.Observers)) {\n\t\t\tmatches = this.find(matches);\n\t\t}\n\n\t\tthis.flush();\n\n\t\tfor (let [o, c] of matches.entries()) {\n\t\t\t// Restore active state\n\t\t\to.active = o.active || o._active;\n\t\t\tdelete o._active;\n\t\t}\n\t}\n\n\tfind (options, callback) {\n\t\tlet keys = Object.keys(options);\n\t\tlet ret = new Mavo.Observers();\n\n\t\tfor (let [o, c] of this.entries()) {\n\t\t\tif (callback && callback !== c) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (keys.every(k => o[k] === options[k])) {\n\t\t\t\tret.set(o, c);\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t}\n};\n\n// Default callback\n_.Observers.callback = records => {\n\tif (this.size === 0) {\n\t\treturn;\n\t}\n\n\tfor (let r of records) {\n\t\t_.observers.applyRecord(r);\n\t}\n};\n\n// Bliss plugins\n\n// Provide shortcuts to long property chains\n$.proxy = $.classProps.proxy = $.overload(function(obj, property, proxy) {\n\tObject.defineProperty(obj, property, {\n\t\tget: function() {\n\t\t\treturn this[proxy][property];\n\t\t},\n\t\tset: function(value) {\n\t\t\tthis[proxy][property] = value;\n\t\t},\n\t\tconfigurable: true,\n\t\tenumerable: true\n\t});\n\n\treturn obj;\n});\n\n// :target-within shim\nfunction updateTargetWithin() {\n\tvar element = _.getTarget();\n\tconst cl = \"mv-target-within\";\n\n\t$$(\".\" + cl).forEach(el => el.classList.remove(cl));\n\n\twhile (element?.classList) {\n\t\telement.classList.add(cl);\n\t\telement = element.parentNode;\n\t}\n};\n\ndocument.addEventListener(\"mv-load\", updateTargetWithin);\naddEventListener(\"hashchange\", updateTargetWithin);\nMavo.observe({attribute: \"id\"}, updateTargetWithin);\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Locale = $.Class({\n\tconstructor: function(lang, phrases) {\n\t\tthis.lang = lang;\n\t\tthis.phrases = {};\n\t\tthis.extend(phrases);\n\t},\n\n\tget fallback() {\n\t\t// TODO should we fallback to other dialects? I.e. should en-US fallback to en-GB if en didn't exist?\n\t\tif (_.all[this.baseLang]) {\n\t\t\treturn _.all[this.baseLang];\n\t\t}\n\n\t\tif (this !== _.default) {\n\t\t\treturn _.default;\n\t\t}\n\t},\n\n\textend: function(phrases) {\n\t\t$.extend(this.phrases, phrases);\n\t},\n\n\tphrase: function(id, vars) {\n\t\tvar key = id.toLowerCase();\n\t\tvar phrase = this.phrases[key];\n\n\t\tif (phrase === undefined && this.fallback) {\n\t\t\tphrase = this.fallback.phrase(key);\n\t\t}\n\n\t\tif (phrase === undefined) {\n\t\t\t// Everything failed, use id\n\t\t\tphrase = key.replace(/\\b-\\b/g, \" \");\n\t\t}\n\t\telse if (vars) {\n\t\t\tvar keys = phrase.match(/\\{\\w+(?=\\})/g)?.map(v => v.slice(1)) ?? [];\n\t\t\tMavo.Functions.unique(keys).forEach(name => {\n\t\t\t\tif (name in vars) {\n\t\t\t\t\tphrase = phrase.replace(RegExp(`{${name}}`, \"gi\"), vars[name]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn phrase;\n\t},\n\n\tlive: {\n\t\tlang: function(lang) {\n\t\t\tthis.baseLang = _.getBaseLang(lang);\n\n\t\t\tif (lang == this.baseLang) {\n\t\t\t\tthis.baseLang = null;\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: {},\n\n\t\t/**\n\t\t * Register new locale or extend existing locale\n\t\t */\n\t\tregister: function(lang, phrases) {\n\t\t\tif (_.all[lang]) {\n\t\t\t\t_.all[lang].extend(phrases);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_.all[lang] = new _(lang, phrases);\n\t\t\t}\n\t\t},\n\n\t\t// Get locale for a given language, use its base as fallback\n\t\tmatch: function(lang = \"\") {\n\t\t\treturn _.all[lang] || _.all[_.getBaseLang(lang)];\n\t\t},\n\n\t\t// Get locale for a given language, use its base as fallback, and the default locale if nothing exists\n\t\tget: function(lang) {\n\t\t\treturn _.match(lang) || _.default;\n\t\t},\n\n\t\tgetBaseLang: function(lang) {\n\t\t\treturn lang.split(\"-\")[0];\n\t\t},\n\n\t\tlazy: {\n\t\t\tdefault: () => {\n\t\t\t\treturn _.match(Mavo.locale) || _.all.en;\n\t\t\t}\n\t\t}\n\t}\n});\n\n/**\n * Use phrase\n */\nMavo.prototype._ = function(id, vars) {\n\treturn this.locale && id? this.locale.phrase(id, vars) : id;\n};\n\nMavo.ready.then(() => {\n\t$$(\"datalist.mv-phrases[lang]\").forEach(datalist => {\n\t\tvar phrases = $$(\"option\", datalist).reduce((o, option) => {\n\t\t\to[option.value] = option.textContent.trim();\n\t\t\treturn o;\n\t\t}, {});\n\n\t\tMavo.Locale.register(datalist.lang, phrases);\n\t});\n});\n\n})(Bliss, Bliss.$);\n\nMavo.Locale.register(\"en\", {\n\t\"second\": \"second\",\n\t\"seconds\": \"seconds\",\n\t\"minute\": \"minute\",\n\t\"minutes\": \"minutes\",\n\t\"hour\": \"hour\",\n\t\"hours\": \"hours\",\n\t\"day\": \"day\",\n\t\"days\": \"days\",\n\t\"week\": \"week\",\n\t\"weeks\": \"weeks\",\n\t\"month\": \"month\",\n\t\"months\": \"months\",\n\t\"year\": \"year\",\n\t\"years\": \"years\",\n\t\"edit\": \"Edit\",\n\t\"editing\": \"Editing\",\n\t\"save\": \"Save\",\n\t\"import\": \"Import\",\n\t\"export\": \"Export\",\n\t\"logout\": \"Logout\",\n\t\"login\": \"Login\",\n\t\"loading\": \"Loading\",\n\t\"uploading\": \"Uploading\",\n\t\"saving\": \"Saving\",\n\t\"dismiss\": \"Dismiss\",\n\t\"logged-in-as\": \"Logged in to {id} as \",\n\t\"login-to\": \"Login to {id}\",\n\t\"error-uploading\": \"Error uploading file\",\n\t\"cannot-load-uploaded-file\": \"Cannot load uploaded file\",\n\t\"filename\": \"Filename?\",\n\t\"problem-saving\": \"Problem saving data\",\n\t\"problem-loading\": \"Problem loading data\",\n\t\"cannot-parse\": \"Cant understand this file\",\n\t\"http-error\": \"HTTP error {status}: {statusText}\",\n\t\"cant-connect\": \"Cant connect to the Internet\",\n\t\"add-item\": \"Add {name}\",\n\t\"add-item-before\": \"Add new {name} before\",\n\t\"add-item-after\": \"Add new {name} after\",\n\t\"drag-to-reorder\": \"Drag to reorder {name}\",\n\t\"delete-item\": \"Delete this {name}\",\n\t\"item-deleted\": \"{name} deleted\",\n\t\"n-items\": \"{n} {name} items\",\n\t\"undo\": \"Undo\",\n\t\"gh-updated-file\": \"Updated {name}\",\n\t\"gh-login-fork-options\": \"You have your own copy of this page, would you like to use it?\",\n\t\"gh-use-my-fork\": \"Yes, show me my data.\"\n});\n\n(function ($, $$) {\n\nMavo.attributes.push(\"mv-plugins\");\n\nvar _ = Mavo.Plugins = {\n\tloaded: {},\n\n\tasync load () {\n\t\t_.plugins = new Set();\n\n\t\t$$(\"[mv-plugins]\").forEach(element => {\n\t\t\telement\n\t\t\t\t.getAttribute(\"mv-plugins\").trim().split(/\\s+/)\n\t\t\t\t.forEach(plugin => _.plugins.add(plugin));\n\t\t});\n\n\t\tif (!_.plugins.size) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Fetch plugin index\n\t\tlet response = await fetch(_.url + \"/plugins.json\");\n\t\tlet json = await response.json();\n\t\tlet plugin = json.plugin;\n\n\t\t// Fetch plugins\n\t\treturn Mavo.thenAll(plugin\n\t\t\t.filter(plugin => _.plugins.has(plugin.id))\n\t\t\t.map(plugin => {\n\t\t\t\tif (_.loaded[plugin.id]) {\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\n\t\t\t\t// Load plugin\n\t\t\t\tvar filename = `mavo-${plugin.id}.js`;\n\n\t\t\t\tif (plugin.repo) {\n\t\t\t\t\t// Plugin hosted in a separate repo\n\t\t\t\t\tvar url = `https://cdn.jsdelivr.net/gh/${plugin.repo}@master/${filename}`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Plugin hosted in the mavo-plugins repo\n\t\t\t\t\tvar url = `${_.url}/${plugin.id}/${filename}`;\n\t\t\t\t}\n\n\t\t\t\treturn $.include(_.loaded[plugin.id], url);\n\t\t\t}));\n\t},\n\n\tregister: function(name, o = {}) {\n\t\tif (_.loaded[name]) {\n\t\t\t// Do not register same plugin twice\n\t\t\treturn;\n\t\t}\n\n\t\tMavo.hooks.add(o.hooks);\n\n\t\tfor (let Class in o.extend) {\n\t\t\tlet existing = Class == \"Mavo\"? Mavo : Mavo[Class];\n\n\t\t\tif ($.type(existing) === \"function\") {\n\t\t\t\t$.Class(existing, o.extend[Class]);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$.extend(existing, o.extend[Class]);\n\t\t\t}\n\t\t}\n\n\t\tvar ready = [];\n\n\t\tif (o.ready) {\n\t\t\tready.push(o.ready);\n\t\t}\n\n\t\tif (o.dependencies) {\n\t\t\tvar base = document.currentScript? document.currentScript.src : location;\n\t\t\tvar dependencies = o.dependencies.map(url => Mavo.load(url, base));\n\t\t\tready.push(...dependencies);\n\t\t}\n\n\t\tif (ready.length) {\n\t\t\tMavo.dependencies.push(...ready);\n\t\t}\n\n\t\t_.loaded[name] = o;\n\n\t\tif (o.init) {\n\t\t\tPromise.all(ready).then(() => o.init());\n\t\t}\n\t},\n\n\turl: \"https://plugins.mavo.io\"\n};\n\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\nMavo.attributes.push(\"mv-bar\");\n\nvar _ = Mavo.UI.Bar = $.Class({\n\tconstructor: function(mavo) {\n\t\tthis.mavo = mavo;\n\n\t\tthis.element = $(\".mv-bar\", this.mavo.element);\n\t\tthis.template = this.mavo.element.getAttribute(\"mv-bar\") || \"\";\n\n\t\tif (this.element) {\n\t\t\tthis.custom = true;\n\t\t\tthis.template += \" \" + (this.element.getAttribute(\"mv-bar\") || \"\");\n\t\t\tthis.template = this.template.trim();\n\n\t\t\tfor (let id in _.controls) {\n\t\t\t\tthis[id] = $(`.mv-${id}`, this.element);\n\n\t\t\t\tif (this[id]) {\n\t\t\t\t\tthis.template = this.template || \"with\";\n\t\t\t\t\tthis.template += ` ${id}`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.element = $.create({\n\t\t\t\tclassName: \"mv-bar mv-ui\",\n\t\t\t\tstart: this.mavo.element,\n\t\t\t\tinnerHTML: \"<button>&nbsp;</button>\"\n\t\t\t});\n\t\t}\n\n\t\tif (this.element.classList.contains(\"mv-compact\")) {\n\t\t\tthis.noResize = true;\n\t\t}\n\n\t\tthis.controls = _.getControls(this.template);\n\n\t\tif (this.controls.length) {\n\t\t\t// Measure height of 1 row\n\t\t\tthis.targetHeight = this.element.offsetHeight;\n\t\t}\n\n\t\tif (!this.custom) {\n\t\t\tthis.element.innerHTML = \"\";\n\t\t}\n\n\t\tthis.controls.forEach(id => {\n\t\t\tlet o = _.controls[id];\n\n\t\t\tif (this[id]) {\n\t\t\t\t// Custom control, remove to not mess up order\n\t\t\t\tthis[id].remove();\n\t\t\t}\n\n\t\t\tif (o.create) {\n\t\t\t\tthis[id] = o.create.call(this.mavo, this[id]);\n\t\t\t}\n\t\t\telse if (!this[id]) {\n\t\t\t\tthis[id] = $.create(\"button\", {\n\t\t\t\t\ttype: \"button\",\n\t\t\t\t\tclassName: `mv-${id}`,\n\t\t\t\t\ttextContent: this.mavo._(id)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// We initially add all of them to retain order,\n\t\t\t// then we remove revocably when/if needed\n\t\t\tthis.add(id);\n\n\t\t\tif (o.permission) {\n\t\t\t\tthis.permissions.can(o.permission, () => {\n\t\t\t\t\tthis.toggle(id, !o.condition || o.condition.call(this.mavo));\n\t\t\t\t}, () => {\n\t\t\t\t\tthis.remove(id);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (o.condition && !o.condition.call(this.mavo)) {\n\t\t\t\tthis.remove(id);\n\t\t\t}\n\n\t\t\tfor (var events in o.events) {\n\t\t\t\t$.bind(this[id], events, o.events[events].bind(this.mavo));\n\t\t\t}\n\t\t});\n\n\t\tfor (let id in _.controls) {\n\t\t\tlet o = _.controls[id];\n\n\t\t\tif (o.action) {\n\t\t\t\t$.delegate(this.mavo.element, \"click\", \".mv-\" + id, evt => {\n\t\t\t\t\tif (!o.permission || this.permissions.is(o.permission)) {\n\t\t\t\t\t\to.action.call(this.mavo);\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (this.controls.length && !this.noResize) {\n\t\t\tthis.resize();\n\n\t\t\tif (self.ResizeObserver) {\n\t\t\t\tthis.resizeObserver = Mavo.observeResize(this.element, entries => {\n\t\t\t\t\tthis.resize();\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tresize: function() {\n\t\tif (!this.targetHeight) {\n\t\t\t// We don't have a correct measurement for target height, abort\n\t\t\tthis.targetHeight = this.element.offsetHeight;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.resizeObserver?.disconnect();\n\n\t\tthis.element.classList.remove(\"mv-compact\", \"mv-tiny\");\n\n\t\t// Remove pointless tooltips\n\t\t$$(\"button, .mv-button\", this.element).forEach(button => {\n\t\t\tif (button.title === button.textContent) {\n\t\t\t\tbutton.title = \"\";\n\t\t\t}\n\t\t});\n\n\t\t// Exceeded single row?\n\t\tif (this.element.offsetHeight > this.targetHeight * 1.6) {\n\t\t\tthis.element.classList.add(\"mv-compact\");\n\n\t\t\tif (this.element.offsetHeight > this.targetHeight * 1.2) {\n\t\t\t\t// Still too tall\n\t\t\t\tthis.element.classList.add(\"mv-tiny\");\n\n\t\t\t\t// Add tooltips, since only icons will be visible\n\t\t\t\t$$(\"button, .mv-button\", this.element).forEach(button => {\n\t\t\t\t\tif (!button.title) {\n\t\t\t\t\t\tbutton.title = button.textContent;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.resizeObserver?.observe(this.element);\n\t},\n\n\tadd: function(id) {\n\t\tvar o = _.controls[id];\n\n\t\tif (o.prepare) {\n\t\t\to.prepare.call(this.mavo);\n\t\t}\n\n\t\tMavo.revocably.add(this[id], this.element);\n\n\t\tif (!this.resizeObserver && !this.noResize) {\n\t\t\trequestAnimationFrame(() => this.resize());\n\t\t}\n\t},\n\n\tremove: function(id) {\n\t\tvar o =_.controls[id];\n\n\t\tMavo.revocably.remove(this[id], \"mv-\" + id);\n\n\t\tif (o.cleanup) {\n\t\t\to.cleanup.call(this.mavo);\n\t\t}\n\n\t\tif (!this.resizeObserver && !this.noResize) {\n\t\t\trequestAnimationFrame(() => this.resize());\n\t\t}\n\t},\n\n\ttoggle: function(id, add) {\n\t\treturn this[add? \"add\" : \"remove\"](id);\n\t},\n\n\tproxy: {\n\t\t\"permissions\": \"mavo\"\n\t},\n\n\tdestroy () {\n\t\tthis.resizeObserver.disconnect();\n\t\tthis.resizeObserver = null;\n\t},\n\n\tstatic: {\n\t\tgetControls: function(template) {\n\t\t\tvar all = Object.keys(_.controls);\n\n\t\t\tif (template && (template = template.trim())) {\n\t\t\t\tif (template == \"none\") {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\tvar relative = /^with\\s|\\b(yes|no)-\\w+\\b/.test(template);\n\t\t\t\ttemplate = template.replace(/\\byes-|^with\\s+/g, \"\");\n\t\t\t\tvar ids = template.split(/\\s+/);\n\n\t\t\t\t// Drop duplicates (last one wins)\n\t\t\t\tids = Mavo.Functions.unique(ids.reverse()).reverse();\n\n\t\t\t\tif (relative) {\n\t\t\t\t\treturn all.filter(id => {\n\t\t\t\t\t\tvar positive = ids.lastIndexOf(id);\n\t\t\t\t\t\tvar negative = ids.lastIndexOf(\"no-\" + id);\n\t\t\t\t\t\tvar keep = positive > Math.max(-1, negative);\n\t\t\t\t\t\tvar drop = negative > Math.max(-1, positive);\n\n\t\t\t\t\t\treturn keep || (!_.controls[id].optional && !drop);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn ids;\n\t\t\t}\n\n\t\t\t// No template, return default set\n\t\t\treturn all.filter(id => !_.controls[id].optional);\n\t\t},\n\n\t\tcontrols: {\n\t\t\tstatus: {\n\t\t\t\tcreate: function(custom) {\n\t\t\t\t\treturn custom || $.create({\n\t\t\t\t\t\tclassName: \"mv-status\"\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tprepare: function() {\n\t\t\t\t\tvar backend = this.primaryBackend;\n\n\t\t\t\t\tif (backend?.user) {\n\t\t\t\t\t\tvar user = backend.user;\n\t\t\t\t\t\tvar html = [user.name || \"\"];\n\n\t\t\t\t\t\tif (user.avatar) {\n\t\t\t\t\t\t\thtml.unshift($.create(\"img\", {\n\t\t\t\t\t\t\t\tclassName: \"mv-avatar\",\n\t\t\t\t\t\t\t\tsrc: user.avatar\n\t\t\t\t\t\t\t}), \" \");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (user.url) {\n\t\t\t\t\t\t\thtml = [$.create(\"a\", {\n\t\t\t\t\t\t\t\thref: user.url,\n\t\t\t\t\t\t\t\ttarget: \"_blank\",\n\t\t\t\t\t\t\t\tcontents: html\n\t\t\t\t\t\t\t})];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.bar.status.textContent = \"\";\n\t\t\t\t\t\t$.contents(this.bar.status, [\n\t\t\t\t\t\t\t{tag: \"span\", innerHTML: this._(\"logged-in-as\", backend)},\n\t\t\t\t\t\t\t\" \",\n\t\t\t\t\t\t\t...html\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpermission: \"logout\"\n\t\t\t},\n\n\t\t\tedit: {\n\t\t\t\taction: function() {\n\t\t\t\t\tif (this.editing) {\n\t\t\t\t\t\tthis.done();\n\t\t\t\t\t\tthis.bar.edit.textContent = this._(\"edit\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.edit();\n\t\t\t\t\t\tthis.bar.edit.textContent = this._(\"editing\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpermission: [\"edit\", \"add\", \"delete\"],\n\t\t\t\tcleanup: function() {\n\t\t\t\t\tif (this.editing) {\n\t\t\t\t\t\tthis.done();\n\n\t\t\t\t\t\tif (this.bar?.edit) {\n\t\t\t\t\t\t\tthis.bar.edit.textContent = this._(\"edit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcondition: function() {\n\t\t\t\t\treturn this.needsEdit;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tsave: {\n\t\t\t\taction: function() {\n\t\t\t\t\tthis.save();\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t\"mouseenter focus\": function() {\n\t\t\t\t\t\tthis.element.classList.add(\"mv-highlight-unsaved\");\n\t\t\t\t\t},\n\t\t\t\t\t\"mouseleave blur\": function() {\n\t\t\t\t\t\tthis.element.classList.remove(\"mv-highlight-unsaved\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpermission: \"save\",\n\t\t\t\tcondition: function() {\n\t\t\t\t\treturn !this.autoSave || this.autoSaveDelay > 0;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\texport: {\n\t\t\t\tcreate: function(custom) {\n\t\t\t\t\tvar a;\n\n\t\t\t\t\tif (custom) {\n\t\t\t\t\t\ta = custom.matches(\"a\")? custom : $.create(\"a\", {\n\t\t\t\t\t\t\tclassName: \"mv-button\",\n\t\t\t\t\t\t\taround: custom\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ta = $.create(\"a\", {\n\t\t\t\t\t\t\tclassName: \"mv-export mv-button\",\n\t\t\t\t\t\t\ttextContent: this._(\"export\")\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\ta.setAttribute(\"download\", this.id + \".json\");\n\n\t\t\t\t\treturn a;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tmousedown: function() {\n\t\t\t\t\t\tthis.bar.export.href = \"data:application/json;charset=UTF-8,\" + encodeURIComponent(this.toJSON());\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tpermission: \"edit\",\n\t\t\t\toptional: true\n\t\t\t},\n\n\t\t\timport: {\n\t\t\t\tcreate: function(custom) {\n\t\t\t\t\tvar button = custom || $.create(\"span\", {\n\t\t\t\t\t\trole: \"button\",\n\t\t\t\t\t\ttabIndex: \"0\",\n\t\t\t\t\t\tclassName: \"mv-import mv-button\",\n\t\t\t\t\t\ttextContent: this._(\"import\"),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tfocus: evt => {\n\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tvar input = $.create(\"input\", {\n\t\t\t\t\t\ttype: \"file\",\n\t\t\t\t\t\tinside: button,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tchange: evt => {\n\t\t\t\t\t\t\t\tvar file = evt.target.files[0];\n\n\t\t\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\t\t\tvar reader = $.extend(new FileReader(), {\n\t\t\t\t\t\t\t\t\t\tonload: evt => {\n\t\t\t\t\t\t\t\t\t\t\tthis.inProgress = false;\n\n\t\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\t\tvar json = JSON.parse(reader.result);\n\t\t\t\t\t\t\t\t\t\t\t\tthis.render(json);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tthis.error(this._(\"cannot-parse\"));\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tonerror: evt => {\n\t\t\t\t\t\t\t\t\t\t\tthis.error(this._(\"problem-loading\"));\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tthis.inProgress = this._(\"uploading\");\n\t\t\t\t\t\t\t\t\treader.readAsText(file);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn button;\n\t\t\t\t},\n\t\t\t\toptional: true\n\t\t\t},\n\n\t\t\tlogin: {\n\t\t\t\taction: function() {\n\t\t\t\t\tthis.primaryBackend.login();\n\t\t\t\t},\n\t\t\t\tpermission: \"login\"\n\t\t\t},\n\n\t\t\tlogout: {\n\t\t\t\taction: function() {\n\t\t\t\t\tthis.primaryBackend.logout();\n\t\t\t\t},\n\t\t\t\tpermission: \"logout\"\n\t\t\t}\n\t\t},\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\nvar _ = Mavo.UI.Message = $.Class({\n\tconstructor: function(mavo, message, o = {}) {\n\t\tthis.mavo = mavo;\n\t\tthis.message = message;\n\t\tthis.closed = Mavo.promise();\n\t\tthis.options = o;\n\n\t\tthis.element = $.create({\n\t\t\tclassName: \"mv-ui mv-message\" + (o.type? \" mv-\" + o.type : \"\"),\n\t\t\t[$.type(this.message) == \"string\"? \"innerHTML\" : \"contents\"]: this.message,\n\t\t\tevents: {\n\t\t\t\tclick: e => Mavo.scrollIntoViewIfNeeded(this.mavo.element)\n\t\t\t},\n\t\t\t[this.mavo.bar? \"after\" : \"start\"]: (this.mavo.bar || this.mavo).element\n\t\t});\n\n\t\tif (o.style) {\n\t\t\t$.style(this.element, o.style);\n\t\t}\n\n\t\tif (o.classes) {\n\t\t\tthis.element.classList.add(...o.classes.split(/\\s+/));\n\t\t}\n\n\t\tif (o.type == \"error\") {\n\t\t\tthis.element.setAttribute(\"role\", \"alert\");\n\t\t}\n\t\telse {\n\t\t\tthis.element.setAttribute(\"aria-live\", \"polite\");\n\t\t}\n\n\t\to.dismiss = o.dismiss || {};\n\n\t\tif (typeof o.dismiss == \"string\" || Array.isArray(o.dismiss)) {\n\t\t\tvar dismiss = {};\n\n\t\t\tMavo.toArray(o.dismiss).forEach(prop => {\n\t\t\t\tdismiss[prop] = true;\n\t\t\t});\n\n\t\t\to.dismiss = dismiss;\n\t\t}\n\n\t\tif (o.dismiss.button) {\n\t\t\t$.create(\"button\", {\n\t\t\t\ttype: \"button\",\n\t\t\t\tclassName: \"mv-close mv-ui\",\n\t\t\t\ttextContent: \"\",\n\t\t\t\tevents: {\n\t\t\t\t\t\"click\": evt => this.close()\n\t\t\t\t},\n\t\t\t\tstart: this.element,\n\t\t\t\ttitle: this.mavo._(\"dismiss\")\n\t\t\t});\n\t\t}\n\n\t\tif (o.dismiss.timeout) {\n\t\t\tvar timeout = typeof o.dismiss.timeout === \"number\"? o.dismiss.timeout : 5000;\n\n\t\t\t$.bind(this.element, {\n\t\t\t\tmouseenter: e => clearTimeout(this.closeTimeout),\n\t\t\t\tmouseleave: Mavo.rr(e => this.closeTimeout = setTimeout(() => this.close(), timeout)),\n\t\t\t});\n\t\t}\n\n\t\tif (o.dismiss.submit) {\n\t\t\tthis.element.addEventListener(\"submit\", evt => {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tthis.close(evt.target);\n\t\t\t});\n\t\t}\n\t},\n\n\tasync close (resolve) {\n\t\t// clearTimeout, make the callback available for garbage collection, and make it easier to debug memory issues\n\t\t// it does nothing if there is no timeout callback.\n\t\tclearTimeout(this.closeTimeout);\n\t\tvar duration = this.element.style.transition ? 1000 * parseFloat(window.getComputedStyle(this.element, null).transitionDuration) : 400;\n\t\tawait $.transition(this.element, {opacity: 0}, duration);\n\n\t\t$.remove(this.element);\n\t\tthis.closed.resolve(resolve);\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Permissions = $.Class({\n\tconstructor: function(o) {\n\t\tthis.triggers = [];\n\t\tthis.hooks = new $.Hooks();\n\n\t\t// If we dont do this, there is no way to retrieve this from inside parentChanged\n\t\tthis.parentChanged = _.prototype.parentChanged.bind(this);\n\n\t\tthis.set(o);\n\t},\n\n\t// Set multiple permissions at once\n\tset: function(o) {\n\t\tfor (var action in o) {\n\t\t\tthis[action] = o[action];\n\t\t}\n\t},\n\n\t// Set a bunch of permissions to true. Chainable.\n\ton: function(actions) {\n\t\tMavo.toArray(actions).forEach(action => this[action] = true);\n\n\t\treturn this;\n\t},\n\n\t// Set a bunch of permissions to false. Chainable.\n\toff: function(actions) {\n\t\tactions = Array.isArray(actions)? actions : [actions];\n\n\t\tactions.forEach(action => this[action] = false);\n\n\t\treturn this;\n\t},\n\n\t// Fired once at least one of the actions passed can be performed\n\t// Kind of like a Promise that can be resolved multiple times.\n\tcan: function(actions, callback, cannot) {\n\t\tthis.observe(actions, true, callback);\n\n\t\tif (cannot) {\n\t\t\t// Fired once the action cannot be done anymore, even though it could be done before\n\t\t\tthis.cannot(actions, cannot);\n\t\t}\n\t},\n\n\t// Fired once NONE of the actions can be performed\n\tcannot: function(actions, callback) {\n\t\tthis.observe(actions, false, callback);\n\t},\n\n\t// Schedule a callback for when a set of permissions changes value\n\tobserve: function(actions, value, callback) {\n\t\tactions = Mavo.toArray(actions);\n\n\t\tif (this.is(actions, value)) {\n\t\t\t// Should be fired immediately\n\t\t\tcallback();\n\t\t}\n\n\t\t// For future transitions\n\t\tthis.triggers.push({ actions, value, callback, active: true });\n\t},\n\n\t// Compare a set of permissions with true or false\n\t// If comparing with true, we want at least one to be true, i.e. OR\n\t// If comparing with false, we want ALL to be false, i.e. NOR\n\tis: function(actions, able = true) {\n\t\tvar or = Mavo.toArray(actions).map(action => !!this[action])\n\t\t                .reduce((prev, current) => prev || current);\n\n\t\treturn able? or : !or;\n\t},\n\n\t// Monitor all changes\n\tonchange: function(callback) {\n\t\t// Future changes\n\t\tthis.hooks.add(\"change\", callback);\n\n\t\t// Fire for current values\n\t\t_.actions.forEach(action => {\n\t\t\tcallback.call(this, {action, value: this[action]});\n\t\t});\n\t},\n\n\tparentChanged: function(o = {}) {\n\t\tvar localValue = this[\"_\" + o.action];\n\n\t\tif (localValue !== undefined || o.from == o.value) {\n\t\t\t// We have a local value so we dont care about parent changes OR nothing changed\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fireTriggers(o.action);\n\n\t\tthis.hooks.run(\"change\", $.extend({context: this}, o));\n\t},\n\n\t// A single permission changed value\n\tchanged: function(action, value, from) {\n\t\tfrom = !!from;\n\t\tvalue = !!value;\n\n\t\tif (value == from) {\n\t\t\t// Nothing changed\n\t\t\treturn;\n\t\t}\n\n\t\t// $.live() calls the setter before the actual property is set so we\n\t\t// need to set it manually, otherwise it still has its previous value\n\t\tthis[\"_\" + action] = value;\n\n\t\tthis.fireTriggers(action);\n\n\t\tthis.hooks.run(\"change\", {action, value, from, context: this});\n\t},\n\n\tfireTriggers: function(action) {\n\t\tthis.triggers.forEach(trigger => {\n\t\t\tvar match = this.is(trigger.actions, trigger.value);\n\n\t\t\tif (trigger.active && trigger.actions.indexOf(action) > -1 && match) {\n\n\t\t\t\ttrigger.active = false;\n\t\t\t\ttrigger.callback();\n\t\t\t}\n\t\t\telse if (!match) {\n\t\t\t\t// This is so that triggers can only be executed in an actual transition\n\t\t\t\t// And that if there is a trigger for [a,b] it won't be executed twice\n\t\t\t\t// if a and b are set to true one after the other\n\t\t\t\ttrigger.active = true;\n\t\t\t}\n\t\t});\n\t},\n\n\tor: function(permissions) {\n\t\t_.actions.forEach(action => {\n\t\t\tthis[action] = this[action] || permissions[action];\n\t\t});\n\n\t\treturn this;\n\t},\n\n\tlive: {\n\t\tparent: function(parent) {\n\t\t\tvar oldParent = this._parent;\n\n\t\t\tif (oldParent == parent) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._parent = parent;\n\n\t\t\t// Remove previous trigger, if any\n\t\t\tif (oldParent) {\n\t\t\t\tMavo.delete(oldParent.hooks.change, this.parentChanged);\n\t\t\t}\n\n\t\t\t// What changes does this cause? Fire triggers for them\n\t\t\t_.actions.forEach(action => {\n\t\t\t\tthis.parentChanged({\n\t\t\t\t\taction,\n\t\t\t\t\tvalue: parent? parent[action] : undefined,\n\t\t\t\t\tfrom: oldParent? oldParent[action] : undefined\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (parent) {\n\t\t\t\t// Add new trigger\n\t\t\t\tparent.onchange(this.parentChanged);\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tactions: [],\n\n\t\t// Register a new permission type\n\t\tregister: function(action, setter) {\n\t\t\tif (Array.isArray(action)) {\n\t\t\t\taction.forEach(action => _.register(action, setter));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.live(_.prototype, action, {\n\t\t\t\tget: function() {\n\t\t\t\t\tvar ret = this[\"_\" + action];\n\n\t\t\t\t\tif (ret === undefined && this.parent) {\n\t\t\t\t\t\treturn this.parent[action];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ret;\n\t\t\t\t},\n\t\t\t\tset: function(able, previous) {\n\t\t\t\t\tif (setter) {\n\t\t\t\t\t\tsetter.call(this, able, previous);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.changed(action, able, previous);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t_.actions.push(action);\n\t\t}\n\t}\n});\n\n_.register([\"read\", \"save\"]);\n\n_.register(\"login\", function(can) {\n\tif (can && this.logout) {\n\t\tthis.logout = false;\n\t}\n});\n\n_.register(\"logout\", function(can) {\n\tif (can && this.login) {\n\t\tthis.login = false;\n\t}\n});\n\n_.register(\"edit\", function(can) {\n\tif (can) {\n\t\tthis.add = this.delete = true;\n\t}\n});\n\n_.register([\"add\", \"delete\"], function(can) {\n\tif (!can) {\n\t\tthis.edit = false;\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\n/**\n * Base class for all backends\n */\nvar _ = Mavo.Backend = $.Class({\n\tconstructor: function(url, o = {}) {\n\t\tthis.update(url, o);\n\n\t\t// Permissions of this particular backend.\n\t\tthis.permissions = new Mavo.Permissions();\n\t},\n\n\tupdate: function(url, o = {}) {\n\t\tthis.source = url;\n\n\t\t// Backends that are not URL-based should just ignore this\n\t\tthis.url = new URL(this.source, Mavo.base);\n\n\t\tthis.options = o;\n\t\tthis.mavo = o.mavo;\n\t\tthis.format = Mavo.Formats.create(o.format, this);\n\n\t\tif (this.constructor.key ?? o.key) {\n\t\t\tthis.key = o.key ?? this.constructor.key;\n\t\t}\n\t},\n\n\tasync get (url = new URL(this.url)) {\n\t\tif (url.protocol != \"data:\" && this.constructor.useCache !== false) {\n\t\t\turl.searchParams.set(\"timestamp\", Date.now()); // ensure fresh copy\n\t\t}\n\n\t\ttry {\n\t\t\tlet xhr = await $.fetch(url.href);\n\t\t\treturn xhr.responseText;\n\t\t}\n\t\tcatch (e) {\n\t\t\treturn null;\n\t\t}\n\t},\n\n\tasync load () {\n\t\tawait this.ready;\n\t\tlet response = await this.get();\n\n\t\tif (typeof response != \"string\") {\n\t\t\t// Backend did the parsing, we're done here\n\t\t\treturn response;\n\t\t}\n\n\t\tresponse = response.replace(/^\\ufeff/, \"\"); // Remove Unicode BOM\n\n\t\treturn this.format.parse(response);\n\t},\n\n\tasync store (data, {path, format = this.format} = {}) {\n\t\tawait this.ready;\n\n\t\tvar serialized = typeof data === \"string\"? data : await format.stringify(data);\n\t\tawait this.put(serialized, path);\n\n\t\treturn {data, serialized};\n\t},\n\n\t// To be be overriden by subclasses\n\tready: Promise.resolve(),\n\tlogin: () => Promise.resolve(),\n\tlogout: () => Promise.resolve(),\n\tput: () => Promise.reject(),\n\n\tisAuthenticated: function() {\n\t\treturn !!this.accessToken;\n\t},\n\n\t// Any extra params to be passed to the oAuth URL.\n\toAuthParams: () => \"\",\n\n\ttoString: function() {\n\t\treturn `${this.id} (${this.url})`;\n\t},\n\n\tequals: function(backend) {\n\t\treturn backend === this || (backend && this.id == backend.id && this.source == backend.source);\n\t},\n\n\t/**\n\t * Helper for making OAuth requests with JSON-based APIs.\n\t */\n\trequest: function(call, data, method = \"GET\", req = {}) {\n\t\treq = $.extend({}, req); // clone\n\t\treq.method = req.method || method;\n\t\treq.responseType = req.responseType || \"json\";\n\n\t\treq.headers = $.extend({\n\t\t\t\"Content-Type\": \"application/json; charset=utf-8\"\n\t\t}, req.headers || {});\n\n\t\tif (this.isAuthenticated()) {\n\t\t\treq.headers[\"Authorization\"] = req.headers[\"Authorization\"] || `Bearer ${this.accessToken}`;\n\t\t}\n\n\t\treq.data = data;\n\n\t\tcall = new URL(call, this.constructor.apiDomain);\n\n\t\t// Prevent getting a cached response. Cache-control is often not allowed via CORS\n\t\tif (req.method == \"GET\" && this.constructor.useCache !== false) {\n\t\t\tcall.searchParams.set(\"timestamp\", Date.now());\n\t\t}\n\n\t\tif ($.type(req.data) === \"object\") {\n\t\t\tif (req.method == \"GET\") {\n\t\t\t\tfor (let p in req.data) {\n\t\t\t\t\tlet action = req.data[p] === undefined? \"delete\" : \"set\";\n\t\t\t\t\tcall.searchParams[action](p, req.data[p]);\n\t\t\t\t}\n\n\t\t\t\tdelete req.data;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treq.data = JSON.stringify(req.data);\n\t\t\t}\n\t\t}\n\n\t\treturn $.fetch(call, req)\n\t\t\t.catch(err => {\n\t\t\t\tif (err?.xhr) {\n\t\t\t\t\treturn Promise.reject(err.xhr);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.mavo.error(\"Something went wrong while connecting to \" + this.id, err);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(xhr => req.method == \"HEAD\"? xhr : xhr.response);\n\t},\n\n\t/**\n\t * Helper method for authenticating in OAuth APIs\n\t */\n\toAuthenticate: function(passive) {\n\t\treturn this.ready.then(() => {\n\t\t\tif (this.isAuthenticated()) {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tvar id = this.id.toLowerCase();\n\n\t\t\t\tif (passive) {\n\t\t\t\t\tthis.accessToken = localStorage[`mavo:${id}token`];\n\n\t\t\t\t\tif (this.accessToken) {\n\t\t\t\t\t\tresolve(this.accessToken);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Show window\n\t\t\t\t\tvar popup = {\n\t\t\t\t\t\twidth: Math.min(1000, innerWidth - 100),\n\t\t\t\t\t\theight: Math.min(800, innerHeight - 100)\n\t\t\t\t\t};\n\n\t\t\t\t\tpopup.top = (screen.height - popup.height)/2;\n\t\t\t\t\tpopup.left = (screen.width - popup.width)/2;\n\n\t\t\t\t\tvar state = {\n\t\t\t\t\t\turl: location.href,\n\t\t\t\t\t\tbackend: this.id\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.authPopup = open(`${this.constructor.oAuth}?client_id=${this.key}&state=${encodeURIComponent(JSON.stringify(state))}` + this.oAuthParams(),\n\t\t\t\t\t\t\"popup\", `width=${popup.width},height=${popup.height},left=${popup.left},top=${popup.top}`);\n\n\t\t\t\t\tif (!this.authPopup) {\n\t\t\t\t\t\tvar message = \"Login popup was blocked! Please check your popup blocker settings.\";\n\t\t\t\t\t\tthis.mavo.error(message);\n\t\t\t\t\t\treject(Error(message));\n\t\t\t\t\t}\n\n\t\t\t\t\taddEventListener(\"message\", evt => {\n\t\t\t\t\t\tif (evt.source === this.authPopup) {\n\t\t\t\t\t\t\tif (evt.data.backend == this.id) {\n\t\t\t\t\t\t\t\tthis.accessToken = localStorage[`mavo:${id}token`] = evt.data.token;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!this.accessToken) {\n\t\t\t\t\t\t\t\treject(Error(\"Authentication error\"));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(this.accessToken);\n\n\t\t\t\t\t\t\t// Log in to other similar backends that are logged out\n\t\t\t\t\t\t\tfor (var appid in Mavo.all) {\n\t\t\t\t\t\t\t\tvar storage = Mavo.all[appid].primaryBackend;\n\n\t\t\t\t\t\t\t\tif (storage\n\t\t\t\t\t\t\t\t\t&& storage.id === this.id\n\t\t\t\t\t\t\t\t\t&& storage !== this\n\t\t\t\t\t\t\t\t\t&& !storage.isAuthenticated()) {\n\t\t\t\t\t\t\t\t\t\tstorage.login(true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * oAuth logout helper\n\t */\n\toAuthLogout: function() {\n\t\tif (this.isAuthenticated()) {\n\t\t\tvar id = this.id.toLowerCase();\n\n\t\t\tlocalStorage.removeItem(`mavo:${id}token`);\n\t\t\tdelete this.accessToken;\n\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\", \"save\"]).on(\"login\");\n\n\t\t\t$.fire(this.mavo.element, \"mv-logout\", {backend: this});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t},\n\n\tstatic: {\n\t\t// Return the appropriate backend(s) for this url\n\t\tcreate: function(url, o = {}, existing) {\n\t\t\tlet Backend;\n\n\t\t\tif (o.type) {\n\t\t\t\t// Using get() for case-insensitive property lookup\n\t\t\t\tBackend = Mavo.Functions.get(_, o.type);\n\t\t\t}\n\n\t\t\tif (url && !Backend) {\n\t\t\t\tBackend = _.types.find(Backend => Backend.test(url, o)) || _.Remote;\n\t\t\t}\n\n\t\t\t// Can we re-use the existing object perhaps?\n\t\t\tif (Backend && existing?.constructor === Backend && existing.constructor.prototype.hasOwnProperty(\"update\")) {\n\t\t\t\texisting.update(url, o);\n\t\t\t\treturn existing;\n\t\t\t}\n\n\t\t\treturn Backend? new Backend(url, o) : null;\n\t\t},\n\n\t\ttypes: [],\n\n\t\tregister: function(Class) {\n\t\t\t_[Class.prototype.id] = Class;\n\t\t\t_.types.push(Class);\n\t\t\treturn Class;\n\t\t}\n\t}\n});\n\n/**\n * Save in an HTML element\n */\n_.register($.Class({\n\tid: \"Element\",\n\textends: _,\n\tconstructor: function () {\n\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\t},\n\n\tupdate: function(url, o) {\n\t\tthis.super.update.call(this, url, o);\n\n\t\tthis.element = $(this.source) || $.create(\"script\", {\n\t\t\ttype: \"application/json\",\n\t\t\tid: this.source.slice(1),\n\t\t\tinside: document.body\n\t\t});\n\t},\n\n\tget: function() {\n\t\treturn Promise.resolve(this.element.textContent);\n\t},\n\n\tput: function(serialized) {\n\t\treturn Promise.resolve(this.element.textContent = serialized);\n\t},\n\n\tstatic: {\n\t\ttest: url => url.indexOf(\"#\") === 0\n\t}\n}));\n\n// Load from a remote URL, no save\n_.register($.Class({\n\tid: \"Remote\",\n\textends: _,\n\tconstructor: function() {\n\t\tthis.permissions.on(\"read\");\n\t},\n\n\tstatic: {\n\t\ttest: url => false\n\t}\n}));\n\n// Save in localStorage\n_.register($.Class({\n\textends: _,\n\tid: \"Local\",\n\tconstructor: function() {\n\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\t\tthis.key = this.mavo.id;\n\t},\n\n\tget: function() {\n\t\treturn Promise[this.key in localStorage? \"resolve\" : \"reject\"](localStorage[this.key]);\n\t},\n\n\tput: function(serialized) {\n\t\tif (!serialized) {\n\t\t\tdelete localStorage[this.key];\n\t\t}\n\t\telse {\n\t\t\tlocalStorage[this.key] = serialized;\n\t\t}\n\n\t\treturn Promise.resolve(serialized);\n\t},\n\n\tstatic: {\n\t\ttest: value => value == \"local\"\n\t}\n}));\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Formats = {};\n\nvar base = _.Base = $.Class({\n\tabstract: true,\n\tconstructor: function(backend) {\n\t\tthis.backend = backend;\n\t},\n\tproxy: {\n\t\t\"mavo\": \"backend\"\n\t},\n\n\t// So that child classes can only override the static methods if they don't\n\t// need access to any instance variables.\n\tparse: function(content) {\n\t\treturn this.constructor.parse(content, this);\n\t},\n\tstringify: function(data) {\n\t\treturn this.constructor.stringify(data, this);\n\t},\n\n\tstatic: {\n\t\tparse: serialized => Promise.resolve(serialized),\n\t\tstringify: data => Promise.resolve(data),\n\t\textensions: [],\n\t\tdependencies: [],\n\t\tready: function() {\n\t\t\treturn Promise.all(this.dependencies.map(d => $.include(d.test(), d.url)));\n\t\t}\n\t}\n});\n\nvar json = _.JSON = $.Class({\n\textends: _.Base,\n\tstatic: {\n\t\tparse: serialized => Promise.resolve(serialized? JSON.parse(serialized) : null),\n\t\tstringify: data => Promise.resolve(Mavo.toJSON(data)),\n\t\textensions: [\".json\", \".jsonld\"]\n\t}\n});\n\nvar text = _.Text = $.Class({\n\textends: _.Base,\n\tconstructor: function(backend) {\n\t\tthis.property = this.mavo.root.getNames(\"Primitive\")[0];\n\t},\n\n\tstatic: {\n\t\textensions: [\".txt\"],\n\t\tparse: (serialized, me) => Promise.resolve({[me? me.property : \"content\"]: serialized}),\n\t\tstringify: (data, me) => Promise.resolve(data[me? me.property : \"content\"])\n\t}\n});\n\nvar csv = _.CSV = $.Class({\n\textends: _.Base,\n\tconstructor: function(backend) {\n\t\tthis.property = this.mavo.root.getNames(\"Collection\")[0];\n\t\tthis.options = $.extend({}, _.CSV.defaultOptions);\n\t},\n\n\tstatic: {\n\t\textensions: [\".csv\", \".tsv\"],\n\t\tdefaultOptions: {\n\t\t\theader: true,\n\t\t\tdynamicTyping: true,\n\t\t\tskipEmptyLines: true\n\t\t},\n\t\tdependencies: [{\n\t\t\ttest: () => self.Papa,\n\t\t\turl: \"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js\"\n\t\t}],\n\t\tready: base.ready,\n\t\tparse: async (serialized, me) => {\n\t\t\tawait csv.ready();\n\t\t\tvar data = Papa.parse(serialized, csv.defaultOptions);\n\t\t\tvar property = me? me.property : \"content\";\n\n\t\t\tif (me) {\n\t\t\t\t// Get delimiter & linebreak for serialization\n\t\t\t\tme.options.delimiter = data.meta.delimiter;\n\t\t\t\tme.options.linebreak = data.meta.linebreak;\n\t\t\t}\n\n\t\t\tif (data.meta.aborted) {\n\t\t\t\tthrow data.meta.errors.pop();\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t[property]: data.data\n\t\t\t};\n\t\t},\n\n\t\tstringify: async (data, me) => {\n\t\t\tawait csv.ready();\n\t\t\tvar property = me? me.property : \"content\";\n\t\t\tvar options = me? me.options : csv.defaultOptions;\n\t\t\treturn Papa.unparse(data[property], options);\n\t\t}\n\t}\n});\n\nObject.defineProperty(_, \"create\", {\n\tvalue: function(format, backend) {\n\t\tif (format && typeof format === \"object\") {\n\t\t\treturn format;\n\t\t}\n\n\t\tif (typeof format === \"string\") {\n\t\t\t// Search by id\n\t\t\tformat = format.toLowerCase();\n\n\t\t\tfor (var id in _) {\n\t\t\t\tvar Format = _[id];\n\n\t\t\t\tif (id.toLowerCase() == format) {\n\t\t\t\t\treturn new Format(backend);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!format) {\n\t\t\tvar url = backend.url? backend.url.pathname : backend.source;\n\t\t\tvar extension = url.match(/\\.\\w+$/)?.[0] ?? \".json\";\n\t\t\tvar Format = _.JSON;\n\n\t\t\tfor (var id in _) {\n\t\t\t\tif (_[id].extensions.indexOf(extension) > -1) {\n\t\t\t\t\t// Do not return match, as we may find another match later\n\t\t\t\t\t// and last match wins\n\t\t\t\t\tFormat = _[id];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn new Format(backend);\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Node = class Node {\n\tconstructor (element, mavo, options = {}) {\n\t\tif (!element || !mavo) {\n\t\t\tthrow new Error(\"Mavo.Node constructor requires an element argument and a mavo object\");\n\t\t}\n\n\t\tvar env = {context: this, options};\n\n\t\t// Set these first, for debug reasons\n\t\tthis.uid = _.all.push(this) - 1;\n\t\tthis.property = null;\n\t\tthis.element = element;\n\t\tthis.isHelperVariable = this.element.matches(\"meta\");\n\n\t\t$.extend(this, env.options);\n\n\t\t_.elements.set(element, [...(_.elements.get(this.element) || []), this]);\n\n\t\tthis.mavo = mavo;\n\t\tthis.group = this.parent = this.parentGroup = env.options.group;\n\n\t\tthis.template = env.options.template;\n\n\t\tthis.alias = this.element.getAttribute(\"mv-alias\");\n\n\t\tif (this.template) {\n\t\t\tthis.template.copies.push(this);\n\t\t}\n\t\telse {\n\t\t\t// First (or only) of its kind\n\t\t\tthis.copies = [];\n\t\t}\n\n\t\tif (!this.fromTemplate(\"property\", \"type\", \"storage\", \"path\")) {\n\t\t\tthis.property = _.getProperty(element);\n\t\t\tthis.type = Mavo.Group.normalize(element);\n\t\t\tthis.storage = this.element.getAttribute(\"mv-storage\");\n\t\t\tthis.path = this.getPath();\n\t\t}\n\n\t\tthis.modes = this.element.getAttribute(\"mv-mode\");\n\n\t\tMavo.hooks.run(\"node-init-start\", env);\n\n\t\tthis.mode = Mavo.getStyle(this.element, \"--mv-mode\") || \"read\";\n\n\t\tthis.collection = env.options.collection;\n\n\t\tif (this.collection) {\n\t\t\t// This is a collection item\n\t\t\tthis.group = this.parentGroup = this.collection.parentGroup;\n\t\t}\n\n\t\t// Must run before collections have a marker which messes up paths\n\t\tvar template = this.template;\n\n\t\tif (template?.expressions) {\n\t\t\t// We know which expressions we have, don't traverse again\n\t\t\tthis.expressions = template.expressions.map(et => new Mavo.DOMExpression({\n\t\t\t\ttemplate: et,\n\t\t\t\titem: this,\n\t\t\t\tmavo: this.mavo\n\t\t\t}));\n\t\t}\n\n\t\tif (this instanceof Mavo.Group || this.collection) {\n\t\t\t// Handle mv-value\n\t\t\t// TODO integrate with the code in Primitive that decides whether this is a computed property\n\t\t\tvar et = Mavo.DOMExpression.search(this.element).filter(et => et.originalAttribute == \"mv-value\")[0];\n\n\t\t\tif (et) {\n\t\t\t\tet.mavoNode = this;\n\t\t\t\tthis.expressionText = et;\n\t\t\t\tthis.storage = this.storage || \"none\";\n\t\t\t\tthis.modes = \"read\";\n\n\t\t\t\tif (this.collection) {\n\t\t\t\t\tthis.collection.expressions = [...(this.collection.expressions || []), et];\n\t\t\t\t\tet.mavoNode = this.collection;\n\t\t\t\t\tthis.collection.storage = this.collection.storage || \"none\";\n\t\t\t\t\tthis.collection.modes = \"read\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tMavo.hooks.run(\"node-init-end\", env);\n\t}\n\n\tget editing() {\n\t\treturn this.mode == \"edit\";\n\t}\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t}\n\n\tget name() {\n\t\treturn Mavo.Functions.readable(this.property || this.type).toLowerCase();\n\t}\n\n\tget saved() {\n\t\treturn this.storage !== \"none\";\n\t}\n\n\tget properties() {\n\t\treturn Object.keys(this.liveData.data[Mavo.route]);\n\t}\n\n\t/**\n\t * Runs after the constructor is done (including the constructor of the inheriting class), synchronously\n\t */\n\tpostInit () {\n\t\tif (this.modes == \"edit\") {\n\t\t\tthis.edit();\n\t\t}\n\t}\n\n\tdestroy () {\n\t\tif (this.template) {\n\t\t\tMavo.delete(this.template.copies, this);\n\t\t}\n\n\t\tif (this.expressions) {\n\t\t\tthis.expressions.forEach(expression => expression.destroy());\n\t\t}\n\n\t\tif (this.itembar) {\n\t\t\tthis.itembar.destroy();\n\t\t}\n\n\t\tdelete _.all[this.uid];\n\n\t\tthis.propagate(\"destroy\");\n\t}\n\n\tgetLiveData () {\n\t\treturn this.liveData.proxy;\n\t}\n\n\tisDataNull (o = {}) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o,\n\t\t\tresult: !this.saved && !o.live\n\t\t};\n\n\t\tMavo.hooks.run(\"node-isdatanull\", env);\n\n\t\treturn env.result;\n\t}\n\n\t/**\n\t * Execute a callback on every node of the Mavo tree\n\t * If callback returns (strict) false, walk stops.\n\t * @param callback {Function}\n\t * @param path {Array} Initial path. Mostly used internally.\n\t * @param o {Object} Options:\n\t * \t\t\t- descentReturn {Boolean} If callback returns false, just don't descend\n\t * \t\t\t                Otherwise, if callback returns false, it stops.\n\t * @return false if was stopped via a false return value, true otherwise\n\t */\n\twalk (callback, path = [], o = {}) {\n\t\tvar walker = (obj, path) => {\n\t\t\tvar ret = callback(obj, path);\n\n\t\t\tif (ret !== false) {\n\t\t\t\tfor (let i in obj.children) {\n\t\t\t\t\tlet node = obj.children[i];\n\n\t\t\t\t\tif (node instanceof Mavo.Node) {\n\t\t\t\t\t\tvar ret = walker.call(node, node, [...path, i]);\n\n\t\t\t\t\t\tif (ret === false && !o.descentReturn) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret !== false;\n\t\t};\n\n\t\treturn walker(this, path);\n\t}\n\n\twalkUp (callback) {\n\t\tvar group = this;\n\n\t\twhile (group = group.parentGroup) {\n\t\t\tvar ret = callback(group);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t}\n\n\tedit ({force} = {}) {\n\t\tthis.mode = \"edit\";\n\n\t\tif (!force && this.mode != \"edit\") {\n\t\t\treturn false;\n\t\t}\n\n\t\t$.fire(this.element, \"mv-edit\", {\n\t\t\tmavo: this.mavo,\n\t\t\tnode: this\n\t\t});\n\n\t\tMavo.hooks.run(\"node-edit-end\", this);\n\t}\n\n\tdone ({force} = {}) {\n\t\tthis.mode = Mavo.getStyle(this.element.parentNode, \"--mv-mode\") || \"read\";\n\n\t\tif (!force && this.mode != \"read\") {\n\t\t\treturn false;\n\t\t}\n\n\t\t$.unbind(this.element, \".mavo:edit\");\n\n\t\t$.fire(this.element, \"mv-done\", {\n\t\t\tmavo: this.mavo,\n\t\t\tnode: this\n\t\t});\n\n\t\tthis.propagate(\"done\");\n\n\t\tMavo.hooks.run(\"node-done-end\", this);\n\t}\n\n\tsave () {\n\t\tthis.unsavedChanges = false;\n\n\t\tthis.propagate(\"save\");\n\t}\n\n\tpropagate (callback) {\n\t\tfor (let i in this.children) {\n\t\t\tlet node = this.children[i];\n\n\t\t\tif (node instanceof Mavo.Node) {\n\t\t\t\tif (typeof callback === \"function\") {\n\t\t\t\t\tcallback.call(node, node);\n\t\t\t\t}\n\t\t\t\telse if (callback in node) {\n\t\t\t\t\tnode[callback]();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfromTemplate (...properties) {\n\t\tif (this.template) {\n\t\t\tproperties.forEach(property => this[property] = this.template[property]);\n\t\t}\n\n\t\treturn !!this.template;\n\t}\n\n\tasync render (data, o = {}) {\n\t\to.live = o.live || Mavo.in(Mavo.isProxy, data);\n\t\to.root = o.root || this;\n\n\t\t// Any promises pending to be rendered?\n\t\tdelete this.pending;\n\n\t\tif ($.type(data) === \"promise\") {\n\t\t\tlet pending = this.pending = data;\n\n\t\t\ttry {\n\t\t\t\tdata = await pending;\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tdata = e;\n\t\t\t}\n\n\t\t\tif (this.pending !== pending) {\n\t\t\t\t// Value has been superseded\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdelete this.pending;\n\t\t}\n\n\t\tif (o.live) {\n\t\t\t// Drop proxy\n\t\t\tdata = Mavo.clone(data);\n\t\t}\n\n\t\tthis.oldData = this.data;\n\t\tthis.data = data;\n\n\t\tif (!o.live) {\n\t\t\tdata = Mavo.subset(data, this.inPath);\n\t\t}\n\n\t\tvar env = {context: this, data, options: o};\n\n\t\tMavo.hooks.run(\"node-render-start\", env);\n\n\t\tif (!this.isHelperVariable) {\n\t\t\tif (!Array.isArray(this.children) && Array.isArray(env.data)) {\n\t\t\t\t// We are rendering an array on a singleton, what to do?\n\t\t\t\tif (this.isRoot) {\n\t\t\t\t\t// Get the name of the first property that is a collection without mv-value\n\t\t\t\t\t// OR if there is a collection with property=\"main\", prioritize that\n\t\t\t\t\tvar mainProperty = this.children.main instanceof Mavo.Collection? \"main\" : this.getNames((p, n) => {\n\t\t\t\t\t\treturn n instanceof Mavo.Collection && !n.expressions?.[0]?.isDynamicObject;\n\t\t\t\t\t})[0];\n\n\t\t\t\t\tif (mainProperty) {\n\t\t\t\t\t\tenv.data = {\n\t\t\t\t\t\t\t[mainProperty]: env.data\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!this.isRoot || !mainProperty) {\n\t\t\t\t\t// Otherwise, render first item\n\t\t\t\t\tthis.inPath.push(\"0\");\n\t\t\t\t\tenv.data = env.data[0];\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.childrenNames?.length == 1 && this.childrenNames[0] === this.property\n\t\t\t         && env.data !== null && Mavo.isPlainObject(env.data)) {\n\t\t\t\t// {foo: {foo: 5}} should become {foo: 5}\n\t\t\t\tenv.data = env.data[this.property];\n\t\t\t}\n\t\t}\n\n\t\tif (this === o.root) {\n\t\t\tthis.expressionsEnabled = false;\n\t\t}\n\n\t\tvar editing = this.editing;\n\n\t\tif (editing) {\n\t\t\tthis.done();\n\t\t}\n\n\t\tvar changed = this.dataRender(env.data, o);\n\n\t\tif (editing) {\n\t\t\tthis.edit();\n\t\t}\n\n\t\tif (this === o.root) {\n\t\t\tthis.save();\n\n\t\t\tthis.expressionsEnabled = true;\n\n\t\t\tif (changed) {\n\t\t\t\trequestAnimationFrame(() => this.mavo.expressions.update(this));\n\t\t\t}\n\t\t}\n\n\t\tMavo.hooks.run(\"node-render-end\", env);\n\n\t\treturn changed;\n\t}\n\n\tdataChanged (action, o = {}) {\n\t\tvar change = $.extend({\n\t\t\taction,\n\t\t\tproperty: this.property,\n\t\t\tmavo: this.mavo,\n\t\t\tnode: this\n\t\t}, o);\n\n\t\t$.fire(o.element || this.element, \"mv-change\", change);\n\t\tthis.mavo.changed(change);\n\t}\n\n\ttoString () {\n\t\treturn `#${this.uid}: ${this.constructor.name} (${this.property})`;\n\t}\n\n\tgetClosestCollection () {\n\t\tvar closestItem = this.closestItem;\n\n\t\treturn closestItem? closestItem.collection : null;\n\t}\n\n\tgetClosestItem () {\n\t\tif (Array.isArray(this.collection?.children)) {\n\t\t\treturn this;\n\t\t}\n\n\t\treturn this.parentGroup?.closestItem || null;\n\t}\n\n\tgetPath () {\n\t\tvar path = this.parent?.path || [];\n\t\treturn this.property? [...path, this.property] : path;\n\t}\n\n\tpathFrom (node) {\n\t\tvar path = this.path;\n\t\tvar nodePath = node.path;\n\n\t\tfor (var i = 0; i<path.length && nodePath[i] == path[i]; i++) {}\n\n\t\treturn path.slice(i);\n\t}\n\n\tgetDescendant (path) {\n\t\treturn path.reduce((acc, cur) => acc.children[cur], this);\n\t}\n\n\t/**\n\t * Get same node in other item in same collection\n\t * E.g. for same node in the next item, use an offset of -1\n\t */\n\tgetCousin (offset, o = {}) {\n\t\tif (!this.closestCollection) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar collection = this.closestCollection;\n\t\tvar distance = Math.abs(offset);\n\t\tvar direction =  offset < 0? -1 : 1;\n\n\t\tif (collection.length < distance + 1) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar index = this.closestItem.index + offset;\n\n\t\tif (o.wrap) {\n\t\t\tindex = Mavo.wrap(index, collection.length);\n\t\t}\n\n\t\tfor (var i = 0; i<collection.length; i++) {\n\t\t\tvar ind = index + i * direction;\n\n\t\t\tif (o.wrap) {\n\t\t\t\tind = Mavo.wrap(ind, collection.length);\n\t\t\t}\n\n\t\t\tvar item = collection.children[ind];\n\n\t\t\tif (item) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!item || item == this.closestItem) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.collection) {\n\t\t\treturn item;\n\t\t}\n\n\t\tvar relativePath = this.pathFrom(this.closestItem);\n\t\treturn item.getDescendant(relativePath);\n\t}\n\n\tcontains (node) {\n\t\tdo {\n\t\t\tif (node === this) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tnode = node.parent;\n\t\t}\n\t\twhile (node);\n\n\t\treturn false;\n\t}\n\n\t// Evaluate expression on the fly with this node as context\n\teval(expr, o) {\n\t\treturn new Mavo.Expression(expr).eval(this.getLiveData(), o);\n\t}\n\n\tstatic create (element, mavo, o = {}) {\n\t\tif (Mavo.is(\"multiple\", element) && !o.collection) {\n\t\t\treturn new Mavo.Collection(element, mavo, o);\n\t\t}\n\n\t\treturn new Mavo[Mavo.is(\"group\", element)? \"Group\" : \"Primitive\"](element, mavo, o);\n\t}\n\n\t/**\n\t * Get & normalize property name, if exists\n\t */\n\tstatic getProperty (element) {\n\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\tif (!property) {\n\t\t\tvar multiple = element.getAttribute(\"mv-multiple\");\n\n\t\t\tif (element.hasAttribute(\"property\")) { // property used without a value\n\t\t\t\tproperty = multiple || element.name || element.id || element.classList[0];\n\n\t\t\t\tif (!property) {\n\t\t\t\t\tproperty = _.generatePropertyName(multiple === null? \"prop\" : \"collection\", element);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (property) {\n\t\t\telement.setAttribute(\"property\", property);\n\t\t}\n\n\t\treturn property;\n\t}\n\n\tstatic generatePropertyName(prefix, element = document.documentElement) {\n\t\tvar root = element.closest(Mavo.selectors.init);\n\n\t\tfor (var i=\"\"; i<10000; i++) { // 1000 is just a failsafe\n\t\t\tvar name = prefix + i;\n\n\t\t\tif (!$(Mavo.selectors.specificProperty(name), root)) {\n\t\t\t\treturn name;\n\t\t\t}\n\t\t}\n\t}\n\n\tstatic get (element, prioritizePrimitive) {\n\t\tvar nodes = (_.elements.get(element) || []).filter(node => !(Array.isArray(node.children)));\n\n\t\tif (nodes.length < 2 || !prioritizePrimitive) {\n\t\t\treturn nodes[0];\n\t\t}\n\n\t\tif (nodes[0] instanceof Mavo.Group) {\n\t\t\treturn nodes[1];\n\t\t}\n\t}\n\n\tstatic getClosest (element, prioritizePrimitive) {\n\t\tvar node;\n\n\t\tdo {\n\t\t\tnode = _.get(element, prioritizePrimitive);\n\t\t} while (!node && (element = element.parentNode));\n\n\t\treturn node;\n\t}\n\n\tstatic getClosestItem (element) {\n\t\tvar item = _.getClosest(element);\n\n\t\tif (item instanceof Mavo.Primitive && !item.collection) {\n\t\t\treturn item.parent;\n\t\t}\n\n\t\treturn item;\n\t}\n\n\t/**\n\t * Get all properties that are inside an element but not nested into other properties\n\t */\n\tstatic children (element) {\n\t\tvar ret = Mavo.Node.get(element);\n\n\t\tif (ret) {\n\t\t\t// element is a Mavo node\n\t\t\treturn [ret];\n\t\t}\n\n\t\tret = $$(Mavo.selectors.property, element)\n\t\t\t.map(e => Mavo.Node.get(e))\n\t\t\t.filter(e => !element.contains(e.parentGroup.element)) // drop nested properties\n\t\t\t.map(e => e.collection || e);\n\n\t\treturn Mavo.Functions.unique(ret);\n\t}\n};\n\n$.Class(_, {\n\ttoJSON: Mavo.prototype.toJSON,\n\n\tlazy: {\n\t\tclosestCollection: function() {\n\t\t\treturn this.getClosestCollection();\n\t\t},\n\n\t\tclosestItem: function() {\n\t\t\treturn this.getClosestItem();\n\t\t},\n\n\t\t// Are we only rendering and editing a subset of the data?\n\t\tinPath: function() {\n\t\t\tvar attribute = this instanceof Mavo.Collection? \"mv-multiple-path\" : \"mv-path\";\n\n\t\t\treturn (this.element.getAttribute(attribute) || \"\").split(\"/\").filter(p => p.length);\n\t\t}\n\t},\n\n\tlive: {\n\t\tstore: function(value) {\n\t\t\t$.toggleAttribute(this.element, \"mv-storage\", value);\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tif (value && (!this.saved || !this.editing)) {\n\t\t\t\tvalue = false;\n\t\t\t}\n\n\t\t\tif (!Array.isArray(this.children)) {\n\t\t\t\tthis.element.classList.toggle(\"mv-unsaved-changes\", value);\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\tmode: function (value) {\n\t\t\tif (this._mode != value) {\n\t\t\t\t// Is it allowed?\n\t\t\t\tif (this.modes && value != this.modes) {\n\t\t\t\t\tvalue = this.modes;\n\t\t\t\t}\n\n\t\t\t\t// If we don't do this, setting the attribute below will\n\t\t\t\t// result in infinite recursion\n\t\t\t\tthis._mode = value;\n\n\t\t\t\tif (!Array.isArray(this.children) && [null, \"\", \"read\", \"edit\"].indexOf(this.element.getAttribute(\"mv-mode\")) > -1) {\n\t\t\t\t\t// If attribute is not one of the recognized values, leave it alone\n\t\t\t\t\tvar set = this.modes || value == \"edit\";\n\t\t\t\t\tlet matches = Mavo.observers.pause({attribute: \"mv-mode\"});\n\t\t\t\t\t$.toggleAttribute(this.element, \"mv-mode\", value, set);\n\t\t\t\t\tMavo.observers.resume(matches);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t},\n\n\t\tmodes: function(value) {\n\t\t\tif (value && value != \"read\" && value != \"edit\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tthis._modes = value;\n\n\t\t\tif (value && this.mode != value) {\n\t\t\t\tthis.mode = value;\n\t\t\t}\n\t\t},\n\n\t\tcollection: function(value) {\n\t\t\t// These only change when collection changes\n\t\t\tthis.parent = value || this.parentGroup;\n\t\t},\n\n\t\tindex: function(value) {\n\t\t\tif (this._index !== value) {\n\t\t\t\tthis._index = value;\n\t\t\t\tthis.liveData.updateKey();\n\t\t\t}\n\t\t},\n\n\t\texpressionsEnabled: {\n\t\t\tget: function() {\n\t\t\t\tif (this._expressionsEnabled === false) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn this.parent? this.parent.expressionsEnabled : true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: [],\n\t\telements: new WeakMap()\n\t}\n});\n\nMavo.observe({attribute: \"mv-storage\"}, function({node}) {\n\t// Handle dynamic mv-storage on Mavo nodes (Fix for #576)\n\tif (node) {\n\t\tnode.storage = node.element.getAttribute(\"mv-storage\");\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Group = class Group extends Mavo.Node {\n\tconstructor (element, mavo, o) {\n\t\tsuper(element, mavo, o);\n\n\t\tthis.children = {};\n\n\t\tthis.group = this;\n\n\t\tMavo.hooks.run(\"group-init-start\", this);\n\n\t\t// Should this element also create a primitive?\n\t\tif (Mavo.Primitive.getValueAttribute(this.element)) {\n\t\t\tthis.children[this.property] = new Mavo.Primitive(this.element, this.mavo, {group: this});\n\t\t}\n\n\t\t// Create Mavo objects for all properties in this group (primitives or groups),\n\t\t// but not properties in descendant groups (they will be handled by their group)\n\t\tvar properties = $$(Mavo.selectors.property + \", \" + Mavo.selectors.multiple, this.element).filter(element => {\n\t\t\treturn this.element === (element.parentNode.closest(Mavo.selectors.childGroup) || this.mavo.element);\n\t\t});\n\n\t\t// Figure out which properties are mv-multiple\n\t\tvar collections = {};\n\t\tproperties.forEach(element => {\n\t\t\tvar property = Mavo.Node.getProperty(element);\n\n\t\t\tif (collections[property] !== \"multiple\") {\n\t\t\t\tcollections[property] = Mavo.is(\"multiple\", element)? \"multiple\" : (collections[property] || 0) + 1;\n\t\t\t}\n\t\t});\n\n\t\t// Now create the node objects\n\t\tproperties.forEach((element, i) => {\n\t\t\tvar property = Mavo.Node.getProperty(element);\n\t\t\tvar template = this.template? this.template.children[property] : null;\n\t\t\tvar options = {template, group: this};\n\t\t\tvar isCollection = collections[property];\n\n\t\t\tif (isCollection === \"multiple\") {\n\t\t\t\tvar existing = this.children[property];\n\n\t\t\t\tif (existing instanceof Mavo.Collection) {\n\t\t\t\t\texisting.add(element);\n\t\t\t\t}\n\t\t\t\telse if (Mavo.is(\"multiple\", element)) {\n\t\t\t\t\t// We must create the collection with the element that actually has mv-multiple\n\t\t\t\t\t// otherwise the template will be all wrong\n\t\t\t\t\tthis.children[property] = new Mavo.Collection(element, this.mavo, options);\n\t\t\t\t\t(existing || []).forEach((e, i) => this.children[property].add(e, i));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.children[property] = [...(existing || []), element];\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (isCollection > 1) {\n\t\t\t\tif (!this.children[property]) {\n\t\t\t\t\tthis.children[property] = new Mavo.ImplicitCollection(element, this.mavo, options);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.children[property].add(element);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Normal case\n\t\t\t\tthis.children[property] = Mavo.Node.create(element, this.mavo, options);\n\t\t\t}\n\t\t});\n\n\t\tthis.childrenNames = Object.keys(this.children);\n\n\t\tthis.vocab = Mavo.getClosestAttribute(this.element, \"vocab\");\n\n\t\tthis.postInit();\n\n\t\tMavo.hooks.run(\"group-init-end\", this);\n\t}\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t}\n\n\tgetNames (type = \"Node\") {\n\t\tvar filter = typeof type === \"function\"? type : (p, n) => n instanceof Mavo[type];\n\t\treturn Object.keys(this.children).filter(p => filter(p, this.children[p]));\n\t}\n\n\tgetData (o = {}) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o\n\t\t};\n\n\t\tif (this.isDataNull(o)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tenv.data = Mavo.shallowClone(Mavo.subset(this.data, this.inPath)) || {};\n\n\t\tfor (var property in this.children) {\n\t\t\tvar obj = this.children[property];\n\n\t\t\tif (obj.saved) {\n\t\t\t\tvar data = obj.getData(env.options);\n\t\t\t}\n\n\t\t\tif (obj.saved && Mavo.value(data) !== null) {\n\t\t\t\tenv.data[obj.property] = data;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdelete env.data[obj.property];\n\t\t\t}\n\t\t}\n\n\t\tif (!this.childrenNames.length && !this.isRoot && !this.collection) {\n\t\t\t// Avoid {} in the data\n\t\t\tenv.data = null;\n\t\t}\n\t\telse if (this.childrenNames.length === 1 && this.property in this.children) {\n\t\t\tenv.data = env.data[this.property];\n\t\t}\n\t\telse if (env.data && typeof env.data === \"object\") {\n\t\t\t// Add JSON-LD stuff\n\t\t\tif (this.type && this.type != _.DEFAULT_TYPE) {\n\t\t\t\tenv.data[\"@type\"] = this.type;\n\t\t\t}\n\n\t\t\tif (this.vocab) {\n\t\t\t\tenv.data[\"@context\"] = this.vocab;\n\t\t\t}\n\t\t}\n\n\t\t// If storing, use the rendered data too\n\t\tenv.data = Mavo.subset(this.data, this.inPath, env.data);\n\n\t\tMavo.hooks.run(\"node-getdata-end\", env);\n\n\t\treturn env.data;\n\t}\n\n\tedit (o = {}) {\n\t\tif (super.edit() === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Promise.all(Object.keys(this.children).map(prop => this.children[prop].edit(o)));\n\t}\n\n\tdataRender (data, o = {}) {\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet changed = false;\n\n\t\t// What if data is not an object?\n\t\tlet noWriteableProperty;\n\t\tlet wasPrimitive;\n\n\t\tif (typeof data !== \"object\") {\n\t\t\twasPrimitive = true;\n\t\t\tlet property = this.property;\n\n\t\t\t// Data is a primitive, render it on this.property or failing that, any writable property\n\t\t\tif (!(this.property in this.children)) {\n\t\t\t\tlet type = $.type(data);\n\t\t\t\tlet score = prop => (this.children[prop] instanceof Mavo.Primitive) + (this.children[prop].datatype == type);\n\n\t\t\t\tproperty = Object.keys(this.children)\n\t\t\t\t\t.filter(p => !this.children[p].expressionText)\n\t\t\t\t\t.sort((prop1, prop2) => score(prop1) - score(prop2))\n\t\t\t\t\t.reverse()[0];\n\t\t\t}\n\n\t\t\tif (!property) {\n\t\t\t\t// No appropriate property found, use this.property\n\t\t\t\tproperty = this.property;\n\t\t\t\tnoWriteableProperty = true;\n\t\t\t}\n\n\t\t\tdata = {[property]: data};\n\n\t\t\tthis.data = Mavo.subset(this.data, this.inPath, data);\n\t\t}\n\n\t\tlet copy; // to handle renaming\n\n\t\tthis.propagate(obj => {\n\t\t\tlet propertyData = data[obj.property];\n\n\t\t\t// find first alias with data, load that data, and set to be copied\n\t\t\tif (obj.alias) {\n\t\t\t\tlet aliasesArr = obj.alias.split(\" \");\n\n\t\t\t\tfor (let i = 0; i < aliasesArr.length; i++) {\n\t\t\t\t\tlet currentAlias = aliasesArr[i];\n\n\t\t\t\t\tif (data[currentAlias] !== undefined) {\n\t\t\t\t\t\tobj.currentAlias = currentAlias;\n\t\t\t\t\t\tcopy = copy || $.extend({}, data);\n\t\t\t\t\t\tpropertyData = data[obj.currentAlias];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tchanged = obj.render(propertyData, o) || changed;\n\t\t});\n\n\t\t// Rename properties. This needs to be done separately to handle swapping.\n\t\tif (copy) {\n\t\t\tthis.propagate(obj => {\n\t\t\t\tif (obj.currentAlias) {\n\t\t\t\t\tdata[obj.property] = copy[obj.currentAlias];\n\n\t\t\t\t\tif (!(obj.currentAlias in this.children)) {\n\t\t\t\t\t\tdelete data[obj.currentAlias];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (!wasPrimitive || noWriteableProperty) {\n\t\t\t// Fire mv-change events for properties not in the template,\n\t\t\t// since nothing else will and they can still be referenced in expressions\n\t\t\tlet oldData = Mavo.subset(this.oldData, this.inPath);\n\n\t\t\tfor (let property in data) {\n\t\t\t\tif (!(property in this.children)) {\n\t\t\t\t\tlet value = data[property];\n\t\t\t\t\tchanged = changed || data[property] !== this.liveData.data[property];\n\n\t\t\t\t\tthis.liveData.set(property, value);\n\n\t\t\t\t\tif (typeof value != \"object\" && (!oldData || oldData[property] != value)) {\n\t\t\t\t\t\t// Property actually changed. Why != \"object\" though?\n\t\t\t\t\t\tthis.dataChanged(\"propertychange\", {property});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\tstatic normalize (element) {\n\t\t// Get & normalize typeof name, if exists\n\t\tif (Mavo.is(\"group\", element)) {\n\t\t\tvar type = Mavo.getAttribute(element, \"typeof\", \"mv-group\") || _.DEFAULT_TYPE;\n\n\t\t\telement.setAttribute(\"typeof\", type);\n\n\t\t\treturn type;\n\t\t}\n\n\t\treturn null;\n\t}\n};\n\n$.Class(_, {\n\tlazy: {\n\t\tliveData: function() {\n\t\t\treturn new Mavo.Data(this, {});\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: new WeakMap(),\n\n\t\tDEFAULT_TYPE: \"Item\"\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(async function($, $$) {\n\nvar _ = Mavo.Primitive = class Primitive extends Mavo.Node {\n\tconstructor(element, mavo, o) {\n\t\tsuper(element, mavo, o);\n\n\t\tthis.liveData = new Mavo.Data(this);\n\n\t\tif (!this.fromTemplate(\"config\", \"attribute\", \"templateValue\", \"originalEditor\")) {\n\t\t\tthis.config = _.getConfig(element);\n\n\t\t\t// Which attribute holds the data, if any?\n\t\t\t// \"null\" or null for none (i.e. data is in content).\n\t\t\tthis.attribute = this.config.attribute;\n\n\t\t\t// HTML attribute names are case insensitive (Fix for #515)\n\t\t\tif (this.attribute && !document.xmlVersion) {\n\t\t\t\tthis.attribute = this.attribute.toLowerCase();\n\t\t\t}\n\t\t}\n\n\t\tthis.datatype = this.config.datatype;\n\n\t\tif (\"modes\" in this.config) {\n\t\t\t// If modes are related to element type, this overrides everything\n\t\t\t// because it means the other mode makes no sense for that element\n\t\t\tthis.modes = this.config.modes;\n\t\t\tthis.element.setAttribute(\"mv-mode\", this.config.modes);\n\t\t}\n\n\t\tMavo.hooks.run(\"primitive-init-start\", this);\n\n\t\t// Link primitive with its expressionText object\n\t\t// We need to do this before any editing UI is generated\n\t\tthis.expressionText = this.expressionText || Mavo.DOMExpression.search(this.element, this.attribute);\n\n\t\tif (this.expressionText && !this.expressionText.mavoNode) {\n\t\t\t// Computed property\n\t\t\tthis.expressionText.primitive = this;\n\t\t\tthis.storage = this.storage || \"none\";\n\t\t\tthis.modes = \"read\";\n\t\t\tthis.element.setAttribute(\"aria-live\", \"polite\");\n\t\t}\n\n\t\t/**\n\t\t * Set up input widget\n\t\t */\n\n\t\tif (this.config.init) {\n\t\t\tthis.config.init.call(this, this.element);\n\t\t}\n\n\t\tif (this.config.initOnce && !this.config.initOnce.called) {\n\t\t\tthis.config.initOnce.call(this, this.element);\n\t\t\tthis.config.initOnce.called = true;\n\t\t}\n\n\t\tif (this.config.changeEvents) {\n\t\t\t$.bind(this.element, this.config.changeEvents, evt => {\n\t\t\t\tif (evt.target === this.element) {\n\t\t\t\t\tthis.value = this.getValue();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.expressionText) {\n\t\t\tthis.setValue(this.expressionText.value, {silent: true});\n\t\t}\n\t\telse {\n\t\t\tif (this.element.hasAttribute(\"aria-label\")) {\n\t\t\t\t// Custom label\n\t\t\t\tthis.label = this.element.getAttribute(\"aria-label\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.label = Mavo.Functions.readable(this.property);\n\t\t\t\tthis.pauseObserver();\n\t\t\t\tthis.element.setAttribute(\"aria-label\", this.label);\n\t\t\t\tthis.resumeObserver();\n\t\t\t}\n\n\t\t\t// Linked widgets\n\t\t\tif (this.element.hasAttribute(\"mv-editor\")) {\n\t\t\t\tthis.originalEditorUpdated();\n\n\t\t\t\tlet editorValue = this.editorValue;\n\n\t\t\t\tif (!this.datatype && (typeof editorValue == \"number\" || typeof editorValue == \"boolean\")) {\n\t\t\t\t\tthis.datatype = typeof editorValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.templateValue = this.getValue();\n\n\t\t\tthis._default = this.element.getAttribute(\"mv-default\");\n\n\t\t\tif (this.default === null) { // no mv-default\n\t\t\t\tthis._default = this.modes? this.templateValue : this.editorValue;\n\t\t\t\tthis.defaultSource = this.modes? \"template\" : \"editor\";\n\t\t\t}\n\t\t\telse if (this.default === \"\") { // mv-default exists, no value, default is template value\n\t\t\t\tthis._default = this.templateValue;\n\t\t\t\tthis.defaultSource = \"template\";\n\t\t\t}\n\t\t\telse { // mv-default with value\n\t\t\t\tthis.defaultExpression = Mavo.DOMExpression.search(this.element, \"mv-default\");\n\n\t\t\t\tif (this.defaultExpression) {\n\t\t\t\t\t// To preserve type, e.g. booleans should stay booleans, not become strings\n\t\t\t\t\tthis.defaultExpression.output = value => this.default = value;\n\t\t\t\t}\n\n\t\t\t\tthis.defaultSource = \"attribute\";\n\t\t\t}\n\n\t\t\tvar keepTemplateValue = !this.template // not in a collection or first item\n\t\t\t                        || this.template.templateValue != this.templateValue // or different template value than first item\n\t\t\t\t\t\t\t\t\t|| this.modes == \"edit\"; // or is always edited\n\n\t\t\tif (this.default === undefined && keepTemplateValue) {\n\t\t\t\tthis.initialValue = this.templateValue;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.initialValue = this.default;\n\t\t\t}\n\n\t\t\tif (this.initialValue === undefined) {\n\t\t\t\tthis.initialValue = this.emptyValue;\n\t\t\t}\n\n\t\t\tthis.setValue(this.initialValue, {silent: true});\n\t\t}\n\n\t\tthis.postInit();\n\n\t\tMavo.hooks.run(\"primitive-init-end\", this);\n\t}\n\n\tget editorValue() {\n\t\tlet editor = this.editor || this.originalEditor;\n\n\t\tif (editor) {\n\t\t\tif (editor.matches(Mavo.selectors.formControl)) {\n\t\t\t\treturn _.getValue(editor, {datatype: this.datatype});\n\t\t\t}\n\n\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\tlet output = $(Mavo.selectors.output + \", \" + Mavo.selectors.formControl, editor);\n\n\t\t\tif (output) {\n\t\t\t\treturn _.getValue(output);\n\t\t\t}\n\t\t}\n\t}\n\n\tset editorValue(value) {\n\t\tif (this.config.setEditorValue && this.datatype !== \"boolean\") {\n\t\t\treturn this.config.setEditorValue.call(this, value);\n\t\t}\n\n\t\tif (this.editor) {\n\t\t\tif (this.editor.matches(Mavo.selectors.formControl)) {\n\t\t\t\tif (this.editor.matches(\"select\")) {\n\t\t\t\t\tlet text = [...this.editor.options].find(o => o.value == value)?.textContent;\n\n\t\t\t\t\t// We have a local editor, do we need to add/remove temp options?\n\t\t\t\t\tif (text === undefined) {\n\t\t\t\t\t\t// Option not found in the select menu, add a temp option\n\t\t\t\t\t\t$.create(\"option\", {\n\t\t\t\t\t\t\tclassName: \"mv-volatile\",\n\t\t\t\t\t\t\ttextContent: value,\n\t\t\t\t\t\t\tinside: this.editor,\n\t\t\t\t\t\t\tselected: true,\n\t\t\t\t\t\t\tdisabled: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_.setValue(this.editor, value, {config: this.editorDefaults});\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\t\tvar output = $(Mavo.selectors.output + \", \" + Mavo.selectors.formControl, this.editor);\n\n\t\t\t\tif (output) {\n\t\t\t\t\t_.setValue(output, value);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tdestroy () {\n\t\tsuper.destroy();\n\t\tthis.originalEditorObserver?.destroy();\n\t}\n\n\tisDataNull(o) {\n\t\treturn super.isDataNull(o) || this._value === null || this._value === undefined;\n\t}\n\n\tgetData (o = {}) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o\n\t\t};\n\n\t\tif (this.isDataNull(o)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tenv.data = this.value;\n\n\t\tif (env.data === \"\" && (!this.templateValue || this.initialValue !== this.templateValue)) {\n\t\t\tenv.data = null;\n\t\t}\n\n\t\tif (this.inPath.length) {\n\t\t\tenv.data = Mavo.subset(this.data, this.inPath, env.data);\n\t\t}\n\n\t\tMavo.hooks.run(\"node-getdata-end\", env);\n\n\t\treturn env.data;\n\t}\n\n\t// Why this complexity? Because it needs to be a stack, so that\n\t// pause, pause, resume doesn't actually resume, you need to resume as many\n\t// times as you paused, so that nested function calls work as expected.\n\tget pausedObserver () {\n\t\treturn this.observerPauses?.length > 0;\n\t}\n\n\tpauseObserver () {\n\t\tMavo.observers.flush();\n\t\tthis.observerPauses = this.observerPauses || [];\n\t\tthis.observerPauses.push(1);\n\t}\n\n\tresumeObserver () {\n\t\tMavo.observers.flush();\n\t\tthis.observerPauses?.pop?.();\n\t}\n\n\tsave() {\n\t\tthis.savedValue = this.value;\n\t\tthis.unsavedChanges = false;\n\t}\n\n\t// Called only the first time this primitive is edited\n\tinitEdit () {\n\t\tif (!this.editor && this.originalEditor) {\n\t\t\tthis.editor = this.originalEditor.cloneNode(true);\n\t\t}\n\n\t\tthis.editorUpdated();\n\n\t\tthis.initEdit = null;\n\t}\n\n\tgenerateDefaultEditor() {\n\t\t// No editor provided, generate default for element type\n\t\t// Find default editor for datatype\n\t\tlet editor = this.config.editor;\n\n\t\tif (!editor || this.datatype == \"boolean\") {\n\t\t\teditor = Mavo.Elements.defaultConfig[this.datatype || \"string\"].editor;\n\t\t}\n\n\t\tthis.editor = $.create($.type(editor) === \"function\"? editor.call(this) : editor);\n\t\tthis.editorValue = this.value;\n\t}\n\n\tupdateEditType() {\n\t\tlet ret = this.element.getAttribute(\"mv-edit-type\")?.trim() ?? \"auto\";\n\n\t\tif (ret === \"auto\") {\n\t\t\t// attribute may be \"auto\", in which case we want to get in here\n\t\t\tret = this.config.editType ?? \"auto\";\n\t\t}\n\n\t\tif (ret === \"auto\") {\n\t\t\tret = this.attribute? \"popup\" : \"inline\";\n\t\t}\n\n\t\treturn this.editType = ret;\n\t}\n\n\teditorUpdated () {\n\t\tif (!this.editor) {\n\t\t\tthis.generateDefaultEditor();\n\t\t}\n\n\t\t$.bind(this.editor, {\n\t\t\t\"input change\": evt => {\n\t\t\t\tthis.value = this.editorValue;\n\t\t\t},\n\t\t\t\"mv-change\": evt => {\n\t\t\t\tif (evt.property === \"output\") {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t$.fire(this.editor, \"input\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tlet multiline = this.editor.matches(\"textarea\");\n\n\t\tif (!multiline) {\n\t\t\tthis.editor.addEventListener(\"focus\", evt => {\n\t\t\t\tthis.editor.select?.();\n\t\t\t});\n\t\t}\n\n\t\tif (\"placeholder\" in this.editor && !this.editor.placeholder) {\n\t\t\tthis.editor.placeholder = `(${this.label})`;\n\t\t}\n\n\t\t// Copy any mv-editor-* attributes from the element to the editor\n\t\tfor (let name of Mavo.getAttributes(this.element, /^mv-editor-/)) {\n\t\t\tlet value = this.element.getAttribute(name);\n\t\t\tname = name.replace(/^mv-editor-/, \"\");\n\t\t\tthis.editor.setAttribute(name, value);\n\t\t}\n\t}\n\n\toriginalEditorUpdated () {\n\t\tlet previousOriginalEditor = this.originalEditor;\n\t\tlet selector = this.element.getAttribute(\"mv-editor\");\n\n\t\ttry {\n\t\t\tthis.originalEditor = $(selector);\n\t\t}\n\t\tcatch (e) {\n\t\t\t// Invalid selector, potentially expression that has not yet evaluated?\n\t\t\tthis.originalEditor = null;\n\t\t}\n\n\t\tif (previousOriginalEditor === this.originalEditor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.originalEditor) {\n\t\t\tif (this.editor) {\n\t\t\t\tthis.editor = this.originalEditor.cloneNode(true);\n\t\t\t\tthis.setValue(this.value, {force: true, silent: true});\n\t\t\t}\n\n\t\t\t// Update editor if original mutates\n\t\t\t// This means that expressions on mv-editor for individual collection items will not be picked up\n\t\t\tif (!this.template || this.originalEditor !== this.template.originalEditor) {\n\t\t\t\tthis.originalEditorObserver?.destroy();\n\n\t\t\t\tthis.originalEditorObserver = new Mavo.Observer(this.originalEditor, \"all\", records => {\n\t\t\t\t\tlet nodes = [this];\n\n\t\t\t\t\tif (this.template) {\n\t\t\t\t\t\tlet copies = this.copies.filter(n => n.originalEditor === this.originalEditor);\n\t\t\t\t\t\tnodes.push(...copies);\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let primitive of nodes) {\n\t\t\t\t\t\tif (primitive.defaultSource == \"editor\") {\n\t\t\t\t\t\t\tprimitive.default = this.originalEditor.value;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (primitive.editor) {\n\t\t\t\t\t\t\tprimitive.editor = this.originalEditor.cloneNode(true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tprimitive.setValue(primitive.value, {force: true, silent: true});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (this.editor) {\n\t\t\t\tthis.generateDefaultEditor();\n\t\t\t\tthis.editorUpdated();\n\t\t\t}\n\t\t}\n\t}\n\n\tedit (o = {}) {\n\t\tlet wasEditing = this.editing;\n\n\t\tif (super.edit(o) === false) {\n\t\t\t// Invalid edit\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!o.force && wasEditing && !this.initEdit) {\n\t\t\t// Already being edited\n\t\t\treturn true;\n\t\t}\n\n\t\tif ($.type(this._value) === \"object\") {\n\t\t\t// Editing is disabled when value is an object (see #692)\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!wasEditing) {\n\t\t\t// Make element focusable, so it can actually receive focus\n\t\t\tif (this.element.tabIndex === -1) {\n\t\t\t\tMavo.revocably.setAttribute(this.element, \"tabindex\", \"0\");\n\t\t\t}\n\n\t\t\t// Prevent default actions while editing\n\t\t\t// e.g. following links etc\n\t\t\tif (!this.modes) {\n\t\t\t\t$.bind(this.element, \"click.mavo:edit\", evt => {\n\t\t\t\t\tif (!this.editor.contains(evt.target)) {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (this.closestCollection && this.editor && this.editor.matches(Mavo.selectors.textInput)) {\n\t\t\t// If pasting text with line breaks and this is a single-line input\n\t\t\t// Insert them as multiple items\n\t\t\tlet multiline = this.editor.matches(\"textarea\");\n\n\t\t\tif (!multiline) {\n\t\t\t\t$.bind(this.editor, \"paste.mavo:edit\", evt => {\n\t\t\t\t\tif (!this.closestCollection.editing || !evt.clipboardData) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet text = evt.clipboardData.getData(\"text/plain\");\n\t\t\t\t\tconst CRLF = /\\r?\\n|\\r/;\n\n\t\t\t\t\tif (CRLF.test(text)) {\n\t\t\t\t\t\tevt.preventDefault();\n\n\t\t\t\t\t\tlet lines = text.split(CRLF);\n\n\t\t\t\t\t\t// \"Paste\" first line where the cursor is\n\t\t\t\t\t\tthis.editor.setRangeText(lines[0]);\n\t\t\t\t\t\t$.fire(this.editor, \"input\");\n\n\t\t\t\t\t\t// Insert the rest of the lines as new items\n\t\t\t\t\t\t// FIXME DRYfy the repetition between this code and the one below\n\t\t\t\t\t\tlet collection = this.closestCollection;\n\t\t\t\t\t\tlet index = closestItem?.index || 0;\n\n\t\t\t\t\t\tfor (let i=1; i<lines.length; i++) {\n\t\t\t\t\t\t\tlet closestItem = this.closestItem;\n\t\t\t\t\t\t\tlet next = collection.add(undefined, index + i);\n\t\t\t\t\t\t\tcollection.editItem(next); // TODO add() should take care of this\n\n\t\t\t\t\t\t\tlet copy = this.getCousin(i);\n\t\t\t\t\t\t\tcopy.render(lines[i]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t$.bind(this.editor, \"keydown.mavo:edit\", evt => {\n\t\t\t\tif (!this.closestCollection.editing) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (evt.key == \"Enter\" && (evt.shiftKey || !multiline)) {\n\t\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet closestItem = this.closestItem;\n\t\t\t\t\tlet next = this.closestCollection.add(undefined, closestItem?.index + 1);\n\t\t\t\t\tthis.closestCollection.editItem(next);\n\n\t\t\t\t\tlet copy = this.getCousin(1);\n\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\tcopy.edit();\n\t\t\t\t\t\tcopy.editor.focus();\n\t\t\t\t\t});\n\n\t\t\t\t\tif (multiline) {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (evt.key == \"Backspace\" && (this.empty || evt[Mavo.superKey])) {\n\t\t\t\t\t// Focus on sibling afterwards\n\t\t\t\t\tlet sibling = this.getCousin(1) || this.getCousin(-1);\n\n\t\t\t\t\t// Backspace on empty primitive or Cmd/Ctrl + Backspace should delete item\n\t\t\t\t\tthis.closestCollection.delete(this.closestItem);\n\n\t\t\t\t\tif (sibling) {\n\t\t\t\t\t\tsibling.edit();\n\t\t\t\t\t\tsibling.editor.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.config.edit) {\n\t\t\tthis.config.edit.call(this);\n\t\t\tthis.initEdit = null;\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.pauseObserver();\n\n\t\t// Actual edit\n\n\t\tif (this.initEdit) {\n\t\t\tthis.initEdit();\n\t\t}\n\n\t\tthis.editor.classList.toggle(\"mv-editor\", this.editType !== \"popup\");\n\n\t\tif (this.editType === \"popup\") {\n\t\t\tif (!this.popup) {\n\t\t\t\tthis.popup = new Mavo.UI.Popup(this);\n\t\t\t}\n\n\t\t\tthis.popup.prepare();\n\n\t\t\tlet events = \"mousedown focus dragover dragenter\".split(\" \").map(e => e + \".mavo:edit\").join(\" \");\n\n\t\t\t$.bind(this.element, events, _ => this.popup.show());\n\t\t}\n\t\telse if (this.editType === \"inline\") {\n\t\t\tif (!this.editor.isConnected) {\n\t\t\t\tthis.editorValue = this.value;\n\n\t\t\t\tif (this.config.hasChildren) {\n\t\t\t\t\tthis.element.textContent = \"\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t_.setText(this.element, \"\");\n\t\t\t\t}\n\n\t\t\t\t// If there's an expression on .textContent, it will kick\n\t\t\t\t// the editor out of the DOM next time it's updated.\n\t\t\t\t// To fix this, we re-assign it to the actual text node.\n\t\t\t\tif (!this.contentExpression) {\n\t\t\t\t\tthis.contentExpression = Mavo.DOMExpression.search(this.element, null);\n\t\t\t\t}\n\n\t\t\t\tif (this.contentExpression) {\n\t\t\t\t\tthis.contentExpression.active = false;\n\t\t\t\t}\n\n\t\t\t\tthis.element.prepend(this.editor);\n\t\t\t}\n\n\t\t\tif (!this.collection) {\n\t\t\t\tMavo.revocably.restoreAttribute(this.element, \"tabindex\");\n\t\t\t}\n\t\t}\n\n\t\tthis.resumeObserver();\n\n\t\treturn true;\n\t} // edit\n\n\tdone (o) {\n\t\tif (super.done(o) === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t$.unbind(this.element, \".mavo:edit\");\n\n\t\tthis.pauseObserver();\n\n\t\tif (this.config.done) {\n\t\t\tthis.config.done.call(this);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.editType === \"popup\") {\n\t\t\tthis.popup?.close();\n\t\t}\n\t\telse if (this.editType === \"inline\" && this.editor) {\n\t\t\tthis.editor.remove();\n\n\t\t\tif (this.contentExpression) {\n\t\t\t\t// This only works because nothing else sets active\n\t\t\t\t// Eventually, we'll need to move to a stack of some sort\n\t\t\t\t// to cater to cases where active was false before, so should be false after\n\t\t\t\tthis.contentExpression.active = true;\n\t\t\t\tthis.contentExpression.update();\n\t\t\t}\n\n\t\t\t// force: true is needed because otherwise setValue() aborts when it sees\n\t\t\t// that the value we are trying to set is the same as the existing one\n\t\t\tthis.setValue(this.editorValue, {silent: true, force: true});\n\t\t}\n\n\t\tif (this.editor?.matches(\"select\")) {\n\t\t\t// Remove any temp options that we dont need anymore\n\t\t\t$$(\".mv-volatile\", this.editor).forEach(o => {\n\t\t\t\tif (!o.selected) {\n\t\t\t\t\to.remove();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.resumeObserver();\n\n\t\tif (!this.collection) {\n\t\t\tMavo.revocably.restoreAttribute(this.element, \"tabindex\");\n\t\t}\n\t}\n\n\tdataRender (data, {live, root} = {}) {\n\t\tvar previousValue = this._value;\n\n\t\tif ($.type(data) === \"object\") {\n\t\t\tif (Symbol.toPrimitive in data) {\n\t\t\t\tdata = data[Symbol.toPrimitive](\"default\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Disable editing when the value is an object\n\t\t\t\t// We do that by calling .done() and then rejecting in .edit()\n\t\t\t\tif (this.editing) {\n\t\t\t\t\tthis.done();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (data === undefined) {\n\t\t\t// New property has been added to the schema and nobody has saved since\n\t\t\tif (!this.modes && this.value === this.templateValue) {\n\t\t\t\tthis.value = this.closestCollection? this.default : this.templateValue;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.value = data;\n\t\t}\n\n\t\treturn this._value !== previousValue;\n\t}\n\n\tfind (property, o = {}) {\n\t\tif (this.property == property && o.exclude !== this) {\n\t\t\treturn this;\n\t\t}\n\t}\n\n\t/**\n\t * Get value from the DOM\n\t */\n\tgetValue (o) {\n\t\tif (this.editing && this.editor && this.editor !== this.element) {\n\t\t\treturn this.editorValue;\n\t\t}\n\n\t\treturn _.getValue(this.element, {\n\t\t\tconfig: this.config,\n\t\t\tattribute: this.attribute,\n\t\t\tdatatype: this.datatype\n\t\t});\n\t}\n\n\tsetValue (value, o = {}) {\n\t\tif (value === undefined) {\n\t\t\tvalue = null;\n\t\t}\n\n\t\tlet oldDatatype = this.datatype;\n\n\t\t// If there's no datatype, adopt that of the value\n\t\tif (!this.datatype && (typeof value == \"number\" || typeof value == \"boolean\")) {\n\t\t\tthis.datatype = typeof value;\n\t\t}\n\n\t\tvalue = _.safeCast(value, this.datatype);\n\n\t\tif (!o.force && value === this._value && oldDatatype == this.datatype) {\n\t\t\t// Do nothing if value didn't actually change, unless forced to\n\t\t\treturn value;\n\t\t}\n\n\t\tthis.pauseObserver();\n\n\t\tif (this.editor && this.editorValue != value) {\n\t\t\t// If an editor is present, set its value to match\n\t\t\tthis.editorValue = value;\n\t\t}\n\n\t\t// Also set DOM value if either using a popup, or there's no editor\n\t\t// or the editor is not inside the element (e.g. it could be a nested editor that is now detached)\n\t\tif (this.editType == \"popup\" || !this.editor || (this.editor !== document.activeElement && !this.element.contains(this.editor))) {\n\t\t\tif (this.config.setValue) {\n\t\t\t\tthis.config.setValue.call(this, this.element, value);\n\t\t\t}\n\t\t\telse if (!o.dataOnly) {\n\t\t\t\tlet map = this.originalEditor || this.editor;\n\t\t\t\tlet presentational;\n\n\t\t\t\tif (map?.matches(\"select\")) {\n\t\t\t\t\tpresentational = [...map.options].find(o => o.value == value)?.textContent;\n\t\t\t\t}\n\n\t\t\t\t_.setValue(this.element, value, {\n\t\t\t\t\tconfig: this.config,\n\t\t\t\t\tattribute: this.attribute,\n\t\t\t\t\tdatatype: this.datatype,\n\t\t\t\t\tpresentational,\n\t\t\t\t\tnode: this\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.empty = !value && value !== 0;\n\n\t\tthis._value = value;\n\n\t\tthis.liveData.update();\n\n\t\tif (!o.silent) {\n\t\t\tif (this.saved) {\n\t\t\t\tthis.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t\t}\n\n\t\t\tthis.dataChanged(\"propertychange\", {value});\n\t\t}\n\n\t\tthis.resumeObserver();\n\n\t\treturn value;\n\t}\n\n\tdataChanged (action = \"propertychange\", o) {\n\t\treturn super.dataChanged(action, o);\n\t}\n\n\tasync upload (file, name = file.name) {\n\t\tif (!this.mavo.uploadBackend || !self.FileReader) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tempURL = URL.createObjectURL(file);\n\n\t\t// FIXME what if there's no attribute?\n\t\tthis.pauseObserver();\n\t\tthis.element.setAttribute(this.attribute, tempURL);\n\t\tthis.resumeObserver();\n\n\t\tvar path = this.element.getAttribute(\"mv-upload-path\") || \"\";\n\t\tvar relative = path + \"/\" + name;\n\n\t\tlet url = await this.mavo.upload(file, relative);\n\t\t// Do we have a URL override?\n\t\tvar base = Mavo.getClosestAttribute(this.element, \"mv-upload-url\");\n\n\t\tif (base) {\n\t\t\t// Throw away backend-provided URL and use the override instead\n\t\t\turl = new URL(relative, new URL(base, location)) + \"\";\n\t\t}\n\n\t\tthis.value = url;\n\n\t\tif (!this.element.matches(\"a\")) {\n\t\t\t// <a> should get the proper URL immediately, because hovering would reveal what it is\n\t\t\t// for other types, we should keep the temporary URL because the real one may not have deployed yet\n\t\t\t// If the editor is manually edited, this will change anyway\n\t\t\tthis.pauseObserver();\n\t\t\tthis.element.setAttribute(this.attribute, tempURL);\n\t\t\tthis.resumeObserver();\n\t\t}\n\t}\n\n\tcreateUploadPopup (type, kind = \"file\", ext) {\n\t\tvar env = { context: this, type, kind, ext };\n\n\t\tenv.mainInput = $.create(\"input\", {\n\t\t\t\"type\": \"url\",\n\t\t\t\"placeholder\": `http://example.com/${kind}.${ext}`,\n\t\t\t\"className\": \"mv-output\",\n\t\t\t\"aria-label\": `URL to ${kind}`\n\t\t});\n\n\t\tif (this.mavo.uploadBackend && self.FileReader) {\n\t\t\tvar checkType = file => file && (!type || file.type.indexOf(type.replace(\"*\", \"\")) === 0);\n\n\t\t\tenv.events = {\n\t\t\t\t\"paste\": evt => {\n\t\t\t\t\t// Look for the first file in the clipboard\n\t\t\t\t\tvar item = Array.from(evt.clipboardData.items).find(item => item.kind === \"file\");\n\t\t\t\t\tvar ext = item?.type.split(\"/\")[1];\n\n\t\t\t\t\tif (item && checkType(item)) {\n\t\t\t\t\t\t// Is a file of the correct type, upload!\n\t\t\t\t\t\t// First, try to find its name in the clipboard\n\t\t\t\t\t\tvar defaultName = evt.clipboardData.getData(\"text\") || `pasted-${kind}-${Date.now()}.${ext}`;\n\t\t\t\t\t\tvar name = prompt(this.mavo._(\"filename\"), defaultName);\n\n\t\t\t\t\t\tif (name === \"\") {\n\t\t\t\t\t\t\tname = defaultName;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (name !== null) {\n\t\t\t\t\t\t\tthis.upload(item.getAsFile(), name, type);\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"drag dragstart dragend dragover dragenter dragleave drop\": evt => {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t},\n\t\t\t\t\"dragover dragenter\": evt => {\n\t\t\t\t\tenv.popup.classList.add(\"mv-dragover\");\n\t\t\t\t\tthis.element.classList.add(\"mv-dragover\");\n\t\t\t\t},\n\t\t\t\t\"dragleave dragend drop\": evt => {\n\t\t\t\t\tenv.popup.classList.remove(\"mv-dragover\");\n\t\t\t\t\tthis.element.classList.remove(\"mv-dragover\");\n\t\t\t\t},\n\t\t\t\t\"drop\": evt => {\n\t\t\t\t\tvar file = evt.dataTransfer.files[0];\n\n\t\t\t\t\tif (file && checkType(file)) {\n\t\t\t\t\t\tthis.upload(file);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tMavo.hooks.run(\"primitive-createuploadpopup-beforecreate\", env);\n\n\t\t\tenv.popup = $.create({\n\t\t\t\tclassName: \"mv-upload-popup\",\n\t\t\t\tcontents: [\n\t\t\t\t\tenv.mainInput, {\n\t\t\t\t\t\ttag: \"input\",\n\t\t\t\t\t\ttype: \"file\",\n\t\t\t\t\t\t\"aria-label\": `Upload ${kind}`,\n\t\t\t\t\t\taccept: type,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tchange: evt => {\n\t\t\t\t\t\t\t\tvar file = evt.target.files[0];\n\n\t\t\t\t\t\t\t\tif (file && checkType(file)) {\n\t\t\t\t\t\t\t\t\tthis.upload(file);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tclassName: \"mv-tip\",\n\t\t\t\t\t\tinnerHTML: \"<strong>Tip:</strong> You can also drag & drop or paste!\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tevents: env.events\n\t\t\t});\n\n\t\t\t// Drag & Drop should also work on the <img> element itself\n\t\t\t$.bind(this.element, env.events);\n\n\t\t\tMavo.hooks.run(\"primitive-createuploadpopup-beforereturn\", env);\n\n\t\t\treturn env.popup;\n\t\t}\n\t\telse {\n\t\t\treturn env.mainInput;\n\t\t}\n\t}\n\n\tstatic getText (element) {\n\t\tvar node = element.nodeType === Node.TEXT_NODE? element : element.firstChild;\n\n\t\tif (node?.nodeType === Node.TEXT_NODE) {\n\t\t\treturn node.nodeValue;\n\t\t}\n\t\telse {\n\t\t\treturn \"\";\n\t\t}\n\t}\n\n\tstatic setText (element, text) {\n\t\tvar node = element.nodeType === Node.TEXT_NODE? element : element.firstChild;\n\n\t\tif (node?.nodeType === Node.TEXT_NODE) {\n\t\t\tnode.nodeValue = text;\n\t\t}\n\t\telse {\n\t\t\telement.prepend(text);\n\t\t}\n\t}\n\n\tstatic getValueAttribute (element, config = Mavo.Elements.search(element)) {\n\t\tvar ret = element.getAttribute(\"mv-attribute\") || config.attribute;\n\n\t\tif (!ret || ret === \"null\" || ret === \"none\") {\n\t\t\tret = null;\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Only cast if conversion is lossless\n\t */\n\tstatic safeCast (value, datatype) {\n\t\tvar existingType = typeof value;\n\t\tvar cast = _.cast(value, datatype);\n\n\t\tif (datatype == \"boolean\") {\n\t\t\tif (!value) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (value === \"true\" || value > 0) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (datatype == \"number\") {\n\t\t\tif (/^[-+]?[0-9.e]+$/i.test(value + \"\")) {\n\t\t\t\treturn cast;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (value === null || value === undefined) {\n\t\t\treturn value;\n\t\t}\n\n\t\treturn cast;\n\t}\n\n\t/**\n\t * Cast to a different primitive datatype\n\t */\n\tstatic cast (value, datatype) {\n\t\tswitch (datatype) {\n\t\t\tcase \"number\": return +value;\n\t\t\tcase \"boolean\": return !!value;\n\t\t\tcase \"string\": return value + \"\";\n\t\t}\n\n\t\treturn value;\n\t}\n\n\tstatic getValue (element, {config, attribute, datatype} = {}) {\n\t\tif (!config) {\n\t\t\tconfig = _.getConfig(element, attribute);\n\t\t}\n\n\t\tattribute = config.attribute;\n\t\tdatatype = config.datatype;\n\n\t\tif (config.getValue && attribute == config.attribute) {\n\t\t\treturn config.getValue(element);\n\t\t}\n\n\t\tvar ret;\n\n\t\tif (attribute in element && _.useProperty(element, attribute)) {\n\t\t\t// Returning properties (if they exist) instead of attributes\n\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\tret = element[attribute];\n\t\t}\n\t\telse if (attribute) {\n\t\t\tret = element.getAttribute(attribute);\n\t\t}\n\t\telse {\n\t\t\tret = element.getAttribute(\"content\") || _.getText(element) || null;\n\t\t}\n\n\t\treturn _.safeCast(ret, datatype);\n\t}\n\n\tstatic getConfig (element, attribute, datatype) {\n\t\tif (attribute === undefined) {\n\t\t\tattribute = element.getAttribute(\"mv-attribute\") || undefined;\n\t\t}\n\n\t\tif (attribute == \"null\" || attribute == \"none\") {\n\t\t\tattribute = null;\n\t\t}\n\n\t\tvar isAttributeDefault = attribute === undefined || attribute == _.getValueAttribute(element);\n\n\t\tif (!datatype && isAttributeDefault) {\n\t\t\tdatatype = element.getAttribute(\"datatype\") || undefined;\n\t\t}\n\n\t\tvar config = Mavo.Elements.search(element, attribute, datatype);\n\t\tconfig = Object.assign({}, config);\n\n\t\tif (config.attribute === undefined) {\n\t\t\tconfig.attribute = attribute || null;\n\t\t}\n\n\t\tif (config.datatype === undefined) {\n\t\t\tconfig.datatype = datatype;\n\t\t}\n\n\t\treturn config;\n\t}\n\n\t// This is called both on primitive nodes to set their value,\n\t// as well as (primitive) expressions\n\tstatic async setValue (element, value, o = {}) {\n\t\tdelete _.pending.get(element)?.[o.attribute];\n\n\t\tif ($.type(value) === \"promise\") {\n\t\t\tif (!_.pending.has(element)) {\n\t\t\t\t_.pending.set(element, {});\n\t\t\t}\n\n\t\t\tlet pending = value;\n\t\t\t_.pending.get(element)[o.attribute] = pending;\n\n\t\t\ttry {\n\t\t\t\tvalue = await pending;\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tvalue = e;\n\t\t\t}\n\n\t\t\tif (_.pending.get(element)[o.attribute] !== pending) {\n\t\t\t\t// Value has been superseded\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdelete _.pending.get(element)?.[o.attribute];\n\t\t}\n\n\t\tif (element.nodeType === 1) {\n\t\t\tif (!o.config) {\n\t\t\t\to.config = _.getConfig(element, o.attribute);\n\t\t\t}\n\n\t\t\to.attribute = o.attribute !== undefined? o.attribute : o.config.attribute;\n\t\t\to.datatype = o.datatype !== undefined? o.datatype : o.config.datatype;\n\n\t\t\tif (o.config.setValue && o.attribute == o.config.attribute) {\n\t\t\t\treturn o.config.setValue(element, value, o.attribute);\n\t\t\t}\n\t\t}\n\n\t\tif (value === null && !o.datatype) {\n\t\t\tvalue = \"\";\n\t\t}\n\n\t\tif (o.attribute) {\n\t\t\tif (o.attribute in element && _.useProperty(element, o.attribute) && element[o.attribute] !== value) {\n\t\t\t\t// Setting properties (if they exist) instead of attributes\n\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\ttry {\n\t\t\t\t\tvar previousValue = element[o.attribute];\n\t\t\t\t\tvar newValue = element[o.attribute] = value;\n\t\t\t\t}\n\t\t\t\tcatch (e) {}\n\t\t\t}\n\n\t\t\t// Set attribute anyway, even if we set a property because when\n\t\t\t// they're not in sync it gets really fucking confusing.\n\t\t\tif (o.datatype == \"boolean\") {\n\t\t\t\tif (value != element.hasAttribute(o.attribute)) {\n\t\t\t\t\t$.toggleAttribute(element, o.attribute, value, value);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (element.getAttribute(o.attribute) != value) {  // intentionally non-strict, e.g. \"3.\" !== 3\n\t\t\t\telement.setAttribute(o.attribute, value);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tvar presentational = o.presentational ?? _.format(value, o);\n\n\t\t\tif (o.node && !o.config.hasChildren) {\n\t\t\t\t_.setText(element, presentational);\n\t\t\t}\n\t\t\telse {\n\t\t\t\telement.textContent = presentational;\n\t\t\t}\n\n\t\t\tif (presentational !== value && element.setAttribute) {\n\t\t\t\telement.setAttribute(\"content\", value);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t *  Set/get a property or an attribute?\n\t * @return {Boolean} true to use a property, false to use the attribute\n\t */\n\tstatic useProperty (element, attribute) {\n\t\tif ([\"href\", \"src\"].indexOf(attribute) > -1) {\n\t\t\t// URL properties resolve \"\" as location.href, fucking up emptiness checks\n\t\t\treturn false;\n\t\t}\n\n\t\tif (element.namespaceURI == \"http://www.w3.org/2000/svg\") {\n\t\t\t// SVG has a fucked up DOM, do not use these properties\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstatic format (value, o = {}) {\n\t\tif (($.type(value) === \"number\" || o.datatype == \"number\")) {\n\t\t\tif (value === null) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\tvar skipNumberFormatting = o.attribute || o.element?.matches(\"style, pre\");\n\n\t\t\tif (!skipNumberFormatting) {\n\t\t\t\treturn _.formatNumber(value);\n\t\t\t}\n\t\t}\n\n\t\tif (Array.isArray(value)) {\n\t\t\treturn value.map(_.format).join(\", \");\n\t\t}\n\n\t\tif ($.type(value) === \"object\") {\n\t\t\t// Oops, we have an object. Print something more useful than [object Object]\n\t\t\treturn Mavo.toJSON(value);\n\t\t}\n\n\t\treturn value;\n\t}\n};\n\n$.Class(_, {\n\tlazy: {\n\t\temptyValue: function() {\n\t\t\tswitch (this.datatype) {\n\t\t\t\tcase \"boolean\":\n\t\t\t\t\treturn false;\n\t\t\t\tcase \"number\":\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn \"\";\n\t\t},\n\n\t\teditorDefaults: function() {\n\t\t\treturn this.editor && _.getConfig(this.editor);\n\t\t},\n\n\t\teditType: function() {\n\t\t\treturn this.updateEditType();\n\t\t}\n\t},\n\n\tlive: {\n\t\teditor: function (value) {\n\t\t\tif (this._editor === value) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If we are editing the node, just setting this.editor won't help\n\t\t\t// we also need to update it in the DOM\n\t\t\tthis._editor?.replaceWith(value);\n\n\t\t\tthis._editor = value;\n\n\t\t\tif (this.defaultSource === \"editor\") {\n\t\t\t\tthis.default = this.editorValue;\n\t\t\t}\n\n\t\t\tthis.editorUpdated();\n\t\t},\n\n\t\tdefault: function (value) {\n\t\t\tif (this.value == this._default) {\n\t\t\t\tthis.value = value;\n\t\t\t}\n\t\t},\n\n\t\tvalue: function (value) {\n\t\t\treturn this.setValue(value);\n\t\t},\n\n\t\tdatatype: function (value) {\n\t\t\tif (value !== this._datatype) {\n\t\t\t\tif (value == \"boolean\" && !this.attribute) {\n\t\t\t\t\tthis.attribute = Mavo.Elements.defaultConfig.boolean.attribute;\n\t\t\t\t}\n\n\t\t\t\t$.toggleAttribute(this.element, \"datatype\", value, value && value !== \"string\");\n\t\t\t}\n\t\t},\n\n\t\tempty: function (value) {\n\t\t\tlet hide = value && // is empty\n\t\t\t           !this.modes && // and supports both modes\n\t\t\t           (!this.attribute || !$(Mavo.selectors.property, this.element)) && // and has no property inside\n\t\t\t\t\t   // and is not boolean OR if it is, its attribute is the default boolean attribute (see #464)\n\t\t\t           (this.datatype !== \"boolean\" || this.attribute === Mavo.Elements.defaultConfig.boolean.attribute);\n\n\t\t\tthis.element.classList.toggle(\"mv-empty\", !!hide);\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: new WeakMap(),\n\t\tpending: new Map(),\n\n\t\tlazy: {\n\t\t\tformatNumber: () => {\n\t\t\t\tvar numberFormat = new Intl.NumberFormat(Mavo.locale, {maximumFractionDigits:2});\n\n\t\t\t\treturn function(value) {\n\t\t\t\t\tif (value === Infinity || value === -Infinity) {\n\t\t\t\t\t\t// Pretty print infinity\n\t\t\t\t\t\treturn value < 0? \"-\" : \"\";\n\t\t\t\t\t}\n\n\t\t\t\t\treturn numberFormat.format(value);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n});\n\nMavo.observe({id: \"primitive\"}, function({node, type, attribute, record, element}) {\n\tif (node instanceof Mavo.Primitive && node.config && !node.pausedObserver) {\n\t\tif (attribute === \"mv-default\" && !node.defaultExpression) {\n\t\t\tnode.default = element.getAttribute(\"mv-default\");\n\t\t}\n\t\telse if (attribute === \"aria-label\") {\n\t\t\tnode.label = element.getAttribute(\"aria-label\");\n\n\t\t\tif (Mavo.in(\"placeholder\", node.editor)) {\n\t\t\t\tnode.editor.placeholder = `(${node.label})`;\n\t\t\t}\n\t\t}\n\t\telse if (attribute && attribute === \"mv-editor\") {\n\t\t\tnode.originalEditorUpdated();\n\t\t}\n\t\telse if (attribute && attribute === \"mv-edit-type\") {\n\t\t\tlet editing = node.editing;\n\n\t\t\tif (editing) {\n\t\t\t\t// Undo whatever editing UI we currently have\n\t\t\t\tnode.done({force: true});\n\t\t\t}\n\n\t\t\tnode.updateEditType();\n\n\t\t\tif (editing) {\n\t\t\t\tnode.edit({force: true});\n\t\t\t}\n\t\t}\n\t\telse if (attribute && attribute.indexOf(\"mv-editor-\") === 0) {\n\t\t\tnode.editor?.setAttribute(attribute.slice(10), element.getAttribute(attribute));\n\t\t}\n\t\telse if (node.config.observer !== false) {\n\t\t\t// Main value observer\n\t\t\tlet update = node.config.subtree; // always update when this flag is on regardless of what changed\n\n\t\t\tif (!update && (!node.editing || node.modes === \"edit\")) {\n\t\t\t\tupdate = attribute === node.attribute // note: these may be null\n\t\t\t\t         || node.config.observedAttributes?.includes(attribute)\n\t\t\t\t         || type === \"characterData\" && !node.attribute;\n\t\t\t}\n\n\t\t\tif (update) {\n\t\t\t\tnode.value = node.getValue();\n\t\t\t}\n\t\t}\n\t}\n});\n\nawait $.ready();\n\n// Migration from mv-edit-* to mv-editor-*\nlet inputTypes = [\n\t\"checkbox\", \"color\", \"date\", \"datetime-local\", \"email\", \"file\", \"month\", \"number\",\n\t\"password\", \"radio\", \"range\", \"search\", \"submit\", \"tel\", \"text\", \"time\", \"url\", \"week\", \"datetime\"];\nlet oldMvEdit = Mavo.attributeStartsWith(\"mv-edit-\")\n\t.filter(a => a.name !== \"mv-edit-type\" || inputTypes.includes(a.value))\n\t.map(a => a.name);\nlet newMvEdit = Mavo.attributeStartsWith(\"mv-editor-\");\n\nif ($(\"[mv-edit]\")) {\n\toldMvEdit.unshift(\"mv-edit\");\n}\n\nif (oldMvEdit.length > 0) {\n\tlet oldMvEditUnique = [...new Set(oldMvEdit)];\n\n\tfor (let name of oldMvEditUnique) {\n\t\tlet newName = name.replace(/^mv-edit(-|$)/, \"mv-editor$1\");\n\t\tlet elements = $$(`[${name}]`);\n\n\t\tconsole.log(`You are using attribute ${name} on ${elements.length} element(s). This syntax is deprecated and will be removed in the next version of Mavo. Please use ${newName} instead.`);\n\n\t\tfor (let element of elements) {\n\t\t\tMavo.setAttributeShy(element, newName, element.getAttribute(name));\n\t\t}\n\t}\n}\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.UI.Popup = $.Class({\n\tconstructor: function(primitive) {\n\t\tthis.primitive = primitive;\n\n\t\t// Need to be defined here so that this is what expected\n\t\tthis.position = evt => {\n\t\t\tvar bounds = this.primitive.element.getBoundingClientRect();\n\t\t\tvar x = bounds.left;\n\t\t\tvar y = bounds.bottom;\n\t\t\tvar pointDown = false;\n\n\t\t\tif (this.element.offsetHeight) {\n\t\t\t\t// Is in the DOM, check if it fits\n\t\t\t\tthis.height = this.element.getBoundingClientRect().height || this.height;\n\t\t\t}\n\n\t\t\tif (this.height + y + 20 > innerHeight) {\n\t\t\t\t// Normal positioning means the popup would be cut off or too close to the edge, adjust\n\n\t\t\t\t// Perhaps placing it above is better\n\t\t\t\tif (bounds.top - this.height > 20) {\n\t\t\t\t\tvar pointDown = true;\n\t\t\t\t\ty = bounds.top - this.height - 20;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Nah, just raise it a bit\n\t\t\t\t\ty = innerHeight - this.height - 20;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.element.classList.toggle(\"mv-point-down\", pointDown);\n\n\t\t\t$.style(this.element, { top:  `${y}px`, left: `${x}px` });\n\t\t};\n\n\t\tthis.element = $.create(\"div\", {\n\t\t\tclassName: \"mv-popup\",\n\t\t\thidden: true,\n\t\t\tcontents: {\n\t\t\t\ttag: \"fieldset\",\n\t\t\t\tcontents: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"legend\",\n\t\t\t\t\t\ttextContent: this.primitive.label + \":\"\n\t\t\t\t\t},\n\t\t\t\t\tthis.editor\n\t\t\t\t]\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tkeyup: evt => {\n\t\t\t\t\tif (evt.keyCode == 13 || evt.keyCode == 27) {\n\t\t\t\t\t\tif (this.element.contains(document.activeElement)) {\n\t\t\t\t\t\t\tthis.primitive.element.focus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t\tthis.hide();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttransitionend: this.position\n\t\t\t}\n\t\t});\n\n\t\t// No point in having a dropdown in a popup\n\t\tif (this.editor.matches(\"select\")) {\n\t\t\tthis.editor.size = Math.min(10, this.editor.children.length);\n\t\t}\n\t\tthis.hideCallback = evt => {\n\t\t\tif (!this.element.contains(evt.target) && !this.primitive.element.contains(evt.target)) {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t};\n\t},\n\n\tshow: function() {\n\t\t$.unbind([this.primitive.element, this.element], \".mavo:showpopup\");\n\n\t\tthis.shown = true;\n\n\t\tthis.element.style.transition = \"none\";\n\t\tthis.element.removeAttribute(\"hidden\");\n\n\t\tthis.position();\n\n\t\tthis.element.setAttribute(\"hidden\", \"\");\n\t\tthis.element.style.transition = \"\";\n\n\t\tdocument.body.appendChild(this.element);\n\n\t\tsetTimeout(() => {\n\t\t\tthis.element.removeAttribute(\"hidden\");\n\t\t}, 100); // trigger transition. rAF or timeouts < 100 don't seem to, oddly.\n\n\t\t$.bind(document, \"focus click\", this.hideCallback, true);\n\t\twindow.addEventListener(\"scroll\", this.position, {passive: true});\n\t},\n\n\thide: function() {\n\t\t$.unbind(document, \"focus click\", this.hideCallback, true);\n\t\twindow.removeEventListener(\"scroll\", this.position, {passive: true});\n\t\tthis.element.setAttribute(\"hidden\", \"\"); // trigger transition\n\t\tthis.shown = false;\n\n\t\tsetTimeout(() => {\n\t\t\t$.remove(this.element);\n\t\t}, parseFloat(getComputedStyle(this.element).transitionDuration) * 1000 || 400); // TODO transition-duration could override this\n\t},\n\n\tprepare: function() {\n\t\t$.bind(this.primitive.element, {\n\t\t\t\"click.mavo:edit\": evt => {\n\t\t\t\tthis.show();\n\t\t\t},\n\t\t\t\"keyup.mavo:edit\": evt => {\n\t\t\t\tif ([13, 113].indexOf(evt.keyCode) > -1) { // Enter or F2\n\t\t\t\t\tthis.show();\n\t\t\t\t\tthis.editor.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!this.element.contains(this.editor)) {\n\t\t\t// This can happen if edit type changes from popup to inline\n\t\t\tthis.element.append(this.editor);\n\t\t}\n\t},\n\n\tclose: function() {\n\t\tthis.hide();\n\t\t$.unbind(this.primitive.element, \".mavo:edit .mavo:preedit .mavo:showpopup\");\n\t},\n\n\tproxy: {\n\t\t\"editor\": \"primitive\"\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n/**\n * Configuration for different types of elements. Options:\n * - attribute {String}\n * - useProperty {Boolean}\n * - datatype {\"number\"|\"boolean\"|\"string\"} Default is \"string\"\n * - modes\n * - editor {Object|Function}\n * - setEditorValue temporary\n * - edit\n * - done\n * - observe\n * - default: If there is no attribute, can we use that rule to pick one?\n * @\n */\n(function($, $$) {\n\nvar _ = Mavo.Elements = {};\n\nObject.defineProperties(_, {\n\t\"register\": {\n\t\tvalue: function(id, config) {\n\t\t\tif (typeof arguments[0] === \"object\") {\n\t\t\t\t// Multiple definitions\n\t\t\t\tfor (let s in arguments[0]) {\n\t\t\t\t\t_.register(s, arguments[0][s]);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (config.extend) {\n\t\t\t\tvar base = _[config.extend];\n\n\t\t\t\tconfig = $.extend($.extend({}, base), config);\n\t\t\t}\n\n\t\t\tif (id.indexOf(\"@\") > -1) {\n\t\t\t\tvar parts = id.split(\"@\");\n\n\t\t\t\tconfig.selector = config.selector || parts[0] || \"*\";\n\n\t\t\t\tif (config.attribute === undefined) {\n\t\t\t\t\tconfig.attribute = parts[1];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconfig.selector = config.selector || id;\n\t\t\tconfig.id = id;\n\n\t\t\tif (Array.isArray(config.attribute)) {\n\t\t\t\tconfig.attribute.forEach(attribute => {\n\t\t\t\t\tvar o = $.extend({}, config);\n\t\t\t\t\to.attribute = attribute;\n\n\t\t\t\t\t_[`${id}@${attribute}`] = o;\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_[id] = config;\n\t\t\t}\n\n\t\t\treturn _;\n\t\t}\n\t},\n\t\"search\": {\n\t\tvalue: function(element, attribute, datatype) {\n\t\t\tvar matches = _.matches(element, attribute, datatype);\n\n\t\t\tif (matches.length === 0 && datatype) {\n\t\t\t\t// 0 matches, try again without datatype\n\t\t\t\tmatches = _.matches(element, attribute);\n\t\t\t}\n\n\t\t\tvar lastMatch = matches[matches.length - 1];\n\n\t\t\tif (lastMatch) {\n\t\t\t\treturn lastMatch;\n\t\t\t}\n\n\t\t\tvar config = $.extend({}, _.defaultConfig[datatype || \"string\"]);\n\t\t\tconfig.attribute = attribute === undefined? config.attribute : attribute;\n\n\t\t\treturn config;\n\t\t}\n\t},\n\t\"matches\": {\n\t\tvalue: function(element, attribute, datatype) {\n\t\t\tvar matches = [];\n\n\t\t\tselectorloop: for (var id in _) {\n\t\t\t\tvar o = _[id];\n\n\t\t\t\t// Passes attribute test?\n\t\t\t\tvar attributeMatches = attribute === undefined && o.default || attribute === o.attribute;\n\n\t\t\t\tif (!attributeMatches) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Passes datatype test?\n\t\t\t\tif (datatype !== undefined && datatype !== \"string\" && datatype !== o.datatype) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Passes selector test?\n\t\t\t\tvar selector = o.selector || id;\n\n\t\t\t\tif (!element.matches(selector)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Passes arbitrary test?\n\t\t\t\tif (o.test && !o.test(element, attribute, datatype)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// All tests have passed\n\t\t\t\tmatches.push(o);\n\t\t\t}\n\n\t\t\treturn matches;\n\t\t}\n\t},\n\n\tisSVG: {\n\t\tvalue: e => e.namespaceURI == \"http://www.w3.org/2000/svg\"\n\t},\n\n\tdefaultConfig: {\n\t\tvalue: {\n\t\t\t\"string\":  {\n\t\t\t\teditor: { tag: \"input\" }\n\t\t\t},\n\t\t\t\"number\":  {\n\t\t\t\teditor: { tag: \"input\", type: \"number\" }\n\t\t\t},\n\t\t\t\"boolean\": {\n\t\t\t\tattribute: \"content\",\n\t\t\t\teditor: { tag: \"input\", type: \"checkbox\" }\n\t\t\t}\n\t\t}\n\t}\n});\n\n_.register({\n\t\"@hidden\": {\n\t\tdatatype: \"boolean\"\n\t},\n\n\t\"@y\": {\n\t\ttest: _.isSVG,\n\t\tdatatype: \"number\"\n\t},\n\n\t\"@x\": {\n\t\tdefault: true,\n\t\ttest: _.isSVG,\n\t\tdatatype: \"number\"\n\t},\n\n\t\"media\": {\n\t\tdefault: true,\n\t\tselector: \"img, video, audio\",\n\t\tattribute: \"src\",\n\t\teditor: function() {\n\t\t\tvar kind = this.element.nodeName.toLowerCase();\n\t\t\tkind = kind == \"img\"? \"image\" : kind;\n\t\t\tMavo.setAttributeShy(this.element, \"mv-upload-path\", kind + \"s\");\n\n\t\t\treturn this.createUploadPopup(kind + \"/*\", kind, \"png\");\n\t\t}\n\t},\n\n\t\"a, link\": {\n\t\tdefault: true,\n\t\tattribute: \"href\"\n\t},\n\n\t\"a[mv-upload-path], link[mv-upload-path]\": {\n\t\tdefault: true,\n\t\tattribute: \"href\",\n\t\teditor: function() {\n\t\t\tvar type = this.element.getAttribute(\"type\");\n\t\t\tvar ext = type && !/\\/\\*$/.test(type)? type.split(\"/\")[1] : \"pdf\";\n\t\t\treturn this.createUploadPopup(type, undefined, ext);\n\t\t}\n\t},\n\n\t\"video, audio\": {\n\t\tattribute: [\"autoplay\", \"buffered\", \"loop\"],\n\t\tdatatype: \"boolean\"\n\t},\n\n\t\"details\": {\n\t\tattribute: \"open\",\n\t\tdatatype: \"boolean\"\n\t},\n\n\t\"input, select, button, textarea\": {\n\t\tattribute: \"disabled\",\n\t\tdatatype: \"boolean\"\n\t},\n\n\t\"formControl\": {\n\t\tselector: \"input\",\n\t\tdefault: true,\n\t\tattribute: \"value\",\n\t\tmodes: \"edit\",\n\t\teditType: \"self\",\n\t\tchangeEvents: \"input change\",\n\t\tedit: () => {},\n\t\tdone: () => {},\n\t\tinit: function() {\n\t\t\tthis._editor = this.element;\n\t\t}\n\t},\n\n\t\"select\": {\n\t\textend: \"formControl\",\n\t\tselector: \"select\",\n\t\tsubtree: true\n\t},\n\n\t\"select[multiple]\": {\n\t\textend: \"select\",\n\t\tselector: \"select[multiple]\",\n\t\tgetValue: element => {\n\t\t\treturn Array.from(element.selectedOptions).map(option => option.value).join();\n\t\t},\n\t\tsetValue: (element, value) => {\n\t\t\t// Why +\"\"? If the value is being set via mv-value and is a number,\n\t\t\t// we must convert it to a string to avoid extra checks.\n\t\t\tvalue = Array.isArray(value)? value : (value + \"\").split(/\\s*,/);\n\n\t\t\tArray.from(element.options).forEach(option => {\n\t\t\t\t// Why? If the value is being set via mv-value,\n\t\t\t\t// we want the element to reflect the changes properly.\n\t\t\t\toption.selected = false;\n\n\t\t\t\t// Why +\"\"? Options' values are strings, so we want \"1\" instead of 1.\n\t\t\t\tvalue = value.map(v => v + \"\");\n\n\t\t\t\tif (value.includes(option.value)) {\n\t\t\t\t\toption.selected = true;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\t\"option\": {\n\t\tattribute: null,\n\t\tmodes: \"read\",\n\t\tdefault: true\n\t},\n\n\t\"textarea\": {\n\t\textend: \"formControl\",\n\t\tselector: \"textarea\",\n\t\tattribute: null,\n\t\tgetValue: element => element.value,\n\t\tsetValue: (element, value) => element.value = value\n\t},\n\n\t\"formNumber\": {\n\t\textend: \"formControl\",\n\t\tselector: \"input[type=range], input[type=number]\",\n\t\tdatatype: \"number\",\n\t\tsetValue: function(element, value) {\n\t\t\telement.value = value;\n\t\t\telement.setAttribute(\"value\", value);\n\n\t\t\tvar attribute = value > element.value? \"max\" : \"min\";\n\n\t\t\tif (!isNaN(value) && element.value != value && !Mavo.data(element, \"boundObserver\")) {\n\t\t\t\t// Value out of bounds, maybe race condition? See #295\n\t\t\t\t// Observe min/max attrs until user interaction or data change\n\t\t\t\tif (Mavo.observers.find({element, id: \"oob\"}).size === 0) {\n\t\t\t\t\tMavo.observe({\n\t\t\t\t\t\tid: \"oob\",\n\t\t\t\t\t\telement, attribute,\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}, () => element.value = value);\n\t\t\t\t}\n\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t$.bind(element, \"input mv-change\", function handler() {\n\t\t\t\t\t\tMavo.unobserve({element, id: \"oob\"});\n\n\t\t\t\t\t\t// Why not just use {once: true}? because we have two events\n\t\t\t\t\t\t$.unbind(element, \"input mv-change\", handler);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tobservedAttributes: [\"min\", \"max\"]\n\t},\n\n\t\"checkbox\": {\n\t\textend: \"formControl\",\n\t\tselector: \"input[type=checkbox]\",\n\t\tattribute: \"checked\",\n\t\tdatatype: \"boolean\",\n\t\tchangeEvents: \"click\"\n\t},\n\n\t\"input[type=checkbox]\": {\n\t\tattribute: \"indeterminate\",\n\t\tdatatype: \"boolean\"\n\t},\n\n\t\"radio\": {\n\t\textend: \"formControl\",\n\t\tselector: \"input[type=radio]\",\n\t\tattribute: \"checked\",\n\t\tmodes: \"edit\",\n\t\tgetValue: element => {\n\t\t\tif (element.form) {\n\t\t\t\treturn element.form[element.name].value;\n\t\t\t}\n\n\t\t\tlet checked = $(`input[type=radio][name=\"${element.name}\"]:checked`);\n\t\t\treturn checked && checked.value;\n\t\t},\n\t\tsetValue: (element, value) => {\n\t\t\tif (element.form) {\n\t\t\t\telement.form[element.name].value = value;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet toCheck = $(`input[type=radio][name=\"${element.name}\"][value=\"${value}\"]`);\n\t\t\tif (toCheck) {\n\t\t\t\ttoCheck.checked = true;\n\t\t\t}\n\t\t},\n\t\tinitOnce: function(element) {\n\t\t\tfunction radioChanged(radio) {\n\t\t\t\tlet name = radio.name;\n\t\t\t\tfor (let otherRadio of $$(`input[type=radio][name=\"${radio.name}\"]`)) {\n\t\t\t\t\tlet node = Mavo.Node.get(otherRadio, true);\n\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\tnode.value = node.getValue();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdocument.addEventListener(\"change\", evt => {\n\t\t\t\tif (evt.target.matches(\"input[type=radio]\")) {\n\t\t\t\t\tradioChanged(evt.target);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tMavo.observe({\n\t\t\t\tattribute: \"value\",\n\t\t\t\tselector: \"input[type=radio]\"\n\t\t\t}, r => radioChanged(r.element));\n\t\t},\n\t\tobservedAttributes: [\"value\"]\n\t},\n\n\t\"counter\": {\n\t\textend: \"formControl\",\n\t\tselector: \"button, .counter\",\n\t\tattribute: \"mv-clicked\",\n\t\tdatatype: \"number\",\n\t\tinit: function(element) {\n\t\t\tif (this.attribute === \"mv-clicked\") {\n\t\t\t\telement.setAttribute(\"mv-clicked\", \"0\");\n\n\t\t\t\telement.addEventListener(\"click\", evt => {\n\t\t\t\t\tlet clicked = +element.getAttribute(\"mv-clicked\") || 0;\n\t\t\t\t\tthis.value = ++clicked;\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\t\"meter, progress\": {\n\t\tdefault: true,\n\t\tattribute: \"value\",\n\t\tdatatype: \"number\",\n\t\tedit: function() {\n\t\t\tvar min = +this.element.getAttribute(\"min\") || 0;\n\t\t\tvar max = +this.element.getAttribute(\"max\") || 1;\n\t\t\tvar range = max - min;\n\t\t\tvar step = +this.element.getAttribute(\"mv-editor-step\") || (range > 1? 1 : range/100);\n\n\t\t\t$.bind(this.element, \"mousemove.mavo:edit\", evt => {\n\t\t\t\t// Change property as mouse moves\n\t\t\t\tvar left = this.element.getBoundingClientRect().left;\n\t\t\t\tvar offset = Math.max(0, (evt.clientX - left) / this.element.offsetWidth);\n\t\t\t\tvar newValue = min + range * offset;\n\t\t\t\tvar mod = newValue % step;\n\n\t\t\t\tnewValue += mod > step/2? step - mod : -mod;\n\t\t\t\tnewValue = Math.max(min, Math.min(newValue, max));\n\n\t\t\t\tthis.pauseObserver();\n\t\t\t\tthis.element.setAttribute(\"value\", newValue);\n\t\t\t\tthis.resumeObserver();\n\t\t\t});\n\n\t\t\t$.bind(this.element, \"mouseleave.mavo:edit\", evt => {\n\t\t\t\t// Return to actual value\n\t\t\t\tthis.pauseObserver();\n\t\t\t\tthis.element.setAttribute(\"value\", this.value);\n\t\t\t\tthis.resumeObserver();\n\t\t\t});\n\n\t\t\t$.bind(this.element, \"click.mavo:edit\", evt => {\n\t\t\t\t// Register change\n\t\t\t\tthis.value = this.getValue();\n\t\t\t});\n\n\t\t\t$.bind(this.element, \"keydown.mavo:edit\", evt => {\n\t\t\t\t// Edit with arrow keys\n\t\t\t\tif (evt.target == this.element && (evt.keyCode == 37 || evt.keyCode == 39)) {\n\t\t\t\t\tvar increment = step * (evt.keyCode == 39? 1 : -1) * (evt.shiftKey? 10 : 1);\n\t\t\t\t\tvar newValue = this.value + increment;\n\t\t\t\t\tnewValue = Math.max(min, Math.min(newValue, max));\n\n\t\t\t\t\tthis.element.setAttribute(\"value\", newValue);\n\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tdone: function() {\n\t\t\t$.unbind(this.element, \".mavo:edit\");\n\t\t},\n\t\tobservedAttributes: [\"min\", \"max\"]\n\t},\n\n\t\"meta\": {\n\t\tdefault: true,\n\t\tattribute: \"content\"\n\t},\n\n\t\"block\": {\n\t\tdefault: true,\n\t\tselector: \"p, div, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, pre\",\n\t\teditor: function() {\n\t\t\tvar cs = getComputedStyle(this.element);\n\t\t\tvar display = cs.display;\n\t\t\tvar tag = display.indexOf(\"inline\") === 0? \"input\" : \"textarea\";\n\t\t\tvar editor = $.create(tag);\n\n\t\t\tif (tag == \"textarea\") {\n\t\t\t\t// Actually multiline\n\t\t\t\tvar width = this.element.offsetWidth;\n\n\t\t\t\tif (width) {\n\t\t\t\t\teditor.width = width;\n\t\t\t\t}\n\n\t\t\t\t// We cannot collapse whitespace because then users\n\t\t\t\t// are adding characters they dont see (#300).\n\t\t\t\teditor.style.whiteSpace = ({\n\t\t\t\t\t\"normal\": \"pre-wrap\",\n\t\t\t\t\t\"nowrap\": \"pre\"\n\t\t\t\t})[cs.whiteSpace] || \"inherit\";\n\t\t\t}\n\n\t\t\treturn editor;\n\t\t},\n\n\t\tsetEditorValue: function(value) {\n\t\t\tif (this.datatype && this.datatype != \"string\") {\n\t\t\t\tvalue = value + \"\";\n\t\t\t}\n\n\t\t\tvar cs = getComputedStyle(this.element);\n\t\t\tvalue = value || \"\";\n\n\t\t\tif ([\"normal\", \"nowrap\"].indexOf(cs.whiteSpace) > -1) {\n\t\t\t\t// Collapse lines\n\t\t\t\tvalue = value.replace(/\\r?\\n/g, \" \");\n\t\t\t}\n\n\t\t\tif ([\"normal\", \"nowrap\", \"pre-line\"].indexOf(cs.whiteSpace) > -1) {\n\t\t\t\t// Collapse whitespace\n\t\t\t\tvalue = value.replace(/^[ \\t]+|[ \\t]+$/gm, \"\").replace(/[ \\t]+/g, \" \");\n\t\t\t}\n\n\t\t\tthis.editor.value = value;\n\t\t\treturn true;\n\t\t}\n\t},\n\n\t\"time\": {\n\t\tattribute: \"datetime\",\n\t\tdefault: true,\n\t\tinit: function() {\n\t\t\tif (!this.fromTemplate(\"dateType\")) {\n\t\t\t\tvar dateFormat = Mavo.DOMExpression.search(this.element, null);\n\t\t\t\tvar datetime = this.element.getAttribute(\"datetime\") || \"YYYY-MM-DD\";\n\n\t\t\t\tfor (var type in this.config.dateTypes) {\n\t\t\t\t\tif (this.config.dateTypes[type].test(datetime)) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.dateType = type;\n\n\t\t\t\tif (!dateFormat) {\n\t\t\t\t\t// TODO what about mv-expressions?\n\t\t\t\t\tthis.element.textContent = this.config.defaultFormats[this.dateType](this.property);\n\t\t\t\t\tthis.mavo.expressions.extract(this.element, null);\n\n\t\t\t\t\tif (dateFormat = Mavo.DOMExpression.search(this.element, null)) {\n\t\t\t\t\t\tthis.mavo.treeBuilt.then(() => {\n\t\t\t\t\t\t\tdateFormat.update();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tdateTypes: {\n\t\t\t\"month\": /^[Y\\d]{4}-[M\\d]{2}$/i,\n\t\t\t\"time\": /^[H\\d]{2}:[M\\d]{2}/i,\n\t\t\t\"datetime-local\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2} [H\\d]{2}:[Mi\\d]{2}/i,\n\t\t\t\"date\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2}$/i,\n\t\t},\n\t\tdefaultFormats: {\n\t\t\t\"date\": name => `[day(${name})] [month(${name}, 'shortname')] [year(${name})]`,\n\t\t\t\"month\": name => `[month(${name}, 'name')] [year(${name})]`,\n\t\t\t\"time\": name => `[hour(${name}, '00')]:[minute(${name}, '00')]`,\n\t\t\t\"datetime-local\": function(name) {\n\t\t\t\treturn this.date(name) + \" \" + this.time(name);\n\t\t\t}\n\t\t},\n\t\teditor: function() {\n\t\t\treturn {tag: \"input\", type: this.dateType};\n\t\t}\n\t},\n\n\t\"circle@r\": {\n\t\tdefault: true,\n\t\tdatatype: \"number\"\n\t},\n\n\t\"circle\": {\n\t\tattribute: [\"cx\", \"cy\"],\n\t\tdatatype: \"number\"\n\t},\n\n\t\"text\": {\n\t\tdefault: true,\n\t\teditType: \"popup\"\n\t},\n\n\t\".mv-toggle\": {\n\t\tdefault: true,\n\t\tattribute: \"aria-checked\",\n\t\tdatatype: \"boolean\",\n\t\tedit: function() {\n\t\t\tMavo.revocably.setAttribute(this.element, \"role\", \"checkbox\");\n\n\t\t\t$.bind(this.element, \"click.mavo:edit keyup.mavo:edit keydown.mavo:edit\", evt => {\n\t\t\t\tif (evt.type == \"click\" || evt.key == \" \" || evt.key == \"Enter\") {\n\t\t\t\t\tif (evt.type != \"keydown\") {\n\t\t\t\t\t\tthis.value = !this.value;\n\t\t\t\t\t}\n\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tdone: function() {\n\t\t\tMavo.revocably.restoreAttribute(this.element, \"role\");\n\n\t\t\t$.unbind(this.element, \".mavo:edit\");\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nMavo.attributes.push(\"mv-multiple\", \"mv-order\", \"mv-accepts\", \"mv-initial-items\", \"mv-like\");\n\nvar _ = Mavo.Collection = class Collection extends Mavo.Node {\n\tconstructor (element, mavo, o) {\n\t\tsuper(element, mavo, o);\n\n\t\t/*\n\t\t * Create the template, remove it from the DOM and store it\n\t\t */\n\t\tthis.templateElement = this.element;\n\n\t\tthis.children = [];\n\t\tthis.liveData = new Mavo.Data(this, []);\n\n\t\t// Keep position of the template in the DOM, since we might remove it\n\t\tthis.marker = document.createComment(\"mv-marker\");\n\t\tMavo.data(this.marker, \"collection\", this);\n\n\t\tthis.templateElement.after(this.marker);\n\t\tthis.addButton = this.createAddButton();\n\n\t\tif (this.templateElement.hasAttribute(\"mv-like\")) {\n\t\t\tMavo.warn(\"@mv-like is deprecated and will be removed in the next version of Mavo\");\n\t\t}\n\n\t\tif (this.mavo.root || !this.templateElement.hasAttribute(\"mv-like\")) {\n\t\t\t// Synchronous init\n\t\t\tthis.init();\n\t\t}\n\t\telse {\n\t\t\t// Async init, we're borrowing the template from elsewhere so we need\n\t\t\t// to give the rest of the tree a chance to initialize\n\t\t\tthis.mavo.treeBuilt.then(() => this.init());\n\t\t}\n\t}\n\n\tcreateAddButton() {\n\t\t// Find add button if provided, or generate one\n\t\tvar selector = `button[class~=\"mv-add-${this.property}\"]`;\n\t\tvar group = this.parentGroup.element;\n\n\t\tvar button = $$(selector, group).filter(button => {\n\t\t\treturn !this.templateElement.contains(button)  // is outside the template element\n\t\t\t\t&& !Mavo.data(button, \"collection\"); // and does not belong to another collection\n\t\t})[0];\n\n\t\tif (button) {\n\t\t\t// Custom add button\n\t\t\tif (button.compareDocumentPosition(this.marker) & Node.DOCUMENT_POSITION_FOLLOWING) {\n\t\t\t\t// Button precedes collection, make collection bottom-up if no mv-order is set\n\t\t\t\tMavo.setAttributeShy(this.templateElement, \"mv-order\", \"desc\");\n\t\t\t}\n\n\t\t\tMavo.revocably.remove(button);\n\t\t}\n\t\telse {\n\t\t\tbutton = $.create(\"button\", {\n\t\t\t\ttype: \"button\",\n\t\t\t\tclassName: \"mv-ui\",\n\t\t\t\ttextContent: this.mavo._(\"add-item\", this)\n\t\t\t});\n\t\t};\n\n\t\tbutton.classList.add(\"mv-add\", `mv-add-${this.property}`);\n\t\tMavo.data(button, \"collection\", this);\n\n\t\tMavo.setAttributeShy(button, \"mv-action\", `add(${this.property})`);\n\n\t\treturn button;\n\t}\n\n\tinit () {\n\t\tif (!this.fromTemplate(\"templateElement\", \"accepts\", \"initialItems\", \"like\", \"likeNode\")) {\n\t\t\tthis.like = this.templateElement.getAttribute(\"mv-like\");\n\n\t\t\tif (this.like) {\n\t\t\t\tvar candidates = [];\n\t\t\t\tthis.mavo.walk(obj => {\n\t\t\t\t\tif (obj instanceof _ && obj.property === this.like && obj !== this) {\n\t\t\t\t\t\tcandidates.push(obj);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (candidates.length > 0) {\n\t\t\t\t\t// If there are multiple collections that match,\n\t\t\t\t\t// compare the paths and select the one that has the most overlap\n\t\t\t\t\tthis.likeNode = candidates.sort((a, b) => {\n\t\t\t\t\t\treturn a.pathFrom(this).length - b.pathFrom(this).length;\n\t\t\t\t\t})[0];\n\n\t\t\t\t\tthis.likeNode = this.likeNode.likeNode || this.likeNode;\n\t\t\t\t\tthis.likeNode = this.likeNode.template || this.likeNode;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.like = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.accepts = this.templateElement.getAttribute(\"mv-accepts\");\n\t\t\tthis.accepts = new Set(this.accepts?.split(/\\s+/));\n\n\t\t\tthis.initialItems = +(this.templateElement.getAttribute(\"mv-initial-items\") || (this.like? 0 : 1));\n\n\t\t\t// Must clone because otherwise once expressions are parsed on the template element\n\t\t\t// we will not be able to pick them up from subsequent items\n\t\t\tthis.templateElement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tif (this.likeNode) {\n\t\t\tthis.itemTemplate = this.likeNode.itemTemplate || this.likeNode;\n\n\t\t\tvar templateElement = this.likeNode.templateElement || this.likeNode.collection?.templateElement || this.likeNode.element;\n\t\t\tthis.templateElement = templateElement.cloneNode(true);\n\t\t\tthis.templateElement.setAttribute(\"property\", this.property);\n\n\t\t\tif (!this.accepts.size) {\n\t\t\t\tthis.accepts = this.likeNode.accepts || this.accepts;\n\t\t\t}\n\t\t}\n\t\telse if (this.initialItems > 0 || !this.template) {\n\t\t\tvar item = this.createItem(this.element);\n\t\t\tthis.add(item, undefined, {silent: true});\n\t\t}\n\n\t\tthis.mavo.treeBuilt.then(() => {\n\t\t\tif (!this.initialItems) {\n\t\t\t\tif (item) {\n\t\t\t\t\tthis.delete(item, {silent: true});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// No item to delete\n\t\t\t\t\tthis.element.remove();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.initialItems > 1) {\n\t\t\t\t// Add extra items\n\t\t\t\tfor (let i=1; i<this.initialItems; i++) {\n\t\t\t\t\tthis.add();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.postInit();\n\n\t\tMavo.hooks.run(\"collection-init-end\", this);\n\t}\n\n\tget length() {\n\t\treturn this.children.length;\n\t}\n\n\tgetData (o = {}) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o\n\t\t};\n\n\t\tenv.data = this.children.map(item => item.getData(env.options))\n\t\t                     .filter(itemData => Mavo.value(itemData) !== null);\n\t\tenv.data = Mavo.subset(this.data, this.inPath, env.data);\n\n\t\tMavo.hooks.run(\"node-getdata-end\", env);\n\n\t\treturn env.data;\n\t}\n\n\t// Create item but don't insert it anywhere\n\t// Mostly used internally\n\tcreateItem (element) {\n\t\tif (!element) {\n\t\t\telement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tvar template = this.itemTemplate || this.template?.itemTemplate || null;\n\n\t\tvar item = Mavo.Node.create(element, this.mavo, {\n\t\t\tcollection: this,\n\t\t\ttemplate,\n\t\t\tproperty: this.property,\n\t\t\ttype: this.type\n\t\t});\n\n\t\tif (!this.itemTemplate) {\n\t\t\tthis.itemTemplate = template || item;\n\t\t}\n\n\t\treturn item;\n\t}\n\n\t/**\n\t * Add a new item to this collection\n\t * @param item {Node|Mavo.Node} Optional. Element or Mavo object for the new item\n\t * @param index {Number} Optional. Index of existing item, will be added opposite to list direction\n\t * @param silent {Boolean} Optional. Throw a datachange event? Mainly used internally.\n\t */\n\tadd (item, index, o = {}) {\n\t\tif (item instanceof Node) {\n\t\t\titem = Mavo.Node.get(item) || this.createItem(item);\n\t\t}\n\t\telse {\n\t\t\titem = item || this.createItem();\n\t\t}\n\n\t\tif (item.collection != this) {\n\t\t\t// Move item to this collection from elsewhere\n\t\t\tif (item.collection) {\n\t\t\t\t// It belongs to another collection, delete from there first\n\t\t\t\titem.collection.splice({remove: item});\n\t\t\t\titem.collection.dataChanged(\"delete\");\n\t\t\t}\n\n\t\t\t// FIXME this only includes saved data\n\t\t\t// Expressions can be recalculated, but writeable data that is simply not saved will not be here\n\t\t\tlet data = item.getData();\n\t\t\tlet editing = item.editing;\n\t\t\titem.element.remove();\n\t\t\titem.destroy();\n\n\t\t\titem = this.createItem();\n\n\t\t\tif (editing) {\n\t\t\t\tthis.editItem(item);\n\t\t\t}\n\n\t\t\titem.render(data);\n\t\t}\n\n\t\tif (index === undefined) {\n\t\t\tindex = this.bottomUp? 0 : this.length;\n\t\t}\n\n\t\t// Add it to the DOM, or fix its place\n\t\tvar rel = this.children?.[index]?.element ?? this.marker;\n\t\t$.before(item.element, rel);\n\n\t\tvar env = {context: this, item};\n\n\t\tenv.previousIndex = item.index;\n\n\t\t// Update internal data model\n\t\tenv.changed = this.splice({\n\t\t\tremove: env.item\n\t\t}, {\n\t\t\tindex: index,\n\t\t\tadd: env.item\n\t\t});\n\n\t\tif (this.mavo.expressions.active && !o.silent) {\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tenv.changed.forEach(i => {\n\t\t\t\t\ti.dataChanged(i == env.item && env.previousIndex === undefined? \"add\" : \"move\");\n\t\t\t\t\ti.unsavedChanges = true;\n\t\t\t\t});\n\n\t\t\t\tthis.unsavedChanges = this.mavo.unsavedChanges = true;\n\n\t\t\t\tthis.mavo.expressions.update(env.item);\n\t\t\t});\n\t\t}\n\n\t\tMavo.hooks.run(\"collection-add-end\", env);\n\n\t\treturn env.item;\n\t}\n\n\tsplice (...actions) {\n\t\tactions.forEach(action => {\n\t\t\tif (action.index === undefined && action.remove && isNaN(action.remove)) {\n\t\t\t\t// Remove is an item\n\t\t\t\taction.index = this.children.indexOf(action.remove);\n\t\t\t\taction.remove = 1;\n\t\t\t}\n\t\t});\n\n\t\t// Sort in reverse index order\n\t\tactions.sort((a, b) => b.index - a.index);\n\n\t\tvar changed = [], deleted = [];\n\n\t\t// FIXME this could still result in buggy behavior.\n\t\t// Think of e.g. adding items on i, then removing > 1 items on i-1.\n\t\t// The new items would get removed instead of the old ones.\n\t\t// Not a pressing issue though since we always remove 1 max when adding things too.\n\t\tactions.forEach(action => {\n\t\t\tif (action.index > -1 && (action.remove || action.add)) {\n\t\t\t\taction.remove = action.remove || 0;\n\t\t\t\taction.add = Mavo.toArray(action.add);\n\t\t\t\tdeleted.push(...this.children.splice(action.index, +action.remove, ...action.add));\n\t\t\t}\n\t\t});\n\n\t\tdeleted = new Set(deleted);\n\n\t\t// Update indices\n\t\tfor (let i = 0; i < this.length; i++) {\n\t\t\tlet item = this.children[i];\n\t\t\tdeleted.delete(item);\n\n\t\t\tif (item && item.index !== i) {\n\t\t\t\titem.index = i;\n\t\t\t\tchanged.push(item);\n\t\t\t}\n\t\t}\n\n\t\t// Unregister expressions for deleted items\n\t\tdeleted.forEach(item => {\n\t\t\titem.expressions?.forEach(domexpression => {\n\t\t\t\titem.mavo.expressions.unregister(domexpression);\n\t\t\t});\n\t\t});\n\n\t\tthis.liveData.update();\n\n\t\treturn changed;\n\t}\n\n\tasync delete (item, {silent, undoable = !silent, transition = !silent, destroy = !undoable} = {}) {\n\t\titem.element.classList.remove(\"mv-highlight\");\n\n\t\tthis.splice({remove: item});\n\n\t\tif (!silent && transition) {\n\t\t\tawait $.transition(item.element, {opacity: 0});\n\t\t\titem.element.style.opacity = \"\";\n\t\t}\n\n\t\t$.remove(item.element);\n\n\t\tif (!silent) {\n\t\t\tthis.unsavedChanges = item.unsavedChanges = this.mavo.unsavedChanges = true;\n\n\t\t\titem.collection.dataChanged(\"delete\", {index: item.index});\n\t\t}\n\n\t\tif (undoable) {\n\t\t\tthis.mavo.setDeleted(item);\n\t\t}\n\t\telse if (destroy) {\n\t\t\titem.destroy();\n\t\t}\n\n\t\treturn item;\n\t}\n\n\t/**\n\t * Move existing item to a new position. Wraps around if position is out of bounds.\n\t * @offset relative position\n\t */\n\tmove (item, offset) {\n\t\tvar index = item.index + offset + (offset > 0);\n\n\t\tindex = Mavo.wrap(index, this.children.length + 1);\n\n\t\tthis.add(item, index);\n\t}\n\n\teditItem (item, o = {}) {\n\t\t// Get rid of old promise and replace it with new promise\n\t\titem.preEdit?.resolve(\"abort\");\n\n\t\tlet immediately = o.immediately || Mavo.inView.is(item.element);\n\n\t\titem.preEdit = Mavo.promise(immediately? Promise.resolve() : Mavo.inView.when(item.element));\n\n\t\treturn item.preEdit.then(value => {\n\t\t\tif (value === \"abort\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!item.itembar) {\n\t\t\t\titem.itembar = new Mavo.UI.Itembar(item);\n\t\t\t}\n\n\t\t\titem.itembar.add();\n\n\t\t\treturn item.edit(o);\n\t\t});\n\t}\n\n\tdoneItem (item) {\n\t\titem.itembar?.remove();\n\t\titem.preEdit?.resolve(\"abort\");\n\t}\n\n\tedit (o = {}) {\n\t\tif (super.edit() === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Insert the add button if it's not already in the DOM\n\t\tif (!this.addButton.parentNode) {\n\t\t\tvar tag = this.element.tagName.toLowerCase();\n\n\t\t\tif (tag in Mavo.selectors.container) {\n\t\t\t\tvar rel = this.marker.parentNode.closest(Mavo.selectors.container[tag]);\n\t\t\t}\n\t\t\telse if (this.bottomUp && this.children[0]) {\n\t\t\t\tvar rel = this.children[0].element;\n\t\t\t}\n\n\t\t\trel = rel || this.marker;\n\t\t\tMavo.revocably.add(this.addButton, e => $[this.bottomUp? \"before\" : \"after\"](e, rel));\n\t\t}\n\n\t\t// Set up drag & drop\n\t\t_.dragula.then(() => {\n\t\t\tthis.getDragula();\n\t\t});\n\n\t\t// Edit items, maybe insert item bar\n\t\treturn Promise.all(this.children.map(item => this.editItem(item, o)));\n\t}\n\n\tdone () {\n\t\tif (super.done() === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\tMavo.revocably.remove(this.addButton);\n\n\t\tthis.propagate(item => this.doneItem(item));\n\t}\n\n\tdataChanged (action, o = {}) {\n\t\to.element = o.element || this.marker;\n\t\treturn super.dataChanged(action, o);\n\t}\n\n\tdataRender (data, o = {}) {\n\t\tif (data === undefined) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata = data === null? [] : Mavo.toArray(data).filter(i => i !== null);\n\t\tvar changed = false;\n\n\t\t// First render on existing items\n\t\tfor (var i = 0; i < this.children.length; i++) {\n\t\t\tvar item = this.children[i];\n\n\t\t\tif (i < data.length) {\n\t\t\t\tchanged = item.render(data[i], o) || changed;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tchanged = true;\n\t\t\t\tthis.delete(item, {silent: true});\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\tif (data.length > i) {\n\t\t\t// There are still remaining items\n\t\t\t// Using document fragments improves performance by 60%\n\t\t\tvar fragment = document.createDocumentFragment();\n\n\t\t\tfor (var j = i; j < data.length; j++) {\n\t\t\t\tvar item = this.createItem();\n\n\t\t\t\tchanged = item.render(data[j], o) || changed;\n\n\t\t\t\tthis.children.push(item);\n\t\t\t\titem.index = j;\n\n\t\t\t\tfragment.appendChild(item.element);\n\n\t\t\t\tvar env = {context: this, item};\n\t\t\t\tMavo.hooks.run(\"collection-add-end\", env);\n\n\t\t\t}\n\n\t\t\tthis.marker.before(fragment);\n\t\t}\n\n\t\tthis.liveData.update();\n\n\t\tif (data.length > i) {\n\t\t\tfor (var j = i; j < this.children.length; j++) {\n\t\t\t\tthis.children[j].dataChanged(\"add\");\n\t\t\t}\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\tisCompatible (c) {\n\t\treturn c && this.itemTemplate.constructor == c.itemTemplate.constructor && (c === this\n\t\t       || c.template == this || this.template == c || this.template && this.template == c.template\n\t\t       || this.accepts.has(c.property) > -1);\n\t}\n\n\t// Make sure to remove reference to .dragula\n\t// it seems to cause problem on OS chrome.\n\tdestroy () {\n\t\tsuper.destroy();\n\n\t\tthis.dragula?.destroy();\n\t\tthis.dragula = null;\n\n\t\tthis.propagate(\"destroy\");\n\t}\n\n\t// Make sure to only call after dragula has loaded\n\tgetDragula () {\n\t\tif (this.dragula) {\n\t\t\treturn this.dragula;\n\t\t}\n\n\t\tif (this.template) {\n\t\t\tMavo.pushUnique(this.template.getDragula().containers, this.marker.parentNode);\n\t\t\treturn this.dragula = this.template.dragula || this.template.getDragula();\n\t\t}\n\n\t\tthis.dragula = dragula({\n\t\t\tcontainers: [this.marker.parentNode],\n\t\t\tisContainer: el => {\n\t\t\t\tif (this.accepts.size) {\n\t\t\t\t\treturn Array.from(el.childNodes).some(child => {\n\t\t\t\t\t\tvar collection = _.get(child);  // Map children to any associated collections\n\n\t\t\t\t\t\treturn collection && this.accepts.has(collection.property);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tmoves: (el, container, handle) => {\n\t\t\t\treturn handle.classList.contains(\"mv-drag-handle\") && handle.closest(Mavo.selectors.multiple) == el;\n\t\t\t},\n\t\t\taccepts: function(el, target, source, next) {\n\t\t\t\tif (el.contains(target)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar previous = next?.previousElementSibling ?? target.lastElementChild;\n\n\t\t\t\tvar collection = _.get(previous) || _.get(next);\n\n\t\t\t\tif (!collection) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar item = Mavo.Node.get(el);\n\n\t\t\t\treturn item?.collection.isCompatible(collection);\n\t\t\t}\n\t\t});\n\n\t\tthis.dragula.on(\"drop\", (el, target, source) => {\n\t\t\tvar item = Mavo.Node.get(el);\n\t\t\t// var oldIndex = item && item.index;\n\t\t\tvar next = el.nextElementSibling;\n\t\t\tvar previous = el.previousElementSibling;\n\t\t\tvar collection = _.get(previous) || _.get(next);\n\t\t\tvar closestItem = Mavo.Node.get(previous) || Mavo.Node.get(next);\n\n\t\t\tif (closestItem && closestItem.collection != collection) {\n\t\t\t\tclosestItem = null;\n\t\t\t}\n\n\t\t\tif (item.collection.isCompatible(collection)) {\n\t\t\t\tvar index = closestItem? closestItem.index + (closestItem.element === previous) : collection.length;\n\t\t\t\tcollection.add(item, index);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn this.dragula.cancel(true);\n\t\t\t}\n\t\t});\n\n\t\t_.dragulas.push(this.dragula);\n\n\t\treturn this.dragula;\n\t}\n\n\tgetClosestCollection () {\n\t\treturn this;\n\t}\n\n\tstatic get (element) {\n\t\t// Is it an add button or a marker?\n\t\tvar collection = Mavo.data(element, \"collection\");\n\n\t\tif (collection) {\n\t\t\treturn collection;\n\t\t}\n\n\t\t// Maybe it's a collection item?\n\t\tvar item = Mavo.Node.get(element);\n\n\t\treturn item?.collection || null;\n\t}\n\n\t// Delete multiple items from potentially multiple collections or even multiple mavos\n\tstatic async delete (nodes, o = {}) {\n\t\t// Drop nodes that are not collection items\n\t\tnodes = nodes.filter(node => !!node.collection);\n\n\t\tif (nodes.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\telse if (nodes.length === 1) {\n\t\t\tlet ret = await nodes[0].collection.delete(nodes[0], o);\n\t\t\treturn [ret];\n\t\t}\n\n\t\tlet deleted = new Mavo.BucketMap({arrays: true}); // Mavos and deleted items\n\t\tlet collections = new Set(); // Collections items were deleted from\n\n\t\tlet promises = nodes.map(async node => {\n\t\t\t\tcollections.add(node.collection);\n\t\t\t\t// We set undoable: false to suppress the Undo UI for individual items\n\t\t\t\t// so we can show one notice about all items\n\t\t\t\tlet options = {silent: true, undoable: false, destroy: false};\n\t\t\t\tlet item = await node.collection.delete(node, options);\n\t\t\t\titem.unsavedChanges = true;\n\t\t\t\tdeleted.set(node.mavo, node);\n\t\t\t\treturn item;\n\t\t\t});\n\n\t\tlet ret = await Promise.all(promises);\n\n\t\tif (o.silent !== false) {\n\t\t\t// Here we are also batching change notifications to limit pointless expression recalc\n\t\t\t// Hopefully at some point we'll utilize a queue on the expression side\n\t\t\t// so we won't need to be careful about this in data modification code\n\t\t\tcollections.forEach(collection => {\n\t\t\t\tcollection.unsavedChanges = collection.mavo.unsavedChanges = true;\n\t\t\t\tcollection.dataChanged(\"delete\");\n\t\t\t});\n\n\t\t\tif (o.undoable !== false) {\n\t\t\t\tdeleted.forEach((nodes, mavo) => {\n\t\t\t\t\tmavo.setDeleted(...nodes);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t}\n};\n\n$.Class(_, {\n\tlazy: {\n\t\tbottomUp: function() {\n\t\t\t/**\n\t\t\t * Add new items at the top or bottom?\n\t\t\t */\n\n\t\t\treturn /^desc\\b/i.test(this.templateElement.getAttribute(\"mv-order\"));\n\t\t}\n\t},\n\n\tstatic: {\n\t\tdragulas: [],\n\n\t\tlazy: {\n\t\t\tdragula: () => $.include(self.dragula, \"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js\")\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.ImplicitCollection = class ImplicitCollection extends Mavo.Node {\n\tconstructor (element, mavo, o) {\n\t\tsuper(element, mavo, o);\n\n\t\tthis.children = [];\n\t\tthis.liveData = new Mavo.Data(this, []);\n\n\t\tthis.add(element);\n\t\tthis.postInit();\n\n\t\tMavo.hooks.run(\"implicit-collection-init-end\", this);\n\t}\n\n\tget length() {\n\t\treturn this.children.length;\n\t}\n\n\tgetData (o = {}) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o,\n\t\t\tdata: []\n\t\t};\n\n\t\tthis.children.forEach(node => {\n\t\t\tif (!node.isDataNull()) {\n\t\t\t\tenv.data.push(node.getData(o));\n\t\t\t}\n\t\t});\n\n\t\tif (this.data) {\n\t\t\t// Maybe rendered data had more items than we could show? Add it back.\n\t\t\tvar rendered = Mavo.toArray(Mavo.subset(this.data, this.inPath));\n\n\t\t\tif (rendered.length > env.data.length) {\n\t\t\t\tenv.data = env.data.concat(rendered.slice(env.data.length));\n\t\t\t}\n\t\t}\n\n\t\tif (Array.isArray(env.data) && env.data.length <= 1) {\n\t\t\tenv.data = env.data.length === 1? env.data[0] : null;\n\t\t}\n\n\t\tenv.data = Mavo.subset(this.data, this.inPath, env.data);\n\n\t\tMavo.hooks.run(\"node-getdata-end\", env);\n\n\t\treturn env.data;\n\t}\n\n\t/**\n\t * Add a new item to this collection\n\t * @param item Element or Mavo object for the new item\n\t */\n\tadd (element) {\n\t\tvar item = Mavo.Node.create(element, this.mavo, {\n\t\t\tcollection: this,\n\t\t\ttemplate: this.template?.children?.[this.length] ?? null,\n\t\t\tproperty: this.property,\n\t\t\ttype: this.type\n\t\t});\n\n\t\titem.index = this.length;\n\t\tthis.children.push(item);\n\n\t\t// item may have tried to propagate updates to us when we created it,\n\t\t// but that wouldn't have worked since item was not yet in\n\t\t// this.children, so we need to update manually.\n\t\tthis.liveData.update();\n\n\t\treturn item;\n\t}\n\n\tedit (o = {}) {\n\t\tif (super.edit() === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Edit items\n\t\treturn Promise.all(this.children.map(item => item.edit(o)));\n\t}\n\n\tdataRender (data, o = {}) {\n\t\tif (data !== undefined) {\n\t\t\tdata = data === null? [] : Mavo.toArray(data).filter(i => i !== null);\n\t\t\tvar changed = data.length !== this.liveData.length;\n\n\t\t\tthis.children.forEach((item, i) => changed = item.render(data?.[i], o) ?? changed);\n\t\t}\n\n\t\tthis.liveData.update();\n\t}\n};\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.UI.Itembar = $.Class({\n\tconstructor: function(item) {\n\t\tthis.item = item;\n\n\t\tthis.element = $$(`.mv-item-bar:not([mv-rel]), .mv-item-bar[mv-rel=\"${this.item.property}\"]`, this.item.element).filter(el => {\n\t\t\t\t// Ignore item controls meant for other collections\n\t\t\t\treturn el.closest(Mavo.selectors.multiple) == this.item.element && !Mavo.data(el, \"item\");\n\t\t\t})[0];\n\n\t\tif (!this.element && this.item.template?.itembar) {\n\t\t\t// We can clone the buttons from the template\n\t\t\tthis.element = this.item.template.itembar.element.cloneNode(true);\n\t\t\tthis.dragHandle = $(\".mv-drag-handle\", this.element) || this.item.element;\n\t\t}\n\t\telse {\n\t\t\t// First item of this type\n\t\t\tthis.element = this.element || $.create({\n\t\t\t\tclassName: \"mv-item-bar mv-ui\"\n\t\t\t});\n\n\t\t\tvar bottomUp = this.collection.bottomUp;\n\t\t\tvar args = `$item${bottomUp? \", $index + 1\" : \"\"}`;\n\t\t\tvar buttons = [\n\t\t\t\t{\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttype: \"button\",\n\t\t\t\t\ttitle: this.mavo._(\"delete-item\", this.item),\n\t\t\t\t\tclassName: \"mv-delete\",\n\t\t\t\t\t// Why $item and not this.collection.property?\n\t\t\t\t\t// If there's a nested property with the same name, the name will refer to that\n\t\t\t\t\t// However, this means that if we place the item bar inside another item, the button will not work anymore\n\t\t\t\t\t// It's a tradeoff, and perhaps if it proves to be a problem we can start detecting which one is best\n\t\t\t\t\t\"mv-action\": \"delete($item)\"\n\t\t\t\t}, {\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttype: \"button\",\n\t\t\t\t\ttitle: this.mavo._(`add-item-${bottomUp? \"after\" : \"before\"}`, this.item),\n\t\t\t\t\tclassName: \"mv-add\",\n\t\t\t\t\t\"mv-action\": `if($cmd, add($item, ${args}), add(${args}))`\n\t\t\t\t}\n\t\t\t];\n\n\t\t\tif (this.item instanceof Mavo.Group) {\n\t\t\t\tthis.dragHandle = $.create({\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttype: \"button\",\n\t\t\t\t\ttitle: this.mavo._(\"drag-to-reorder\", this.item),\n\t\t\t\t\tclassName: \"mv-drag-handle\"\n\t\t\t\t});\n\n\t\t\t\tbuttons.push(this.dragHandle);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.dragHandle = this.item.element;\n\t\t\t}\n\n\t\t\t$.set(this.element, {\n\t\t\t\t\"mv-rel\": this.item.property,\n\t\t\t\tcontents: buttons\n\t\t\t});\n\t\t}\n\n\t\tthis.element.setAttribute(\"hidden\", \"\");\n\n\t\t$.bind([this.item.element, this.element], \"focusin mouseover\", this);\n\n\t\t$.bind(this.element, {\n\t\t\tmouseenter: evt => {\n\t\t\t\tthis.item.element.classList.add(\"mv-highlight\");\n\t\t\t},\n\t\t\tmouseleave: evt => {\n\t\t\t\tthis.item.element.classList.remove(\"mv-highlight\");\n\t\t\t}\n\t\t});\n\n\t\tthis.dragHandle.addEventListener(\"keydown\", evt => {\n\t\t\tif (evt.target === this.dragHandle && this.item.editing && evt.keyCode >= 37 && evt.keyCode <= 40) {\n\t\t\t\t// Arrow keys\n\t\t\t\tthis.collection.move(this.item, evt.keyCode <= 38? -1 : 1);\n\n\t\t\t\tevt.stopPropagation();\n\t\t\t\tevt.preventDefault();\n\t\t\t\tevt.target.focus();\n\t\t\t}\n\t\t});\n\n\t\tif (this.dragHandle !== this.item.element) {\n\t\t\tthis.dragHandle.addEventListener(\"click\", evt => evt.target.focus());\n\t\t}\n\n\t\tMavo.data(this.element, \"item\", this.item);\n\t},\n\n\tdestroy: function() {\n\t\tthis.hide();\n\t},\n\n\tshow: function(sticky) {\n\t\t_.visible.forEach(instance => {\n\t\t\tif (instance != this && (!this.sticky || instance.sticky)) {\n\t\t\t\tclearTimeout(instance.hideTimeout);\n\t\t\t\tinstance.hide(sticky, _.DELAY);\n\t\t\t}\n\t\t});\n\n\t\t_.visible.add(this);\n\n\t\tif (this.element.hasAttribute(\"hidden\") || sticky && !this.sticky) {\n\t\t\tthis.element.removeAttribute(\"hidden\");\n\t\t\tthis.sticky = this.sticky || sticky;\n\t\t\t$.bind([this.item.element, this.element], \"focusout mouseleave\", this);\n\t\t}\n\t},\n\n\thide: function(sticky, timeout = 0) {\n\t\tif (!this.sticky || sticky) {\n\t\t\tif (timeout) {\n\t\t\t\tthis.hideTimeout = setTimeout(() => this.hide(sticky), timeout);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.element.setAttribute(\"hidden\", \"\");\n\t\t\t\t$.unbind([this.item.element, this.element], \"focusout mouseleave\", this);\n\t\t\t\tthis.sticky = false;\n\t\t\t\t_.visible.delete(this);\n\t\t\t}\n\n\t\t}\n\t},\n\n\thandleEvent: function(evt) {\n\t\tvar sticky = evt.type.indexOf(\"mouse\") === -1;\n\n\t\tif (this.isWithinItem(evt.target)) {\n\t\t\tclearTimeout(this.hideTimeout);\n\n\t\t\tif ([\"mouseleave\", \"focusout\", \"blur\"].indexOf(evt.type) > -1) {\n\t\t\t\tif (!this.isWithinItem(evt.relatedTarget)) {\n\t\t\t\t\tthis.hide(sticky, _.DELAY);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.show(sticky);\n\t\t\t\tevt.stopPropagation();\n\t\t\t}\n\t\t}\n\t},\n\n\tisWithinItem: function(element) {\n\t\tif (!element) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar itemBar = element.closest(\".mv-item-bar\");\n\t\treturn itemBar? itemBar === this.element : element.closest(Mavo.selectors.item) === this.item.element;\n\t},\n\n\tadd: function() {\n\t\tif (!this.element.parentNode && !Mavo.revocably.add(this.element)) {\n\t\t\t// Has not been added before\n\t\t\tvar tag = this.item.element.nodeName.toLowerCase();\n\n\t\t\tif (tag in _.container) {\n\t\t\t\tvar rel = $(_.container[tag], this.item.element);\n\t\t\t}\n\n\t\t\t(rel || this.item.element).appendChild(this.element);\n\t\t}\n\n\t\tif (this.dragHandle == this.item.element) {\n\t\t\tthis.item.element.classList.add(\"mv-drag-handle\");\n\t\t}\n\t},\n\n\tremove: function() {\n\t\tMavo.revocably.remove(this.element);\n\n\t\tif (this.dragHandle == this.item.element) {\n\t\t\tthis.item.element.classList.remove(\"mv-drag-handle\");\n\t\t}\n\t},\n\n\tlive: {\n\t\tsticky: function(v) {\n\t\t\tthis.element.classList.toggle(\"mv-sticky\", v);\n\t\t}\n\t},\n\n\tproxy: {\n\t\tcollection: \"item\",\n\t\tmavo: \"item\"\n\t},\n\n\tstatic: {\n\t\tDELAY: 100,\n\t\tvisible: new Set(),\n\t\tcontainer: {\n\t\t\t\"details\": \"summary\"\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function() {\n\nvar _ = Mavo.Expression = class Expression {\n\tconstructor (expression, options = {}) {\n\t\tthis.options = options;\n\t\tthis.expression = expression;\n\t}\n\n\teval (data = Mavo.Data.stub) {\n\t\tMavo.hooks.run(\"expression-eval-beforeeval\", this);\n\n\t\tif (this.function instanceof Error) {\n\t\t\t// Previous compilation error\n\t\t\treturn this.function;\n\t\t}\n\n\t\ttry {\n\t\t\treturn this.function(data);\n\t\t}\n\t\tcatch (error) {\n\t\t\t// Runtime error\n\t\t\tthis.error(`Something went wrong with the expression ${this.expression}`,\n\t\t\t\terror.message,\n\t\t\t\t`Data was: ${JSON.stringify(data)}`\n\t\t\t);\n\n\t\t\tMavo.hooks.run(\"expression-eval-error\", {context: this, error});\n\n\t\t\treturn error;\n\t\t}\n\t}\n\n\terror (title, ...message) {\n\t\tmessage = message.join(\"\\n\");\n\t\tconsole.info(`%cOops!  ${title}:`, \"color: #c04; font-weight: bold;\", message);\n\t}\n\n\ttoString () {\n\t\treturn this.expression;\n\t}\n\n\tchangedBy (evt) {\n\t\treturn _.changedBy(this.identifiers, evt);\n\t}\n};\n\nBliss.Class(_, {\n\tlive: {\n\t\texpression: function(value) {\n\t\t\ttry {\n\t\t\t\tthis.function = Mavo.Script.compile(value, this.options);\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\t// Compilation error\n\t\t\t\tthis.error(`There is something wrong with the expression ${value}`,\n\t\t\t\t\terror.message,\n\t\t\t\t\t\"Not an expression? See https://mavo.io/docs/expressions/#disabling-expressions for information on how to disable expressions.\"\n\t\t\t\t);\n\n\t\t\t\tMavo.hooks.run(\"expression-compile-error\", {context: this, error});\n\n\t\t\t\tthis.function = error;\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tthis.ast = this.options.ast;\n\t\t\tdelete this.options.ast;\n\n\t\t\tif (this.ast) {\n\t\t\t\t// Traverse AST to find potential identifiers\n\t\t\t\tlet identifiers = new Set();\n\n\t\t\t\tMavo.Script.walk(this.ast, (n, property, parent) => {\n\t\t\t\t\tif (n.type === \"Identifier\" && property !== \"callee\") {\n\t\t\t\t\t\tidentifiers.add(n.name);\n\t\t\t\t\t}\n\t\t\t\t\telse if (n.type === \"MemberExpression\") {\n\t\t\t\t\t\tif (n.object.name) {\n\t\t\t\t\t\t\tidentifiers.add(n.object.name);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tidentifiers.add(n.property.name);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.identifiers = [...identifiers];\n\t\t\t}\n\t\t}\n\t}\n});\n\n_.Syntax = class Syntax {\n\tconstructor (start, end) {\n\t\tthis.start = start;\n\t\tthis.end = end;\n\t\t// Try to parse anything between start and end as an expression. Note\n\t\t// that this parses text that we don't want to treat as expressions,\n\t\t// including the empty expression, but we want to parse them out anyway\n\t\t// and only later decide not to evaluate them as expressions so that we\n\t\t// don't parse, say, [][1] as a single expression containing \"][1\".\n\n\t\t// Regex note: \"[\\S\\s]\" matches all characters, unlike \".\", which\n\t\t// doesn't match newlines.\n\t\tthis.regex = RegExp(`${Mavo.escapeRegExp(start)}([\\\\S\\\\s]*?)${Mavo.escapeRegExp(end)}`, \"gi\");\n\t}\n\n\ttest (str) {\n\t\tthis.regex.lastIndex = 0;\n\n\t\treturn this.regex.test(str);\n\t}\n\n\ttokenize (str) {\n\t\tvar match, ret = [], lastIndex = 0;\n\n\t\tthis.regex.lastIndex = 0;\n\n\t\twhile ((match = this.regex.exec(str)) !== null) {\n\t\t\t// Literal before the expression\n\t\t\tif (match.index > lastIndex) {\n\t\t\t\tret.push(str.substring(lastIndex, match.index));\n\t\t\t}\n\n\t\t\tlastIndex = this.regex.lastIndex;\n\n\t\t\tif (/\\S/.test(match[1])) {\n\t\t\t\tret.push(new Mavo.Expression(match[1]));\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// If the matched expression is empty or consists only of\n\t\t\t\t// whitespace, don't treat it as an expression.\n\t\t\t\tret.push(match[0]);\n\t\t\t}\n\t\t}\n\n\t\t// Literal at the end\n\t\tif (lastIndex < str.length) {\n\t\t\tret.push(str.substring(lastIndex));\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tstatic create (element) {\n\t\tif (element) {\n\t\t\tvar syntax = element.getAttribute(\"mv-expressions\");\n\n\t\t\tif (syntax) {\n\t\t\t\tsyntax = syntax.trim();\n\t\t\t\treturn /\\s/.test(syntax)? new _.Syntax(...syntax.split(/\\s+/)) : _.Syntax.ESCAPE;\n\t\t\t}\n\t\t}\n\t}\n};\n\n_.Syntax.ESCAPE = -1;\n_.Syntax.default = new _.Syntax(\"[\", \"]\");\n\n})();\n\n(function($, $$) {\n\nvar _ = Mavo.DOMExpression = $.Class({\n\tconstructor: function(o = {}) {\n\t\tthis.mavo = o.mavo;\n\t\tthis.template = o.template?.template || o.template;\n\n\t\tfor (let prop of [\"item\", \"path\", \"syntax\", \"fallback\", \"attribute\", \"originalAttribute\", \"expression\", \"parsed\", \"identifiers\"]) {\n\t\t\tthis[prop] = o[prop] === undefined && this.template? this.template[prop] : o[prop];\n\t\t}\n\n\t\tthis.node = o.node;\n\n\t\tif (!this.node) {\n\t\t\t// No node provided, figure it out from path\n\t\t\tthis.node = Mavo.elementPath(this.item.element, this.path);\n\t\t}\n\n\t\tthis.element = this.node;\n\t\tthis.attribute = this.attribute || null;\n\n\t\tMavo.hooks.run(\"domexpression-init-start\", this);\n\n\t\tif (this.attribute == \"mv-value\") {\n\t\t\tthis.originalAttribute = \"mv-value\";\n\t\t\tthis.attribute = Mavo.Primitive.getValueAttribute(this.element);\n\t\t\tthis.fallback = this.fallback || Mavo.Primitive.getValue(this.element, {attribute: this.attribute});\n\t\t\tvar expression = this.element.getAttribute(\"mv-value\");\n\t\t\tthis.element.removeAttribute(\"mv-value\");\n\t\t\tthis.parsed = [new Mavo.Expression(expression)];\n\t\t\tthis.expression = this.syntax.start + expression + this.syntax.end;\n\t\t}\n\n\t\tif (this.node.nodeType === 3 && this.element === this.node) {\n\t\t\tthis.element = this.node.parentNode;\n\n\t\t\t// If no element siblings make this.node the element, which is more robust\n\t\t\t// Same if attribute, there are no attributes on a text node!\n\t\t\tif (!this.node.parentNode.children.length || this.attribute) {\n\t\t\t\tthis.node = this.element;\n\t\t\t\tthis.element.normalize();\n\t\t\t}\n\t\t}\n\n\t\tif (!this.expression) { // Still unhandled?\n\t\t\tif (this.attribute) {\n\t\t\t\t// Some web components (e.g. AFrame) hijack getAttribute()\n\t\t\t\tvar value = Element.prototype.getAttribute.call(this.node, this.attribute);\n\n\t\t\t\tthis.expression = (value || \"\").trim();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Move whitespace outside to prevent it from messing with types\n\t\t\t\tthis.node.normalize();\n\n\t\t\t\tif (this.node.childNodes.length === 1 && this.node?.firstChild?.nodeType === 3) {\n\t\t\t\t\tvar whitespace = this.node.firstChild.textContent.match(/^\\s*|\\s*$/g);\n\n\t\t\t\t\tif (whitespace[1]) {\n\t\t\t\t\t\tthis.node.firstChild.splitText(this.node.firstChild.textContent.length - whitespace[1].length);\n\t\t\t\t\t\tthis.node.after(this.node.lastChild);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (whitespace[0]) {\n\t\t\t\t\t\tthis.node.firstChild.splitText(whitespace[0].length);\n\t\t\t\t\t\tthis.node.parentNode.insertBefore(this.node.firstChild, this.node);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.expression = this.node.textContent;\n\t\t\t}\n\n\t\t\tthis.parsed = this.template? this.template.parsed : this.syntax.tokenize(this.expression);\n\t\t}\n\n\t\tthis.oldValue = this.value = this.parsed.map(x => x instanceof Mavo.Expression? \"\" : x);\n\n\t\t// Cache identifiers\n\t\tthis.identifiers = this.identifiers || this.parsed.flatMap(x => x.identifiers || []);\n\n\t\t// Any identifiers that need additional updating?\n\t\t_.special.add(this);\n\n\t\tthis.mavo.treeBuilt.then(() => {\n\t\t\tif (!this.template && !this.item) {\n\t\t\t\t// Only collection items and groups can have their own expressions arrays\n\t\t\t\tthis.item = Mavo.Node.getClosestItem(this.element);\n\t\t\t}\n\n\t\t\tif (this.originalAttribute == \"mv-value\" && this.mavoNode && this.mavoNode == this.item.collection) {\n\t\t\t\tMavo.delete(this.item.expressions, this);\n\t\t\t}\n\n\t\t\tthis.mavo.expressions.register(this);\n\n\t\t\tMavo.hooks.run(\"domexpression-init-treebuilt\", this);\n\t\t});\n\n\t\tMavo.hooks.run(\"domexpression-init-end\", this);\n\n\t\t_.elements.set(this.element, [...(_.elements.get(this.element) || []), this]);\n\t},\n\n\tdestroy: function() {\n\t\t_.special.delete(this);\n\t\tthis.mavo.expressions.unregister(this);\n\t},\n\n\tget isDynamicObject() {\n\t\treturn this.originalAttribute == \"mv-value\"\n\t\t       && this.mavoNode\n\t\t\t   && !(this.mavoNode instanceof Mavo.Primitive);\n\t},\n\n\tchangedBy: function(evt) {\n\t\tif (this.isDynamicObject) {\n\t\t\t// Just prevent the same node from triggering changes, everything else is game\n\t\t\treturn !evt || !this.mavoNode.contains(evt.node);\n\t\t}\n\n\t\treturn Mavo.Expression.changedBy(this.identifiers, evt);\n\t},\n\n\tupdate: function() {\n\t\tif (this.active === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar env = {context: this};\n\t\tvar parentEnv = env;\n\n\t\tif (this.item) {\n\t\t\tvar scope = this.isDynamicObject? this.item.parent : this.item;\n\t\t\tvar data = this.data = scope.getLiveData();\n\t\t}\n\t\telse {\n\t\t\tvar data = this.data === undefined? Mavo.Data.stub : this.data;\n\t\t}\n\n\t\tMavo.hooks.run(\"domexpression-update-start\", env);\n\n\t\tthis.oldValue = this.value;\n\t\tvar changed = false;\n\n\t\tenv.value = this.value = this.parsed.map((expr, i) => {\n\t\t\tif (expr instanceof Mavo.Expression) {\n\t\t\t\tvar env = {context: this, expr, parentEnv};\n\n\t\t\t\tMavo.hooks.run(\"domexpression-update-beforeeval\", env);\n\n\t\t\t\tenv.value = Mavo.value(env.expr.eval(data));\n\n\t\t\t\tMavo.hooks.run(\"domexpression-update-aftereval\", env);\n\n\t\t\t\tchanged = true;\n\n\t\t\t\tif (env.value instanceof Error) {\n\t\t\t\t\treturn this.fallback !== undefined? this.fallback : this.syntax.start + env.expr.expression + this.syntax.end;\n\t\t\t\t}\n\n\t\t\t\tif (env.value === undefined || env.value === null) {\n\t\t\t\t\t// Dont print things like \"undefined\" or \"null\"\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\treturn env.value;\n\t\t\t}\n\n\t\t\treturn expr;\n\t\t});\n\n\t\tif (!changed) {\n\t\t\t// If nothing changed, no need to do anything\n\t\t\treturn;\n\t\t}\n\n\t\tif (env.value.length === 1) {\n\t\t\tenv.value = env.value[0];\n\t\t}\n\t\telse {\n\t\t\tenv.value = env.value.map(v => Mavo.Primitive.format(v, {\n\t\t\t\tattribute: this.attribute,\n\t\t\t\telement: this.element\n\t\t\t})).join(\"\");\n\t\t}\n\n\t\tthis.output(env.value);\n\n\t\tMavo.hooks.run(\"domexpression-update-end\", env);\n\t},\n\n\toutput: function(value) {\n\t\tif (this.primitive) {\n\t\t\tif (Mavo.in(Mavo.isProxy, value)) {\n\t\t\t\tvalue = Mavo.clone(value); // Drop proxy\n\t\t\t}\n\n\t\t\tthis.primitive.value = value;\n\t\t}\n\t\telse if (this.mavoNode) {\n\t\t\tthis.mavoNode.render(value);\n\t\t}\n\t\telse {\n\t\t\tMavo.Primitive.setValue(this.node, value, {attribute: this.attribute});\n\t\t}\n\t},\n\n\tlive: {\n\t\titem: function(item) {\n\t\t\tif (item && this._item != item) {\n\t\t\t\tif (this._item) {\n\t\t\t\t\t// Previous item, delete from its expressions\n\t\t\t\t\tMavo.delete(this._item.expressions, this);\n\t\t\t\t}\n\n\t\t\t\titem.expressions = item.expressions || [];\n\t\t\t\titem.expressions.push(this);\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\telements: new WeakMap(),\n\n\t\t/**\n\t\t * Search for Mavo.DOMExpression object(s) associated with a given element\n\t\t * and optionally an attribute.\n\t\t *\n\t\t * @return If one argument, array of matching DOMExpression objects.\n\t\t *         If two arguments, the matching DOMExpression object or null\n\t\t */\n\t\tsearch: function (element, attribute) {\n\t\t\tif (element === null) {\n\t\t\t\treturn element;\n\t\t\t}\n\n\t\t\t// HTML attributes are case-insensitive (fix for #515)\n\t\t\tif (attribute && !element.ownerDocument.xmlVersion) {\n\t\t\t\tattribute = attribute.toLowerCase();\n\t\t\t}\n\n\t\t\tvar all = _.elements.get(element) || [];\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tif (!all.length) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn all.filter(et => et.attribute === attribute)[0] || null;\n\t\t\t}\n\n\t\t\treturn all;\n\t\t},\n\n\t\tspecial: {\n\t\t\tadd: function(domexpression, name) {\n\t\t\t\tif (name) {\n\t\t\t\t\tvar o = this.vars[name];\n\t\t\t\t\tvar hasName = domexpression.identifiers.indexOf(name) > -1;\n\t\t\t\t\tvar hasUnprefixedName = (name.startsWith(\"$\") &&\n\t\t\t\t\t\tdomexpression.identifiers.indexOf(name.substr(1)) > -1);\n\n\t\t\t\t\tif (o && (hasName || hasUnprefixedName)) {\n\t\t\t\t\t\to.all = o.all || new Set();\n\t\t\t\t\t\to.all.add(domexpression);\n\n\t\t\t\t\t\tif (o.all.size === 1) {\n\t\t\t\t\t\t\to.observe();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!o.all.size) {\n\t\t\t\t\t\t\to.unobserve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// All names\n\t\t\t\t\tfor (var name in this.vars) {\n\t\t\t\t\t\tthis.add(domexpression, name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tdelete: function(domexpression, name) {\n\t\t\t\tif (name) {\n\t\t\t\t\tvar o = this.vars[name];\n\n\t\t\t\t\to.all = o.all || new Set();\n\t\t\t\t\to.all.delete(domexpression);\n\n\t\t\t\t\tif (!o.all.size) {\n\t\t\t\t\t\to.unobserve();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// All names\n\t\t\t\t\tfor (var name in this.vars) {\n\t\t\t\t\t\tthis.delete(domexpression, name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tupdate: function() {\n\t\t\t\tthis.update?.(...arguments);\n\n\t\t\t\tthis.all.forEach(domexpression => domexpression.update());\n\t\t\t},\n\n\t\t\tevent: function(name, {type, update, target = document} = {}) {\n\t\t\t\tthis.vars[name] = {\n\t\t\t\t\tobserve: function() {\n\t\t\t\t\t\tthis.callback = this.callback || _.special.update.bind(this);\n\t\t\t\t\t\ttarget.addEventListener(type, this.callback);\n\t\t\t\t\t},\n\t\t\t\t\tunobserve: function() {\n\t\t\t\t\t\ttarget.removeEventListener(type, this.callback);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif (update) {\n\t\t\t\t\tthis.vars[name].update = function(evt) {\n\t\t\t\t\t\tMavo.Functions[name] = update(evt);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tvars: {\n\t\t\t\t\"$now\": {\n\t\t\t\t\tobserve: function() {\n\t\t\t\t\t\tvar callback = () => {\n\t\t\t\t\t\t\t_.special.update.call(this);\n\t\t\t\t\t\t\tthis.timer = requestAnimationFrame(callback);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis.timer = requestAnimationFrame(callback);\n\t\t\t\t\t},\n\t\t\t\t\tunobserve: function() {\n\t\t\t\t\t\tcancelAnimationFrame(this.timer);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n\n_.special.event(\"$mouse\", {\n\ttype: \"mousemove\",\n\tupdate: function(evt) {\n\t\treturn {x: evt.clientX, y: evt.clientY};\n\t}\n});\n\n_.special.event(\"$hash\", {\n\ttype: \"hashchange\",\n\ttarget: window\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nMavo.attributes.push(\"mv-expressions\");\n\nvar _ = Mavo.Expressions = $.Class({\n\tasync constructor (mavo) {\n\t\tthis.mavo = mavo;\n\t\tthis.active = true;\n\n\t\tthis.expressions = [];\n\t\tthis.identifiers = {};\n\n\t\tvar syntax = Mavo.Expression.Syntax.create(this.mavo.element.closest(\"[mv-expressions]\")) || Mavo.Expression.Syntax.default;\n\t\tthis.traverse(this.mavo.element, undefined, syntax);\n\n\t\tthis.scheduled = {};\n\n\t\tawait this.mavo.treeBuilt;\n\n\t\tthis.expressions = [];\n\t\tthis.update();\n\t},\n\n\tregister: function(domexpression) {\n\t\tvar ids = this.identifiers;\n\t\tdomexpression.registeredApp = domexpression.registeredApp || new Set();\n\t\tdomexpression.identifiers.forEach(id => {\n\t\t\tif (!(ids[id] instanceof Set)) {\n\t\t\t\tids[id] = new Set();\n\t\t\t}\n\n\t\t\tids[id].add(domexpression);\n\n\t\t\tif (Mavo.all[id] instanceof Mavo && Mavo.all[id] !== this.mavo && !domexpression.registeredApp.has(id) ) {\n\t\t\t\t// Cross-mavo expressions, make sure to track app id before calling register.\n\t\t\t\tdomexpression.registeredApp.add(id);\n\t\t\t\tMavo.all[id].expressions.register(domexpression);\n\t\t\t}\n\t\t});\n\t},\n\n\tunregister: function(domexpression) {\n\t\tvar ids = this.identifiers;\n\n\t\tdomexpression.identifiers.forEach(id => {\n\t\t\tif (ids[id]) {\n\t\t\t\tids[id].delete(domexpression);\n\t\t\t}\n\n\t\t\t// just in case domexpresssion has been destroyed by another app during the loop\n\t\t\t// when another app is destroyed.\n\t\t\tif (id in Mavo.all && typeof domexpresssion !== \"undefined\") {\n\t\t\t\t// Cross-mavo expressions\n\t\t\t\tMavo.all[id].expressions.unregister(domexpresssion);\n\t\t\t}\n\t\t});\n\t},\n\n\tupdateThrottled: function(evt) {\n\t\tif (!this.active) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar scheduled = this.scheduled[evt.action] = this.scheduled[evt.action] || new Set();\n\n\t\tif (evt.node.template) {\n\t\t\t// Throttle events in collections and events from other Mavos\n\t\t\tif (!scheduled.has(evt.node.template)) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tscheduled.delete(evt.node.template);\n\t\t\t\t\tthis.update(evt);\n\t\t\t\t}, _.THROTTLE);\n\n\t\t\t\tscheduled.add(evt.node.template);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\trequestAnimationFrame(() => this.update(evt));\n\t\t}\n\t},\n\n\tupdate: function(evt) {\n\t\tif (!this.active) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar root, rootObject;\n\n\t\tif (evt instanceof Mavo.Node) {\n\t\t\trootObject = evt;\n\t\t}\n\t\telse if (evt instanceof Element) {\n\t\t\troot = evt.closest(Mavo.selectors.item);\n\t\t\trootObject = Mavo.Node.get(root);\n\t\t}\n\t\telse if (evt) {\n\t\t\t// Specific data change\n\t\t\tvar cache = {\n\t\t\t\tupdated: new Set()\n\t\t\t};\n\n\t\t\tthis.updateByIdThrottled(evt.property, evt, cache);\n\n\t\t\tif (evt.action == \"propertychange\") {\n\t\t\t\tif (evt.node?.path) {\n\t\t\t\t\t// Ensure that [collectionName] updates when changing children\n\t\t\t\t\tthis.updateByIdThrottled(evt.node.path, evt, cache);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Collection modifications (add, delete, move etc)\n\t\t\t\tthis.updateById(Object.keys(Mavo.Data.special), evt, cache);\n\n\t\t\t\tvar collection = evt.node.collection || evt.node;\n\n\t\t\t\tthis.updateById(collection.properties, evt, cache);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\telse {\n\t\t\trootObject = this.mavo.root;\n\t\t}\n\n\t\trootObject.walk((obj, path) => {\n\t\t\tif (!obj.expressionsEnabled) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tobj.expressions?.forEach(et => {\n\t\t\t\t// Prevent mv-value loops\n\t\t\t\tif (!evt || et.mavoNode !== evt) {\n\t\t\t\t\tet.update();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tupdateByIdThrottled: function(property, evt, cache) {\n\t\tif (!property) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (property.forEach) {\n\t\t\tproperty.forEach(property => this.updateByIdThrottled(property, evt, cache));\n\t\t}\n\t\telse {\n\t\t\tvar scheduled = this.scheduledIds = this.scheduledIds || new Set();\n\n\t\t\tif (!scheduled.has(property)) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tscheduled.delete(property);\n\n\t\t\t\t\tthis.updateById(property, evt, cache);\n\t\t\t\t}, _.THROTTLE);\n\n\t\t\t\tscheduled.add(property);\n\t\t\t}\n\t\t}\n\t},\n\n\tupdateById: function(property, evt, cache) {\n\t\tif (property.forEach) {\n\t\t\t// Multiple properties\n\t\t\tproperty.forEach(p => this.updateById(p, evt, cache));\n\t\t\treturn;\n\t\t}\n\n\t\tvar exprs = this.identifiers[property];\n\n\t\tif (exprs) {\n\t\t\texprs.forEach(expr => {\n\t\t\t\t// Prevent the same node from triggering changes, everything else is game\n\t\t\t\tif (expr.originalAttribute == \"mv-value\" && expr.mavoNode && !(expr.mavoNode instanceof Mavo.Primitive) && expr.mavoNode.contains(evt.node)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!cache.updated.has(expr)) {\n\t\t\t\t\texpr.update();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\textract: function(node, attribute, path, syntax = Mavo.Expression.Syntax.default) {\n\t\tif (attribute && _.skip.indexOf(attribute.name) > -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (attribute && _.directives.indexOf(attribute.name) > -1 ||\n\t\t    syntax !== Mavo.Expression.Syntax.ESCAPE && syntax.test(attribute? attribute.value : node.textContent)\n\t\t) {\n\t\t\tif (path === undefined) {\n\t\t\t\tpath = Mavo.elementPath(node.closest(Mavo.selectors.item), node);\n\t\t\t}\n\n\t\t\tthis.expressions.push(new Mavo.DOMExpression({\n\t\t\t\tnode, syntax, path,\n\t\t\t\tattribute: attribute?.name,\n\t\t\t\tmavo: this.mavo\n\t\t\t}));\n\t\t}\n\t},\n\n\t// Traverse an element, including attribute nodes, text nodes and all descendants\n\ttraverse: function(node, path = [], syntax) {\n\t\tif (node.nodeType === 8) {\n\t\t\t// We don't want expressions to be picked up from comments!\n\t\t\t// Commenting stuff out is a common debugging technique\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeType === 3) { // Text node\n\t\t\t// Leaf node, extract references from content\n\t\t\tthis.extract(node, null, path, syntax);\n\t\t}\n\t\telse {\n\t\t\tnode.normalize();\n\n\t\t\tsyntax = Mavo.Expression.Syntax.create(node) || syntax;\n\n\t\t\tif (Mavo.is(\"item\", node)) {\n\t\t\t\tpath = [];\n\t\t\t}\n\n\t\t\tif (node.hasAttribute(\"mv-expressions-ignore\")) {\n\t\t\t\tvar ignore = new Set(node.getAttribute(\"mv-expressions-ignore\").trim().split(/\\s*,\\s*/));\n\t\t\t}\n\n\t\t\t$$(node.attributes).forEach(attribute => {\n\t\t\t\tif (!ignore || !ignore.has(attribute.name)) {\n\t\t\t\t\tthis.extract(node, attribute, path, syntax);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar index = -1, offset = 0;\n\n\t\t\tif (!node.matches(\"script:not([mv-expressions])\")) {\n\t\t\t\t$$(node.childNodes).forEach(child => {\n\t\t\t\t\tif (child.nodeType == 1) {\n\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t\tindex++;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\toffset++;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (child.nodeType == 1 || child.nodeType == 3) {\n\t\t\t\t\t\tvar segment = offset > 0? `${index}.${offset}` : index;\n\t\t\t\t\t\tthis.traverse(child, [...path || [], segment], syntax);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tdirectives: [\n\t\t\t\"mv-value\"\n\t\t],\n\n\t\tskip: [\"mv-expressions\", \"mv-action\"],\n\n\t\tTHROTTLE: 50,\n\n\t\tdirective: function(name, o) {\n\t\t\t_.directives.push(name);\n\t\t\tMavo.attributes.push(name);\n\t\t\tMavo.Plugins.register(name, o);\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n// mv-if plugin\n(function($, $$) {\n\nMavo.Expressions.directive(\"mv-if\", {\n\textend: {\n\t\t\"Primitive\": {\n\t\t\tlive: {\n\t\t\t\t\"hidden\": function(value) {\n\t\t\t\t\tif (this._hidden !== value) {\n\t\t\t\t\t\tthis._hidden = value;\n\t\t\t\t\t\tthis.liveData.update();\n\t\t\t\t\t\tthis.dataChanged();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"DOMExpression\": {\n\t\t\tlazy: {\n\t\t\t\t\"childProperties\": function() {\n\t\t\t\t\tvar properties = $$(Mavo.selectors.property, this.element)\n\t\t\t\t\t\t\t\t\t.filter(el => el.closest(\"[mv-if]\") == this.element)\n\t\t\t\t\t\t\t\t\t.map(el => Mavo.Node.get(el));\n\n\t\t\t\t\t// When the element is detached, mv-change events from properties\n\t\t\t\t\t// do not propagate up to the group so expressions do not recalculate.\n\t\t\t\t\t// We must do this manually.\n\t\t\t\t\tthis.element.addEventListener(\"mv-change\", evt => {\n\t\t\t\t\t\t// Cannot redispatch synchronously [why??]\n\t\t\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\t\t\tif (!this.element.parentNode) { // out of the DOM?\n\t\t\t\t\t\t\tthis.item.element.dispatchEvent(evt);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\treturn properties;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\thooks: {\n\t\t\"domexpression-init-start\": function() {\n\t\t\tif (this.attribute != \"mv-if\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!Mavo.Node.prototype.fromTemplate.call(this, \"parsed\", \"expression\")) {\n\t\t\t\tthis.expression = this.element.getAttribute(\"mv-if\");\n\t\t\t\tthis.parsed = [new Mavo.Expression(this.expression)];\n\t\t\t\tthis.expression = this.syntax.start + this.expression + this.syntax.end;\n\t\t\t}\n\n\t\t\tthis.parentIf = this.element.parentNode && Mavo.DOMExpression.search(this.element.parentNode.closest(\"[mv-if]\"), \"mv-if\");\n\n\t\t\tif (this.parentIf) {\n\t\t\t\tthis.parentIf.childIfs = (this.parentIf.childIfs || new Set()).add(this);\n\t\t\t}\n\t\t},\n\t\t\"domexpression-update-end\": async function() {\n\t\t\tif (this.attribute !== \"mv-if\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar value = this.value[0];\n\t\t\tvar oldValue = this.oldValue[0];\n\n\t\t\t// Only apply this after the tree is built, otherwise any properties inside the if will go missing!\n\t\t\tawait this.item.mavo.treeBuilt;\n\n\t\t\tif (this.parentIf) {\n\t\t\t\tvar parentValue = this.parentIf.value[0];\n\t\t\t\tthis.value[0] = value = value && parentValue;\n\t\t\t}\n\n\t\t\tif (parentValue !== false) { // If parent if was false, it wouldn't matter whether this is in the DOM or not\n\t\t\t\tif (value) {\n\t\t\t\t\t// Is removed from the DOM and needs to get back\n\t\t\t\t\tMavo.revocably.add(this.element);\n\t\t\t\t}\n\t\t\t\telse if (this.element.parentNode) {\n\t\t\t\t\t// Is in the DOM and needs to be removed\n\t\t\t\t\tMavo.revocably.remove(this.element, \"mv-if\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (value !== oldValue) {\n\t\t\t\t// Mark any properties inside as hidden or not\n\t\t\t\tthis.childProperties?.forEach(property => property.hidden = !value);\n\t\t\t\tthis.childIfs?.forEach(childIf => childIf.update());\n\t\t\t}\n\t\t},\n\t\t\"node-isdatanull\": function(env) {\n\t\t\tenv.result = env.result || (this.hidden && env.options.live);\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n/**\n * Functions available inside Mavo expressions\n */\n\n(function($, val) {\n\nvar _ = Mavo.Functions = {\n\toperators: {\n\t\t\"=\": \"eq\"\n\t},\n\n\t/**\n\t * Get a property of an object. Used by the . operator to prevent TypeErrors\n\t */\n\tget: function(obj, property, meta = {}) {\n\t\tproperty = meta.property = val(property);\n\n\t\t// Get same case property name if it exists,\n\t\t// otherwise do a case insensitive search among properties\n\t\tvar canonicalProperty = Mavo.getCanonicalProperty(obj, property);\n\n\t\tif (canonicalProperty !== undefined) {\n\t\t\tmeta.property = canonicalProperty;\n\t\t\tvar ret = obj[canonicalProperty];\n\n\t\t\tif (typeof ret === \"function\" && ret.name.indexOf(\"bound\") !== 0) {\n\t\t\t\treturn ret.bind(obj);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (Array.isArray(obj) && property && isNaN(property)) {\n\t\t\t// Array and non-numerical property\n\t\t\tvar eqIndex = property.indexOf(\"=\");\n\n\t\t\tif (eqIndex > -1) {\n\t\t\t\t// propertyName=value is used as a query for arrays of objects\n\t\t\t\t// This is mainly useful for mv-path\n\t\t\t\tmeta.query = {\n\t\t\t\t\tproperty: property.slice(0, eqIndex),\n\t\t\t\t\tvalue: property.slice(eqIndex + 1)\n\t\t\t\t};\n\n\t\t\t\tmeta.property = [];\n\n\t\t\t\tret = obj.filter((e, i) => {\n\t\t\t\t\tvar passes = _.get(e, meta.query.property) == meta.query.value;\n\n\t\t\t\t\tif (passes) {\n\t\t\t\t\t\tmeta.property.push(i);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn passes;\n\t\t\t\t});\n\n\t\t\t\tif (meta.query.property == \"id\") {\n\t\t\t\t\tmeta.property = meta.property[0];\n\t\t\t\t\tret = ret[0];\n\t\t\t\t}\n\n\t\t\t\tif (ret === undefined) {\n\t\t\t\t\tmeta.property = obj.length;\n\t\t\t\t}\n\t\t\t\telse if (ret.length === 0) {\n\t\t\t\t\tmeta.property = [obj.length];\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Not a property query, get from objects inside\n\t\t\t\t// TODO meta.property = ??\n\t\t\t\treturn obj.map(e => _.get(e, property));\n\t\t\t}\n\t\t}\n\n\t\t// Not found :(\n\t\treturn null;\n\t},\n\n\turl: (id, url = location) => {\n\t\tif (id === undefined) {\n\t\t\treturn location.href;\n\t\t}\n\n\t\tif (id) {\n\t\t\tid = str(id).replace(/[^\\w-:]/g);\n\n\t\t\tvar ret = url.search.match(RegExp(`[?&]${id}(?:=(.+?))?(?=$|&)`))\n\t\t\t       || url.pathname.match(RegExp(`(?:^|\\\\/)${id}\\\\/([^\\\\/]*)`));\n\t\t}\n\n\t\tif (ret === null || !id) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn decodeURIComponent(ret[1] || \"\");\n\t},\n\n\tfirst: (n, arr) => {\n\t\tif (arr === undefined) {\n\t\t\tarr = n;\n\t\t\tn = undefined;\n\t\t}\n\n\t\tif (arr === undefined) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!Array.isArray(arr)) {\n\t\t\treturn n !== undefined ? [arr] : arr;\n\t\t}\n\n\t\tif (n < 0) {\n\t\t\treturn _.last(Math.abs(n), arr);\n\t\t}\n\t\telse {\n\t\t\tvar ret = [];\n\t\t\tvar numReturn = n === undefined ? 1 : Math.floor(n);\n\n\t\t\tfor (var i = 0; i<arr.length && ret.length<numReturn; i++) {\n\t\t\t\tif (Mavo.value(arr[i]) !== null) {\n\t\t\t\t\tret.push(arr[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (n === undefined) {\n\t\t\t\treturn ret[0] !== undefined ? ret[0] : null;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t},\n\tlast: (n, arr) => {\n\t\tif (arr === undefined) {\n\t\t\tarr = n;\n\t\t\tn = undefined;\n\t\t}\n\n\t\tif (arr === undefined) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!Array.isArray(arr)) {\n\t\t\treturn n !== undefined ? [arr] : arr;\n\t\t}\n\n\t\tif (n < 0) {\n\t\t\treturn _.first(Math.abs(n), arr);\n\t\t}\n\t\telse {\n\t\t\tvar ret = [];\n\t\t\tvar numReturn = n === undefined ? 1 : Math.floor(n);\n\n\t\t\tfor (var i = arr.length-1; i>=0 && ret.length<numReturn; i--) {\n\t\t\t\tif (Mavo.value(arr[i]) !== null) {\n\t\t\t\t\tret.push(arr[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (n === undefined) {\n\t\t\t\treturn ret[0] !== undefined ? ret[0] : null;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t},\n\t// Get rid of empty values in array. Same as first(count(arr), arr)\n\tcondense: (arr) => {\n\t\treturn _.first(arr.length, arr);\n\t},\n\n\tunique: function(arr) {\n\t\tif (!Array.isArray(arr)) {\n\t\t\treturn arr;\n\t\t}\n\n\t\treturn [...new Set(arr.map(val))];\n\t},\n\n\t/**\n\t * Do two arrays or sets have a non-empty intersection?\n\t * @return {Boolean}\n\t */\n\tintersects: function(arr1, arr2) {\n\t\tif (arr1 && arr2) {\n\t\t\tvar set2 = new Set(Mavo.toArray(arr2).map(val));\n\t\t\tarr1 = Mavo.toArray(arr1).map(val);\n\n\t\t\treturn !arr1.every(el => !set2.has(el));\n\t\t}\n\t},\n\n\t/*********************\n\t * Number functions\n\t *********************/\n\n\t/**\n\t * Aggregate sum\n\t */\n\tsum: $.extend(function(array) {\n\t\treturn $u.numbers(array, arguments).reduce((prev, current) => {\n\t\t\treturn +prev + (+current || 0);\n\t\t}, 0);\n\t}, {\n\t\tisAggregate: true\n\t}),\n\n\t/**\n\t * Average of an array of numbers\n\t */\n\taverage: $.extend(function(array) {\n\t\tarray = $u.numbers(array, arguments);\n\t\treturn array.length && _.sum(array) / array.length;\n\t}, {\n\t\tisAggregate: true,\n\t\talias: \"avg\"\n\t}),\n\n\t/**\n\t * Median of an array of numbers\n\t */\n\tmedian: $.extend(function(array) {\n\t\tarray = $u.numbers(array, arguments).sort((a, b) => a - b);\n\t\tvar mi = (array.length - 1) / 2;\n\t\t[m1, m2] = [array[Math.floor(mi)], array[Math.ceil(mi)]];\n\t\treturn (m1 + m2) / 2 || 0;\n\t}, {\n\t\tisAggregate: true\n\t}),\n\n\t/**\n\t * Min of an array of numbers\n\t */\n\tmin: $.extend(function(array) {\n\t\treturn Math.min(...$u.numbers(array, arguments));\n\t}, {\n\t\tisAggregate: true\n\t}),\n\n\t/**\n\t * Max of an array of numbers\n\t */\n\tmax: $.extend(function(array) {\n\t\treturn Math.max(...$u.numbers(array, arguments));\n\t}, {\n\t\tisAggregate: true\n\t}),\n\n\tatan2: $.extend((dividend, divisor) => Math.atan2(dividend, divisor), {\n\t\tmultiValued: true,\n\t\trightUnary: b => b,\n\t\tdefault: 1\n\t}),\n\n\tpow: $.extend((base, exponent) => Math.pow(base, exponent), {\n\t\tmultiValued: true,\n\t\tdefault: 1\n\t}),\n\n\timul: $.extend((a, b) => Math.imul(a, b), {\n\t\tmultiValued: true,\n\t\tdefault: 1\n\t}),\n\n\tcount: $.extend(function(array) {\n\t\treturn Mavo.toArray(array).filter(a => !empty(a)).length;\n\t}, {\n\t\tisAggregate: true\n\t}),\n\n\treverse: function(array) {\n\t\treturn Mavo.toArray(array).slice().reverse();\n\t},\n\n\tround: $.extend((num, decimals) => {\n\t\tif (not(num) || not(decimals) || !isFinite(num)) {\n\t\t\treturn Math.round(num);\n\t\t}\n\n\t\treturn +(+num).toLocaleString(\"en-US\", {\n\t\t\tuseGrouping: false,\n\t\t\tmaximumFractionDigits: decimals\n\t\t});\n\t}, {\n\t\tmultiValued: true,\n\t\trightUnary: b => b,\n\t\tdefault: 0\n\t}),\n\n\tordinal: $.extend((num) => {\n\t\tif (empty(num)) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (num < 10 || num > 20) {\n\t\t\tvar ord = [\"th\", \"st\", \"nd\", \"rd\", \"th\"][num % 10];\n\t\t}\n\n\t\treturn ord || \"th\";\n\t}, {\n\t\tmultiValued: true,\n\t\talias: \"th\"\n\t}),\n\n\tdigits: $.extend((digits, decimals, num) => {\n\t\tif (num === undefined) {\n\t\t\tnum = decimals;\n\t\t\tdecimals = undefined;\n\t\t}\n\n\t\tif (isNaN(num)) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar parts = (num + \"\").split(\".\");\n\n\t\t// If it has more digits than n = digits, only keep the last n digits.\n\t\tparts[0] = parts[0].slice(-digits);\n\n\t\t// Chop extra decimals without rounding\n\t\tif (decimals !== undefined && parts[1]) {\n\t\t\tparts[1] = parts[1].slice(0, decimals);\n\t\t}\n\n\t\tnum = +parts.join(\".\");\n\n\t\t// This is mainly for padding with zeroes, we've done the rest already\n\t\treturn num.toLocaleString(\"en\", {\n\t\t\tuseGrouping: false, // we want something that can be converted to a number again\n\t\t\tminimumIntegerDigits: digits,\n\t\t\tminimumFractionDigits: decimals,\n\t\t\tmaximumFractionDigits: decimals || 20\n\t\t});\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\tiff: function(condition, iftrue=condition, iffalse=null) {\n\t\tif (Array.isArray(condition)) {\n\t\t\treturn condition.map((c, i) => {\n\t\t\t\tvar ret = val(c)? iftrue : iffalse;\n\n\t\t\t\treturn Array.isArray(ret)? ret[Math.min(i, ret.length - 1)] : ret;\n\t\t\t});\n\t\t}\n\n\t\treturn val(condition)? iftrue : iffalse;\n\t},\n\n\tgroup: (...objects) => {\n\t\tif (objects.length === 0) {\n\t\t\treturn {};\n\t\t}\n\n\t\treturn Object.assign(...objects);\n\t},\n\tlist: (...items) => items.flat(),\n\n\t// FIXME if step=0 returns NaN\n\trandom: $.extend((min = 0, max = 100, step = 1) => {\n\t\tif (arguments.length == 1) {\n\t\t\tmax = min;\n\t\t\tmin = 0;\n\t\t}\n\n\t\tvar rand = Math.random();\n\t\tvar range = (max - min)  / step;\n\t\treturn Math.floor(rand * (range + 1)) * step + min;\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\trange: (a, b, step) => {\n\t\tif (step === undefined) {\n\t\t\tif (b === undefined) {\n\t\t\t\t[a, b] = [a >= 0? 1 : -1, a]\n\t\t\t}\n\n\t\t\tstep = a <= b? 1 : -1;\n\t\t}\n\n\t\tlet steps = Math.floor((b - a)/step + 1);\n\n\t\tif (steps <= 0 || !isFinite(steps)) {\n\t\t\treturn [a];\n\t\t}\n\n\t\tlet ret = [];\n\n\t\tfor (let i = 0, n = a; i++ < steps; n += step) {\n\t\t\tret.push(n);\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tshuffle: list => {\n\t\tif (Array.isArray(list)) {\n\t\t\t// Fisher-Yates shuffle\n\t\t\tvar ret = list.slice();\n\n\t\t\tfor (var i = ret.length - 1; i > 0; i--) {\n\t\t\t\tvar j = Math.floor(Math.random() * (i + 1));\n\t\t\t\t[ret[i], ret[j]] = [ret[j], ret[i]];\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t\telse {\n\t\t\treturn list;\n\t\t}\n\t},\n\n\t/*********************\n\t * String functions\n\t *********************/\n\n\t/**\n\t * Replace all occurences of a string with another string\n\t */\n\treplace: $.extend((haystack, needle, replacement = \"\", iterations = 1) => {\n\t\tif (Array.isArray(haystack)) {\n\t\t\treturn haystack.map(item => _.replace(item, needle, replacement));\n\t\t}\n\n\t\t// Simple string replacement\n\t\tvar needleRegex = RegExp(Mavo.escapeRegExp(needle), \"g\");\n\t\tvar ret = haystack, prev;\n\t\tvar counter = 0;\n\n\t\twhile (ret != prev && (counter++ < iterations)) {\n\t\t\tprev = ret;\n\t\t\tret = ret.replace(needleRegex, replacement);\n\t\t}\n\n\t\treturn ret;\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\tlen: $.extend(text => str(text).length, {\n\t\tmultiValued: true\n\t}),\n\n\t/**\n\t * Search if a group, collection, or primitive contains a string\n\t * @returns Boolean if a haystack AND needle of object or primitive are passed\n\t * @returns Array of booleans if either a haystack OR needle of array is passed\n\t */\n\tcontains: $.extend((haystack, needle) => {\n\t\tlet ret;\n\t\tlet haystackType = $.type(haystack);\n\n\t\tif ($.type(needle) === \"object\") {\n\t\t\treturn JSON.stringify(haystack).indexOf(JSON.stringify(needle)) >= 0;\n\t\t}\n\n\t\tif (haystackType === \"object\" || haystackType === \"array\") {\n\t\t\tfor (let property in haystack) {\n\t\t\t\tret = _.contains(haystack[property], needle);\n\n\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\tret = Mavo.Functions.or(ret);\n\t\t\t\t}\n\t\t\t\tif (ret) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\treturn _.search(haystack, needle) >= 0;\n\t\t}\n\n\t\treturn ret;\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\t/**\n\t * Case insensitive search\n\t */\n\tsearch: $.extend((haystack, needle) => {\n\t\thaystack = str(haystack);\n\t\tneedle = str(needle);\n\t\treturn haystack && needle? haystack.toLowerCase().indexOf(needle.toLowerCase()) : -1;\n\t}, {\n\t\tmultiValued: true,\n\t}),\n\n\tstarts: $.extend((haystack, needle) => _.search(str(haystack), str(needle)) === 0, {\n\t\tmultiValued: true,\n\t}),\n\n\tends: $.extend((haystack, needle) => {\n\t\t[haystack, needle] = [str(haystack), str(needle)];\n\n\t\tvar i = _.search(haystack, needle);\n\t\treturn  i > -1 && i === haystack.length - needle.length;\n\t}, {\n\t\tmultiValued: true,\n\t}),\n\n\tjoin: function(array, glue) {\n\t\treturn Mavo.toArray(array).filter(a => !empty(a)).join(str(glue));\n\t},\n\n\tidify: $.extend(readable => {\n\t\treturn str(readable)\n\t\t\t.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\") // Convert accented letters to ASCII\n\t\t\t.replace(/[^\\w\\s-]/g, \"\") // Remove remaining non-ASCII characters\n\t\t\t.trim().replace(/\\s+/g, \"-\") // Convert whitespace to hyphens\n\t\t\t.toLowerCase();\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\t// Convert an identifier to readable text that can be used as a label\n\treadable: $.extend(identifier => {\n\t\t// Is it camelCase?\n\t\treturn str(identifier)\n\t\t\t\t.replace(/([a-z])([A-Z])(?=[a-z])/g, ($0, $1, $2) => $1 + \" \" + $2.toLowerCase()) // camelCase?\n\t\t\t\t.replace(/([a-z0-9])[_\\/-](?=[a-z0-9])/g, \"$1 \") // Hyphen-separated / Underscore_separated?\n\t\t\t\t.replace(/^[a-z]/, $0 => $0.toUpperCase()); // Capitalize\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\tuppercase: $.extend(text => str(text).toUpperCase(), {\n\t\tmultiValued: true\n\t}),\n\tlowercase: $.extend(text => str(text).toLowerCase(), {\n\t\tmultiValued: true\n\t}),\n\n\tfrom: $.extend((haystack, needle) => _.between(haystack, needle), {\n\t\tmultiValued: true,\n\t}),\n\n\tfromlast: $.extend((haystack, needle) => _.between(haystack, needle, \"\", true), {\n\t\tmultiValued: true,\n\t}),\n\n\tto: $.extend((haystack, needle) => _.between(haystack, \"\", needle), {\n\t\tmultiValued: true,\n\t}),\n\n\ttofirst: $.extend((haystack, needle) => _.between(haystack, \"\", needle, true), {\n\t\tmultiValued: true,\n\t}),\n\n\tbetween: $.extend((haystack, from, to, tight) => {\n\t\t[haystack, from, to] = [str(haystack), str(from), str(to)];\n\n\t\tvar i1 = from? haystack[tight? \"lastIndexOf\" : \"indexOf\"](from) : -1;\n\t\tvar i2 = haystack[tight? \"indexOf\" : \"lastIndexOf\"](to);\n\n\t\tif (from && i1 === -1 || i2 === -1) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn haystack.slice(i1 + 1, i2 === -1 || !to? haystack.length : i2);\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\tphrase: $.extend(function(id, vars, lang) {\n\t\tif (arguments.length === 3 && $.type(vars) === \"string\") {\n\t\t\t[lang, vars] = [vars];\n\t\t}\n\n\t\tvar locale = lang? Mavo.Locale.get(lang) : (this?.[Mavo.mavo]?.locale ?? Mavo.Locale.default);\n\n\t\treturn locale.phrase(id, vars);\n\t}, {\n\t\tneedsContext: true\n\t}),\n\n\tfilename: $.extend(url => new URL(str(url), Mavo.base).pathname.match(/[^/]+?$/)?.[0], {\n\t\tmultiValued: true\n\t}),\n\n\tjson: data => Mavo.safeToJSON(data),\n\n\tsplit: $.extend((text, separator = /\\s+/) => {\n\t\tif (!text) {\n\t\t\treturn [];\n\t\t}\n\n\t\ttext = str(text);\n\n\t\treturn text.split(separator);\n\t}, {\n\t\tmultiValued: true\n\t}),\n\n\t// Log to the console and return\n\tlog: (...args) => {\n\t\tconsole.log(...args.map(val));\n\t\treturn args[0];\n\t},\n\n\t// Other special variables (some updated via events)\n\t$mouse: {x: 0, y: 0},\n\n\tget $hash() {\n\t\treturn location.hash.slice(1);\n\t},\n\n\tget $alt() {\n\t\treturn _.$evt? _.$evt.altKey : false;\n\t},\n\n\tget $ctrl() {\n\t\treturn _.$evt? _.$evt.ctrlKey : false;\n\t},\n\n\tget $shift() {\n\t\treturn _.$evt? _.$evt.shiftKey : false;\n\t},\n\n\tget $cmd() {\n\t\treturn _.$evt? _.$evt[Mavo.superKey] : false;\n\t},\n\n\t// \"Private\" helpers\n\tutil: {\n\t\tnumbers: function(array, args) {\n\t\t\tarray = Array.isArray(array)? array : (args? $$(args) : [array]);\n\n\t\t\treturn array.filter(number => !isNaN(number) && val(number) !== \"\" && val(number) !== null).map(n => +n);\n\t\t},\n\n\t\t// Implement function metadata\n\t\tpostProcess: function(callback) {\n\t\t\tvar multiValued = callback.multiValued;\n\t\t\tvar newCallback;\n\n\t\t\tif (multiValued === true || multiValued?.length === 2) {\n\t\t\t\tnewCallback = (...args) => {\n\t\t\t\t\t// Define index of multiValued arguments\n\t\t\t\t\t// Fallback to first 2 arguments if not explicitly defined\n\t\t\t\t\tvar idxA = multiValued[0] || 0;\n\t\t\t\t\tvar idxB = multiValued[1] || 1;\n\n\t\t\t\t\treturn Mavo.Script.binaryOperation(args[idxA], args[idxB], {\n\t\t\t\t\t\tscalar: (a, b) => {\n\t\t\t\t\t\t\t// Replace multiValued argument with its individual elements\n\t\t\t\t\t\t\tif (idxA in args) {\n\t\t\t\t\t\t\t\targs[idxA] = a;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (idxB in args) {\n\t\t\t\t\t\t\t\targs[idxB] = b;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn callback(...args);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t...callback\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t}\n\t\t\telse if (callback.isAggregate) {\n\t\t\t\tnewCallback = function(array) {\n\t\t\t\t\tif (Mavo.in(Mavo.groupedBy, array)) { // grouped structures\n\t\t\t\t\t\treturn array.map(e => newCallback(e.$items));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar ret = callback.call(this, ...arguments);\n\n\t\t\t\t\treturn ret === undefined? array : ret;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (newCallback) {\n\t\t\t\t// Preserve function metadata\n\t\t\t\t$.extend(newCallback, callback);\n\t\t\t\tnewCallback.original = callback;\n\t\t\t}\n\n\t\t\tif (callback.alias) {\n\t\t\t\tfor (let alias of Mavo.toArray(callback.alias)) {\n\t\t\t\t\tMavo.Functions[alias] = newCallback || callback;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn newCallback;\n\t\t}\n\t}\n};\n\nvar $u = _.util;\n\n/**\n * After plugins are loaded, enable\n * multi-valued arguments of Mavo and Math functions\n */\nMavo.ready.then(() => {\n\tObject.getOwnPropertyNames(Mavo.Functions).forEach(property => {\n\t\tvar newCallback = $u.postProcess(Mavo.Functions[property]);\n\n\t\tif (newCallback) {\n\t\t\tMavo.Functions[property] = newCallback;\n\t\t}\n\t});\n\n\t// Deal with Math functions that have 1 argument\n\tObject.getOwnPropertyNames(Math).forEach(property => {\n\t\tif (Math[property].length === 1 && !Mavo.Functions.hasOwnProperty(property)) {\n\t\t\tMavo.Functions[property] = operand => Mavo.Script.unaryOperation(operand, operand => Math[property](operand));\n\t\t}\n\t});\n});\n\n/**\n * Private helper methods\n */\n\n// Convert argument to string\nfunction str(str = \"\") {\n\tstr = val(str);\n\treturn !str && str !== 0? \"\" : str + \"\";\n}\n\nfunction empty(v) {\n\tv = Mavo.value(v);\n\treturn v === null || v === false || v === \"\";\n}\n\nfunction not(v) {\n\treturn !val(v);\n}\n\n})(Bliss, Mavo.value);\n\n/**\n * Date Functions available inside Mavo expressions\n */\n\n(function($, val, _, $u = _.util) {\n\nvar s = {seconds: 1, minutes: 60};\ns.hours  = s.minutes * 60;\ns.days   = s.hours   * 24;\ns.weeks  = s.days    * 7;\ns.months = s.days    * 30.4368;\ns.years  = s.weeks   * 52;\n\nvar numeric = {\n\tyear: d => d.getFullYear(),\n\tmonth: d => d.getMonth() + 1,\n\tday: d => d.getDate(),\n\tweekday: d => d.getDay() || 7,\n\thour: d => d.getHours(),\n\tminute: d => d.getMinutes(),\n\tsecond: d => d.getSeconds(),\n\tms: d => d.getMilliseconds()\n};\n\n$.extend(_, {\n\tget $now() {\n\t\treturn new Date();\n\t},\n\n\t$startup: new Date(), // Like $now, but doesn't update\n\n\tget $today() {\n\t\treturn _.date(new Date());\n\t},\n\n\tyear: $.extend(function() {\n\t\treturn $u.dateComponent(\"year\", ...arguments);\n\t}, {multiValued: true}),\n\n\tmonth: $.extend(function() {\n\t\treturn $u.dateComponent(\"month\", ...arguments);\n\t}, {multiValued: true}),\n\n\tweek: () => s.weeks * 1000,\n\n\tday: $.extend(function() {\n\t\treturn $u.dateComponent(\"day\", ...arguments);\n\t}, {multiValued: true}),\n\n\tweekday: $.extend(function() {\n\t\treturn $u.dateComponent(\"weekday\", ...arguments);\n\t}, {multiValued: true}),\n\n\thour: $.extend(function() {\n\t\treturn $u.dateComponent(\"hour\", ...arguments);\n\t}, {multiValued: true}),\n\n\tminute: $.extend(function() {\n\t\treturn $u.dateComponent(\"minute\", ...arguments);\n\t}, {multiValued: true}),\n\n\tsecond: $.extend(function() {\n\t\treturn $u.dateComponent(\"second\", ...arguments);\n\t}, {multiValued: true}),\n\n\tms: $.extend(function() {\n\t\treturn $u.dateComponent(\"ms\", ...arguments);\n\t}, {multiValued: true}),\n\n\tdate: $.extend(date => {\n\t\tdate = $u.date(date);\n\n\t\treturn date? `${_.year(date)}-${_.month(date, \"00\")}-${_.day(date, \"00\")}` : \"\";\n\t}, {multiValued: true}),\n\n\ttime: $.extend((date, precision = \"seconds\") => {\n\t\tdate = $u.date(date);\n\n\t\tif (!date) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tvar ret = `${_.hour(date, \"00\")}:${precision == \"hours\"? \"00\" : _.minute(date, \"00\")}`;\n\n\t\tif (precision == \"seconds\" || precision == \"ms\") {\n\t\t\tret += `:${_.second(date, \"00\")}`;\n\n\t\t\tif (precision == \"ms\") {\n\t\t\t\tret += `.${_.ms(date)}`;\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t}, {multiValued: true}),\n\n\tlocalTimezone: -(new Date()).getTimezoneOffset(),\n});\n\n_.msTo = (what, ms) => Math.floor(Math.abs(ms) / (s[what] * 1000)) || 0;\n\nfor (let unit in s) {\n\t_[unit] = $.extend(function(ms) {\n\t\tif (arguments.length === 0) {\n\t\t\treturn s[unit] * 1000;\n\t\t}\n\n\t\treturn _.msTo(unit, ms);\n\t}, {multiValued: true});\n}\n\n_.duration = $.extend(function (ms, terms) {\n\tif (ms === 0 || terms === undefined) {\n\t\tterms = 1;\n\t}\n\n\tlet timeLeft = ms || 0;\n\tlet ret = [];\n\n\tif (ms < 1) {\n\t\tret = [\"0 ms\"];\n\t}\n\telse {\n\t\tlet units = [...Object.keys(s).reverse(), \"ms\"];\n\n\t\tfor (let i=0, unit; unit = units[i]; i++) {\n\t\t\t// get largest value of time unit for the remaining\n\t\t\t// time to account for\n\t\t\tlet unitMs = unit in s? s[unit] * 1000 : 1; // number of ms in 1 unit\n\t\t\tlet unitValue = Math.floor(timeLeft / unitMs); // quotient\n\t\t\ttimeLeft = timeLeft % unitMs; // remainder\n\n\t\t\tif (unitValue > 0 && ret.length < terms) {\n\t\t\t\tlet unitProperPlurality = unitValue === 1 && unit !== \"ms\" ? unit.slice(0, -1) : unit;\n\t\t\t\tret.push(unitValue + \" \" + _.phrase.call(this, unitProperPlurality));\n\t\t\t}\n\t\t\telse if (ret.length > 0) {\n\t\t\t\t// Discard any further terms to avoid non-continous terms like e.g. \"1 month, 10 ms\"\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn arguments.length === 1 ? ret[0] : ret;\n}, {\n\tneedsContext: true,\n\tmultiValued: true\n});\n\n$.extend(_.util, {\n\tfixDateString: function(date) {\n\t\tdate = date.trim();\n\n\t\tvar hasDate = /^\\d{4}-\\d{2}(-\\d{2})?/.test(date);\n\t\tvar hasTime = date.indexOf(\":\") > -1;\n\n\t\tif (!hasDate && !hasTime) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Fix up time format\n\t\tif (!hasDate) {\n\t\t\t// No date, add todays\n\t\t\tdate = _.$today + \" \" + date;\n\t\t}\n\t\telse {\n\t\t\t// Only year-month, add day\n\t\t\tdate = date.replace(/^(\\d{4}-\\d{2})(?!-\\d{2})/, \"$1-01\");\n\t\t}\n\n\t\tif (!hasTime) {\n\t\t\t// Add a time if one doesn't exist\n\t\t\tdate += \"T00:00:00\";\n\t\t}\n\t\telse {\n\t\t\t// Make sure time starts with T, due to Safari bug\n\t\t\tdate = date.replace(/\\-(\\d{2})\\s+(?=\\d{2}:)/, \"-$1T\");\n\t\t}\n\n\t\t// Remove all whitespace\n\t\tdate = date.replace(/\\s+/g, \"\");\n\n\t\treturn date;\n\t},\n\n\tdateComponent: function(component, date, format) {\n\t\tif (arguments.length === 1 && component + \"s\" in s) {\n\t\t\treturn _[component + \"s\"]();\n\t\t}\n\n\t\tvar dateO = $u.date(date);\n\n\t\tif (component === \"year\") {\n\t\t\t// Why +\"\"? We don't want years to be formatted like 2,017!\n\t\t\t// Why the .match()? For incomplete dates, see #226\n\t\t\tdate = date && date.match? date : date + \"\";\n\t\t\tvar ret = dateO? dateO.getFullYear() + \"\" : (date.match(/\\b[1-9]\\d\\d\\b|\\d+/) || [])[0];\n\t\t}\n\n\t\tif (!ret && !dateO) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tvar ret = ret || numeric[component](dateO);\n\n\t\tif (format) {\n\t\t\tif (/^0+$/.test(format)) {\n\t\t\t\t// Leading zeroes\n\t\t\t\treturn (ret + \"\").padStart(format.length, \"0\").slice(-format.length);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tformat = {name: \"long\", shortname: \"short\"}[format] || format;\n\t\t\t\tret = dateO.toLocaleString(Mavo.locale, {[component]: format});\n\t\t\t\tret = ret.replace(/\\u200e/g, \"\"); // Stupid Edge bug\n\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\n\t\treturn component === \"year\"? ret : +ret;\n\t},\n\n\tdate: function(date) {\n\t\tdate = val(date);\n\n\t\tif (!date) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar object = new Date(date);\n\n\t\t// Either arg is not string or is exactly the same as a re-serialization of it as a date\n\t\tif ($.type(date) !== \"string\" || !isNaN(object) && (object + \"\" == date)) {\n\t\t\treturn object;\n\t\t}\n\n\t\tdate = $u.fixDateString(date);\n\n\t\tif (date === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tvar timezone = date.match(/[+-]\\d{2}:?\\d{2}|Z$/)?.[0];\n\n\t\tif (timezone) {\n\t\t\t// parse as ISO format\n\t\t\tdate = new Date(date);\n\t\t}\n\t\telse {\n\t\t\t// construct date in local timezone\n\t\t\tvar fields = date.match(/\\d+/g);\n\n\t\t\tdate = new Date(\n\t\t\t\t// year, month, date,\n\t\t\t\tfields[0], (fields[1] || 1) - 1, fields[2] || 1,\n\t\t\t\t// hours, minutes, seconds, milliseconds,\n\t\t\t\tfields[3] || 0, fields[4] || 0, fields[5] || 0, fields[6] || 0\n\t\t\t);\n\t\t}\n\n\t\treturn isNaN(date)? null : date;\n\t}\n});\n\n})(Bliss, Mavo.value, Mavo.Functions);\n\n(function($, val, $u) {\n\nvar _ = Mavo.Script = {\n\t$fn: self.Proxy? new Proxy({[Symbol.unscopables]: {undefined: true}}, {\n\t\tget: (data, property) => {\n\t\t\tvar propertyL = property.toLowerCase(), ret;\n\n\t\t\t// Is this a data action function?\n\t\t\tif (propertyL in Mavo.Actions.Functions) {\n\t\t\t\tif (Mavo.Actions.running) {\n\t\t\t\t\tret = Mavo.Actions.Functions[propertyL];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tret = Mavo.Actions.nope;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Is this a Mavo function?\n\t\t\tif (ret === undefined) {\n\t\t\t\tif (propertyL in Mavo.Functions) {\n\t\t\t\t\tret = Mavo.Functions[propertyL];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Maybe it's a Math function?\n\t\t\t\t\tret = Math[property] || Math[propertyL];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\thas: (data, property) => {\n\t\t\tvar propertyL = property.toLowerCase();\n\n\t\t\treturn propertyL in Mavo.Functions || propertyL in Mavo.Actions.Functions\n\t\t\t\t   || property in Math || propertyL in Math;\n\t\t}\n\t}) : Mavo.Functions,\n\n\taddUnaryOperator: function(name, o) {\n\t\tif (o.symbol) {\n\t\t\t// Build map of symbols to function names for easy rewriting\n\t\t\tMavo.toArray(o.symbol).forEach(symbol => {\n\t\t\t\t_.unarySymbols[symbol] = name;\n\t\t\t\tjsep.addUnaryOp(symbol);\n\t\t\t});\n\t\t}\n\n\t\treturn operand => _.unaryOperation(operand, operand => o.scalar(val(operand)));\n\t},\n\n\tunaryOperation: function(operand, scalar) {\n\t\tif (Array.isArray(operand)) {\n\t\t\treturn operand.map(scalar);\n\t\t}\n\t\telse {\n\t\t\treturn scalar(operand);\n\t\t}\n\t},\n\n\tbinaryOperation: function(a, b, o = {}) {\n\t\to.scalar = typeof o === \"function\" ? o : o.scalar;\n\t\tvar result;\n\n\t\tif (Array.isArray(b)) {\n\t\t\tif (Array.isArray(a)) {\n\t\t\t\tresult = [];\n\t\t\t\tvar max = Math.max(a.length, b.length);\n\t\t\t\tvar leftUnary = o.leftUnary || o.unary;\n\t\t\t\tvar rightUnary = o.rightUnary || o.unary;\n\t\t\t\tvar leftDefault = o.leftDefault === undefined ? o.default : o.leftDefault;\n\t\t\t\tvar rightDefault = o.rightDefault === undefined ? o.default : o.rightDefault;\n\n\t\t\t\tfor (let i = 0; i < max; i++) {\n\t\t\t\t\tif (o.comparison && (a[i] === undefined || b[i] === undefined)) {\n\t\t\t\t\t\tresult[i] = o.default;\n\t\t\t\t\t}\n\t\t\t\t\telse if (a[i] === undefined) {\n\t\t\t\t\t\tresult[i] = rightUnary ? rightUnary(b[i]) : o.scalar(leftDefault, b[i]);\n\t\t\t\t\t}\n\t\t\t\t\telse if (b[i] === undefined) {\n\t\t\t\t\t\tresult[i] = leftUnary ? leftUnary(a[i]) : o.scalar(a[i], rightDefault);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tresult[i] = o.scalar(a[i], b[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tresult = b.map(n => o.scalar(a, n));\n\t\t\t}\n\t\t}\n\t\telse if (Array.isArray(a)) {\n\t\t\tresult = a.map(n => o.scalar(n, b));\n\t\t}\n\t\telse {\n\t\t\tresult = o.scalar(a, b);\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Extend a scalar operator to arrays, or arrays and scalars\n\t * The operation between arrays is applied element-wise.\n\t * The operation operation between a scalar and an array will result in\n\t * the operation being applied between the scalar and every array element.\n\t */\n\taddBinaryOperator: function(name, o) {\n\t\tif (o.symbol) {\n\t\t\t// Build map of symbols to function names for easy rewriting\n\t\t\tMavo.toArray(o.symbol).forEach(symbol => {\n\t\t\t\t_.symbols[symbol] = name;\n\n\t\t\t\tif (o.precedence) {\n\t\t\t\t\tjsep.addBinaryOp(symbol, o.precedence);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\to.default = o.default === undefined? 0 : o.default;\n\n\t\treturn o.code || function(...operands) {\n\t\t\tif (operands.length === 1) {\n\t\t\t\tif (Array.isArray(operands[0])) {\n\t\t\t\t\t// Operand is an array of operands, expand it out\n\t\t\t\t\toperands = [...operands[0]];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!o.raw) {\n\t\t\t\toperands = operands.map(val);\n\t\t\t}\n\n\t\t\tvar prev = o.comparison ? true : operands[0], result;\n\n\t\t\tfor (let i = 1; i < operands.length; i++) {\n\t\t\t\tlet a = o.comparison? operands[i - 1] : prev;\n\t\t\t\tlet b = operands[i];\n\n\t\t\t\tif (Array.isArray(b) && typeof o.default == \"number\") {\n\t\t\t\t\tb = $u.numbers(b);\n\t\t\t\t}\n\n\t\t\t\tvar result = _.binaryOperation(a, b, o);\n\n\t\t\t\tif (o.comparison) {\n\t\t\t\t\tprev = _.binaryOperation(prev, result, _.operators[\"and\"]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tprev = result;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn prev;\n\t\t};\n\t},\n\n\t/**\n\t * Mapping of operator symbols (strings) to function names (strings).\n\t * Populated via addOperator() and addLogicalOperator()\n\t */\n\tsymbols: {},\n\tunarySymbols: {},\n\n\tgetOperatorName: (op, unary) => _[unary? \"unarySymbols\" : \"symbols\"][op] || op,\n\n\tisComparisonOperator: (op) => {\n\t\t// decides if op, a string, is a comparison operator like < or <=\n\t\tif (op) {\n\t\t\tlet operatorDefinition = _.operators[_.symbols[op]];\n\t\t\treturn operatorDefinition && operatorDefinition.comparison;\n\t\t}\n\t},\n\n\t// Is this variable?\n\t// E.g. foo or foo.bar is not static whereas \"foo\" or bar() is\n\tisStatic: node => {\n\t\tif (node.type === \"Identifier\") {\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (let property of _.childProperties) {\n\t\t\tif (node[property] && property !== \"callee\") {\n\t\t\t\tif (!_.isStatic(node[property])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Operations for elements and scalars.\n\t * Operations between arrays happen element-wise.\n\t * Operations between a scalar and an array will result in the operation being performed between the scalar and every array element.\n\t * Ordered by precedence (higher to lower)\n\t * @param scalar {Function} The operation between two scalars\n\t * @param unary/leftUnary/rightUnary Custom versions of scalar for when there is only 1 operand.\n\t * @param precedence {Number}\n\t * @param symbol {String} The operator's symbol\n\t * @param default The operations default/identity element. Defaults to 0.\n\t *                There are also leftDefault and rightDefault options if needed.\n\t * @param export {Boolean} Whether to add the resulting function to Mavo.Functions. It will always be available on Mavo.Script.operators[name].code anyway. Default: true\n\t * @param code {Function} The full implementation of the operator (including handling for array operands), if one prefers to provide instead of have it be generated.\n\t * @param transformation {Function}\n\t * @param postFlattenTransformation {Function}\n\t * @param raw {Boolean} If true, do not use Mavo.value() on operands\n\t */\n\toperators: {\n\t\t\"not\": {\n\t\t\tsymbol: \"!\",\n\t\t\tscalar: a => !val(a)\n\t\t},\n\t\t\"multiply\": {\n\t\t\tscalar: (a, b) => a * b,\n\t\t\tdefault: 1,\n\t\t\tsymbol: \"*\"\n\t\t},\n\t\t\"divide\": {\n\t\t\tscalar: (a, b) => a / b,\n\t\t\trightUnary: b => b,\n\t\t\tdefault: 1,\n\t\t\tsymbol: \"/\"\n\t\t},\n\t\t\"addition\": {\n\t\t\tscalar: (a, b) => {\n\t\t\t\tif (isNaN(a) || isNaN(b)) {\n\t\t\t\t\t// Handle dates\n\t\t\t\t\tvar dateA = $u.date(a), dateB = $u.date(b);\n\n\t\t\t\t\tif (dateA || dateB) {\n\t\t\t\t\t\treturn +dateA + +dateB;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn +a + +b;\n\t\t\t},\n\t\t\tsymbol: \"+\"\n\t\t},\n\t\t\"plus\": {\n\t\t\tscalar: a => +a,\n\t\t\tsymbol: \"+\"\n\t\t},\n\t\t\"subtract\": {\n\t\t\tscalar: (a, b) => {\n\t\t\t\tif (isNaN(a) || isNaN(b)) {\n\t\t\t\t\t// Handle dates\n\t\t\t\t\tvar dateA = $u.date(a), dateB = $u.date(b);\n\n\t\t\t\t\tif (dateA && dateB) {\n\t\t\t\t\t\treturn dateA - dateB;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn a - b;\n\t\t\t},\n\t\t\tsymbol: \"-\"\n\t\t},\n\t\t\"minus\": {\n\t\t\tscalar: a => -a,\n\t\t\tsymbol: \"-\"\n\t\t},\n\t\t\"mod\": {\n\t\t\tscalar: (a, b) => {\n\t\t\t\tvar ret = a % b;\n\t\t\t\tret += ret < 0? b : 0;\n\t\t\t\treturn ret;\n\t\t\t},\n\t\t\tsymbol: \"mod\",\n\t\t\tprecedence: 10\n\t\t},\n\t\t\"lte\": {\n\t\t\tcomparison: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = _.getNumericalOperands(a, b);\n\t\t\t\treturn a <= b;\n\t\t\t},\n\t\t\tdefault: false,\n\t\t\tsymbol: \"<=\"\n\t\t},\n\t\t\"lt\": {\n\t\t\tcomparison: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = _.getNumericalOperands(a, b);\n\t\t\t\treturn a < b;\n\t\t\t},\n\t\t\tdefault: false,\n\t\t\tsymbol: \"<\"\n\t\t},\n\t\t\"gte\": {\n\t\t\tcomparison: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = _.getNumericalOperands(a, b);\n\t\t\t\treturn a >= b;\n\t\t\t},\n\t\t\tdefault: false,\n\t\t\tsymbol: \">=\"\n\t\t},\n\t\t\"gt\": {\n\t\t\tcomparison: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\t[a, b] = _.getNumericalOperands(a, b);\n\t\t\t\treturn a > b;\n\t\t\t},\n\t\t\tdefault: false,\n\t\t\tsymbol: \">\"\n\t\t},\n\t\t\"eq\": {\n\t\t\tcomparison: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\treturn a == b || Mavo.safeToJSON(a) === Mavo.safeToJSON(b);\n\t\t\t},\n\t\t\tsymbol: [\"=\", \"==\"],\n\t\t\tdefault: false,\n\t\t\tprecedence: 7 // to match other comparison operators in jsep\n\t\t},\n\t\t\"neq\": {\n\t\t\tcomparison: true,\n\t\t\tscalar: (a, b) => {\n\t\t\t\treturn a != b && Mavo.safeToJSON(a) !== Mavo.safeToJSON(b);\n\t\t\t},\n\t\t\tsymbol: [\"!=\"],\n\t\t\tdefault: true,\n\t\t\tprecedence: 7 // to match other comparison operators in jsep\n\t\t},\n\t\t\"and\": {\n\t\t\tscalar: (a, b) => a && b,\n\t\t\tdefault: false,\n\t\t\tsymbol: [\"&&\", \"and\"],\n\t\t\tprecedence: 2\n\t\t},\n\t\t\"or\": {\n\t\t\tscalar: (a, b) => a || b,\n\t\t\tdefault: false,\n\t\t\tsymbol: [\"||\", \"or\"],\n\t\t\tprecedence: 2\n\t\t},\n\t\t\"concatenate\": {\n\t\t\tsymbol: \"&\",\n\t\t\tdefault: \"\",\n\t\t\tscalar: (a, b) => \"\" + (a || \"\") + (b || \"\"),\n\t\t\tprecedence: 10\n\t\t},\n\t\t\"keyvalue\": {\n\t\t\tsymbol: \":\",\n\t\t\tcode: (...operands) => {\n\t\t\t\tvar i = operands.length - 1;\n\t\t\t\tvar value = operands[i];\n\n\t\t\t\twhile (i--) {\n\t\t\t\t\tvalue = {[operands[i]]: value};\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\t\t\ttransformation: node => {\n\t\t\t\t// Allow unquoted property names, just like JS\n\t\t\t\tif (node.left.type == \"Identifier\") {\n\t\t\t\t\tnode.left = {\n\t\t\t\t\t\ttype: \"Literal\",\n\t\t\t\t\t\tvalue: node.left.name,\n\t\t\t\t\t\traw: JSON.stringify(node.left.name)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t},\n\t\t\tprecedence: 4\n\t\t},\n\t\t\"filter\": {\n\t\t\tsymbol: \"where\",\n\t\t\tcode: (a, ...filters) => {\n\t\t\t\tfor (let b of filters) {\n\t\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\t\tif (Array.isArray(b)) {\n\t\t\t\t\t\t\ta = a.map((v, i) => val(b[i])? v : null);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tb = val(b);\n\n\t\t\t\t\t\t\tif (typeof b === \"boolean\") {\n\t\t\t\t\t\t\t\t// foo where true/false should equal foo/null respectively\n\t\t\t\t\t\t\t\ta = b? a : a.map(v => null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// foo where 5 should equal foo where foo = 5\n\t\t\t\t\t\t\t\ta = a.map(v => v == b? v : null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\ta = val(b)? a : null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn a;\n\t\t\t},\n\t\t\tprecedence: 1,\n\t\t\tpostFlattenTransformation: node => {\n\t\t\t\t// Scope all identifiers (likely properties) in the where clause to the thing we're filtering from.\n\t\t\t\t// For example, assume you have a list of people and a list of cats, both with names and ages.\n\t\t\t\t// Without this, cat where age > 3 would return nonsensical results\n\t\t\t\tvar object = node.arguments[0];\n\n\t\t\t\tfor (let i=1; i<node.arguments.length; i++) {\n\t\t\t\t\tif (!_.isStatic(node.arguments[i])) {\n\t\t\t\t\t\tnode.arguments[i] = Object.assign(_.parse(\"scope()\"), {\n\t\t\t\t\t\t\targuments: [\n\t\t\t\t\t\t\t\tobject,\n\t\t\t\t\t\t\t\tnode.arguments[i]\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"range\": {\n\t\t\tsymbol: \"..\",\n\t\t\tscalar: (a, b) => Mavo.Functions.range(a, b),\n\t\t\tprecedence: 2,\n\t\t\texport: false\n\t\t},\n\t\t\"has\": {\n\t\t\tsymbol: \"in\",\n\t\t\tcode: function(needle, ...haystacks) {\n\t\t\t\tvar ret;\n\t\t\t\thaystacks.map(b => {\n\t\t\t\t\tif (Array.isArray(b)) {\n\t\t\t\t\t\tvar op =  a => {\n\t\t\t\t\t\t\t// If object, comparison will fail because references. Must serialize first.\n\t\t\t\t\t\t\tvar fn = $.type(val(a)) === \"object\"? Mavo.safeToJSON : val;\n\n\t\t\t\t\t\t\treturn b.map(fn).indexOf(fn(a)) > -1;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\telse if ($.type(b) === \"object\") {\n\t\t\t\t\t\t// Mimic JS' in operator\n\t\t\t\t\t\tvar op = a => Mavo.in(val(a), b);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar op = a => Mavo.Functions.eq(a, b);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar result = Mavo.Script.unaryOperation(needle, op);\n\t\t\t\t\tret = ret === undefined? result : Mavo.Functions.and(result, ret);\n\t\t\t\t});\n\t\t\t\treturn ret;\n\t\t\t},\n\t\t\tprecedence: 3\n\t\t},\n\t\t\"groupby\": {\n\t\t\tsymbol: \"by\",\n\t\t\tcode: (array, key) => {\n\t\t\t\tarray = Mavo.toArray(array);\n\t\t\t\tkey = Mavo.toArray(key);\n\t\t\t\tvar property = key[Mavo.as] || key[0]?.[Mavo.toNode]?.property;\n\t\t\t\tvar groups = new Mavo.BucketMap({arrays: true});\n\t\t\t\tvar ret = [];\n\t\t\t\tret[Mavo.groupedBy] = true;\n\n\t\t\t\tarray.forEach((item, i) => {\n\t\t\t\t\tlet k = i < key.length ? Mavo.value(key[i]) : null;\n\t\t\t\t\tgroups.set(k, item);\n\t\t\t\t});\n\n\t\t\t\tif (Mavo.in(Mavo.route, array)) {\n\t\t\t\t\tret[Mavo.route] = Object.assign({}, array[Mavo.route]);\n\t\t\t\t}\n\n\t\t\t\tgroups.forEach((items, value) => {\n\t\t\t\t\tvar obj = {\n\t\t\t\t\t\t$value: value,\n\t\t\t\t\t\t[property || \"$value\"]: value,\n\t\t\t\t\t\t$items: items\n\t\t\t\t\t};\n\n\t\t\t\t\tif (Mavo.in(Mavo.route, array)) {\n\t\t\t\t\t\titems[Mavo.route] = obj[Mavo.route] = Object.assign({}, array[Mavo.route]);\n\t\t\t\t\t\tobj[Mavo.route] = $.each(items[Mavo.route], (p, v) => new Set([\"$items\"]));\n\t\t\t\t\t}\n\n\t\t\t\t\tret.push(obj);\n\t\t\t\t});\n\n\t\t\t\treturn Mavo.Data.proxify(ret);\n\t\t\t},\n\t\t\tprecedence: 2\n\t\t},\n\t\t\"as\": {\n\t\t\tsymbol: \"as\",\n\t\t\tcode: (property, name) => {\n\t\t\t\tif (property !== undefined && $.type(property) === \"array\" && name !== undefined) {\n\t\t\t\t\tvar ret = property.slice();\n\n\t\t\t\t\tif (!Array.isArray(name) && name?.[Mavo.toNode]?.property !== undefined) {\n\t\t\t\t\t\tret[Mavo.as] = name?.[Mavo.toNode]?.property;\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($.type(name) === \"string\") {\n\t\t\t\t\t\tret[Mavo.as] = name;\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (name[0]?.[Mavo.toNode]?.property !== undefined) {\n\t\t\t\t\t\tret[Mavo.as] = name[0]?.[Mavo.toNode]?.property;\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn property;\n\t\t\t\t}\n\t\t\t\treturn property;\n\t\t\t},\n\t\t\tprecedence: 3\n\t\t},\n\t},\n\n\tgetNumericalOperands: function(a, b) {\n\t\tif (isNaN(a) || isNaN(b)) {\n\t\t\t// Try comparing as dates\n\t\t\tvar da = $u.date(a), db = $u.date(b);\n\n\t\t\tif (da && db) {\n\t\t\t\t// Both valid dates\n\t\t\t\treturn [da, db];\n\t\t\t}\n\t\t}\n\n\t\treturn [a, b];\n\t},\n\n\tchildProperties: [\n\t\t\"arguments\", \"callee\", // CallExpression\n\t\t\"left\", \"right\", // BinaryExpression, LogicalExpression\n\t\t\"argument\", // UnaryExpression\n\t\t\"elements\", // ArrayExpression\n\t\t\"test\", \"consequent\", \"alternate\", // ConditionalExpression\n\t\t\"object\",  \"property\", // MemberExpression\n\t\t\"body\"\n\t],\n\n\t/**\n\t * Recursively execute a callback on this node and all its children\n\t * Caveat: For CallExpression arguments, it will call callback with an array\n\t * callback needs to take care of iterating over the array\n\t */\n\twalk: function(node, callback, o = {}, property, parent) {\n\t\tif (!o.type || node.type === o.type) {\n\t\t\tvar ret = callback(node, property, parent);\n\t\t}\n\n\t\tif (!o.ignore || o.ignore.indexOf(node.type) === -1) {\n\t\t\tif (Array.isArray(node)) {\n\t\t\t\tfor (let n of node) {\n\t\t\t\t\t_.walk(n, callback, o, property, node);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_.childProperties.forEach(property => {\n\t\t\t\t\tif (node[property]) {\n\t\t\t\t\t\t_.walk(node[property], callback, o, property, node);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (ret !== undefined && parent) {\n\t\t\t// Apply transformations after walking, otherwise it may recurse infinitely\n\t\t\tparent[property] = ret;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\t/**\n\t * These serializers transform the AST into JS\n\t */\n\tserializers: {\n\t\t\"BinaryExpression\": node => `${_.serialize(node.left, node)} ${node.operator} ${_.serialize(node.right, node)}`,\n\t\t\"UnaryExpression\": node => `${node.operator}${_.serialize(node.argument, node)}`,\n\t\t\"CallExpression\": node => {\n\t\t\tvar callee = node.callee;\n\t\t\tlet root = node.callee;\n\t\t\tlet parent = node;\n\t\t\tlet prop = \"callee\";\n\n\t\t\t// Find left-most member\n\t\t\twhile (root.type === \"MemberExpression\") {\n\t\t\t\tparent = root;\n\t\t\t\troot = root.object;\n\t\t\t\tprop = \"object\";\n\t\t\t}\n\n\t\t\tif (node.callee.type === \"MemberExpression\") {\n\t\t\t\tif (node.callee.property.type === \"Identifier\" && node.callee.property.name === \"call\") {\n\t\t\t\t\tcallee = node.callee.object;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (root.type === \"Identifier\") {\n\t\t\t\t// Clashes with native prototype methods? If so, look first in Function trap\n\t\t\t\tvar name = root.name;\n\n\t\t\t\tif (name === \"scope\") {\n\t\t\t\t\treturn _.serializeScopeCall(node.arguments);\n\t\t\t\t}\n\t\t\t\telse if (name in Mavo.Script.$fn) {\n\t\t\t\t\tparent[prop] = {\n\t\t\t\t\t\ttype: \"MemberExpression\",\n\t\t\t\t\t\tcomputed: false,\n\t\t\t\t\t\tobject: {type: \"Identifier\", name: \"$fn\"},\n\t\t\t\t\t\tproperty: root\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar nameSerialized = _.serialize(node.callee, node);\n\t\t\tvar argsSerialized = node.arguments.map(n => _.serialize(n, node));\n\t\t\treturn `${nameSerialized}(${argsSerialized.join(\", \")})`;\n\t\t},\n\t\t\"ConditionalExpression\": node => `${_.serialize(node.test, node)}? ${_.serialize(node.consequent, node)} : ${_.serialize(node.alternate, node)}`,\n\t\t\"MemberExpression\": (node, parent) => {\n\t\t\tlet n = node, pn, callee;\n\n\t\t\tdo {\n\t\t\t\tif (n.type === \"CallExpression\" && n.callee === pn) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tpn = n;\n\t\t\t} while (n = n.parent);\n\n\t\t\tif (n) { // Use plain serialization for foo.bar.baz()\n\t\t\t\tvar property = node.computed? `[${_.serialize(node.property, node)}]` : `.${node.property.name}`;\n\t\t\t\treturn `${_.serialize(node.object, node)}${property}`;\n\t\t\t}\n\n\t\t\tvar property = node.computed? _.serialize(node.property, node) : `\"${node.property.name}\"`;\n\t\t\treturn `$fn.get(${_.serialize(node.object, node)}, ${property})`;\n\t\t},\n\t\t\"ArrayExpression\": node => `[${node.elements.map(n => _.serialize(n, node)).join(\", \")}]`,\n\t\t\"Literal\": node => node.raw.replace(/\\r/g, \"\\\\r\").replace(/\\n/g, \"\\\\n\"),\n\t\t\"Identifier\": node => node.name,\n\t\t\"ThisExpression\": node => \"this\",\n\t\t\"Compound\": node => node.body.map(n => _.serialize(n, node)).join(\", \")\n\t},\n\n\t/**\n\t * These are run before the serializers and transform the expression to support MavoScript\n\t */\n\ttransformations: {\n\t\t\"BinaryExpression\": node => {\n\t\t\tlet name = _.getOperatorName(node.operator);\n\t\t\tlet def = _.operators[name];\n\n\t\t\t// Operator-specific transformations\n\t\t\tdef.transformation?.(node);\n\n\t\t\tvar nodeLeft = node;\n\t\t\tvar ret = {\n\t\t\t\ttype: \"CallExpression\",\n\t\t\t\targuments: [],\n\t\t\t\tcallee: {type: \"Identifier\", name}\n\t\t\t};\n\n\t\t\tif (def.comparison) {\n\t\t\t\t// Flatten comparison operator calls. If all comparison\n\t\t\t\t// operators are the same, flatten into one call (to maintain\n\t\t\t\t// simplicity of output):\n\t\t\t\t// 3 < 4 < 5 becomes lt(3, 4, 5).\n\t\t\t\t// Otherwise, assemble an argument list like so:\n\t\t\t\t// 3 < 4 = 5 becomes compare(3, \"lt\", 4, \"eq\", 5).\n\n\t\t\t\t// Create list of {comparison, operand} objects\n\t\t\t\tlet comparisonOperands = [];\n\t\t\t\tdo {\n\t\t\t\t\tlet operatorName = _.getOperatorName(nodeLeft.operator); // e.g. \"lt\"\n\t\t\t\t\tcomparisonOperands.unshift({\n\t\t\t\t\t\tcomparison: operatorName,\n\t\t\t\t\t\toperand: nodeLeft.right\n\t\t\t\t\t});\n\t\t\t\t\tnodeLeft = nodeLeft.left;\n\t\t\t\t} while (def.flatten !== false && _.isComparisonOperator(nodeLeft.operator));\n\n\t\t\t\t// Determine if all comparison operators are the same\n\t\t\t\tlet comparisonsHeterogeneous = false;\n\t\t\t\tfor (let i = 0; i < comparisonOperands.length - 1; i++) {\n\t\t\t\t\tif (comparisonOperands[i].comparison != comparisonOperands[i+1].comparison) {\n\t\t\t\t\t\tcomparisonsHeterogeneous = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Assemble final callee and argument list\n\t\t\t\tret.arguments.push(nodeLeft); // first operand\n\t\t\t\tif (comparisonsHeterogeneous) {\n\t\t\t\t\tret.callee.name = \"compare\";\n\t\t\t\t\tcomparisonOperands.forEach(co => {\n\t\t\t\t\t\tret.arguments.push({\n\t\t\t\t\t\t\ttype: \"Literal\",\n\t\t\t\t\t\t\tvalue: co.comparison,\n\t\t\t\t\t\t\traw: `\"${co.comparison}\"`,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tret.arguments.push(co.operand);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcomparisonOperands.forEach(co => {\n\t\t\t\t\t\tret.arguments.push(co.operand);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Flatten same operator calls\n\t\t\t\tdo {\n\t\t\t\t\tret.arguments.unshift(nodeLeft.right);\n\t\t\t\t\tnodeLeft = nodeLeft.left;\n\t\t\t\t} while (def.flatten !== false && _.getOperatorName(nodeLeft.operator) === name);\n\n\t\t\t\tret.arguments.unshift(nodeLeft);\n\t\t\t}\n\n\t\t\t// Operator-specific transformations\n\t\t\tdef.postFlattenTransformation?.(ret);\n\n\t\t\treturn ret;\n\t\t},\n\t\t\"UnaryExpression\": node => {\n\t\t\tvar name = _.getOperatorName(node.operator, true);\n\n\t\t\tif (name) {\n\t\t\t\treturn {\n\t\t\t\t\ttype: \"CallExpression\",\n\t\t\t\t\targuments: [node.argument],\n\t\t\t\t\tcallee: {type: \"Identifier\", name}\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\t\t\"CallExpression\": node => {\n\t\t\tif (node.callee.type == \"Identifier\") {\n\t\t\t\tif (node.callee.name == \"if\") {\n\t\t\t\t\tnode.callee.name = \"iff\";\n\n\t\t\t\t\t// Traverse data actions inside if() and rewrite them to their *if() counterpart\n\t\t\t\t\tvar condition = node.arguments[0];\n\n\t\t\t\t\tfor (let i=1; i<node.arguments.length; i++) {\n\t\t\t\t\t\tif (i == 2) {\n\t\t\t\t\t\t\t// Else, negate condition\n\t\t\t\t\t\t\tcondition = _.parse(\"not()\");\n\t\t\t\t\t\t\tcondition.arguments.push(node.arguments[0]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_.walk(node.arguments[i], n => {\n\t\t\t\t\t\t\tvar name = n.callee.name;\n\n\t\t\t\t\t\t\tif (Mavo.Actions.Functions.hasOwnProperty(name) // is a data action\n\t\t\t\t\t\t\t    && !/if$/.test(name) // and not already the *if() version of itself\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tn.callee.name += \"if\";\n\n\t\t\t\t\t\t\t\t// Add condition as first argument of *if() function\n\t\t\t\t\t\t\t\tn.arguments.unshift(condition);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {type: \"CallExpression\"});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (node.callee.name == \"delete\") {\n\t\t\t\t\tnode.callee.name = \"clear\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar def = Mavo.Functions[node.callee.name];\n\n\t\t\t\t\tif (def && def.needsContext) {\n\t\t\t\t\t\t// Rewrite to funcName.call($this, ...args)\n\t\t\t\t\t\tnode.callee = {\n\t\t\t\t\t\t\ttype: \"MemberExpression\",\n\t\t\t\t\t\t\tcomputed: false,\n\t\t\t\t\t\t\tobject: node.callee,\n\t\t\t\t\t\t\tproperty: {type: \"Identifier\", name: \"call\"}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tnode.arguments.unshift({type: \"Identifier\", name: \"$this\"});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"ThisExpression\": node => {\n\t\t\treturn {type: \"Identifier\", name: \"$this\"};\n\t\t}\n\t},\n\n\tclosest (node, type) {\n\t\tlet n = node;\n\n\t\tdo {\n\t\t\tif (n.type === type) {\n\t\t\t\treturn n;\n\t\t\t}\n\t\t} while (n = n.parent);\n\n\t\treturn null;\n\t},\n\n\tserialize: (node, parent) => {\n\t\tif (typeof node === \"string\") {\n\t\t\treturn node; // already serialized\n\t\t}\n\n\t\tif (parent) {\n\t\t\tnode.parent = parent;\n\t\t}\n\n\t\tvar ret = _.transformations[node.type]?.(node, parent);\n\n\t\tif (typeof ret == \"object\" && ret?.type) {\n\t\t\tnode = ret;\n\t\t}\n\t\telse if (ret !== undefined) {\n\t\t\treturn ret;\n\t\t}\n\n\t\treturn _.serializers[node.type](node, parent);\n\t},\n\n\trewrite: function(code, o) {\n\t\tlet ast = _.parse(code);\n\n\t\tif (o) {\n\t\t\to.ast = ast;\n\t\t}\n\n\t\treturn _.serialize(ast);\n\t},\n\n\tcompile: function(code, o) {\n\t\tif (!/\\S/.test(code)) {\n\t\t\t// If code contains only whitespace, including in particular if\n\t\t\t// code is just the empty string, treat it as an expression that\n\t\t\t// evaluates to an empty string. This is consistent with\n\t\t\t// interpreting bare words as their corresponding strings.\n\t\t\treturn () => \"\";\n\t\t}\n\n\t\tcode = _.rewrite(code, o);\n\n\t\tcode = `with (Mavo.Data.stub)\n\twith (data || {}) {\n\t\tlet $fn = Mavo.Script.$fn;\n\t\treturn (${code});\n\t}`;\n\n\t\tif (o?.actions) {\n\t\t\t// Yes this is a horrible, horrible hack and Im truly ashamed.\n\t\t\t// If you understand the reasons and can think of a better way, be my guest!\n\t\t\tcode = `\nMavo.Actions._running = Mavo.Actions.running;\nMavo.Actions.running = true;\n${code}\nMavo.Actions.running = Mavo.Actions._running;`;\n\t\t}\n\n\t\treturn new Function(\"data\", code);\n\t},\n\n\tparse: self.jsep,\n\n\t// scope() rewriting\n\tserializeScopeCall: (args) => {\n\t\tvar withCode = `with (Mavo.Script.subScope(scope, $this) || {}) { return (${_.serialize(args[1])}); }`;\n\t\treturn `(function() {\n\tvar scope = ${_.serialize(args[0])};\n\tif (Array.isArray(scope)) {\n\t\treturn scope.map(function(scope) {\n\t\t\t${withCode}\n\t\t});\n\t}\n\n\t${withCode}\n})()`;\n\t},\n\n\t// This is used for scope() rewriting, to support $this passing through\n\tsubScope: (proxy, $this) => {\n\t\tvar unscopables = Object.keys($this).reduce((o, k) => {\n\t\t\to[k] = true;\n\t\t\treturn o;\n\t\t}, {$this: true});\n\n\t\tif (!proxy || typeof proxy !== \"object\") {\n\t\t\treturn proxy;\n\t\t}\n\n\t\treturn new Proxy(proxy, {\n\t\t\tget: (t, property, r) => {\n\t\t\t\tif (property === Symbol.unscopables) {\n\t\t\t\t\treturn unscopables;\n\t\t\t\t}\n\n\t\t\t\treturn Reflect.get(t, property, r);\n\t\t\t}\n\t\t});\n\t}\n};\n\n_.serializers.LogicalExpression = _.serializers.BinaryExpression;\n_.transformations.LogicalExpression = _.transformations.BinaryExpression;\n\nfor (let name in _.operators) {\n\tlet details = _.operators[name];\n\n\tif (details.scalar?.length < 2) {\n\t\tvar ret = _.addUnaryOperator(name, details);\n\t}\n\telse {\n\t\tvar ret = _.addBinaryOperator(name, details);\n\t}\n\n\tdetails.code = details.code || ret;\n\n\tif (ret && details.export !== false) {\n\t\tMavo.Functions[name] = ret;\n\t}\n}\n\n// Takes a list of arguments that consist of interleaved operands and strings\n// representing comparison operations, and returns the result of evaluating the\n// chained comparison.\n// e.g. compare(3, \"lt\", 4, \"lt\", 5) means 3 < 4 < 5, or (3 < 4) && (4 < 5)\nMavo.Functions.compare = function(...operands) {\n\tlet result = true;\n\n\tfor (let i = 2; i < operands.length; i += 2) {\n\t\tlet a = operands[i - 2];\n\t\tlet op = operands[i - 1];\n\t\tlet b = operands[i];\n\t\tlet term = _.binaryOperation(a, b, Mavo.Script.operators[op]);\n\t\tresult = _.binaryOperation(result, term, Mavo.Script.operators[\"and\"]);\n\t}\n\n\treturn result;\n};\n\n})(Bliss, Mavo.value, Mavo.Functions.util);\n\n(function($, $$) {\n\nMavo.attributes.push(\"mv-action\");\n\nvar _ = Mavo.Actions = {\n\tlistener: evt => {\n\t\tvar tag = evt.type === \"submit\"? \"form\" : \":not(form)\";\n\t\tvar element = evt.target.closest(tag + \"[mv-action]\");\n\n\t\tif (!element) {\n\t\t\treturn; // Not an action\n\t\t}\n\n\t\tvar node = Mavo.Node.get(element);\n\n\t\tif (node && node.editing && node.modes !== \"edit\") {\n\t\t\t// If this is a node, and being edited (and supports other modes), we don't want to have the action interfering.\n\t\t\treturn;\n\t\t}\n\n\t\tif (evt.type === \"submit\") {\n\t\t\tevt.preventDefault();\n\t\t}\n\n\t\tif (element) {\n\t\t\t_.run(element.getAttribute(\"mv-action\"), element, evt);\n\t\t}\n\t},\n\n\trun: (code, element, evt) => {\n\t\tif (code) {\n\t\t\tvar node = Mavo.Node.getClosest(element);\n\n\t\t\tif (node) {\n\t\t\t\tvar expression = new Mavo.Expression(code, {actions: true});\n\n\t\t\t\tvar previousEvt = Mavo.Functions.$evt;\n\t\t\t\tMavo.Functions.$evt = evt;\n\n\t\t\t\tvar ret = expression.eval(node.getLiveData());\n\n\t\t\t\tMavo.Functions.$evt = previousEvt;\n\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tgetNodes: ref => {\n\t\tvar node = _.getNode(ref);\n\n\t\tif (node) {\n\t\t\treturn [node];\n\t\t}\n\n\t\treturn Mavo.toArray(ref).map(n => _.getNode(n)).filter(n => n !== undefined);\n\t},\n\n\tgetNode: node => {\n\t\tif (node instanceof Mavo.Node) {\n\t\t\treturn node;\n\t\t}\n\t\telse if (node?.[Mavo.toNode]) {\n\t\t\treturn node[Mavo.toNode];\n\t\t}\n\t},\n\n\tgetCollection: ref => {\n\t\tvar collection = _.getNode(ref);\n\n\t\tif (collection instanceof Mavo.Collection) {\n\t\t\treturn collection;\n\t\t}\n\n\t\t// ref is not a collection. Either it's an item or we don't have a collection\n\t\treturn collection?.collection ?? null;\n\t},\n\n\t// Function to run instead of actions if actions are called outside mv-action\n\tnope: () => {\n\t\tvar actions = Object.keys(_.Functions).map(name => `${name}()`);\n\t\tMavo.warn(`Mavo actions (${actions}) can only be used in the mv-action attribute.`);\n\t},\n\n\tFunctions: {\n\t\t/**\n\t\t * @param data (Optional) data of new item(s)\n\t\t * @param ref Collection to add to\n\t\t * @param index {Number} index of new item(s).\n\t\t * @returns Newly added item(s)\n\t\t */\n\t\tadd: function(data, ref, index) {\n\t\t\tif (arguments.length < 3) {\n\t\t\t\tif (arguments.length <= 1) {\n\t\t\t\t\t// add(ref) signature used\n\t\t\t\t\t[data, ref] = [undefined, data];\n\t\t\t\t}\n\t\t\t\telse if (arguments.length === 2) {\n\t\t\t\t\t// Is it (data, ref) or (ref, index)?\n\t\t\t\t\t// ref might be a number, if collection of numbers!\n\t\t\t\t\tvar collection = _.getCollection(ref);\n\n\t\t\t\t\tif (!collection) {\n\t\t\t\t\t\t// No collection from ref, must be (ref, index)\n\t\t\t\t\t\tcollection = _.getCollection(data);\n\n\t\t\t\t\t\tif (collection) {\n\t\t\t\t\t\t\t// Yup, it's (ref, index)\n\t\t\t\t\t\t\t[data, ref, index] = [undefined, data, ref];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!ref) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcollection = collection || _.getCollection(ref);\n\n\t\t\tif (!collection) {\n\t\t\t\tMavo.warn(\"No collection or collection item provided to add().\", {once: false});\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\tif (index === undefined) {\n\t\t\t\t// If there is no index and item provided instead of collection,\n\t\t\t\t// get index from collection item\n\t\t\t\tvar node = _.getNode(ref);\n\n\t\t\t\tif (node !== collection) {\n\t\t\t\t\tindex = node.index;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn (Array.isArray(data)? data : [data]).map(datum => {\n\t\t\t\tvar item = collection.add(undefined, index);\n\n\t\t\t\tif (datum !== undefined) {\n\t\t\t\t\titem.render(datum);\n\t\t\t\t}\n\n\t\t\t\tif (collection.editing) {\n\t\t\t\t\tcollection.editItem(item);\n\t\t\t\t}\n\n\t\t\t\treturn item.getLiveData();\n\t\t\t});\n\t\t},\n\n\t\t/**\n\t\t * @param from {Mavo.Node|Array<Mavo.Node>} one or more items to move\n\t\t * @param to where to move to, item or collection. Optional\n\t\t * @param index {Number} index. Optional\n\t\t * @returns Moved item(s)\n\t\t */\n\t\tmove: (from, to, index) => {\n\t\t\tif (!from || to === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ($.type(to) == \"number\" && !(toNode?.collection)) {\n\t\t\t\t// If to is a number and not a collection item, it's an index\n\t\t\t\t[index, to] = [to];\n\t\t\t}\n\n\t\t\tvar toNode = _.getNode(to);\n\t\t\tvar fromNodes = Mavo.toArray(from).map(_.getNode).filter(n => n?.closestCollection);\n\t\t\tvar collection = (toNode || fromNodes[0]).closestCollection;\n\n\t\t\tif (!fromNodes.length) {\n\t\t\t\tif (collection) {\n\t\t\t\t\tMavo.warn(\"First parameter of move() was not a collection or collection item, using add() instead.\", {once: false});\n\t\t\t\t\treturn _.Functions.add(from, collection, index);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tMavo.warn(\"You need to provide at least one collection or collection item for move() to have something to do.\", {once: false});\n\t\t\t\t\treturn from;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar ret = _.Functions.add(from, collection, index);\n\t\t\tMavo.Collection.delete(fromNodes, {silent: true});\n\t\t\treturn ret;\n\t\t},\n\n\t\t/**\n\t\t * @param ref Items to delete\n\t\t */\n\t\tclear: (...ref) => {\n\t\t\tif (!ref.length || !ref[0]) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar nodes = _.getNodes(ref.flat());\n\t\t\tvar itemsToDelete = [];\n\n\t\t\tnodes.forEach(node => {\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (node instanceof Mavo.Collection) {\n\t\t\t\t\t// Clear collection\n\t\t\t\t\titemsToDelete.push(...node.children);\n\t\t\t\t}\n\t\t\t\telse if (node.collection) {\n\t\t\t\t\t// Collection item, delete\n\t\t\t\t\titemsToDelete.push(node);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Ordinary node, just clear its data\n\t\t\t\t\tnode.walk(n => {\n\t\t\t\t\t\tif (n instanceof Mavo.Primitive) {\n\t\t\t\t\t\t\tn.value = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (n !== node) {\n\t\t\t\t\t\t\t_.clear(n);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tMavo.Collection.delete(itemsToDelete);\n\n\t\t\treturn nodes.map(n => n.getLiveData());\n\t\t},\n\n\t\tclearif: (condition, ...targets) => {\n\t\t\ttargets = targets.map(t => Mavo.Functions.iff(condition, t));\n\t\t\treturn _.Functions.clear(...targets);\n\t\t},\n\n\t\t/**\n\t\t * Set node(s) to value(s)\n\t\t * If ref is a single node or a collection, render values on it\n\t\t * If ref is multiple nodes, set it to corresponding value\n\t\t * If ref is multiple nodes and values is not an array, set all nodes to values\n\t\t */\n\t\tset: (ref, values) => {\n\t\t\tif (!ref) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar node = _.getNode(ref);\n\n\t\t\tif (node) {\n\t\t\t\t// Single node, render values on it\n\t\t\t\tnode.render(values);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar wasArray = Array.isArray(ref);\n\t\t\t\tvar nodes = _.getNodes(ref);\n\n\t\t\t\tif (!nodes.length) {\n\t\t\t\t\tMavo.warn(`The first parameter of set() needs to be one or more existing properties, ${Mavo.safeToJSON(ref)} is not.`);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tMavo.Script.binaryOperation(wasArray? nodes : nodes[0], values, {\n\t\t\t\t\t\tscalar: (node, value) => {\n\t\t\t\t\t\t\treturn node ? node.render(value) : null;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn values;\n\t\t}\n\t}\n};\n\n// Create *if() versions of data actions\nfor (let name in _.Functions) {\n\tlet nameif = name + \"if\";\n\n\tif (!(nameif in _.Functions)) {\n\t\t_.Functions[nameif] = (condition, target, ...rest) => {\n\t\t\ttarget = Mavo.Functions.iff(condition, target);\n\t\t\treturn Mavo.value(condition)? _.Functions[name](target, ...rest) : null;\n\t\t};\n\t}\n}\n\n_.Functions.deleteif = _.Functions.clearif;\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Data = $.Class(class Data {\n\tconstructor(node, data) {\n\t\tthis.node = node;\n\n\t\tif (data !== undefined) {\n\t\t\tthis.data = data;\n\t\t}\n\t}\n\n\tget parent() {\n\t\tvar parent = this.node.parent;\n\t\treturn parent?.liveData ?? null;\n\t}\n\n\tget collection() {\n\t\treturn this.node.collection;\n\t}\n\n\tget key() {\n\t\treturn this._key = this.collection? this.node.index : this.node.property;\n\t}\n\n\tproxify() {\n\t\treturn _.proxify(this.data);\n\t}\n\n\tupdate() {\n\t\tif (this.node instanceof Mavo.Collection || this.node instanceof Mavo.ImplicitCollection) {\n\t\t\t// TODO eventually we should do more granular updates than this O(N) stuff\n\t\t\tthis.data.length = 0;\n\n\t\t\tfor (var i=0; i<this.node.children.length; i++) {\n\t\t\t\tthis.data[i] = this.node.children[i].liveData.data;\n\t\t\t}\n\n\t\t\tif (this.node instanceof Mavo.ImplicitCollection) {\n\t\t\t\t// Implicit collections drop nulls\n\t\t\t\tMavo.filter(this.data, data => Mavo.value(data) !== null);\n\n\t\t\t\t// Implicit collections can alternate between arrays and singletons\n\t\t\t\t// depending on which items are null\n\t\t\t\tthis.updateParent();\n\t\t\t}\n\t\t}\n\t\telse if (this.node instanceof Mavo.Primitive) {\n\t\t\tvar value = this.node.value;\n\n\t\t\tif (this.node.isDataNull({live: true})) {\n\t\t\t\tvalue = null;\n\t\t\t}\n\n\t\t\tthis.data = Mavo.objectify(value);\n\n\t\t\tif (Mavo.isPlainObject(value) || Array.isArray(value)) {\n\t\t\t\t// Object rendered on a primitive, we should traverse it and store its properties\n\t\t\t\t// Why check prototype instead of just type == \"object\"? Because instances of ES6 classes also return \"object\"\n\t\t\t\t_.computeRoutes(this.data);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t_.computeMetadata(this.data, this.key, this.parent);\n\t\t\t}\n\n\t\t\tthis.updateParent();\n\t\t}\n\t}\n\n\tupdateParent() {\n\t\tif (!this.parent) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.node instanceof Mavo.ImplicitCollection) {\n\t\t\t// Is implicit collection\n\t\t\t// See https://github.com/LeaVerou/mavo/issues/50#issuecomment-266079652\n\t\t\tvar data = this.data.length === 1? this.data[0] : this.data;\n\t\t\tthis.parent.set(this.node.property, data, true);\n\t\t}\n\t\telse if (this.collection instanceof Mavo.ImplicitCollection) {\n\t\t\t// Is implicit collection *Item*\n\t\t\tthis.parent.update();\n\t\t}\n\t\telse {\n\t\t\tvar key = this.key, isDeleted = false;\n\n\t\t\tif (this.collection instanceof Mavo.Collection) {\n\t\t\t\t// Is collection item, check if deleted\n\t\t\t\tisDeleted = this.collection.children[this.node.index] !== this.node;\n\t\t\t}\n\n\t\t\tif (key !== undefined && !isDeleted) {\n\t\t\t\tthis.parent.set(key, this.data, true);\n\t\t\t}\n\t\t}\n\t}\n\n\tset(property, value, shallow) {\n\t\tthis.data[property] = value;\n\t\t_[\"computeRoute\" + (shallow? \"\" : \"s\")](value, property, this.data);\n\t}\n\n\tupdateKey() {\n\t\tvar oldKey = this._key;\n\n\t\tif (this.parent[oldKey] === this.data) {\n\t\t\tdelete this.parent[oldKey];\n\t\t}\n\n\t\tthis.updateParent();\n\t}\n\n\tresolve(property) {\n\t\treturn _.resolve(property, this.data);\n\t}\n}, {\n\tlive: {\n\t\tdata: function(data) {\n\t\t\tif (data !== this._data) {\n\t\t\t\tthis.isArray = Array.isArray(data);\n\n\t\t\t\tthis._data = data;\n\n\t\t\t\tdata[Mavo.toNode] = this.node;\n\t\t\t\tdata[Mavo.parent] = this.parent?.data;\n\t\t\t\tdata[Mavo.mavo] = this.node.mavo;\n\n\t\t\t\tthis.proxy = this.proxify();\n\n\t\t\t\tthis.updateParent();\n\n\t\t\t\treturn this._data;\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\t// The context for expression evaluation\n\t\tstub: self.Proxy? new Proxy({[Symbol.unscopables]: {data: true, undefined: true}}, {\n\t\t\tget: (data, property) => {\n\t\t\t\tvar ret = Reflect.get(data, property);\n\n\t\t\t\tif (ret !== undefined || typeof property !== \"string\") {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\n\t\t\t\tvar propertyL = property.toLowerCase();\n\n\t\t\t\tif (propertyL[0] === \"$\" && propertyL in Mavo.Functions) {\n\t\t\t\t\t// Non-data $specialProperty\n\t\t\t\t\treturn Mavo.Functions[propertyL];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar propertyU = property.toUpperCase();\n\t\t\t\t\tif (propertyU in Math) {\n\t\t\t\t\t\t// Math constants\n\t\t\t\t\t\treturn Math[propertyU];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Still not found? Maybe it's a global\n\t\t\t\tif (typeof window !== \"undefined\" && window.hasOwnProperty(property)) {\n\t\t\t\t\t// hasOwnProperty to avoid elements with ids clobbering globals\n\t\t\t\t\treturn window[property];\n\t\t\t\t}\n\n\t\t\t\t// Still not found? Maybe it's a special property used without a $ (see #343)\n\t\t\t\tif (property[0] !== \"$\") {\n\t\t\t\t\tvar $property = \"$\" + property.toLowerCase();\n\n\t\t\t\t\tif ($property in Mavo.Functions) {\n\t\t\t\t\t\treturn Mavo.Functions[$property];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Prevent undefined at all costs\n\t\t\t\treturn property;\n\t\t\t},\n\t\t\thas: (data, property) => {\n\t\t\t\treturn Reflect.has(data, property) || typeof property === \"string\";\n\t\t\t}\n\t\t}) : Mavo.Functions,\n\n\t\tisItem (data) {\n\t\t\treturn Array.isArray(data?.[Mavo.parent]);\n\t\t},\n\n\t\tclosest (obj, test) {\n\t\t\tvar path = [];\n\t\t\tdo {\n\t\t\t\tif (test(obj)) {\n\t\t\t\t\treturn {value: obj, path};\n\t\t\t\t}\n\n\t\t\t\tpath.push(obj[Mavo.property]);\n\t\t\t} while (obj = obj[Mavo.parent]);\n\n\t\t\treturn {value: null, path};\n\t\t},\n\n\t\troot (obj) {\n\t\t\treturn _.closest(obj, o => !o[Mavo.parent]);\n\t\t},\n\n\t\tclosestItem (obj) {\n\t\t\treturn _.closest(obj, _.isItem);\n\t\t},\n\n\t\tclosestArray(obj) {\n\t\t\treturn _.closest(obj, Array.isArray);\n\t\t},\n\n\t\tgetProperty (data) {\n\t\t\tvar ret = _.isItem(data)? data[Mavo.parent] : data;\n\n\t\t\treturn ret[Mavo.property];\n\t\t},\n\n\t\tfind (property, data, o = {}) {\n\t\t\tif (!data || o.exclude === data) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Mavo.in(property, data) && o.exclude !== data[property]) {\n\t\t\t\treturn data[property];\n\t\t\t}\n\n\t\t\tif (!data[Mavo.route] || !Mavo.in(property, data[Mavo.route])) {\n\t\t\t\tif (data[Mavo.property] === property) {\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\n\t\t\t\tif (_.isItem(data) && _.getProperty(data) === property) {\n\t\t\t\t\t// Inside collection items we want their property name\n\t\t\t\t\t// to return the current item, not the entire collection\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(data)) {\n\t\t\t\t\t// Perhaps it's an array of nodes, such as the one created with deep references?\n\t\t\t\t\tvar ret = data.map(a => _.find(property, a))\n\t\t\t\t\t              .filter(x => x !== undefined);\n\n\t\t\t\t\tif (ret.length) {\n\t\t\t\t\t\treturn ret.flat();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar results = [], returnArray = Array.isArray(data), ret;\n\n\t\t\tresults[Mavo.route] = {};\n\t\t\tresults[Mavo.mavo] = data[Mavo.mavo];\n\n\t\t\tvar findDown = prop => {\n\t\t\t\tvar ret = _.find(property, data[prop], o);\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t// FIXME How do we set a sensible Mavo.route when the returned array is empty?\n\t\t\t\t\t// E.g. because we were pointing to inner elements of a collection that currently has no items.\n\t\t\t\t\tif (Mavo.in(Mavo.route, ret)) {\n\t\t\t\t\t\tfor (var p in ret[Mavo.route]) {\n\t\t\t\t\t\t\tresults[Mavo.route][p] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\tresults.push(...ret);\n\t\t\t\t\t\treturnArray = true;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tresults.push(ret);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tif (Array.isArray(data) || data[Mavo.route][property] === true) {\n\t\t\t\tfor (var prop in data) {\n\t\t\t\t\tfindDown(prop);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdata[Mavo.route][property].forEach(findDown);\n\t\t\t}\n\n\t\t\treturn returnArray || results.length > 1? results : results[0];\n\t\t},\n\n\t\t// First look in descendants, then ancestors and their descendants\n\t\t// one level up at a time (excluding the subtree we've already explored)\n\t\tfindUp (property, data) {\n\t\t\tvar parent = data;\n\t\t\tvar child;\n\n\t\t\tdo {\n\t\t\t\tvar ret = _.find(property, parent, {exclude: child});\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\n\t\t\t\tif (_.getProperty(parent) === property) {\n\t\t\t\t\treturn parent;\n\t\t\t\t}\n\n\t\t\t\tchild = parent;\n\t\t\t\tparent = parent[Mavo.parent];\n\t\t\t} while (parent);\n\t\t},\n\n\t\tresolve (property, data) {\n\t\t\tif (property === Mavo.isProxy) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (typeof property === \"symbol\") {\n\t\t\t\t// We can't do much for symbols\n\t\t\t\treturn data[property];\n\t\t\t}\n\n\t\t\tvar ret;\n\t\t\tvar propertyIsNumeric = !isNaN(property);\n\n\t\t\tif (property in data) {\n\t\t\t\tret = data[property];\n\t\t\t}\n\t\t\telse if (!propertyIsNumeric) {\n\t\t\t\t// Property does not exist on data, if non-numeric, look for it elsewhere\n\t\t\t\tif (property in _.special) { // $special properties\n\t\t\t\t\tret = _.special[property](data);\n\t\t\t\t}\n\t\t\t\telse if (data[Mavo.mavo]) {\n\t\t\t\t\tvar all = data[Mavo.mavo].root.liveData.data[Mavo.route];\n\n\t\t\t\t\tif (Mavo.in(property, all)) {\n\t\t\t\t\t\tret = _.findUp(property, data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (Mavo.in(Mavo.route, data) && Mavo.in(property, data[Mavo.route])) {\n\t\t\t\t\tret = _.find(property, data);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!propertyIsNumeric) {\n\t\t\t\tvar propertyL = property.toLowerCase();\n\t\t\t}\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\t// Should we proxify value before returning it? Is it data?\n\t\t\t\tvar proxify = ret !== null && typeof ret === \"object\" // Can be a proxy\n\t\t\t\t              && (Mavo.route in ret || Mavo.toNode in ret); // Either has a route or comes from a node\n\n\t\t\t\treturn !proxify? ret : _.proxify(ret);\n\t\t\t}\n\n\t\t\tif (!propertyIsNumeric) {\n\t\t\t\t// Does it reference another Mavo?\n\t\t\t\tif (isNaN(property) && Mavo.all?.[property]?.root) {\n\t\t\t\t\treturn Mavo.all[property].root.getLiveData();\n\t\t\t\t}\n\n\t\t\t\t// Still not found? Maybe it's a special property used without a $ (see #343)\n\t\t\t\tif (property[0] !== \"$\") {\n\t\t\t\t\tvar $property = \"$\" + propertyL;\n\n\t\t\t\t\tif ($property in _.special) {\n\t\t\t\t\t\treturn _.resolve($property, data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\thas (property, data) {\n\t\t\t// We don't care about priority here, just whether they exist\n\t\t\t// so we'll make the fastest searches first.\n\t\t\tif (property === Mavo.isProxy) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (typeof property !== \"string\") {\n\t\t\t\treturn Reflect.has(data, property);\n\t\t\t}\n\n\t\t\tvar objects = [data, Mavo.all, _.special];\n\n\t\t\tif (objects.some(obj => property in obj)) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (typeof property === \"string\") {\n\t\t\t\tvar propertyL = property.toLowerCase();\n\n\t\t\t\tif (propertyL !== property && objects.some(obj => propertyL in obj)) {\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\tif (propertyL[0] !== \"$\" && \"$\" + propertyL in _.special) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Slowest search last: Is the property present anywhere in the data?\n\t\t\tif (data[Mavo.mavo]) {\n\t\t\t\treturn Mavo.in(property, data[Mavo.mavo].root.liveData.data[Mavo.route]);\n\t\t\t}\n\t\t},\n\n\t\tproxify (data) {\n\t\t\tif (!data || typeof data !== \"object\" || !self.Proxy || data[Mavo.isProxy]) {\n\t\t\t\t// Data is a primitive, proxies are not supported, or is already a proxy\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\treturn new Proxy(data, {\n\t\t\t\tget: (data, property, proxy) => {\n\t\t\t\t\treturn _.resolve(property, data);\n\t\t\t\t},\n\n\t\t\t\thas: (data, property) => {\n\t\t\t\t\treturn _.has(property, data);\n\t\t\t\t},\n\n\t\t\t\tset: function(data, property = \"\", value) {\n\t\t\t\t\tif (typeof property !== \"symbol\") {\n\t\t\t\t\t\tMavo.warn(`You cannot set data via expressions. Attempt to set ${property.toString()} to ${value} ignored.`);\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.set(data, property, value);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tcomputeMetadata (object, property, parent) {\n\t\t\tif (object && typeof object === \"object\") { // not primitive\n\t\t\t\tif (property !== undefined) {\n\t\t\t\t\tobject[Mavo.property] = property;\n\t\t\t\t}\n\n\t\t\t\tif (parent && !object[Mavo.parent]) {\n\t\t\t\t\tobject[Mavo.parent] = parent;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcomputeRoute (object, property, parent) {\n\t\t\tif (typeof object === \"function\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t_.computeMetadata(object, property, parent);\n\n\t\t\tif (Mavo.isPlainObject(object) === Object.prototype || Array.isArray(object)) {\n\t\t\t\tif (!object[Mavo.route]) {\n\t\t\t\t\tobject[Mavo.route] = {};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ($.type(property) !== \"number\") {\n\t\t\t\tvar child = object;\n\n\t\t\t\twhile (parent) {\n\t\t\t\t\tif (!parent[Mavo.route]) {\n\t\t\t\t\t\tparent[Mavo.route] = {};\n\t\t\t\t\t}\n\n\t\t\t\t\t// parent[up] = child\n\t\t\t\t\tvar up = child?.[Mavo.property];\n\n\t\t\t\t\tif (up && parent[Mavo.route][property] !== true) {\n\t\t\t\t\t\tif (!parent[Mavo.route][property]) {\n\t\t\t\t\t\t\tparent[Mavo.route][property] = new Set();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (parent[Mavo.route][property].has(up)) {\n\t\t\t\t\t\t\t// We've already computed routes on this subtree\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparent[Mavo.route][property].add(up);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tparent[Mavo.route][property] = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tchild = parent;\n\t\t\t\t\tparent = parent[Mavo.parent];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcomputeRoutes (object, property, parent) {\n\t\t\t_.traverse(_.computeRoute, object, property, parent);\n\t\t},\n\n\t\t// Recursively traverse a JSON structure\n\t\t// Warning: No cycle detection. Will loop infinitely if there are cycles\n\t\ttraverseDown (callback, object, property, parent) {\n\t\t\tif (Array.isArray(object)) {\n\t\t\t\tobject.forEach((item, i) => _.traverse(callback, item, i, object));\n\t\t\t}\n\t\t\telse if ($.type(object) === \"object\") {\n\t\t\t\tfor (var prop in object) {\n\t\t\t\t\t_.traverse(callback, object[prop], prop, object);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\ttraverse (callback, object, property, parent) {\n\t\t\tcallback(object, property, parent);\n\t\t\t_.traverseDown(callback, object, property, parent);\n\t\t},\n\n\t\tspecial: {\n\t\t\t$index: function(obj) {\n\t\t\t\tvar closestItem = _.closestItem(obj).value;\n\n\t\t\t\tif (!closestItem) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\n\t\t\t\tvar property = closestItem[Mavo.property];\n\n\t\t\t\tif (isNaN(property)) {\n\t\t\t\t\t// Is an array item but its property is not a number! Search the array.\n\t\t\t\t\t// This happens with Implicit Collections of only 1 item.\n\t\t\t\t\treturn closestItem[Mavo.parent].indexOf(closestItem);\n\t\t\t\t}\n\n\t\t\t\treturn property;\n\t\t\t},\n\n\t\t\t$item: function(obj) {\n\t\t\t\treturn _.closestItem(obj).value;\n\t\t\t},\n\n\t\t\t$all: function(obj) {\n\t\t\t\tvar arr = _.closestArray(obj);\n\t\t\t\tvar path = arr.path.reverse().slice(1); // Drop index\n\t\t\t\tvar ret = arr.value.map(a => $.value(a, ...path));\n\n\t\t\t\tif (ret.length > 0 && ret?.[0]?.[Mavo.route]) {\n\t\t\t\t\tret[Mavo.route] = $.each(ret[0][Mavo.route], (p, v) => true);\n\t\t\t\t\tret[Mavo.mavo] = ret[0][Mavo.mavo];\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\t$next: function(obj) {\n\t\t\t\tvar arr = _.closestArray(obj);\n\t\t\t\tvar path = arr.path.reverse();\n\t\t\t\tvar index = arr.path[0];\n\t\t\t\tpath = path.slice(1);\n\t\t\t\tvar nextClosestItem = arr.value?.[index + 1];\n\n\t\t\t\treturn nextClosestItem? $.value(nextClosestItem, ...path) : null;\n\t\t\t},\n\n\t\t\t$previous: function(obj) {\n\t\t\t\tvar arr = _.closestArray(obj);\n\t\t\t\tvar path = arr.path.reverse();\n\t\t\t\tvar index = arr.path[0];\n\t\t\t\tpath = path.slice(1);\n\t\t\t\tvar prevClosestItem = arr.value?.[index - 1];\n\n\t\t\t\treturn prevClosestItem? $.value(prevClosestItem, ...path) : null;\n\t\t\t},\n\n\t\t\t$this: function(obj) {\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Mavo.Backend.register($.Class({\n\textends: Mavo.Backend,\n\tid: \"Dropbox\",\n\tconstructor: function() {\n\t\tthis.permissions.on([\"login\", \"read\"]);\n\n\t\tthis.login(true);\n\t},\n\n\tupdate: function(url, o) {\n\t\tthis.super.update.call(this, url, o);\n\n\t\tthis.url = _.fixShareURL(this.url);\n\t},\n\n\tasync upload (file, path) {\n\t\tpath = this.path.replace(/[^/]+$/, \"\") + path;\n\n\t\tawait this.put(file, path);\n\t\treturn this.getURL(path);\n\t},\n\n\tasync getURL (path) {\n\t\tlet shareInfo = await this.request(\"sharing/create_shared_link_with_settings\", {path}, \"POST\");\n\t\treturn _.fixShareURL(shareInfo.url);\n\t},\n\n\t/**\n\t * Saves a file to the backend.\n\t * @param {Object} file - An object with name & data keys\n\t * @return {Promise} A promise that resolves when the file is saved.\n\t */\n\tput (serialized, path = this.path, o = {}) {\n\t\treturn this.request(\"https://content.dropboxapi.com/2/files/upload\", serialized, \"POST\", {\n\t\t\theaders: {\n\t\t\t\t\"Dropbox-API-Arg\": JSON.stringify({\n\t\t\t\t\tpath,\n\t\t\t\t\tmode: \"overwrite\"\n\t\t\t\t}),\n\t\t\t\t\"Content-Type\": \"application/octet-stream\"\n\t\t\t}\n\t\t});\n\t},\n\n\toAuthParams: () => `&redirect_uri=${encodeURIComponent(\"https://auth.mavo.io\")}&response_type=code`,\n\n\tasync getUser () {\n\t\tif (this.user) {\n\t\t\treturn this.user;\n\t\t}\n\n\t\tlet info = await this.request(\"users/get_current_account\", \"null\", \"POST\");\n\n\t\tthis.user = {\n\t\t\tusername: info.email,\n\t\t\tname: info.name.display_name,\n\t\t\tavatar: info.profile_photo_url,\n\t\t\tinfo\n\t\t};\n\n\t\t$.fire(this.mavo.element, \"mv-login\", { backend: this });\n\t},\n\n\tasync login (passive) {\n\t\tawait this.oAuthenticate(passive);\n\t\tawait this.getUser();\n\n\t\tif (this.user) {\n\t\t\tthis.permissions.logout = true;\n\n\t\t\t// Check if can actually edit the file\n\t\t\tlet info = await this.request(\"sharing/get_shared_link_metadata\", {\n\t\t\t\t\"url\": this.source\n\t\t\t}, \"POST\");\n\n\t\t\tthis.path = info.path_lower;\n\t\t\tthis.permissions.on([\"edit\", \"save\"]);\n\t\t}\n\t},\n\n\tlogout: function() {\n\t\treturn this.oAuthLogout();\n\t},\n\n\tstatic: {\n\t\tapiDomain: \"https://api.dropboxapi.com/2/\",\n\t\toAuth: \"https://www.dropbox.com/oauth2/authorize\",\n\t\tkey: \"2mx6061p054bpbp\",\n\n\t\ttest: function(url) {\n\t\t\turl = new URL(url, Mavo.base);\n\t\t\treturn /dropbox.com/.test(url.host);\n\t\t},\n\n\t\t// Transform the dropbox shared URL into something raw and CORS-enabled\n\t\tfixShareURL: url => {\n\t\t\turl = new URL(url, Mavo.base);\n\t\t\turl.hostname = \"dl.dropboxusercontent.com\";\n\t\t\turl.search = url.search.replace(/\\bdl=0|^$/, \"raw=1\");\n\t\t\treturn url;\n\t\t}\n\t}\n}));\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nlet _ = Mavo.Backend.register($.Class({\n\textends: Mavo.Backend,\n\tid: \"Github\",\n\tconstructor: function(url, o) {\n\t\tthis.permissions.on([\"login\", \"read\"]);\n\n\t\tthis.login(true);\n\t},\n\n\tupdate: function(url, o) {\n\t\tthis.super.update.call(this, url, o);\n\n\t\t// Extract info for username, repo, branch, filepath from URL\n\t\tlet extension = this.format.constructor.extensions[0] || \".json\";\n\n\t\tthis.defaults = {\n\t\t\trepo: \"mv-data\",\n\t\t\tfilename: `${this.mavo.id}${extension}`\n\t\t};\n\n\t\tthis.info = _.parseURL(this.source, this.defaults);\n\n\t\t// If an author provided backend metadata, use them\n\t\t// since they have higher priority\n\t\tfor (const prop in o) {\n\t\t\t// Skip the format and mavo properties\n\t\t\t// since they are already updated in the parent's update method\n\t\t\tif ([\"format\", \"mavo\"].includes(prop)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.info.apiCall === \"graphql\" && prop === \"query\") {\n\t\t\t\t// It makes sense to set/update the apiData property only for calls with GraphQL.\n\t\t\t\t// Otherwise, it will break the Github#get method.\n\t\t\t\tthis.info.apiData = { query: o.query };\n\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.info[prop] = o[prop];\n\t\t}\n\n\t\t$.extend(this, this.info);\n\t},\n\n\tget: async function(url) {\n\t\tif (this.isAuthenticated() || !this.path || url) {\n\t\t\t// Authenticated or raw API call\n\t\t\tlet info = url? _.parseURL(url) : this.info;\n\n\t\t\tif (info.apiData) {\n\t\t\t\t// GraphQL\n\t\t\t\treturn this.request(info.apiCall, info.apiData, \"POST\")\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tif (response.errors?.length) {\n\t\t\t\t\t\t\treturn Promise.reject(response.errors.map(x => x.message).join(\"\\n\"));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn response.data;\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.request(info.apiCall, {ref:this.branch}, \"GET\", {\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Accept\": \"application/vnd.github.squirrel-girl-preview\"\n\t\t\t\t\t}\n\t\t\t\t}).then(response => Promise.resolve(info.repo && response.content? _.atob(response.content) : response));\n\t\t}\n\t\telse {\n\t\t\t// Unauthenticated, use simple GET request to avoid rate limit\n\t\t\turl = new URL(`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch || \"main\"}/${this.path}`);\n\t\t\turl.searchParams.set(\"timestamp\", Date.now()); // ensure fresh copy\n\n\t\t\ttry {\n\t\t\t\tlet xhr = await $.fetch(url.href);\n\t\t\t\tthis.branch = this.branch || \"main\";\n\t\t\t\treturn xhr.responseText;\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tif (e.status === 404 && !this.branch) {\n\t\t\t\t\t// Possibly using older default branch \"master\", try again and store branch name\n\t\t\t\t\turl.pathname = `/${this.username}/${this.repo}/master/${this.path}`;\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet xhr = await $.fetch(url.href);\n\t\t\t\t\t\tthis.branch = \"master\";\n\t\t\t\t\t\treturn xhr.responseText;\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t},\n\n\tupload: function(file, path = this.path) {\n\t\treturn Mavo.readFile(file).then(dataURL => {\n\t\t\t\tlet base64 = dataURL.slice(5); // remove data:\n\t\t\t\tlet media = base64.match(/^\\w+\\/[\\w+]+/)[0];\n\t\t\t\tmedia = media.replace(\"+\", \"\\\\+\"); // Fix for #608\n\t\t\t\tbase64 = base64.replace(RegExp(`^${media}(;base64)?,`), \"\");\n\t\t\t\tpath = this.path.replace(/[^/]+$/, \"\") + path; // make upload path relative to existing path\n\n\t\t\t\treturn this.put(base64, path, {isEncoded: true});\n\t\t\t})\n\t\t\t.then(fileInfo => this.getURL(path, fileInfo.commit.sha));\n\t},\n\n\t/**\n\t * Saves a file to the backend.\n\t * @param {String} serialized - Serialized data\n\t * @param {String} path - Optional file path\n\t * @return {Promise} A promise that resolves when the file is saved.\n\t */\n\tput: function(serialized, path = this.path, o = {}) {\n\t\tif (!path) {\n\t\t\t// Raw API calls are read-only for now\n\t\t\treturn;\n\t\t}\n\n\t\tlet repoCall = `repos/${this.username}/${this.repo}`;\n\t\tlet fileCall = `${repoCall}/contents/${path}`;\n\t\tlet commitPrefix = this.mavo.element.getAttribute(\"mv-github-commit-prefix\") || \"\";\n\n\t\t// Create repo if it doesnt exist\n\t\tlet repoInfo = this.repoInfo?\n\t\t               Promise.resolve(this.repoInfo)\n\t\t             : this.request(\"user/repos\", {name: this.repo}, \"POST\").then(repoInfo => this.repoInfo = repoInfo);\n\n\t\tserialized = o.isEncoded? serialized : _.btoa(serialized);\n\n\t\treturn repoInfo.then(repoInfo => {\n\t\t\t\tif (!this.canPush()) {\n\t\t\t\t\t// Does not have permission to commit, create a fork\n\t\t\t\t\treturn this.request(`${repoCall}/forks`, {name: this.repo}, \"POST\")\n\t\t\t\t\t\t.then(forkInfo => {\n\t\t\t\t\t\t\tfileCall = `repos/${forkInfo.full_name}/contents/${path}`;\n\t\t\t\t\t\t\treturn this.forkInfo = forkInfo;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(forkInfo => {\n\t\t\t\t\t\t\t// Ensure that fork is created (they take a while)\n\t\t\t\t\t\t\tlet timeout;\n\t\t\t\t\t\t\tlet test = (resolve, reject) => {\n\t\t\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\t\t\tthis.request(`repos/${forkInfo.full_name}/commits`, {until: \"1970-01-01T00:00:00Z\"}, \"HEAD\")\n\t\t\t\t\t\t\t\t\t.then(x => {\n\t\t\t\t\t\t\t\t\t\tresolve(forkInfo);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch(x => {\n\t\t\t\t\t\t\t\t\t\t// Try again after 1 second\n\t\t\t\t\t\t\t\t\t\ttimeout = setTimeout(test, 1000);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treturn new Promise(test);\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn repoInfo;\n\t\t\t})\n\t\t\t.then(repoInfo => {\n\t\t\t\treturn this.request(fileCall, {\n\t\t\t\t\tref: this.branch\n\t\t\t\t}).then(fileInfo => this.request(fileCall, {\n\t\t\t\t\tmessage: commitPrefix + this.mavo._(\"gh-updated-file\", {name: fileInfo.name || \"file\"}),\n\t\t\t\t\tcontent: serialized,\n\t\t\t\t\tbranch: this.branch,\n\t\t\t\t\tsha: fileInfo.sha\n\t\t\t\t}, \"PUT\"), xhr => {\n\t\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t\t// File does not exist, create it\n\t\t\t\t\t\treturn this.request(fileCall, {\n\t\t\t\t\t\t\tmessage: commitPrefix + \"Created file\",\n\t\t\t\t\t\t\tcontent: serialized,\n\t\t\t\t\t\t\tbranch: this.branch\n\t\t\t\t\t\t}, \"PUT\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn xhr;\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(fileInfo => {\n\t\t\t\tconst env = {context: this, fileInfo};\n\n\t\t\t\tMavo.hooks.run(\"gh-after-commit\", env);\n\n\t\t\t\treturn env.fileInfo;\n\t\t\t});\n\t},\n\n\tlogin: function(passive) {\n\t\treturn this.oAuthenticate(passive)\n\t\t\t.then(() => this.getUser())\n\t\t\t.catch(xhr => {\n\t\t\t\tif (xhr.status == 401) {\n\t\t\t\t\t// Unauthorized. Access token we have is invalid, discard it\n\t\t\t\t\tthis.logout();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(u => {\n\t\t\t\tif (this.user) {\n\n\t\t\t\t\tthis.permissions.on(\"logout\");\n\n\t\t\t\t\tif (this.info.path) {\n\t\t\t\t\t\tthis.permissions.on([\"edit\", \"save\"]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.repo) {\n\t\t\t\t\t\treturn this.request(`repos/${this.username}/${this.repo}`)\n\t\t\t\t\t\t.then(repoInfo => {\n\t\t\t\t\t\t\tif (this.branch === undefined) {\n\t\t\t\t\t\t\t\tthis.branch = repoInfo.default_branch;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.repoInfo = repoInfo;\n\n\t\t\t\t\t\t\tif (!this.mavo.source) { // if url doesn't have source, check for forks\n\t\t\t\t\t\t\t\tif (!this.canPush()) { // Check if current user has a fork of this repo, and display dialog to switch\n\t\t\t\t\t\t\t\t\tif (this.user.info.public_repos < repoInfo.forks) { // graphql search of current user's forks\n\t\t\t\t\t\t\t\t\t\tlet query = `query {\n\t\t\t\t\t\t\t\t\t\t\t\t\t  viewer {\n\t\t\t\t\t\t\t\t\t\t\t\t\t    name\n\t\t\t\t\t\t\t\t\t\t\t\t\t      repositories(last: 100, isFork: true) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t      nodes {\n\t\t\t\t\t\t\t\t\t\t\t\t\t        url\n\t\t\t\t\t\t\t\t\t\t\t\t\t        parent {\n\t\t\t\t\t\t\t\t\t\t\t\t\t          nameWithOwner\n\t\t\t\t\t\t\t\t\t\t\t\t\t        }\n\t\t\t\t\t\t\t\t\t\t\t\t\t      }\n\t\t\t\t\t\t\t\t\t\t\t\t\t    }\n\t\t\t\t\t\t\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t\t\t\t\t\t\t}`;\n\t\t\t\t\t\t\t\t\t\treturn this.request(\"https://api.github.com/graphql\", {query: query}, \"POST\")\n\t\t\t\t\t\t\t\t\t\t.then(data => {\n\t\t\t\t\t\t\t\t\t\t\tlet repos = data.data.viewer.repositories.nodes;\n\n\t\t\t\t\t\t\t\t\t\t\tfor (let i in repos) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (repos[i].parent.nameWithOwner === repoInfo.full_name) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.switchToMyForkDialog(repos[i].url);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn repoInfo;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\treturn repoInfo;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse { // search forks of this repo\n\t\t\t\t\t\t\t\t\t\treturn this.request(repoInfo.forks_url)\n\t\t\t\t\t\t\t\t\t\t.then(forks => {\n\t\t\t\t\t\t\t\t\t\t\tfor (let i in forks) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (forks[i].owner.login === this.user.username) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.switchToMyForkDialog(forks[i].html_url);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn repoInfo;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treturn repoInfo;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn repoInfo;\n\t\t\t\t\t\t}).then(repoInfo => {\n\t\t\t\t\t\t\tconst env = { context: this, repoInfo };\n\n\t\t\t\t\t\t\tMavo.hooks.run(\"gh-after-login\", env);\n\n\t\t\t\t\t\t\treturn env.repoInfo;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t},\n\n\tcanPush: function() {\n\t\tif (this.repoInfo) {\n\t\t\treturn this.repoInfo.permissions.push;\n\t\t}\n\n\t\t// Repo does not exist so we can't check permissions\n\t\t// Just check if authenticated user is the same as our URL username\n\t\treturn this.user?.username?.toLowerCase() == this.username.toLowerCase();\n\t},\n\n\toAuthParams: () => \"&scope=repo\",\n\n\tlogout: function() {\n\t\treturn this.oAuthLogout().then(() => {\n\t\t\tthis.user = null;\n\t\t});\n\t},\n\n\tgetUser: function() {\n\t\tif (this.user) {\n\t\t\treturn Promise.resolve(this.user);\n\t\t}\n\n\t\treturn this.request(\"user\").then(info => {\n\t\t\tthis.user = {\n\t\t\t\tusername: info.login,\n\t\t\t\tname: info.name || info.login,\n\t\t\t\tavatar: info.avatar_url,\n\t\t\t\turl: \"https://github.com/\" + info.login,\n\t\t\t\tinfo\n\t\t\t};\n\n\t\t\t$.fire(this.mavo.element, \"mv-login\", { backend: this });\n\t\t});\n\t},\n\n\tgetURL: function(path = this.path, sha) {\n\t\tlet repoInfo = this.forkInfo || this.repoInfo;\n\t\tlet repo = repoInfo.full_name;\n\t\tpath = path.replace(/ /g, \"%20\");\n\n\t\trepoInfo.pagesInfo = repoInfo.pagesInfo || this.request(`repos/${repo}/pages`, {}, \"GET\", {\n\t\t\theaders: {\n\t\t\t\t\"Accept\": \"application/vnd.github.mister-fantastic-preview+json\"\n\t\t\t}\n\t\t});\n\n\t\treturn repoInfo.pagesInfo.then(pagesInfo => pagesInfo.html_url + path)\n\t\t\t.catch(xhr => {\n\t\t\t\t// No Github Pages, return jsdelivr URLs\n\t\t\t\treturn `https://cdn.jsdelivr.net/gh/${repo}@${sha || this.branch || \"latest\"}/${path}`;\n\t\t\t});\n\t},\n\n\tswitchToMyForkDialog: function(forkURL) {\n\t\t\tlet params = (new URL(location)).searchParams;\n\t\t\tparams.append(`${this.mavo.id}-storage`, forkURL + \"/\" + this.path);\n\n\t\t\tthis.notice = this.mavo.message(`\n\t\t\t${this.mavo._(\"gh-login-fork-options\")}\n\t\t\t<form onsubmit=\"return false\">\n\t\t\t\t<a href=\"${location.pathname}?${params}\"><button>${this.mavo._(\"gh-use-my-fork\")}</button></a>\n\t\t\t</form>`, {\n\t\t\t\tclasses: \"mv-inline\",\n\t\t\t\tdismiss: [\"button\", \"submit\"]\n\t\t\t});\n\n\t\t\tthis.notice.closed.then(form => {\n\t\t\t\tif (!form) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thistory.pushState({}, \"\", `${location.pathname}?${params}`);\n\t\t\t\tlocation.replace(`${location.pathname}?${params}`);\n\n\t\t\t});\n\t\t\treturn;\n\t},\n\n\tstatic: {\n\t\tapiDomain: \"https://api.github.com/\",\n\t\toAuth: \"https://github.com/login/oauth/authorize\",\n\t\tkey: \"7e08e016048000bc594e\",\n\n\t\ttest: function(url) {\n\t\t\turl = new URL(url, Mavo.base);\n\t\t\treturn /^((api\\.)?github\\.com|raw\\.githubusercontent\\.com)/.test(url.host);\n\t\t},\n\n\t\t/**\n\t\t * Parse Github URLs, return username, repo, branch, path\n\t\t */\n\t\tparseURL: function(source, defaults = {}) {\n\t\t\tconst ret = {};\n\n\t\t\t// Define computed properties as writable accessors\n\t\t\tObject.defineProperties(ret, {\n\t\t\t\t\"apiCall\": {\n\t\t\t\t\tget() {\n\t\t\t\t\t\tlet call = `repos/${this.username}/${this.repo}/${this.resources ?? \"contents\"}`;\n\n\t\t\t\t\t\tconst path = this.path;\n\t\t\t\t\t\tif (path) {\n\t\t\t\t\t\t\tcall += `/${path}`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Don't lose search params for raw API calls\n\t\t\t\t\t\treturn call + (this.apiParams ?? \"\");\n\t\t\t\t\t},\n\t\t\t\t\tset (v) {\n\t\t\t\t\t\tdelete this.apiCall;\n\t\t\t\t\t\tthis.apiCall = v;\n\t\t\t\t\t},\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true\n\t\t\t\t},\n\n\t\t\t\t\"path\": {\n\t\t\t\t\tget() {\n\t\t\t\t\t\tif (this.filename) {\n\t\t\t\t\t\t\treturn (this.filepath? this.filepath + \"/\" : \"\") + this.filename;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treturn this.filepath;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tset (v) {\n\t\t\t\t\t\tdelete this.path;\n\t\t\t\t\t\tthis.path = v;\n\t\t\t\t\t},\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst url = new URL(source, Mavo.base);\n\t\t\tlet path = url.pathname.slice(1).split(\"/\");\n\n\t\t\tret.username = path.shift();\n\t\t\tret.repo = path.shift() || defaults.repo;\n\n\t\t\tif (/raw.githubusercontent.com$/.test(url.host)) {\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\t\t\telse if (/api.github.com$/.test(url.host)) {\n\t\t\t\t// Raw API call\n\t\t\t\tdelete ret.username;\n\t\t\t\tdelete ret.repo;\n\n\t\t\t\tret.apiParams = url.search;\n\t\t\t\tret.apiData = Mavo.Functions.from(source, \"#\"); // url.* drops line breaks\n\n\t\t\t\tconst apiCall = url.pathname.slice(1) + ret.apiParams;\n\n\t\t\t\tif (apiCall == \"graphql\") {\n\t\t\t\t\tret.apiCall = apiCall;\n\t\t\t\t\tret.apiData = { query: ret.apiData };\n\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\n\t\t\t\tpath = url.pathname.slice(1).split(\"/\");\n\t\t\t\tconst firstSegment = path.shift();\n\n\t\t\t\tif (firstSegment != \"repos\") {\n\t\t\t\t\tret.apiCall = apiCall;\n\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\n\t\t\t\tret.username = path.shift();\n\t\t\t\tret.repo = path.shift();\n\t\t\t\tret.resources = path.shift();\n\t\t\t}\n\t\t\telse if (path[0] == \"blob\") {\n\t\t\t\tpath.shift();\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\n\t\t\tconst lastSegment = path[path.length - 1];\n\n\t\t\tif (/\\.\\w+$/.test(lastSegment)) {\n\t\t\t\tret.filename = lastSegment;\n\t\t\t\tpath.splice(path.length - 1, 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// If we work with a raw API call and couldn't find the filename in the path,\n\t\t\t\t// leave the filename blank\n\t\t\t\tret.filename = ret.hasOwnProperty(\"apiParams\")? \"\" : defaults.filename;\n\t\t\t}\n\n\t\t\tret.filepath = path.join(\"/\") || defaults.filepath || \"\";\n\n\t\t\treturn ret;\n\t\t},\n\n\t\t// Fix atob() and btoa() so they can handle Unicode\n\t\tbtoa: str => btoa(unescape(encodeURIComponent(str))),\n\t\tatob: str => decodeURIComponent(escape(window.atob(str)))\n\t}\n}));\n\n})(Bliss, Bliss.$);\n\nconsole.log(\"local\");\n\n//# sourceMappingURL=maps/mavo-nodeps.js.map\n\n//# sourceMappingURL=maps/mavo.js.map\n"],"names":["t","e","n","i","arguments","length","r","type","apply","this","o","s","Array","prototype","slice","call","splice","Object","getOwnPropertyDescriptor","writable","configurable","enumerable","get","set","defineProperty","forEach","a","test","toString","match","toLowerCase","isNaN","self","Bliss","document","querySelector","extend","overload","property","listeners","WeakMap","Map","original","addEventListener","EventTarget","Node","removeEventListener","sources","noop","$","Window","querySelectorAll","defined","create","tag","createElement","each","ready","readyState","once","Promise","Class","concat","keys","classProps","hasOwnProperty","constructor","__abstract","Error","indexOf","lazy","value","live","include","resolve","async","onload","parentNode","removeChild","onerror","src","inside","head","load","URL","location","href","loading","pathname","rel","fetch","TypeError","url","data","method","headers","xhr","XMLHttpRequest","toUpperCase","hooks","run","search","body","setAttribute","open","user","password","upload","console","error","map","c","setRequestHeader","u","removeAttribute","status","statusText","ontimeout","send","reduce","Hooks","add","isArray","context","Element","subject","bliss","setProps","transition","style","transitionDuration","transitionProperty","join","clearTimeout","setTimeout","bind","fire","createEvent","initEvent","dispatchEvent","handleEvent","capture","callback","trim","split","filter","push","className","unbind","when","toggleAttribute","setProperty","attributes","properties","events","delegate","target","closest","contents","createTextNode","appendChild","before","insertBefore","after","nextSibling","start","firstChild","around","all","element","array","shift","HTMLElement","C","U","w","k","index","description","O","S","j","A","P","true","false","null","L","B","operator","left","right","M","q","String","fromCharCode","J","p","charAt","charCodeAt","f","consequent","alternate","l","substr","h","prec","pop","d","v","b","argument","prefix","g","parseFloat","raw","x","name","y","m","computed","object","callee","elements","E","version","addUnaryOp","Math","max","addBinaryOp","addLiteral","removeUnaryOp","removeAllUnaryOps","removeBinaryOp","removeAllBinaryOps","removeLiteral","removeAllLiterals","exports","jsep","noConflict","module","parse","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","Stretchy","selectors","base","script","currentScript","resize","resizes","getComputedStyle","placeholder","nodeName","height","boxSizing","offsetHeight","clientHeight","minHeight","scrollHeight","width","offsetWidth","clientWidth","minWidth","scrollWidth","scrollLeft","selectedIndex","textContent","options","resizeAll","active","init","getAttribute","MutationObserver","observer","addedNodes","observe","documentElement","childList","subtree","$$","requestAnimationFrame","window","$$1","_","Mavo","treeBuilt","promise","dataLoaded","deleted","inProgress","id","attribute","deep","lang","getClosestAttribute","locale","Locale","autoEdit","classList","contains","autoSave","hasAttribute","autoSaveDelay","setAttributeShy","multiple","primitive","config","Primitive","getConfig","hasChildren","is","expressions","Expressions","observers","Observers","characterData","root","Group","permissions","Permissions","backendTypes","role","updateBackend","replace","includes","source","can","loginUrlParam","Functions","undefined","currentURL","searchParams","delete","history","replaceState","primaryBackend","login","evt","backend","storage","unsavedChanges","bar","UI","Bar","needsEdit","calculateNeedsEdit","setUnsavedChanges","onchange","action","edit","nodes","children","nodeloop","mode","node","previousMode","modes","getStyle","update","hash","getElementById","scrollIntoViewIfNeeded","then","debouncedSave","debounce","save","saved","key","superKey","altKey","preventDefault","editor","closestCollection","nextNode","getCousin","wrap","editing","focus","Actions","listener","assign","unobserve","getData","env","toJSON","message","Message","log","dismiss","render","remove","parent","toggle","done","walk","obj","changed","existing","roleAttributes","getAttributes","RegExp","fromEntries","equals","Backend","format","mavo","Boolean","catch","err","reject","defer","store","file","path","uploadBackend","lastSaved","Date","now","descentReturn","change","updateThrottled","setDeleted","destroy","deletionNotice","close","phrase","counts","ret","notice","click","undoDelete","classes","button","timeout","closed","undone","collection","_storage","_primaryBackend","uploads","static","navigator","platform","protocol","dependencies","Plugins","polyfillsNeeded","blissfuljs","from","Intl","IntersectionObserver","Symbol","prepend","flat","flatMap","polyfills","container","warn","Set","has","thenAll","iterable","resolved","res","rej","delay","symbol","specificProperty","group","childGroup","formControl","textInput","ui","tr","option","item","output","supported","inited","polyfillURL","attributeStartsWith","ownerElement","elem","readFile","reader","FileReader","result","onabort","JSON","stringify","safeToJSON","cache","WeakSet","isPlainObject","proto","getPrototypeOf","primitivify","valueOf","toPrimitive","objectify","toStringTag","toArray","arr","pushUnique","union","set1","set2","thing","getPropertyValue","elementData","elementPath","ancestor","acc","cur","last","offset","countNonElementSiblings","nodeType","sibling","unshift","revocably","insert","comment","isRemoved","replaceChild","commentText","createComment","restoreAttribute","previousValue","inView","getBoundingClientRect","bottom","innerHeight","top","innerWidth","rootMargin","entries","entry","intersectionRatio","stopPropagation","scrollIntoView","behavior","getTarget","XPath","query","doc","ownerDocument","evaluate","XPathResult","ANY_TYPE","iterateNext","str","regex","getAttributeNames","in","getCanonicalProperty","propertyL","subset","meta","clone","shallowClone","fn","code","timer","args","escapeRegExp","observeResize","callbackOrObserver","ResizeObserver","previousRect","ro","contentRect","Observer","attributeFilter","attributeOldValue","oldValue","characterDataOldValue","running","stop","flush","records","takeRecords","disconnect","pause","runOnResume","resume","rr","pair","BucketMap","arrays","iterator","values","updateTargetWithin","cl","el","super","self1","applyRecord","matchesRecord","attributeName","record","selector","find","_active","every","size","proxy","phrases","fallback","baseLang","default","vars","unique","getBaseLang","register","en","datalist","second","seconds","minute","minutes","hour","hours","day","days","week","weeks","month","months","year","years","import","export","logout","uploading","saving","filename","undo","loaded","plugins","plugin","response","json","repo","template","custom","controls","innerHTML","noResize","getControls","targetHeight","permission","condition","resizeObserver","title","prepare","cleanup","relative","ids","reverse","positive","lastIndexOf","negative","keep","drop","optional","html","avatar","mousedown","encodeURIComponent","tabIndex","input","files","readAsText","prop","mouseenter","closeTimeout","mouseleave","submit","duration","opacity","triggers","parentChanged","on","actions","off","cannot","able","or","prev","current","fireTriggers","trigger","oldParent","_parent","setter","previous","Formats","useCache","responseText","serialized","put","isAuthenticated","accessToken","oAuthParams","request","req","responseType","apiDomain","oAuthenticate","passive","localStorage","popup","min","screen","state","authPopup","oAuth","appid","token","oAuthLogout","removeItem","types","Remote","extends","Base","abstract","content","extensions","csv","Text","getNames","me","CSV","defaultOptions","header","dynamicTyping","skipEmptyLines","Papa","delimiter","linebreak","aborted","errors","unparse","Format","extension","uid","isHelperVariable","parentGroup","alias","copies","fromTemplate","getProperty","normalize","getPath","et","DOMExpression","originalAttribute","mavoNode","expressionText","isRoot","readable","liveData","route","postInit","expression","itembar","propagate","getLiveData","isDataNull","walker","walkUp","force","isProxy","pending","oldData","inPath","mainProperty","main","Collection","isDynamicObject","childrenNames","expressionsEnabled","dataRender","dataChanged","getClosestCollection","closestItem1","closestItem","getClosestItem","pathFrom","nodePath","getDescendant","distance","abs","direction","ind","relativePath","eval","expr","Expression","generatePropertyName","prioritizePrimitive","getClosest","_mode","_modes","_index","updateKey","_expressionsEnabled","getValueAttribute","collections","isCollection","ImplicitCollection","vocab","DEFAULT_TYPE","noWriteableProperty","wasPrimitive","copy","score","datatype","sort","prop1","prop2","propertyData","aliasesArr","currentAlias","Data","xmlVersion","initOnce","called","changeEvents","getValue","setValue","silent","label","pauseObserver","resumeObserver","originalEditorUpdated","editorValue","templateValue","_default","defaultSource","defaultExpression","keepTemplateValue","initialValue","emptyValue","originalEditor","setEditorValue","text","selected","disabled","editorDefaults","originalEditorObserver","_value","pausedObserver","observerPauses","savedValue","initEdit","cloneNode","editorUpdated","generateDefaultEditor","Elements","defaultConfig","updateEditType","editType","select","previousOriginalEditor","wasEditing","multiline","clipboardData","CRLF","lines","setRangeText","next","editItem","shiftKey","empty","bottomUp","Popup","show","isConnected","setText","contentExpression","exclude","oldDatatype","safeCast","activeElement","dataOnly","presentational","tempURL","createObjectURL","createUploadPopup","kind","ext","mainInput","checkType","paste","items","defaultName","prompt","getAsFile","dataTransfer","accept","TEXT_NODE","nodeValue","cast","useProperty","getText","isAttributeDefault","namespaceURI","formatNumber","_editor","replaceWith","_datatype","boolean","hide","numberFormat","NumberFormat","maximumFractionDigits","Infinity","observedAttributes","inputTypes","oldMvEdit","oldMvEditUnique","newName","position","bounds","pointDown","hidden","keyup","keyCode","transitionend","hideCallback","shown","append","defineProperties","parts","lastMatch","isSVG","string","number","media","details","selectedOptions","textarea","formNumber","handler","checkbox","radio","form","checked","toCheck","radioChanged","otherRadio","counter","clicked","range","step","clientX","newValue","mod","increment","block","cs","display","whiteSpace","normal","nowrap","time","dateFormat","datetime","dateTypes","dateType","defaultFormats","extract","date","circle","templateElement","marker","addButton","createAddButton","compareDocumentPosition","DOCUMENT_POSITION_FOLLOWING","like","candidates","likeNode","accepts","initialItems","itemTemplate","createItem","itemData","previousIndex","domexpression","unregister","undoable","move","preEdit","immediately","Itembar","doneItem","tagName","dragula","getDragula","fragment","createDocumentFragment","isCompatible","containers","isContainer","childNodes","some","child","moves","handle","previousElementSibling","lastElementChild","nextElementSibling","cancel","dragulas","promises","rendered","dragHandle","buttons","sticky","visible","instance","hideTimeout","DELAY","isWithinItem","relatedTarget","itemBar","stub","function","info","changedBy","identifiers","Script","compile","ast","Syntax","end","lastIndex","tokenize","exec","substring","syntax","ESCAPE","parsed","whitespace","splitText","lastChild","special","parentEnv","scope","_item","hasName","hasUnprefixedName","startsWith","event","$now","cancelAnimationFrame","clientY","traverse","scheduled","registeredApp","domexpresssion","THROTTLE","rootObject","updated","updateByIdThrottled","updateById","scheduledIds","exprs","skip","directives","ignore","segment","directive","_hidden","childProperties","parentIf","childIfs","parentValue","childIf","val","operators","canonicalProperty","eqIndex","passes","decodeURIComponent","first","numReturn","floor","condense","intersects","arr1","arr2","sum","$u","numbers","isAggregate","average","median","mi","m1","m2","ceil","atan2","dividend","divisor","multiValued","rightUnary","pow","exponent","imul","count","round","num","decimals","not","isFinite","toLocaleString","useGrouping","ordinal","ord","digits","minimumIntegerDigits","minimumFractionDigits","iff","iftrue","iffalse","objects","list","random","rand","steps","shuffle","haystack","needle","replacement","iterations","needleRegex","len","haystackType","starts","ends","glue","idify","identifier","$0","$1","$2","uppercase","lowercase","between","fromlast","to","tofirst","tight","i1","i2","needsContext","separator","$mouse","$hash","$alt","$evt","$ctrl","ctrlKey","$shift","$cmd","util","postProcess","newCallback","idxA","idxB","binaryOperation","scalar","groupedBy","$items","getOwnPropertyNames","operand","unaryOperation","numeric","getFullYear","getMonth","getDate","weekday","getDay","getHours","getMinutes","getSeconds","ms","getMilliseconds","$startup","$today","dateComponent","precision","localTimezone","getTimezoneOffset","msTo","what","unit","terms","timeLeft","units","unitMs","unitValue","unitProperPlurality","fixDateString","hasDate","hasTime","component","dateO","padStart","shortname","timezone","fields","$fn","Proxy","unscopables","nope","addUnaryOperator","unarySymbols","leftUnary","unary","leftDefault","rightDefault","comparison","addBinaryOperator","symbols","precedence","operands","getOperatorName","op","isComparisonOperator","operatorDefinition","isStatic","multiply","divide","addition","dateA","dateB","plus","subtract","minus","lte","getNumericalOperands","lt","gte","gt","eq","neq","and","concatenate","keyvalue","transformation","filters","postFlattenTransformation","haystacks","groupby","as","toNode","groups","$value","proxify","da","db","serializers","BinaryExpression","serialize","UnaryExpression","CallExpression","serializeScopeCall","ConditionalExpression","MemberExpression","pn","ArrayExpression","Literal","Identifier","ThisExpression","Compound","transformations","def","nodeLeft","comparisonOperands","operatorName","flatten","comparisonsHeterogeneous","co","rewrite","Function","withCode","subScope","$this","Reflect","LogicalExpression","compare","term","previousEvt","getNodes","ref","getNode","getCollection","datum","fromNodes","clear","itemsToDelete","clearif","targets","wasArray","nameif","rest","deleteif","_key","updateParent","computeRoutes","computeMetadata","isDeleted","shallow","oldKey","_data","propertyU","$property","isItem","closestArray","results","returnArray","findDown","findUp","propertyIsNumeric","computeRoute","up","traverseDown","$index","$item","$all","$next","nextClosestItem","$previous","prevClosestItem","fixShareURL","getURL","shareInfo","username","email","display_name","profile_photo_url","getUser","path_lower","host","hostname","defaults","parseURL","apiCall","apiData","branch","Accept","atob","dataURL","base64","isEncoded","fileInfo","commit","sha","repoCall","fileCall","commitPrefix","repoInfo","btoa","canPush","forkInfo","full_name","until","default_branch","public_repos","forks","repos","viewer","repositories","nameWithOwner","switchToMyForkDialog","forks_url","owner","html_url","avatar_url","pagesInfo","forkURL","params","pushState","resources","apiParams","filepath","lastSegment","unescape","escape"],"version":3,"file":"index.ba5775f7.js.map"}